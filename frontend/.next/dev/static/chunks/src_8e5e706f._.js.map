{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/components/forms/ProfileMenu.tsx"],"sourcesContent":["// src/components/ProfileMenu.tsx\r\n\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport {\r\n  User as UserIcon,\r\n  Settings,\r\n  LogOut,\r\n  HelpCircle,\r\n  Moon,\r\n  Sun,\r\n  ChevronDown,\r\n  Crown,\r\n  Bell,\r\n  Zap\r\n} from \"lucide-react\";\r\n\r\ntype Profile = {\r\n  avatarUrl?: string | null;\r\n  displayName?: string | null;\r\n};\r\n\r\ntype MeUser = {\r\n  id: string;\r\n  name?: string | null;\r\n  email?: string | null;\r\n  role?: string | null;\r\n  profile?: Profile | null;\r\n};\r\n\r\nexport default function ProfileMenu() {\r\n  const router = useRouter();\r\n  const ref = useRef<HTMLDivElement | null>(null);\r\n\r\n  const [user, setUser] = useState<MeUser | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isDarkMode, setIsDarkMode] = useState(false);\r\n\r\n  // load current user on mount\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      try {\r\n        const res = await fetch(\"/api/me\");\r\n        if (!res.ok) {\r\n          if (mounted) setUser(null);\r\n          return;\r\n        }\r\n        const json = await res.json().catch(() => null);\r\n        if (mounted && json?.ok && json.user) setUser(json.user as MeUser);\r\n      } catch (err) {\r\n        // ignore errors\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, []);\r\n\r\n  // click outside to close menu\r\n  useEffect(() => {\r\n    function onDoc(e: MouseEvent) {\r\n      if (!ref.current) return;\r\n      if (!ref.current.contains(e.target as Node)) setIsOpen(false);\r\n    }\r\n    document.addEventListener(\"mousedown\", onDoc);\r\n    return () => document.removeEventListener(\"mousedown\", onDoc);\r\n  }, []);\r\n\r\n  function initials(name?: string | null, email?: string | null) {\r\n    const source = name || email || \"U\";\r\n    return (source.trim().charAt(0) || \"U\").toUpperCase();\r\n  }\r\n\r\n  async function handleLogout() {\r\n    try {\r\n      await fetch(\"/api/auth/logout\", { method: \"POST\" }).catch(() => {});\r\n    } finally {\r\n      setUser(null);\r\n      router.push(\"/login\");\r\n    }\r\n  }\r\n\r\n  const menuItems = [\r\n    {\r\n      icon: UserIcon,\r\n      label: \"Profile\",\r\n      action: () => router.push(\"/account\"),\r\n      gradient: \"from-blue-500 to-cyan-500\"\r\n    },\r\n    {\r\n      icon: Settings,\r\n      label: \"Settings\",\r\n      action: () => router.push(\"/dashboard\"),\r\n      gradient: \"from-slate-500 to-slate-700\"\r\n    },\r\n    {\r\n      icon: Bell,\r\n      label: \"Notifications\",\r\n      action: () => console.log(\"Notifications clicked\"),\r\n      gradient: \"from-violet-500 to-purple-500\",\r\n      badge: 3\r\n    },\r\n    {\r\n      icon: HelpCircle,\r\n      label: \"Help & Support\",\r\n      action: () => console.log(\"Help clicked\"),\r\n      gradient: \"from-emerald-500 to-teal-500\"\r\n    },\r\n    {\r\n      icon: LogOut,\r\n      label: \"Sign Out\",\r\n      action: handleLogout,\r\n      gradient: \"from-rose-500 to-pink-500\",\r\n      danger: true\r\n    }\r\n  ];\r\n\r\n  const displayName = user?.profile?.displayName || user?.name || user?.email || (loading ? \"Loading...\" : \"Account\");\r\n\r\n  return (\r\n    <div ref={ref} className=\"relative\">\r\n      {/* Profile trigger button */}\r\n      <motion.button\r\n        onClick={() => setIsOpen((v) => !v)}\r\n        className=\"w-full flex items-center gap-3 p-3 rounded-xl hover:bg-slate-100 transition-all duration-200 group\"\r\n        whileHover={{ scale: 1.02 }}\r\n        whileTap={{ scale: 0.98 }}\r\n        aria-haspopup=\"true\"\r\n        aria-expanded={isOpen}\r\n      >\r\n        {/* Avatar with status indicator */}\r\n        <div className=\"relative flex-shrink-0\">\r\n          <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-600 via-cyan-500 to-emerald-500 flex items-center justify-center shadow-lg shadow-blue-500/30 overflow-hidden\">\r\n            {user?.profile?.avatarUrl ? (\r\n              // eslint-disable-next-line @next/next/no-img-element\r\n              <img src={user.profile.avatarUrl} alt=\"avatar\" className=\"w-full h-full object-cover\" />\r\n            ) : (\r\n              <div className=\"text-white font-semibold\">{initials(user?.name, user?.email)}</div>\r\n            )}\r\n          </div>\r\n          <motion.div\r\n            className=\"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-emerald-400 rounded-full border-2 border-white\"\r\n            animate={{ scale: [1, 1.2, 1] }}\r\n            transition={{ duration: 2, repeat: Infinity }}\r\n          />\r\n        </div>\r\n\r\n        {/* User info */}\r\n        <div className=\"flex-1 text-left min-w-0\">\r\n          <div className=\"text-sm font-semibold text-slate-800 truncate flex items-center gap-1.5\">\r\n            {displayName}\r\n            <Crown className=\"w-3.5 h-3.5 text-amber-500\" />\r\n          </div>\r\n          <div className=\"text-xs text-slate-500 truncate\">{user?.email || \"\"}</div>\r\n        </div>\r\n\r\n        {/* Dropdown indicator */}\r\n        <motion.div animate={{ rotate: isOpen ? 180 : 0 }} transition={{ duration: 0.3 }}>\r\n          <ChevronDown className=\"w-4 h-4 text-slate-400 group-hover:text-slate-600 transition-colors\" />\r\n        </motion.div>\r\n      </motion.button>\r\n\r\n      {/* Dropdown menu */}\r\n      <AnimatePresence>\r\n        {isOpen && (\r\n          <>\r\n            {/* Backdrop for mobile */}\r\n            <motion.div\r\n              className=\"fixed inset-0 z-40 lg:hidden\"\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n              onClick={() => setIsOpen(false)}\r\n            />\r\n\r\n            {/* Menu */}\r\n            <motion.div\r\n              initial={{ opacity: 0, y: 10, scale: 0.95 }}\r\n              animate={{ opacity: 1, y: 0, scale: 1 }}\r\n              exit={{ opacity: 0, y: 10, scale: 0.95 }}\r\n              transition={{ duration: 0.2 }}\r\n              className=\"absolute bottom-full left-0 right-0 mb-2 z-50 bg-white rounded-xl shadow-2xl border border-slate-200 overflow-hidden\"\r\n            >\r\n              {/* Pro badge */}\r\n              <div className=\"p-3 bg-gradient-to-r from-amber-50 to-orange-50 border-b border-amber-100\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center shadow-lg\">\r\n                    <Crown className=\"w-4 h-4 text-white\" />\r\n                  </div>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"text-xs font-bold text-amber-900\">Pro Member</div>\r\n                    <div className=\"text-[10px] text-amber-700\">Premium features unlocked</div>\r\n                  </div>\r\n                  <Zap className=\"w-4 h-4 text-amber-500\" />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Menu items */}\r\n              <div className=\"p-2\">\r\n                {menuItems.map((item, index) => {\r\n                  const Icon = item.icon as any;\r\n                  return (\r\n                    <motion.button\r\n                      key={item.label}\r\n                      initial={{ opacity: 0, x: -10 }}\r\n                      animate={{ opacity: 1, x: 0 }}\r\n                      transition={{ delay: index * 0.05 }}\r\n                      onClick={() => {\r\n                        item.action();\r\n                        setIsOpen(false);\r\n                      }}\r\n                      className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 group ${\r\n                        item.danger\r\n                          ? \"hover:bg-rose-50 text-rose-600\"\r\n                          : \"hover:bg-slate-50 text-slate-700\"\r\n                      }`}\r\n                      whileHover={{ x: 4 }}\r\n                    >\r\n                      <div className={`w-8 h-8 rounded-lg bg-gradient-to-br ${item.gradient} flex items-center justify-center shadow-sm`}>\r\n                        <Icon className=\"w-4 h-4 text-white\" />\r\n                      </div>\r\n                      <span className=\"flex-1 text-left\">{item.label}</span>\r\n                      {item.badge && (\r\n                        <span className=\"px-2 py-0.5 text-[10px] font-bold bg-rose-500 text-white rounded-full\">{item.badge}</span>\r\n                      )}\r\n                    </motion.button>\r\n                  );\r\n                })}\r\n              </div>\r\n\r\n              {/* Dark mode toggle */}\r\n              <div className=\"p-3 border-t border-slate-200 bg-slate-50\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-slate-600 to-slate-800 flex items-center justify-center shadow-sm\">\r\n                      {isDarkMode ? <Moon className=\"w-4 h-4 text-white\" /> : <Sun className=\"w-4 h-4 text-white\" />}\r\n                    </div>\r\n                    <span className=\"text-sm font-medium text-slate-700\">Dark Mode</span>\r\n                  </div>\r\n                  <motion.button\r\n                    onClick={() => setIsDarkMode(!isDarkMode)}\r\n                    className={`relative w-11 h-6 rounded-full transition-colors duration-300 ${\r\n                      isDarkMode ? \"bg-gradient-to-r from-blue-500 to-cyan-500\" : \"bg-slate-300\"\r\n                    }`}\r\n                    whileTap={{ scale: 0.95 }}\r\n                  >\r\n                    <motion.div\r\n                      className=\"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-md\"\r\n                      animate={{ x: isDarkMode ? 20 : 0 }}\r\n                      transition={{ type: \"spring\", stiffness: 500, damping: 30 }}\r\n                    />\r\n                  </motion.button>\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          </>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["React","useEffect","useRef","useState","motion","AnimatePresence","useRouter","User","UserIcon","Settings","LogOut","HelpCircle","Moon","Sun","ChevronDown","Crown","Bell","Zap","Profile","avatarUrl","displayName","MeUser","id","name","email","role","profile","ProfileMenu","router","ref","HTMLDivElement","user","setUser","loading","setLoading","isOpen","setIsOpen","isDarkMode","setIsDarkMode","mounted","load","res","fetch","ok","json","catch","err","onDoc","e","MouseEvent","current","contains","target","Node","document","addEventListener","removeEventListener","initials","source","trim","charAt","toUpperCase","handleLogout","method","push","menuItems","icon","label","action","gradient","console","log","badge","danger","v","scale","duration","repeat","Infinity","rotate","opacity","y","map","item","index","Icon","x","delay","type","stiffness","damping"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 540, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/components/ui/sidebar/Sidebar.tsx"],"sourcesContent":["// components/ui/sidebar/Sidebar.tsx\r\n\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport clsx from \"clsx\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n  LayoutDashboard,\r\n  Inbox,\r\n  Send,\r\n  Users,\r\n  BarChart3,\r\n  Settings,\r\n  Search,\r\n  Menu,\r\n  X,\r\n  ChevronRight,\r\n  Sparkles,\r\n  ArrowRight,\r\n  Calendar,\r\n  Clock,\r\n  Plus,\r\n  Clipboard,\r\n  Slack,\r\n  User,\r\n  CheckCircle,\r\n  Bell,\r\n  CalendarClock,\r\n} from \"lucide-react\";\r\nimport ProfileMenu from \"@/components/forms/ProfileMenu\";\r\n\r\n/**\r\n * Sidebar component that renders portal-specific navigation.\r\n *\r\n * Props:\r\n * - portal?: \"admin\" | \"manager\" | \"employee\" (default \"admin\")\r\n * - isOpen?: boolean (controlled mobile drawer)\r\n * - onClose?: () => void (callback when mobile drawer closes)\r\n * - hideToggle?: boolean (hide floating hamburger when true)\r\n *\r\n * Notes:\r\n * - Manager and Employee sidebars intentionally differ from Admin.\r\n * - The component includes an internal ScheduleModal used by Managers.\r\n * - Replace fetch endpoints (/api/...) to match your backend.\r\n */\r\n\r\ntype Portal = \"admin\" | \"manager\" | \"employee\" | undefined;\r\n\r\ntype Props = {\r\n  portal?: Portal;\r\n  isOpen?: boolean;\r\n  onClose?: () => void;\r\n  hideToggle?: boolean;\r\n};\r\n\r\ntype NavItem = {\r\n  id: string;\r\n  label: string;\r\n  href: string;\r\n  icon: React.ComponentType<any>;\r\n  gradient?: string;\r\n  badge?: number | null;\r\n};\r\n\r\nfunction formatPath(raw: string | null | undefined) {\r\n  if (!raw) return \"/\";\r\n  return raw === \"/\" ? \"/\" : raw.replace(/\\/+$/, \"\");\r\n}\r\n\r\n/* ------------------- Simple Schedule Modal (Manager-only) ------------------- */\r\nfunction ScheduleModal({\r\n  open,\r\n  onClose,\r\n  onCreated,\r\n  defaultOrganizer,\r\n}: {\r\n  open: boolean;\r\n  onClose: (success?: boolean) => void;\r\n  onCreated?: (data: any) => void;\r\n  defaultOrganizer?: string | null;\r\n}) {\r\n  const [organizer, setOrganizer] = useState(defaultOrganizer ?? \"\");\r\n  const [datetime, setDatetime] = useState(\"\");\r\n  const [reminder, setReminder] = useState<number>(10);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      setOrganizer(defaultOrganizer ?? \"\");\r\n      setDatetime(\"\");\r\n      setReminder(10);\r\n      setError(null);\r\n    }\r\n  }, [open, defaultOrganizer]);\r\n\r\n  const handleSubmit = async (e?: React.FormEvent) => {\r\n    e?.preventDefault();\r\n    setError(null);\r\n    if (!organizer || !datetime) {\r\n      setError(\"Please provide an organizer and meeting date/time.\");\r\n      return;\r\n    }\r\n    // Basic ISO date validation\r\n    const dt = new Date(datetime);\r\n    if (Number.isNaN(dt.getTime())) {\r\n      setError(\"Invalid date/time.\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      // POST to scheduling endpoint - adapt to your backend\r\n      const res = await fetch(\"/api/schedule/create\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ organizer, sendAt: dt.toISOString(), reminderMinutes: reminder }),\r\n        credentials: \"same-origin\",\r\n      });\r\n      const json = await res.json();\r\n      if (!res.ok) {\r\n        throw new Error(json?.message || \"Failed to schedule meeting\");\r\n      }\r\n      onCreated?.(json);\r\n      onClose(true);\r\n    } catch (err: any) {\r\n      setError(err?.message || \"Network error\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!open) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6\">\r\n      <div className=\"absolute inset-0 bg-black/40\" onClick={() => onClose(false)} />\r\n      <motion.div\r\n        initial={{ scale: 0.98, opacity: 0 }}\r\n        animate={{ scale: 1, opacity: 1 }}\r\n        transition={{ duration: 0.12 }}\r\n        className=\"relative w-full max-w-md bg-white rounded-2xl p-6 shadow-xl z-10\"\r\n      >\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h3 className=\"text-lg font-semibold\">Schedule meeting</h3>\r\n          <button className=\"p-1 rounded-md hover:bg-slate-100\" onClick={() => onClose(false)}>\r\n            <X className=\"w-4 h-4\" />\r\n          </button>\r\n        </div>\r\n\r\n        <form onSubmit={(e) => handleSubmit(e)} className=\"space-y-3\">\r\n          <div>\r\n            <label className=\"text-xs text-slate-600\">Organizer</label>\r\n            <input\r\n              value={organizer}\r\n              onChange={(e) => setOrganizer(e.target.value)}\r\n              className=\"w-full mt-1 p-2 border rounded-md text-sm\"\r\n              placeholder=\"Organizer name or email\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"text-xs text-slate-600\">Date & time</label>\r\n            <input\r\n              type=\"datetime-local\"\r\n              value={datetime}\r\n              onChange={(e) => setDatetime(e.target.value)}\r\n              className=\"w-full mt-1 p-2 border rounded-md text-sm\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"text-xs text-slate-600\">Reminder (before meeting)</label>\r\n            <select value={String(reminder)} onChange={(e) => setReminder(Number(e.target.value))} className=\"w-full mt-1 p-2 border rounded-md text-sm\">\r\n              {[10, 20, 30, 40, 50, 60].map((m) => (\r\n                <option key={m} value={m}>\r\n                  {m} minutes before\r\n                </option>\r\n              ))}\r\n            </select>\r\n            <p className=\"text-xs text-slate-400 mt-1\">Reminder will be scheduled as: meeting_time - reminder.</p>\r\n          </div>\r\n\r\n          {error && <div className=\"text-sm text-rose-600\">{error}</div>}\r\n\r\n          <div className=\"flex items-center justify-end gap-2 pt-2\">\r\n            <button type=\"button\" className=\"px-3 py-1 rounded-md text-sm\" onClick={() => onClose(false)} disabled={loading}>\r\n              Cancel\r\n            </button>\r\n            <button type=\"submit\" disabled={loading} className=\"px-4 py-2 rounded-md bg-slate-900 text-white text-sm flex items-center gap-2\">\r\n              {loading ? \"Scheduling…\" : \"Schedule\"}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ------------------- Sidebar Component ------------------- */\r\nexport default function Sidebar({ portal = \"admin\", isOpen: isOpenProp, onClose, hideToggle = false }: Props) {\r\n  const raw = usePathname();\r\n  const pathname = formatPath(raw);\r\n\r\n  // mobile open controlled/uncontrolled\r\n  const [internalOpen, setInternalOpen] = useState(false);\r\n  const openControlled = typeof isOpenProp === \"boolean\";\r\n  const open = openControlled ? isOpenProp! : internalOpen;\r\n  const setOpen = (next: boolean) => {\r\n    if (openControlled) {\r\n      if (!next && onClose) onClose();\r\n    } else {\r\n      setInternalOpen(next);\r\n      if (!next && onClose) onClose();\r\n    }\r\n  };\r\n\r\n  // UI state\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [hoveredItem, setHoveredItem] = useState<string | null>(null);\r\n  const closeBtnRef = useRef<HTMLButtonElement | null>(null);\r\n\r\n  // manager-specific state\r\n  const [scheduleOpen, setScheduleOpen] = useState(false);\r\n  const [teams, setTeams] = useState<Array<{ id: string; name: string }>>([]);\r\n  const [teamsLoading, setTeamsLoading] = useState(false);\r\n  const [currentTeamId, setCurrentTeamId] = useState<string | null>(null);\r\n\r\n  // keyboard esc to close\r\n  useEffect(() => {\r\n    function onEsc(e: KeyboardEvent) {\r\n      if (e.key === \"Escape\") setOpen(false);\r\n    }\r\n    window.addEventListener(\"keydown\", onEsc);\r\n    return () => window.removeEventListener(\"keydown\", onEsc);\r\n  }, [isOpenProp]);\r\n\r\n  useEffect(() => {\r\n    if (open) closeBtnRef.current?.focus();\r\n  }, [open]);\r\n\r\n  // Load teams for managers (only when manager portal active)\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    if (portal !== \"manager\") return;\r\n    setTeamsLoading(true);\r\n    (async () => {\r\n      try {\r\n        const res = await fetch(\"/api/dashboard/teams\", { credentials: \"same-origin\" });\r\n        if (!res.ok) {\r\n          setTeams([]);\r\n          return;\r\n        }\r\n        const json = await res.json();\r\n        const list = Array.isArray(json) ? json : json?.teams ?? [];\r\n        if (mounted) {\r\n          setTeams(list);\r\n          if (list.length > 0 && !currentTeamId) setCurrentTeamId(list[0].id);\r\n        }\r\n      } catch (e) {\r\n        if (mounted) setTeams([]);\r\n      } finally {\r\n        if (mounted) setTeamsLoading(false);\r\n      }\r\n    })();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [portal]);\r\n\r\n  /* ------------------- NAV CONFIGS ------------------- */\r\n  const NAV_ADMIN: NavItem[] = [\r\n    { id: \"overview\", label: \"Overview\", href: \"/dashboard/admin/overview\", icon: LayoutDashboard, gradient: \"from-blue-500 to-cyan-500\" },\r\n    { id: \"inbox\", label: \"Inbox\", href: \"/dashboard/admin/inbox\", icon: Inbox, gradient: \"from-emerald-500 to-teal-500\", badge: 12 },\r\n    { id: \"sent\", label: \"Sent\", href: \"/dashboard/admin/sent\", icon: Send, gradient: \"from-violet-500 to-purple-500\" },\r\n    { id: \"teams\", label: \"Teams\", href: \"/dashboard/admin/teams\", icon: Users, gradient: \"from-orange-500 to-rose-500\" },\r\n    { id: \"analytics\", label: \"Analytics\", href: \"/dashboard/admin/analytics\", icon: BarChart3, gradient: \"from-pink-500 to-rose-500\" },\r\n    { id: \"settings\", label: \"Settings\", href: \"/dashboard/admin/settings\", icon: Settings, gradient: \"from-slate-500 to-slate-700\" },\r\n  ];\r\n\r\n  const NAV_MANAGER: NavItem[] = [\r\n    { id: \"dashboard\", label: \"Dashboard\", href: \"/dashboard/manager/overview\", icon: LayoutDashboard, gradient: \"from-blue-500 to-cyan-500\" },\r\n    { id: \"team-inbox\", label: \"Team Inbox\", href: \"/dashboard/manager/TeamInbox\", icon: Inbox, gradient: \"from-emerald-500 to-teal-500\" },\r\n    \r\n    { id: \"tasks\", label: \"Tasks\", href: \"/dashboard/manager/Tasks\", icon: Clipboard, gradient: \"from-pink-500 to-rose-500\" },\r\n    { id: \"people\", label: \"People\", href: \"/dashboard/manager/People\", icon: User, gradient: \"from-teal-500 to-emerald-500\" },\r\n    { id: \"analytics\", label: \"Analytics\", href: \"/dashboard/manager/Analytics\", icon: BarChart3, gradient: \"from-pink-500 to-rose-500\" },\r\n    { id: \"settings\", label: \"Settings\", href: \"/dashboard/manager/settings\", icon: Settings, gradient: \"from-slate-500 to-slate-700\" },\r\n  ];\r\n\r\n  const NAV_EMPLOYEE: NavItem[] = [\r\n    { id: \"inbox\", label: \"Inbox\", href: \"/dashboard/employee/Inbox\", icon: Inbox, gradient: \"from-emerald-500 to-teal-500\" },\r\n    { id: \"my-tasks\", label: \"My Tasks\", href: \"/dashboard/employee/tasks\", icon: Clipboard, gradient: \"from-pink-500 to-rose-500\" },\r\n    { id: \"my-schedule\", label: \"My Schedule\", href: \"/dashboard/employee/schedule\", icon: Calendar, gradient: \"from-violet-500 to-purple-500\" },\r\n    {id:  \"my-team\", label: \"My Team\", href:\"/dashboard/employee/myteam\", icon: Users, gradient : \"from-emerald-500 to-teal-500\"},\r\n     ];\r\n\r\n  const NAV = portal === \"admin\" ? NAV_ADMIN : portal === \"manager\" ? NAV_MANAGER : NAV_EMPLOYEE;\r\n\r\n  /* ------------------- Active computation ------------------- */\r\n  const computeActive = (p: string | undefined | null) => {\r\n    const t = formatPath(p);\r\n    if (portal === \"admin\") {\r\n      if (t.startsWith(\"/dashboard/admin/overview\")) return \"overview\";\r\n      if (t.startsWith(\"/dashboard/admin/inbox\")) return \"inbox\";\r\n      if (t.startsWith(\"/dashboard/admin/sent\")) return \"sent\";\r\n      if (t.startsWith(\"/dashboard/admin/teams\")) return \"teams\";\r\n      if (t.startsWith(\"/dashboard/admin/analytics\")) return \"analytics\";\r\n      if (t.startsWith(\"/dashboard/admin/settings\")) return \"settings\";\r\n    } else if (portal === \"manager\") {\r\n      if (t.startsWith(\"/dashboard/manager/overview\")) return \"dashboard\";\r\n      if (t.startsWith(\"/dashboard/manager/inbox\")) return \"team-inbox\";\r\n      if (t.startsWith(\"/dashboard/manager/team\")) return \"my-team\";\r\n      if (t.startsWith(\"/dashboard/manager/schedule\")) return \"schedule\";\r\n      if (t.startsWith(\"/dashboard/manager/tasks\")) return \"tasks\";\r\n      if (t.startsWith(\"/dashboard/manager/people\")) return \"people\";\r\n      if (t.startsWith(\"/dashboard/manager/analytics\")) return \"analytics\";\r\n      if (t.startsWith(\"/dashboard/manager/settings\")) return \"settings\";\r\n    } else {\r\n      if (t.startsWith(\"/dashboard/employee/Inbox\")) return \"inbox\";\r\n      if (t.startsWith(\"/dashboard/employee/tasks\")) return \"my-tasks\";\r\n      if (t.startsWith(\"/dashboard/employee/schedule\")) return \"my-schedule\";\r\n      if (t.startsWith(\"/dashboard/employee/knowledge\")) return \"knowledge\";\r\n      if (t.startsWith(\"/dashboard/employee/profile\")) return \"profile\";\r\n    }\r\n    return undefined;\r\n  };\r\n\r\n  const activeId = computeActive(pathname);\r\n\r\n  const filteredNav = NAV.filter((it) => it.label.toLowerCase().includes(searchQuery.toLowerCase()));\r\n\r\n  /* ------------------- Sidebar content ------------------- */\r\n  const sidebarContent = (isMobile = false) => (\r\n    <div className=\"flex flex-col h-full\">\r\n      {/* Header */}\r\n      <div className=\"p-6 pb-4\">\r\n        <motion.div initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.36 }} className=\"flex items-center gap-3 mb-6\">\r\n          <div className=\"relative\">\r\n            <div className=\"w-11 h-11 rounded-xl bg-gradient-to-br from-blue-600 via-cyan-500 to-emerald-500 flex items-center justify-center text-white font-bold shadow-lg shadow-blue-500/30\">S</div>\r\n            <motion.div className=\"absolute -top-1 -right-1 w-3 h-3 bg-emerald-400 rounded-full border-2 border-white\" animate={{ scale: [1, 1.2, 1] }} transition={{ duration: 2, repeat: Infinity }} />\r\n          </div>\r\n\r\n          <div className=\"flex-1\">\r\n            <div className=\"text-base font-bold bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent\">SignalHub</div>\r\n            <div className=\"text-xs text-slate-500 font-medium flex items-center gap-1\">\r\n              <Sparkles className=\"w-3 h-3\" />\r\n              Unified Inbox\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n\r\n        {/* Manager team switcher (only visible to manager portal) */}\r\n        {portal === \"manager\" && (\r\n          <div className=\"mb-3\">\r\n            <label className=\"text-xs text-slate-500\">Team</label>\r\n            <div className=\"mt-2\">\r\n              {teamsLoading ? (\r\n                <div className=\"text-xs text-slate-400\">Loading teams…</div>\r\n              ) : (\r\n                <select value={currentTeamId ?? \"\"} onChange={(e) => setCurrentTeamId(e.target.value || null)} className=\"w-full p-2 rounded-md border text-sm\">\r\n                  {teams.length === 0 && <option value=\"\">No teams</option>}\r\n                  {teams.map((t) => (\r\n                    <option key={t.id} value={t.id}>\r\n                      {t.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Search */}\r\n        <motion.div className=\"relative group\" initial={{ opacity: 0, scale: 0.98 }} animate={{ opacity: 1, scale: 1 }} transition={{ duration: 0.32, delay: 0.06 }}>\r\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 group-focus-within:text-blue-500 transition-colors\" />\r\n          <input\r\n            aria-label=\"Search navigation\"\r\n            placeholder=\"Search...\"\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n            className=\"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 focus:bg-white transition-all duration-200\"\r\n          />\r\n        </motion.div>\r\n      </div>\r\n\r\n      {/* Navigation */}\r\n      <nav className=\"flex-1 px-3 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-300 scrollbar-track-transparent\" aria-label=\"Primary\">\r\n        <div className=\"space-y-1\">\r\n          {filteredNav.map((item, index) => {\r\n            const Icon = item.icon as any;\r\n            const isActive = activeId === item.id;\r\n            const isHovered = hoveredItem === item.id;\r\n\r\n            return (\r\n              <motion.div key={item.id} initial={{ opacity: 0, x: -18 }} animate={{ opacity: 1, x: 0 }} transition={{ duration: 0.28, delay: index * 0.03 }}>\r\n                <Link\r\n                  href={item.href}\r\n                  onClick={() => {\r\n                    if (isMobile) setOpen(false);\r\n                  }}\r\n                  onMouseEnter={() => setHoveredItem(item.id)}\r\n                  onMouseLeave={() => setHoveredItem(null)}\r\n                  className={clsx(\r\n                    \"relative flex items-center gap-3 px-3 py-3 rounded-xl text-sm font-medium transition-all duration-200 group\",\r\n                    isActive ? \"bg-gradient-to-r from-blue-50 to-cyan-50 text-blue-700 shadow-sm\" : \"text-slate-600 hover:bg-slate-50\"\r\n                  )}\r\n                  aria-current={isActive ? \"page\" : undefined}\r\n                >\r\n                  {isActive && (\r\n                    <motion.div layoutId=\"activeIndicator\" className=\"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-gradient-to-b from-blue-500 to-cyan-500 rounded-r-full\" transition={{ type: \"spring\", stiffness: 300, damping: 30 }} />\r\n                  )}\r\n\r\n                  <div className=\"relative\">\r\n                    <motion.div className={clsx(\"w-9 h-9 rounded-lg flex items-center justify-center transition-all duration-200\", isActive ? `bg-gradient-to-br ${item.gradient} shadow-lg` : \"bg-slate-100 group-hover:bg-slate-200\")} animate={isActive ? { scale: [1, 1.05, 1] } : {}}>\r\n                      <Icon className={clsx(\"w-4 h-4 transition-colors\", isActive ? \"text-white\" : \"text-slate-600\")} />\r\n                    </motion.div>\r\n\r\n                    {item.badge && (\r\n                      <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} className=\"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 bg-gradient-to-br from-rose-500 to-pink-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center shadow-lg\" aria-hidden=\"true\">\r\n                        {item.badge}\r\n                      </motion.div>\r\n                    )}\r\n                  </div>\r\n\r\n                  <span className=\"flex-1 text-left\">{item.label}</span>\r\n\r\n                  <motion.div initial={{ opacity: 0, x: -5 }} animate={{ opacity: isHovered && !isActive ? 1 : 0, x: isHovered && !isActive ? 0 : -5 }} transition={{ duration: 0.18 }} aria-hidden=\"true\">\r\n                    <ChevronRight className=\"w-4 h-4 text-slate-400\" />\r\n                  </motion.div>\r\n\r\n                  {isActive && (\r\n                    <motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ duration: 0.18 }}>\r\n                      <ArrowRight className=\"w-4 h-4 text-blue-600\" />\r\n                    </motion.div>\r\n                  )}\r\n                </Link>\r\n              </motion.div>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {/* Quick actions (portal specific) */}\r\n        <motion.div initial={{ opacity: 0, y: 8 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.36, delay: 0.18 }} className=\"mt-6 mb-4 px-3\">\r\n          <div className=\"mb-2 text-xs font-semibold text-slate-400 uppercase tracking-wider\">Quick Actions</div>\r\n\r\n          {portal === \"admin\" && (\r\n            <div className=\"p-4 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-xl text-white relative overflow-hidden group cursor-pointer hover:shadow-xl transition-shadow duration-300\">\r\n              <div className=\"relative\">\r\n                <div className=\"text-sm font-bold mb-1\">Invite managers</div>\r\n                <div className=\"text-xs opacity-90 mb-3\">Send an invite to a new manager</div>\r\n                <motion.div className=\"inline-flex items-center gap-1 text-xs font-semibold bg-white/20 backdrop-blur-sm px-3 py-1.5 rounded-lg\" whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>\r\n                  Invite <ArrowRight className=\"w-3 h-3\" />\r\n                </motion.div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {portal === \"manager\" && (\r\n            <>\r\n              <div className=\"flex gap-2\">\r\n                <button onClick={() => setScheduleOpen(true)} className=\"flex-1 inline-flex items-center justify-center gap-2 rounded-md bg-indigo-600 text-white px-3 py-2 text-sm hover:bg-indigo-700 transition\">\r\n                  <Calendar className=\"w-4 h-4\" /> Schedule meeting\r\n                </button>\r\n                <button className=\"inline-flex items-center gap-2 rounded-md border border-slate-200 px-3 py-2 text-sm\" onClick={() => {\r\n                  // client-side shortcut to create task - adapt to your create task flow\r\n                  window.location.href = \"/dashboard/manager/tasks/create\";\r\n                }}>\r\n                  <Plus className=\"w-4 h-4\" /> Task\r\n                </button>\r\n              </div>\r\n              <p className=\"text-xs text-slate-400 mt-2\">Quickly schedule meetings for your team or create tasks.</p>\r\n            </>\r\n          )}\r\n\r\n          {portal === \"employee\" && (\r\n            <>\r\n              <div className=\"flex gap-2\">\r\n                <button className=\"flex-1 inline-flex items-center justify-center gap-2 rounded-md bg-emerald-600 text-white px-3 py-2 text-sm hover:bg-emerald-700 transition\" onClick={() => {\r\n                  // start break / status toggle (demo client-side action)\r\n                  fetch(\"/api/me/status\", { method: \"POST\", credentials: \"same-origin\", body: JSON.stringify({ onBreak: true }) }).catch(() => {});\r\n                }}>\r\n                  <Clock className=\"w-4 h-4\" /> Start break\r\n                </button>\r\n                <button className=\"inline-flex items-center gap-2 rounded-md border border-slate-200 px-3 py-2 text-sm\" onClick={() => window.location.href = \"/dashboard/employee/notes/create\"}>\r\n                  <Plus className=\"w-4 h-4\" /> Note\r\n                </button>\r\n              </div>\r\n              <p className=\"text-xs text-slate-400 mt-2\">Set your status or jot down a quick note.</p>\r\n            </>\r\n          )}\r\n        </motion.div>\r\n      </nav>\r\n\r\n      {/* Profile section */}\r\n      <div className=\"p-4 border-t border-slate-200 bg-slate-50/50\">\r\n        <ProfileMenu />\r\n      </div>\r\n\r\n      {/* Schedule Modal (manager only) */}\r\n      {portal === \"manager\" && (\r\n        <ScheduleModal\r\n          open={scheduleOpen}\r\n          onClose={(success?: boolean) => {\r\n            setScheduleOpen(false);\r\n            if (success) {\r\n              // optional toast or action - simple page reload to refresh schedule\r\n              // window.location.reload();\r\n            }\r\n          }}\r\n          onCreated={() => {\r\n            // placeholder hook\r\n          }}\r\n          defaultOrganizer={undefined}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n\r\n  /* ------------------- Render root (desktop + mobile) ------------------- */\r\n  return (\r\n    <>\r\n      {/* Floating mobile hamburger toggle */}\r\n      {!hideToggle && (\r\n        <div className=\"lg:hidden fixed top-4 left-4 z-50\">\r\n          <motion.button\r\n            whileHover={{ scale: 1.05 }}\r\n            whileTap={{ scale: 0.95 }}\r\n            aria-label={open ? \"Close menu\" : \"Open menu\"}\r\n            onClick={() => setOpen(!open)}\r\n            className=\"p-3 rounded-xl bg-white shadow-lg shadow-slate-900/10 text-slate-700 border border-slate-200 backdrop-blur-sm\"\r\n          >\r\n            <AnimatePresence mode=\"wait\">\r\n              {open ? (\r\n                <motion.div key=\"close\" initial={{ rotate: -90, opacity: 0 }} animate={{ rotate: 0, opacity: 1 }} exit={{ rotate: 90, opacity: 0 }} transition={{ duration: 0.18 }}>\r\n                  <X className=\"w-5 h-5\" />\r\n                </motion.div>\r\n              ) : (\r\n                <motion.div key=\"menu\" initial={{ rotate: 90, opacity: 0 }} animate={{ rotate: 0, opacity: 1 }} exit={{ rotate: -90, opacity: 0 }} transition={{ duration: 0.18 }}>\r\n                  <Menu className=\"w-5 h-5\" />\r\n                </motion.div>\r\n              )}\r\n            </AnimatePresence>\r\n          </motion.button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Desktop fixed sidebar */}\r\n      <motion.aside initial={{ x: -12, opacity: 0 }} animate={{ x: 0, opacity: 1 }} transition={{ duration: 0.36 }} className=\"hidden lg:fixed lg:inset-y-0 lg:left-0 lg:flex lg:flex-col lg:w-72 lg:min-h-screen lg:border-r lg:border-slate-200 lg:bg-white/80 lg:backdrop-blur-xl z-30\" aria-hidden={false}>\r\n        {sidebarContent(false)}\r\n      </motion.aside>\r\n\r\n      {/* Mobile drawer */}\r\n      <AnimatePresence>\r\n        {open && (\r\n          <>\r\n            <motion.div className=\"fixed inset-0 z-40 bg-slate-900/60 backdrop-blur-sm\" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} transition={{ duration: 0.28 }} onClick={() => setOpen(false)} aria-hidden=\"true\" />\r\n\r\n            <motion.aside initial={{ x: \"-100%\", opacity: 0 }} animate={{ x: 0, opacity: 1 }} exit={{ x: \"-100%\", opacity: 0 }} transition={{ type: \"spring\", stiffness: 300, damping: 30 }} className=\"fixed inset-y-0 left-0 z-50 w-80 bg-white shadow-2xl\" role=\"dialog\" aria-modal=\"true\" aria-label=\"Main menu\">\r\n              <div className=\"absolute top-4 right-4 z-10\">\r\n                <motion.button ref={closeBtnRef} whileHover={{ scale: 1.1, rotate: 90 }} whileTap={{ scale: 0.9 }} className=\"p-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-700 transition-colors\" aria-label=\"Close menu\" onClick={() => setOpen(false)}>\r\n                  <X className=\"w-5 h-5\" />\r\n                </motion.button>\r\n              </div>\r\n\r\n              {sidebarContent(true)}\r\n            </motion.aside>\r\n          </>\r\n        )}\r\n      </AnimatePresence>\r\n    </>\r\n  );\r\n}\r\n"],"names":["React","useEffect","useRef","useState","Link","usePathname","clsx","motion","AnimatePresence","LayoutDashboard","Inbox","Send","Users","BarChart3","Settings","Search","Menu","X","ChevronRight","Sparkles","ArrowRight","Calendar","Clock","Plus","Clipboard","Slack","User","CheckCircle","Bell","CalendarClock","ProfileMenu","Portal","Props","portal","isOpen","onClose","hideToggle","NavItem","id","label","href","icon","ComponentType","gradient","badge","formatPath","raw","replace","ScheduleModal","open","onCreated","defaultOrganizer","success","data","organizer","setOrganizer","datetime","setDatetime","reminder","setReminder","loading","setLoading","error","setError","handleSubmit","e","FormEvent","preventDefault","dt","Date","Number","isNaN","getTime","res","fetch","method","headers","body","JSON","stringify","sendAt","toISOString","reminderMinutes","credentials","json","ok","Error","message","err","scale","opacity","duration","target","value","String","map","m","Sidebar","isOpenProp","pathname","internalOpen","setInternalOpen","openControlled","setOpen","next","searchQuery","setSearchQuery","hoveredItem","setHoveredItem","closeBtnRef","HTMLButtonElement","scheduleOpen","setScheduleOpen","teams","setTeams","Array","name","teamsLoading","setTeamsLoading","currentTeamId","setCurrentTeamId","onEsc","KeyboardEvent","key","window","addEventListener","removeEventListener","current","focus","mounted","list","isArray","length","NAV_ADMIN","NAV_MANAGER","NAV_EMPLOYEE","NAV","computeActive","p","t","startsWith","undefined","activeId","filteredNav","filter","it","toLowerCase","includes","sidebarContent","isMobile","y","repeat","Infinity","delay","item","index","Icon","isActive","isHovered","x","type","stiffness","damping","location","onBreak","catch","rotate"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 1933, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/hooks/useChatSocket.ts"],"sourcesContent":["// src/hooks/useChatSocket.ts\r\n\"use client\";\r\n\r\nimport { useEffect, useRef, useState, useCallback } from \"react\";\r\nimport { io, Socket } from \"socket.io-client\";\r\nimport type { Chat, Message, UserSummary } from \"@/types/chat\";\r\n\r\ntype EventHandlers = {\r\n  onChatCreated?: (chat: Chat) => void;\r\n  onMessageNew?: (message: Message) => void;\r\n  onChatMemberAdded?: (chatId: string, user: UserSummary) => void;\r\n  onChatMemberRemoved?: (chatId: string, userId: string) => void;\r\n  onTyping?: (chatId: string, userId: string, isTyping: boolean) => void;\r\n};\r\n\r\nexport default function useChatSocket(\r\n  token: string | null,\r\n  handlers: EventHandlers = {}\r\n) {\r\n  const socketRef = useRef<Socket | null>(null);\r\n  const [connected, setConnected] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!token) return;\r\n    // connect to socketio endpoint; server should accept cookie or token auth\r\n    const socket = io(\"/api/socketio\", {\r\n      autoConnect: true,\r\n      auth: { token },\r\n      path: \"/api/socketio\", // in case server uses default\r\n    });\r\n\r\n    socketRef.current = socket;\r\n\r\n    socket.on(\"connect\", () => setConnected(true));\r\n    socket.on(\"disconnect\", () => setConnected(false));\r\n\r\n    socket.on(\"chat:created\", (payload: { chat: Chat }) => {\r\n      handlers.onChatCreated?.(payload.chat);\r\n    });\r\n\r\n    socket.on(\"message:new\", (payload: { message: Message }) => {\r\n      handlers.onMessageNew?.(payload.message);\r\n    });\r\n\r\n    socket.on(\"chat:member:added\", (payload: { chatId: string; user: UserSummary }) => {\r\n      handlers.onChatMemberAdded?.(payload.chatId, payload.user);\r\n    });\r\n\r\n    socket.on(\"chat:member:removed\", (payload: { chatId: string; userId: string }) => {\r\n      handlers.onChatMemberRemoved?.(payload.chatId, payload.userId);\r\n    });\r\n\r\n    socket.on(\"typing\", (payload: { chatId: string; userId: string; isTyping: boolean }) => {\r\n      handlers.onTyping?.(payload.chatId, payload.userId, payload.isTyping);\r\n    });\r\n\r\n    return () => {\r\n      socket.disconnect();\r\n      socketRef.current = null;\r\n    };\r\n  }, [token]);\r\n\r\n  const joinChat = useCallback((chatId: string) => {\r\n    socketRef.current?.emit(\"chat:join\", { chatId });\r\n  }, []);\r\n\r\n  const leaveChat = useCallback((chatId: string) => {\r\n    socketRef.current?.emit(\"chat:leave\", { chatId });\r\n  }, []);\r\n\r\n  const sendMessage = useCallback((chatId: string, content: string) => {\r\n    // prefer REST POST to /api/chats/[chatId]/messages for persistence,\r\n    // but also emit via socket for low-latency if server supports it.\r\n    socketRef.current?.emit(\"message:send\", { chatId, content });\r\n  }, []);\r\n\r\n  const emitTyping = useCallback((chatId: string, isTyping: boolean) => {\r\n    socketRef.current?.emit(\"typing\", { chatId, isTyping });\r\n  }, []);\r\n\r\n  return {\r\n    socket: socketRef.current,\r\n    connected,\r\n    joinChat,\r\n    leaveChat,\r\n    sendMessage,\r\n    emitTyping,\r\n  };\r\n}\r\n"],"names":["useEffect","useRef","useState","useCallback","io","Socket","Chat","Message","UserSummary","EventHandlers","onChatCreated","chat","onMessageNew","message","onChatMemberAdded","chatId","user","onChatMemberRemoved","userId","onTyping","isTyping","useChatSocket","token","handlers","socketRef","connected","setConnected","socket","autoConnect","auth","path","current","on","payload","disconnect","joinChat","emit","leaveChat","sendMessage","content","emitTyping"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 2050, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/providers/ChatProvider.tsx"],"sourcesContent":["// src/providers/ChatProvider.tsx\r\n\"use client\";\r\n\r\nimport React, { createContext, useContext, useEffect, useMemo, useState } from \"react\";\r\nimport useChatSocket from \"@/hooks/useChatSocket\";\r\nimport type { Chat, Message, UserSummary } from \"@/types/chat\";\r\n\r\n/**\r\n * ChatProvider - holds chat list, active chat, unread counts, and provides helper actions.\r\n *\r\n * Usage:\r\n *  - Wrap your app (or dashboard pages) with <ChatProvider token={authToken}>...</ChatProvider>\r\n *  - Use useChat() hook to access chats, openChat(chatId), sendMessage, etc.\r\n */\r\n\r\ntype ChatContextValue = {\r\n  chats: Chat[];\r\n  setChats: (c: Chat[]) => void;\r\n  activeChatId: string | null;\r\n  openChat: (chatId: string) => void;\r\n  closeChat: () => void;\r\n  sendMessage: (chatId: string, content: string) => Promise<void>;\r\n  addMessageLocally: (message: Message) => void;\r\n  unreadTotal: number;\r\n  loading: boolean;\r\n};\r\n\r\nconst ChatContext = createContext<ChatContextValue | null>(null);\r\n\r\nexport function useChat() {\r\n  const ctx = useContext(ChatContext);\r\n  if (!ctx) throw new Error(\"useChat must be used within ChatProvider\");\r\n  return ctx;\r\n}\r\n\r\nexport function ChatProvider({ token, children }: { token: string | null; children: React.ReactNode }) {\r\n  const [chats, setChats] = useState<Chat[]>([]);\r\n  const [activeChatId, setActiveChatId] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const handlers = {\r\n    onChatCreated: (chat: Chat) => setChats((prev) => [chat, ...prev]),\r\n    onMessageNew: (message: Message) => {\r\n      // bump lastMessage + unread logic\r\n      setChats((prev) =>\r\n        prev.map((c) => {\r\n          if (c.id === message.chatId) {\r\n            const unread = (c.unreadCount ?? 0) + (activeChatId === c.id ? 0 : 1);\r\n            return { ...c, lastMessage: message, unreadCount: unread };\r\n          }\r\n          return c;\r\n        })\r\n      );\r\n    },\r\n    onChatMemberAdded: (chatId: string, user: UserSummary) => {\r\n      setChats((prev) => prev.map((c) => (c.id === chatId ? { ...c, members: [...(c.members ?? []), user] } : c)));\r\n    },\r\n    onChatMemberRemoved: (chatId: string, userId: string) => {\r\n      setChats((prev) => prev.map((c) => (c.id === chatId ? { ...c, members: (c.members ?? []).filter((m) => m.id !== userId) } : c)));\r\n    },\r\n  };\r\n\r\n  const { socket, connected, joinChat, leaveChat, sendMessage: socketSend } = useChatSocket(token, handlers);\r\n\r\n  // Fetch initial chat list\r\n  useEffect(() => {\r\n    if (!token) {\r\n      setChats([]);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    fetch(\"/api/chats\")\r\n      .then((r) => r.json())\r\n      .then((data) => {\r\n        if (data?.ok) {\r\n          setChats(data.chats || []);\r\n        } else {\r\n          setChats([]);\r\n        }\r\n      })\r\n      .catch(() => setChats([]))\r\n      .finally(() => setLoading(false));\r\n  }, [token]);\r\n\r\n  useEffect(() => {\r\n    // when opening activeChat, join via socket\r\n    if (activeChatId && socket) {\r\n      joinChat(activeChatId);\r\n    }\r\n    return () => {\r\n      if (activeChatId && socket) leaveChat(activeChatId);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [activeChatId]);\r\n\r\n  const openChat = (chatId: string) => {\r\n    setActiveChatId(chatId);\r\n    setChats((prev) => prev.map((c) => (c.id === chatId ? { ...c, unreadCount: 0 } : c)));\r\n  };\r\n\r\n  const closeChat = () => setActiveChatId(null);\r\n\r\n  const addMessageLocally = (message: Message) => {\r\n    setChats((prev) =>\r\n      prev.map((c) => (c.id === message.chatId ? { ...c, lastMessage: message } : c))\r\n    );\r\n  };\r\n\r\n  const sendMessage = async (chatId: string, content: string) => {\r\n    // Prefer REST API for durability and server ACLs; also emit socket for low latency.\r\n    try {\r\n      const res = await fetch(`/api/chats/${chatId}`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ content }),\r\n      });\r\n      const json = await res.json();\r\n      if (json?.ok && json?.message) {\r\n        // message will be broadcast by server; optionally also optimistically add\r\n        addMessageLocally(json.message);\r\n      } else {\r\n        // fallback to socket emit\r\n        socketSend(chatId, content);\r\n      }\r\n    } catch (e) {\r\n      // as fallback try socket\r\n      socketSend(chatId, content);\r\n    }\r\n  };\r\n\r\n  const unreadTotal = chats.reduce((sum, c) => sum + (c.unreadCount ?? 0), 0);\r\n\r\n  const ctxValue = useMemo(\r\n    () => ({\r\n      chats,\r\n      setChats,\r\n      activeChatId,\r\n      openChat,\r\n      closeChat,\r\n      sendMessage,\r\n      addMessageLocally,\r\n      unreadTotal,\r\n      loading,\r\n    }),\r\n    [chats, activeChatId, unreadTotal, loading]\r\n  );\r\n\r\n  return <ChatContext.Provider value={ctxValue}>{children}</ChatContext.Provider>;\r\n}\r\n"],"names":["c","_c","React","createContext","useContext","useEffect","useMemo","useState","useChatSocket","Chat","Message","UserSummary","ChatContextValue","chats","setChats","activeChatId","openChat","chatId","closeChat","sendMessage","content","Promise","addMessageLocally","message","unreadTotal","loading","ChatContext","useChat","$","$i","Symbol","for","ctx","Error","ChatProvider","token","children","ReactNode","setActiveChatId","setLoading","handlers","onChatCreated","chat","prev","onMessageNew","map","id","unread","unreadCount","lastMessage","onChatMemberAdded","user","members","onChatMemberRemoved","userId","filter","m","socket","connected","joinChat","leaveChat","socketSend","fetch","then","r","json","data","ok","catch","finally","res","method","headers","body","JSON","stringify","e","reduce","sum","ctxValue"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 2251, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/app/dashboard/ChatSocketProvider.tsx"],"sourcesContent":["// src/components/chat/ChatList.tsx\r\n\"use client\";\r\n\r\nimport React, {\r\n  useEffect,\r\n  useMemo,\r\n  useState,\r\n  useCallback,\r\n} from \"react\";\r\n// try to use your existing useChat provider if present (keeps backwards compatibility)\r\nimport { useChat as useChatProvider } from \"@/providers/ChatProvider\";\r\nimport { useChatSocket } from \"@/app/dashboard/ChatSocketProvider\";\r\n\r\ntype MinimalUser = {\r\n  id: string;\r\n  name?: string | null;\r\n  email?: string | null;\r\n  role?: string | null;\r\n};\r\n\r\ntype LocalChat = {\r\n  id: string;\r\n  name?: string | null;\r\n  type?: string; // \"GROUP\" | \"PRIVATE\" | \"TEAM\" | \"DIRECT\"\r\n  lastMessage?: { content: string; createdAt: string } | null;\r\n  unreadCount?: number | null;\r\n  teamId?: string | null;\r\n  meta?: any;\r\n  members?: MinimalUser[] | null;\r\n};\r\n\r\nfunction normalizeMembers(raw: any): MinimalUser[] | undefined {\r\n  if (!raw) return undefined;\r\n  const arr = Array.isArray(raw) ? raw : [];\r\n  const mapped = arr\r\n    .map((m) => {\r\n      if (!m) return null;\r\n      // backend normalizeChat gives: { id, name, email, role }\r\n      const id =\r\n        m.id ??\r\n        m.userId ??\r\n        m.user?.id ??\r\n        m.user?._id ??\r\n        null;\r\n      const name =\r\n        m.name ??\r\n        m.displayName ??\r\n        m.user?.name ??\r\n        null;\r\n      const email = m.email ?? m.user?.email ?? null;\r\n      const role = m.role ?? m.user?.role ?? null;\r\n      if (!id) return null;\r\n      return {\r\n        id: String(id),\r\n        name,\r\n        email,\r\n        role,\r\n      } as MinimalUser;\r\n    })\r\n    .filter(Boolean) as MinimalUser[];\r\n\r\n  return mapped.length ? mapped : undefined;\r\n}\r\n\r\n/**\r\n * Derive a per-user display name:\r\n * - DIRECT / PRIVATE → show the \"other person\" for this user\r\n * - TEAM / GROUP    → server name or Team <id>\r\n * - fallback        → \"Chat <id>\"\r\n */\r\nfunction deriveDisplayName(\r\n  chat: LocalChat,\r\n  me: MinimalUser | null\r\n): string {\r\n  const rawType = (chat.type ?? \"\").toString().toLowerCase();\r\n  const serverName =\r\n    chat.name ?? chat.meta?.name ?? \"\";\r\n  const isGeneric =\r\n    !serverName ||\r\n    serverName === \"Chat\" ||\r\n    serverName.startsWith(\"Chat \");\r\n\r\n  const isDirect =\r\n    rawType === \"direct\" ||\r\n    rawType === \"private\" ||\r\n    rawType === \"dm\";\r\n\r\n  if (isDirect) {\r\n    const candidates =\r\n      chat.members ??\r\n      normalizeMembers(chat.meta?.members) ??\r\n      normalizeMembers(chat.meta?.participants);\r\n\r\n    if (\r\n      candidates &&\r\n      candidates.length > 0 &&\r\n      me?.id\r\n    ) {\r\n      const other = candidates.find(\r\n        (p) => String(p.id) !== String(me.id)\r\n      );\r\n      if (other) {\r\n        if (other.name) return other.name;\r\n        if (other.email) return other.email;\r\n      }\r\n    }\r\n\r\n    if (!isGeneric && serverName) return serverName;\r\n    return \"Direct chat\";\r\n  }\r\n\r\n  const isTeamOrGroup =\r\n    rawType === \"team\" || rawType === \"group\";\r\n\r\n  if (!isGeneric && serverName) return serverName;\r\n\r\n  if (isTeamOrGroup) {\r\n    return chat.name\r\n      ? chat.name\r\n      : `Team ${chat.teamId ?? chat.id}`;\r\n  }\r\n\r\n  return serverName || `Chat ${chat.id}`;\r\n}\r\n\r\nfunction ChatRow({\r\n  chat,\r\n  onOpen,\r\n  currentUser,\r\n}: {\r\n  chat: LocalChat;\r\n  onOpen: (id: string) => void;\r\n  currentUser: MinimalUser | null;\r\n}) {\r\n  const typeLabel = (chat.type ?? \"\")\r\n    .toString()\r\n    .toUpperCase();\r\n  const isGroupLike =\r\n    typeLabel.includes(\"GROUP\") ||\r\n    typeLabel.includes(\"TEAM\");\r\n  const displayName = deriveDisplayName(\r\n    chat,\r\n    currentUser\r\n  );\r\n\r\n  return (\r\n    <button\r\n      className=\"w-full text-left p-3 hover:bg-slate-50 flex items-center gap-3\"\r\n      onClick={() => onOpen(chat.id)}\r\n    >\r\n      <div className=\"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden\">\r\n        {isGroupLike ? <span>👥</span> : <span>💬</span>}\r\n      </div>\r\n      <div className=\"flex-1\">\r\n        <div className=\"flex justify-between\">\r\n          <div className=\"font-medium text-sm truncate\">\r\n            {displayName}\r\n          </div>\r\n          <div className=\"text-xs text-gray-500\">\r\n            {chat.lastMessage\r\n              ? new Date(\r\n                  chat.lastMessage.createdAt\r\n                ).toLocaleTimeString()\r\n              : \"\"}\r\n          </div>\r\n        </div>\r\n        <div className=\"text-xs text-gray-600 truncate\">\r\n          {chat.lastMessage?.content ??\r\n            \"No messages yet\"}\r\n        </div>\r\n      </div>\r\n      {chat.unreadCount ? (\r\n        <div className=\"ml-3 text-sm px-2 py-1 bg-blue-600 text-white rounded-full\">\r\n          {chat.unreadCount}\r\n        </div>\r\n      ) : null}\r\n    </button>\r\n  );\r\n}\r\n\r\n/**\r\n * ChatList\r\n *\r\n * Optional prop:\r\n *  - onOpen?: (chatId: string) => void    // if parent wants to handle opening\r\n *\r\n * Behavior:\r\n *  - If parent doesn't pass onOpen, ChatList will try to use useChatProvider()?.openChat()\r\n *    (keeps compatibility with existing provider-based flow).\r\n *  - Maintains local list of chats fetched from /api/chats and updates realtime via socket.\r\n *  - For DIRECT chats, the display name is computed per user from members.\r\n */\r\nexport default function ChatList({\r\n  onOpen,\r\n}: {\r\n  onOpen?: (id: string) => void;\r\n}) {\r\n  // Try to use existing ChatProvider (if your app already has one). It may return { chats, openChat, loading }\r\n  let chatProvider: any = null;\r\n  try {\r\n    chatProvider = useChatProvider?.();\r\n  } catch {\r\n    chatProvider = null;\r\n  }\r\n\r\n  const socket = useChatSocket();\r\n  const [chats, setChats] = useState<LocalChat[]>([]);\r\n  const [loading, setLoading] =\r\n    useState<boolean>(true);\r\n  const [error, setError] = useState<string | null>(\r\n    null\r\n  );\r\n  const [currentUser, setCurrentUser] =\r\n    useState<MinimalUser | null>(null);\r\n\r\n  // load current user (for \"other person\" name)\r\n  const loadMe = useCallback(async () => {\r\n    try {\r\n      const res = await fetch(\"/api/me\", {\r\n        credentials: \"same-origin\",\r\n      });\r\n      if (!res.ok) return;\r\n      const j = await res.json().catch(() => ({}));\r\n      const u = j?.user ?? null;\r\n      if (u && u.id) {\r\n        setCurrentUser({\r\n          id: String(u.id),\r\n          name: u.name ?? null,\r\n          email: u.email ?? null,\r\n          role: u.role ?? null,\r\n        });\r\n      }\r\n    } catch {\r\n      // non-fatal\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadMe();\r\n  }, [loadMe]);\r\n\r\n  // load chats from api (same endpoint pages use)\r\n  const loadChats = useCallback(async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await fetch(\"/api/chats\", {\r\n        credentials: \"same-origin\",\r\n      });\r\n      if (!res.ok)\r\n        throw new Error(`HTTP ${res.status}`);\r\n      const j = await res.json();\r\n      const payload = (j?.chats ?? []) as any[];\r\n\r\n      const normalized: LocalChat[] = payload.map(\r\n        (c) => ({\r\n          id: c.id,\r\n          name: c.name ?? null,\r\n          type: (c.type ?? c.chatType ?? null) as\r\n            | string\r\n            | undefined,\r\n          lastMessage: c.lastMessage\r\n            ? {\r\n                content:\r\n                  c.lastMessage.content ?? \"\",\r\n                createdAt:\r\n                  c.lastMessage.createdAt ??\r\n                  new Date().toISOString(),\r\n              }\r\n            : c.lastMessageAt\r\n            ? {\r\n                content: \"\",\r\n                createdAt: c.lastMessageAt,\r\n              }\r\n            : null,\r\n          unreadCount:\r\n            typeof c.unreadCount === \"number\"\r\n              ? c.unreadCount\r\n              : 0,\r\n          teamId: c.teamId ?? null,\r\n          meta: c.meta ?? c ?? null,\r\n          members: normalizeMembers(\r\n            c.members ?? c.participants\r\n          ) ?? null,\r\n        })\r\n      );\r\n\r\n      setChats(normalized);\r\n    } catch (err: any) {\r\n      console.warn(\r\n        \"ChatList: failed to load chats\",\r\n        err\r\n      );\r\n      setError(\"Could not load chats\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // If a ChatProvider is present and exposes chats, use it as source of truth\r\n    if (\r\n      chatProvider &&\r\n      Array.isArray(chatProvider.chats) &&\r\n      typeof chatProvider.loading !== \"undefined\"\r\n    ) {\r\n      const mapped: LocalChat[] = (\r\n        chatProvider.chats ?? []\r\n      ).map((c: any) => ({\r\n        id: c.id,\r\n        name: c.name ?? null,\r\n        type: c.type ?? null,\r\n        lastMessage: c.lastMessage\r\n          ? {\r\n              content:\r\n                c.lastMessage.content ?? \"\",\r\n              createdAt:\r\n                c.lastMessage.createdAt ??\r\n                new Date().toISOString(),\r\n            }\r\n          : null,\r\n        unreadCount:\r\n          typeof c.unreadCount === \"number\"\r\n            ? c.unreadCount\r\n            : 0,\r\n        teamId: c.teamId ?? null,\r\n        meta: c.meta ?? c ?? null,\r\n        members: normalizeMembers(\r\n          c.members ?? c.participants\r\n        ) ?? null,\r\n      }));\r\n\r\n      setChats(mapped);\r\n      setLoading(Boolean(chatProvider.loading));\r\n      return;\r\n    }\r\n\r\n    // Otherwise fetch from API\r\n    loadChats();\r\n  }, [chatProvider, loadChats]);\r\n\r\n  // Socket handlers: keep the list realtime\r\n  useEffect(() => {\r\n    if (!socket) return;\r\n\r\n    const handleTeamCreated = (payload: any) => {\r\n      const chatPayload =\r\n        payload?.chat ??\r\n        (payload?.team\r\n          ? {\r\n              id: payload.team.id,\r\n              name: payload.team.name,\r\n              teamId: payload.team.id,\r\n              members:\r\n                payload.team.members ??\r\n                payload.chat?.members ??\r\n                null,\r\n            }\r\n          : null);\r\n      if (!chatPayload) return;\r\n      setChats((prev) => {\r\n        if (\r\n          prev.find(\r\n            (p) => p.id === chatPayload.id\r\n          )\r\n        )\r\n          return prev;\r\n        const newRow: LocalChat = {\r\n          id: chatPayload.id,\r\n          name:\r\n            chatPayload.name ??\r\n            `Team ${chatPayload.teamId ?? \"\"}`,\r\n          type: \"GROUP\",\r\n          lastMessage: null,\r\n          unreadCount: 0,\r\n          teamId: chatPayload.teamId ?? null,\r\n          members:\r\n            normalizeMembers(\r\n              chatPayload.members\r\n            ) ?? null,\r\n        };\r\n        return [newRow, ...prev];\r\n      });\r\n    };\r\n\r\n    const handleChatMessage = (payload: any) => {\r\n      const chatId =\r\n        payload?.chatId ?? payload?.chat?.id ?? null;\r\n      if (!chatId) return;\r\n      const text =\r\n        payload?.message?.content ??\r\n        payload?.content ??\r\n        \"\";\r\n      const createdAt =\r\n        payload?.message?.createdAt ??\r\n        new Date().toISOString();\r\n      const membersFromPayload =\r\n        payload?.chat?.members ??\r\n        payload?.chat?.participants ??\r\n        null;\r\n\r\n      // update existing chat\r\n      setChats((prev) =>\r\n        prev.map((c) => {\r\n          if (c.id !== chatId) return c;\r\n          return {\r\n            ...c,\r\n            lastMessage: {\r\n              content: text,\r\n              createdAt,\r\n            },\r\n            unreadCount:\r\n              (c.unreadCount ?? 0) + 1,\r\n            members:\r\n              c.members ??\r\n              (normalizeMembers(\r\n                membersFromPayload\r\n              ) ?? null),\r\n          };\r\n        })\r\n      );\r\n\r\n      // if chat not present, add a stub\r\n      setChats((prev) => {\r\n        if (prev.find((c) => c.id === chatId))\r\n          return prev;\r\n        const stub: LocalChat = {\r\n          id: chatId,\r\n          name:\r\n            payload?.chat?.name ??\r\n            `Chat ${chatId}`,\r\n          type:\r\n            payload?.chat?.type ?? \"DIRECT\",\r\n          lastMessage: {\r\n            content: text,\r\n            createdAt,\r\n          },\r\n          unreadCount: 1,\r\n          teamId: payload?.chat?.teamId ?? null,\r\n          meta: payload?.chat ?? null,\r\n          members:\r\n            normalizeMembers(\r\n              membersFromPayload\r\n            ) ?? null,\r\n        };\r\n        return [stub, ...prev];\r\n      });\r\n    };\r\n\r\n    socket.on(\"team:created\", handleTeamCreated);\r\n    socket.on(\"chat:message\", handleChatMessage);\r\n\r\n    return () => {\r\n      socket.off(\"team:created\", handleTeamCreated);\r\n      socket.off(\"chat:message\", handleChatMessage);\r\n    };\r\n  }, [socket]);\r\n\r\n  // openChat handler — use parent prop if provided, otherwise fall back to chatProvider.openChat()\r\n  const handleOpen = useCallback(\r\n    async (id: string) => {\r\n      try {\r\n        try {\r\n          await socket.joinChat?.(id);\r\n        } catch {}\r\n\r\n        if (typeof onOpen === \"function\") {\r\n          onOpen(id);\r\n          return;\r\n        }\r\n\r\n        if (\r\n          chatProvider &&\r\n          typeof chatProvider.openChat ===\r\n            \"function\"\r\n        ) {\r\n          chatProvider.openChat(id);\r\n          return;\r\n        }\r\n\r\n        if (typeof window !== \"undefined\") {\r\n          try {\r\n            window.history.pushState(\r\n              {},\r\n              \"\",\r\n              `${window.location.pathname}?chatId=${encodeURIComponent(\r\n                id\r\n              )}`\r\n            );\r\n          } catch {}\r\n        }\r\n      } catch {\r\n        // ignore\r\n      }\r\n    },\r\n    [onOpen, chatProvider, socket]\r\n  );\r\n\r\n  if (loading)\r\n    return (\r\n      <div className=\"p-4\">\r\n        Loading chats…\r\n      </div>\r\n    );\r\n  if (error)\r\n    return (\r\n      <div className=\"p-4 text-sm text-red-600\">\r\n        {error}\r\n      </div>\r\n    );\r\n  if (!chats.length)\r\n    return (\r\n      <div className=\"p-4 text-sm text-gray-600\">\r\n        No chats yet\r\n      </div>\r\n    );\r\n\r\n  return (\r\n    <div className=\"divide-y border-r\">\r\n      {chats.map((c) => (\r\n        <ChatRow\r\n          key={c.id}\r\n          chat={c}\r\n          onOpen={handleOpen}\r\n          currentUser={currentUser}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["c","_c","React","useEffect","useMemo","useState","useCallback","useChat","useChatProvider","useChatSocket","MinimalUser","id","name","email","role","LocalChat","type","lastMessage","content","createdAt","unreadCount","teamId","meta","members","normalizeMembers","raw","undefined","arr","Array","isArray","mapped","map","m","userId","user","_id","displayName","String","filter","Boolean","length","deriveDisplayName","chat","me","rawType","toString","toLowerCase","serverName","isGeneric","startsWith","isDirect","candidates","participants","other","find","p","isTeamOrGroup","ChatRow","t0","$","$i","Symbol","for","onOpen","currentUser","t1","t2","typeLabel","toUpperCase","includes","isGroupLike","t3","t4","ChatRow[<button>.onClick]","t5","t6","t7","Date","toLocaleTimeString","t8","t9","t10","t11","t12","t13","t14","ChatList","chatProvider","socket","chats","setChats","loading","setLoading","error","setError","setCurrentUser","loadMe","res","fetch","credentials","ok","j","json","catch","u","loadChats","Error","status","payload","normalized","chatType","toISOString","lastMessageAt","err","console","warn","handleTeamCreated","chatPayload","team","prev","newRow","handleChatMessage","chatId","text","message","membersFromPayload","stub","on","off","handleOpen","joinChat","openChat","window","history","pushState","location","pathname","encodeURIComponent"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 2818, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/app/dashboard/layout.tsx"],"sourcesContent":["// app/dashboard/layout.tsx\r\n\"use client\";\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport type { ReactNode } from \"react\";\r\nimport Sidebar from \"@/components/ui/sidebar/Sidebar\";\r\nimport { ChatSocketProvider } from \"./ChatSocketProvider\";   // ⬅️ added import\r\n\r\ntype MeResponse = {\r\n  ok?: boolean;\r\n  role?: string;\r\n  user?: { id?: string; email?: string; role?: string; organizationId?: string; organizationName?: string };\r\n};\r\n\r\nexport default function DashboardLayout({ children }: { children: ReactNode }) {\r\n  const [loading, setLoading] = useState(true);\r\n  const [role, setRole] = useState<string | null>(null);\r\n  const [orgName, setOrgName] = useState<string | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // determine portal from role\r\n  const portal = role === \"ADMIN\" ? \"admin\" : role === \"MANAGER\" ? \"manager\" : \"employee\";\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    setLoading(true);\r\n    (async () => {\r\n      try {\r\n        const res = await fetch(\"/api/me\", { credentials: \"include\" });\r\n        if (!res.ok) {\r\n          if (mounted) {\r\n            setRole(null);\r\n            setOrgName(null);\r\n            setError(\"Not authenticated\");\r\n            setLoading(false);\r\n          }\r\n          return;\r\n        }\r\n        const j: MeResponse = await res.json().catch(() => ({}));\r\n        const r = (j?.role ?? j?.user?.role ?? null) as string | null;\r\n        const org = (j?.user?.organizationName ?? null) as string | null;\r\n        if (mounted) {\r\n          setRole(r ? String(r).toUpperCase() : null);\r\n          setOrgName(org);\r\n          setError(null);\r\n          setLoading(false);\r\n        }\r\n      } catch (err: any) {\r\n        if (mounted) {\r\n          setError(err?.message || String(err));\r\n          setLoading(false);\r\n        }\r\n      }\r\n    })();\r\n\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, []);\r\n\r\n  // Loading skeleton\r\n  if (loading) {\r\n    return (\r\n      <ChatSocketProvider>\r\n        <div className=\"min-h-screen flex bg-slate-50\">\r\n          <aside className=\"w-72 p-6\">\r\n            <div className=\"h-8 w-36 rounded-lg bg-slate-200 animate-pulse mb-6\" />\r\n            <div className=\"space-y-3\">\r\n              <div className=\"h-10 rounded-lg bg-slate-200 animate-pulse\" />\r\n              <div className=\"h-10 rounded-lg bg-slate-200 animate-pulse\" />\r\n              <div className=\"h-10 rounded-lg bg-slate-200 animate-pulse\" />\r\n              <div className=\"h-10 rounded-lg bg-slate-200 animate-pulse\" />\r\n            </div>\r\n          </aside>\r\n\r\n          <div className=\"flex-1 p-6\">\r\n            <div className=\"h-8 w-1/3 rounded bg-slate-200 animate-pulse mb-4\" />\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n              <div className=\"lg:col-span-2 space-y-4\">\r\n                <div className=\"h-44 rounded bg-slate-200 animate-pulse\" />\r\n                <div className=\"h-44 rounded bg-slate-200 animate-pulse\" />\r\n              </div>\r\n              <div className=\"space-y-4\">\r\n                <div className=\"h-28 rounded bg-slate-200 animate-pulse\" />\r\n                <div className=\"h-28 rounded bg-slate-200 animate-pulse\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </ChatSocketProvider>\r\n    );\r\n  }\r\n\r\n  // Not signed in\r\n  if (!role) {\r\n    return (\r\n      <ChatSocketProvider>\r\n        <div className=\"min-h-screen flex items-center justify-center p-6 bg-slate-50\">\r\n          <div className=\"bg-white rounded-lg p-6 shadow\">\r\n            <h2 className=\"text-lg font-semibold\">Not signed in</h2>\r\n            <p className=\"text-sm text-slate-600 mt-2\">Please sign in to access the dashboard.</p>\r\n            <div className=\"mt-4 flex gap-2\">\r\n              <a href=\"/login\" className=\"px-3 py-2 rounded bg-indigo-600 text-white text-sm\">Sign in</a>\r\n              <a href=\"/\" className=\"px-3 py-2 rounded border text-sm\">Go home</a>\r\n            </div>\r\n            {error && <div className=\"mt-3 text-xs text-rose-600\">{error}</div>}\r\n          </div>\r\n        </div>\r\n      </ChatSocketProvider>\r\n    );\r\n  }\r\n\r\n  // Main dashboard layout\r\n  return (\r\n    <ChatSocketProvider>\r\n      <div className=\"min-h-screen flex bg-slate-50\">\r\n        {/* Sidebar */}\r\n        <Sidebar portal={portal as any} />\r\n\r\n        {/* Main content area */}\r\n        <div className=\"flex-1 min-h-screen lg:pl-72\">\r\n          {/* Header */}\r\n          <header className=\"bg-white border-b border-slate-200 sticky top-0 z-20\">\r\n            <div className=\"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-4\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <button\r\n                  onClick={() => {\r\n                    const el = document.querySelector(\"button[aria-label='Open menu']\");\r\n                    if (el) (el as HTMLButtonElement).click();\r\n                  }}\r\n                  className=\"lg:hidden inline-flex items-center justify-center p-2 rounded-md bg-white border shadow-sm\"\r\n                  aria-label=\"Open menu\"\r\n                >\r\n                  <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden>\r\n                    <path d=\"M4 6h16M4 12h16M4 18h16\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n                  </svg>\r\n                </button>\r\n\r\n                <div>\r\n                  <div className=\"text-sm font-semibold text-slate-800\">Dashboard</div>\r\n                  <div className=\"text-xs text-slate-500\">{orgName ?? \"Organization\"} • {role?.toLowerCase()}</div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex items-center gap-3\">\r\n                <a href=\"/account\" className=\"hidden sm:inline-flex text-sm px-3 py-1 rounded-md hover:bg-slate-50\">Account</a>\r\n                <form action=\"/api/auth/logout\" method=\"POST\">\r\n                  <button type=\"submit\" className=\"px-3 py-1 rounded-md border text-sm\">Sign out</button>\r\n                </form>\r\n              </div>\r\n            </div>\r\n          </header>\r\n\r\n          <main className=\"p-6\">\r\n            <div className=\"max-w-7xl mx-auto\">{children}</div>\r\n          </main>\r\n        </div>\r\n      </div>\r\n    </ChatSocketProvider>\r\n  );\r\n}\r\n"],"names":["React","useEffect","useState","ReactNode","Sidebar","ChatSocketProvider","MeResponse","ok","role","user","id","email","organizationId","organizationName","DashboardLayout","children","loading","setLoading","setRole","orgName","setOrgName","error","setError","portal","mounted","res","fetch","credentials","j","json","catch","r","org","String","toUpperCase","err","message","el","document","querySelector","HTMLButtonElement","click","toLowerCase"],"mappings":"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","ignoreList":[],"debugId":null}}]
}