{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/hooks/useChatSocket.ts"],"sourcesContent":["// src/hooks/useChatSocket.ts\r\n\"use client\";\r\n\r\nimport { useEffect, useRef, useState, useCallback } from \"react\";\r\nimport { io, Socket } from \"socket.io-client\";\r\nimport type { Chat, Message, UserSummary } from \"@/types/chat\";\r\n\r\ntype EventHandlers = {\r\n  onChatCreated?: (chat: Chat) => void;\r\n  onMessageNew?: (message: Message) => void;\r\n  onChatMemberAdded?: (chatId: string, user: UserSummary) => void;\r\n  onChatMemberRemoved?: (chatId: string, userId: string) => void;\r\n  onTyping?: (chatId: string, userId: string, isTyping: boolean) => void;\r\n};\r\n\r\nexport default function useChatSocket(\r\n  token: string | null,\r\n  handlers: EventHandlers = {}\r\n) {\r\n  const socketRef = useRef<Socket | null>(null);\r\n  const [connected, setConnected] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!token) return;\r\n    // connect to socketio endpoint; server should accept cookie or token auth\r\n    const socket = io(\"/api/socketio\", {\r\n      autoConnect: true,\r\n      auth: { token },\r\n      path: \"/api/socketio\", // in case server uses default\r\n    });\r\n\r\n    socketRef.current = socket;\r\n\r\n    socket.on(\"connect\", () => setConnected(true));\r\n    socket.on(\"disconnect\", () => setConnected(false));\r\n\r\n    socket.on(\"chat:created\", (payload: { chat: Chat }) => {\r\n      handlers.onChatCreated?.(payload.chat);\r\n    });\r\n\r\n    socket.on(\"message:new\", (payload: { message: Message }) => {\r\n      handlers.onMessageNew?.(payload.message);\r\n    });\r\n\r\n    socket.on(\"chat:member:added\", (payload: { chatId: string; user: UserSummary }) => {\r\n      handlers.onChatMemberAdded?.(payload.chatId, payload.user);\r\n    });\r\n\r\n    socket.on(\"chat:member:removed\", (payload: { chatId: string; userId: string }) => {\r\n      handlers.onChatMemberRemoved?.(payload.chatId, payload.userId);\r\n    });\r\n\r\n    socket.on(\"typing\", (payload: { chatId: string; userId: string; isTyping: boolean }) => {\r\n      handlers.onTyping?.(payload.chatId, payload.userId, payload.isTyping);\r\n    });\r\n\r\n    return () => {\r\n      socket.disconnect();\r\n      socketRef.current = null;\r\n    };\r\n  }, [token]);\r\n\r\n  const joinChat = useCallback((chatId: string) => {\r\n    socketRef.current?.emit(\"chat:join\", { chatId });\r\n  }, []);\r\n\r\n  const leaveChat = useCallback((chatId: string) => {\r\n    socketRef.current?.emit(\"chat:leave\", { chatId });\r\n  }, []);\r\n\r\n  const sendMessage = useCallback((chatId: string, content: string) => {\r\n    // prefer REST POST to /api/chats/[chatId]/messages for persistence,\r\n    // but also emit via socket for low-latency if server supports it.\r\n    socketRef.current?.emit(\"message:send\", { chatId, content });\r\n  }, []);\r\n\r\n  const emitTyping = useCallback((chatId: string, isTyping: boolean) => {\r\n    socketRef.current?.emit(\"typing\", { chatId, isTyping });\r\n  }, []);\r\n\r\n  return {\r\n    socket: socketRef.current,\r\n    connected,\r\n    joinChat,\r\n    leaveChat,\r\n    sendMessage,\r\n    emitTyping,\r\n  };\r\n}\r\n"],"names":["useEffect","useRef","useState","useCallback","io","Socket","Chat","Message","UserSummary","EventHandlers","onChatCreated","chat","onMessageNew","message","onChatMemberAdded","chatId","user","onChatMemberRemoved","userId","onTyping","isTyping","useChatSocket","token","handlers","socketRef","connected","setConnected","socket","autoConnect","auth","path","current","on","payload","disconnect","joinChat","emit","leaveChat","sendMessage","content","emitTyping"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 121, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/providers/ChatProvider.tsx"],"sourcesContent":["// src/providers/ChatProvider.tsx\r\n\"use client\";\r\n\r\nimport React, { createContext, useContext, useEffect, useMemo, useState } from \"react\";\r\nimport useChatSocket from \"@/hooks/useChatSocket\";\r\nimport type { Chat, Message, UserSummary } from \"@/types/chat\";\r\n\r\n/**\r\n * ChatProvider - holds chat list, active chat, unread counts, and provides helper actions.\r\n *\r\n * Usage:\r\n *  - Wrap your app (or dashboard pages) with <ChatProvider token={authToken}>...</ChatProvider>\r\n *  - Use useChat() hook to access chats, openChat(chatId), sendMessage, etc.\r\n */\r\n\r\ntype ChatContextValue = {\r\n  chats: Chat[];\r\n  setChats: (c: Chat[]) => void;\r\n  activeChatId: string | null;\r\n  openChat: (chatId: string) => void;\r\n  closeChat: () => void;\r\n  sendMessage: (chatId: string, content: string) => Promise<void>;\r\n  addMessageLocally: (message: Message) => void;\r\n  unreadTotal: number;\r\n  loading: boolean;\r\n};\r\n\r\nconst ChatContext = createContext<ChatContextValue | null>(null);\r\n\r\nexport function useChat() {\r\n  const ctx = useContext(ChatContext);\r\n  if (!ctx) throw new Error(\"useChat must be used within ChatProvider\");\r\n  return ctx;\r\n}\r\n\r\nexport function ChatProvider({ token, children }: { token: string | null; children: React.ReactNode }) {\r\n  const [chats, setChats] = useState<Chat[]>([]);\r\n  const [activeChatId, setActiveChatId] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const handlers = {\r\n    onChatCreated: (chat: Chat) => setChats((prev) => [chat, ...prev]),\r\n    onMessageNew: (message: Message) => {\r\n      // bump lastMessage + unread logic\r\n      setChats((prev) =>\r\n        prev.map((c) => {\r\n          if (c.id === message.chatId) {\r\n            const unread = (c.unreadCount ?? 0) + (activeChatId === c.id ? 0 : 1);\r\n            return { ...c, lastMessage: message, unreadCount: unread };\r\n          }\r\n          return c;\r\n        })\r\n      );\r\n    },\r\n    onChatMemberAdded: (chatId: string, user: UserSummary) => {\r\n      setChats((prev) => prev.map((c) => (c.id === chatId ? { ...c, members: [...(c.members ?? []), user] } : c)));\r\n    },\r\n    onChatMemberRemoved: (chatId: string, userId: string) => {\r\n      setChats((prev) => prev.map((c) => (c.id === chatId ? { ...c, members: (c.members ?? []).filter((m) => m.id !== userId) } : c)));\r\n    },\r\n  };\r\n\r\n  const { socket, connected, joinChat, leaveChat, sendMessage: socketSend } = useChatSocket(token, handlers);\r\n\r\n  // Fetch initial chat list\r\n  useEffect(() => {\r\n    if (!token) {\r\n      setChats([]);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    fetch(\"/api/chats\")\r\n      .then((r) => r.json())\r\n      .then((data) => {\r\n        if (data?.ok) {\r\n          setChats(data.chats || []);\r\n        } else {\r\n          setChats([]);\r\n        }\r\n      })\r\n      .catch(() => setChats([]))\r\n      .finally(() => setLoading(false));\r\n  }, [token]);\r\n\r\n  useEffect(() => {\r\n    // when opening activeChat, join via socket\r\n    if (activeChatId && socket) {\r\n      joinChat(activeChatId);\r\n    }\r\n    return () => {\r\n      if (activeChatId && socket) leaveChat(activeChatId);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [activeChatId]);\r\n\r\n  const openChat = (chatId: string) => {\r\n    setActiveChatId(chatId);\r\n    setChats((prev) => prev.map((c) => (c.id === chatId ? { ...c, unreadCount: 0 } : c)));\r\n  };\r\n\r\n  const closeChat = () => setActiveChatId(null);\r\n\r\n  const addMessageLocally = (message: Message) => {\r\n    setChats((prev) =>\r\n      prev.map((c) => (c.id === message.chatId ? { ...c, lastMessage: message } : c))\r\n    );\r\n  };\r\n\r\n  const sendMessage = async (chatId: string, content: string) => {\r\n    // Prefer REST API for durability and server ACLs; also emit socket for low latency.\r\n    try {\r\n      const res = await fetch(`/api/chats/${chatId}`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ content }),\r\n      });\r\n      const json = await res.json();\r\n      if (json?.ok && json?.message) {\r\n        // message will be broadcast by server; optionally also optimistically add\r\n        addMessageLocally(json.message);\r\n      } else {\r\n        // fallback to socket emit\r\n        socketSend(chatId, content);\r\n      }\r\n    } catch (e) {\r\n      // as fallback try socket\r\n      socketSend(chatId, content);\r\n    }\r\n  };\r\n\r\n  const unreadTotal = chats.reduce((sum, c) => sum + (c.unreadCount ?? 0), 0);\r\n\r\n  const ctxValue = useMemo(\r\n    () => ({\r\n      chats,\r\n      setChats,\r\n      activeChatId,\r\n      openChat,\r\n      closeChat,\r\n      sendMessage,\r\n      addMessageLocally,\r\n      unreadTotal,\r\n      loading,\r\n    }),\r\n    [chats, activeChatId, unreadTotal, loading]\r\n  );\r\n\r\n  return <ChatContext.Provider value={ctxValue}>{children}</ChatContext.Provider>;\r\n}\r\n"],"names":["c","_c","React","createContext","useContext","useEffect","useMemo","useState","useChatSocket","Chat","Message","UserSummary","ChatContextValue","chats","setChats","activeChatId","openChat","chatId","closeChat","sendMessage","content","Promise","addMessageLocally","message","unreadTotal","loading","ChatContext","useChat","$","$i","Symbol","for","ctx","Error","ChatProvider","token","children","ReactNode","setActiveChatId","setLoading","handlers","onChatCreated","chat","prev","onMessageNew","map","id","unread","unreadCount","lastMessage","onChatMemberAdded","user","members","onChatMemberRemoved","userId","filter","m","socket","connected","joinChat","leaveChat","socketSend","fetch","then","r","json","data","ok","catch","finally","res","method","headers","body","JSON","stringify","e","reduce","sum","ctxValue"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 322, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/components/chat/ChatList.tsx"],"sourcesContent":["// src/components/chat/ChatList.tsx\r\n\"use client\";\r\n\r\nimport React, {\r\n  useEffect,\r\n  useMemo,\r\n  useState,\r\n  useCallback,\r\n} from \"react\";\r\n// try to use your existing useChat provider if present (keeps backwards compatibility)\r\nimport { useChat as useChatProvider } from \"@/providers/ChatProvider\";\r\nimport { useChatSocket } from \"@/app/dashboard/ChatSocketProvider\";\r\n\r\ntype MinimalUser = {\r\n  id: string;\r\n  name?: string | null;\r\n  email?: string | null;\r\n  role?: string | null;\r\n};\r\n\r\ntype LocalChat = {\r\n  id: string;\r\n  name?: string | null;\r\n  type?: string; // \"GROUP\" | \"PRIVATE\" | \"TEAM\" | \"DIRECT\"\r\n  lastMessage?: { content: string; createdAt: string } | null;\r\n  unreadCount?: number | null;\r\n  teamId?: string | null;\r\n  meta?: any;\r\n  members?: MinimalUser[] | null;\r\n};\r\n\r\nfunction normalizeMembers(raw: any): MinimalUser[] | undefined {\r\n  if (!raw) return undefined;\r\n  const arr = Array.isArray(raw) ? raw : [];\r\n  const mapped = arr\r\n    .map((m) => {\r\n      if (!m) return null;\r\n      // backend normalizeChat gives: { id, name, email, role }\r\n      const id =\r\n        m.id ??\r\n        m.userId ??\r\n        m.user?.id ??\r\n        m.user?._id ??\r\n        null;\r\n      const name =\r\n        m.name ??\r\n        m.displayName ??\r\n        m.user?.name ??\r\n        null;\r\n      const email = m.email ?? m.user?.email ?? null;\r\n      const role = m.role ?? m.user?.role ?? null;\r\n      if (!id) return null;\r\n      return {\r\n        id: String(id),\r\n        name,\r\n        email,\r\n        role,\r\n      } as MinimalUser;\r\n    })\r\n    .filter(Boolean) as MinimalUser[];\r\n\r\n  return mapped.length ? mapped : undefined;\r\n}\r\n\r\n/**\r\n * Derive a per-user display name:\r\n * - DIRECT / PRIVATE â†’ show the \"other person\" for this user\r\n * - TEAM / GROUP    â†’ server name or Team <id>\r\n * - fallback        â†’ \"Chat <id>\"\r\n */\r\nfunction deriveDisplayName(\r\n  chat: LocalChat,\r\n  me: MinimalUser | null\r\n): string {\r\n  const rawType = (chat.type ?? \"\").toString().toLowerCase();\r\n  const serverName =\r\n    chat.name ?? chat.meta?.name ?? \"\";\r\n  const isGeneric =\r\n    !serverName ||\r\n    serverName === \"Chat\" ||\r\n    serverName.startsWith(\"Chat \");\r\n\r\n  const isDirect =\r\n    rawType === \"direct\" ||\r\n    rawType === \"private\" ||\r\n    rawType === \"dm\";\r\n\r\n  if (isDirect) {\r\n    const candidates =\r\n      chat.members ??\r\n      normalizeMembers(chat.meta?.members) ??\r\n      normalizeMembers(chat.meta?.participants);\r\n\r\n    if (\r\n      candidates &&\r\n      candidates.length > 0 &&\r\n      me?.id\r\n    ) {\r\n      const other = candidates.find(\r\n        (p) => String(p.id) !== String(me.id)\r\n      );\r\n      if (other) {\r\n        if (other.name) return other.name;\r\n        if (other.email) return other.email;\r\n      }\r\n    }\r\n\r\n    if (!isGeneric && serverName) return serverName;\r\n    return \"Direct chat\";\r\n  }\r\n\r\n  const isTeamOrGroup =\r\n    rawType === \"team\" || rawType === \"group\";\r\n\r\n  if (!isGeneric && serverName) return serverName;\r\n\r\n  if (isTeamOrGroup) {\r\n    return chat.name\r\n      ? chat.name\r\n      : `Team ${chat.teamId ?? chat.id}`;\r\n  }\r\n\r\n  return serverName || `Chat ${chat.id}`;\r\n}\r\n\r\nfunction ChatRow({\r\n  chat,\r\n  onOpen,\r\n  currentUser,\r\n}: {\r\n  chat: LocalChat;\r\n  onOpen: (id: string) => void;\r\n  currentUser: MinimalUser | null;\r\n}) {\r\n  const typeLabel = (chat.type ?? \"\")\r\n    .toString()\r\n    .toUpperCase();\r\n  const isGroupLike =\r\n    typeLabel.includes(\"GROUP\") ||\r\n    typeLabel.includes(\"TEAM\");\r\n  const displayName = deriveDisplayName(\r\n    chat,\r\n    currentUser\r\n  );\r\n\r\n  return (\r\n    <button\r\n      className=\"w-full text-left p-3 hover:bg-slate-50 flex items-center gap-3\"\r\n      onClick={() => onOpen(chat.id)}\r\n    >\r\n      <div className=\"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden\">\r\n        {isGroupLike ? <span>ðŸ‘¥</span> : <span>ðŸ’¬</span>}\r\n      </div>\r\n      <div className=\"flex-1\">\r\n        <div className=\"flex justify-between\">\r\n          <div className=\"font-medium text-sm truncate\">\r\n            {displayName}\r\n          </div>\r\n          <div className=\"text-xs text-gray-500\">\r\n            {chat.lastMessage\r\n              ? new Date(\r\n                  chat.lastMessage.createdAt\r\n                ).toLocaleTimeString()\r\n              : \"\"}\r\n          </div>\r\n        </div>\r\n        <div className=\"text-xs text-gray-600 truncate\">\r\n          {chat.lastMessage?.content ??\r\n            \"No messages yet\"}\r\n        </div>\r\n      </div>\r\n      {chat.unreadCount ? (\r\n        <div className=\"ml-3 text-sm px-2 py-1 bg-blue-600 text-white rounded-full\">\r\n          {chat.unreadCount}\r\n        </div>\r\n      ) : null}\r\n    </button>\r\n  );\r\n}\r\n\r\n/**\r\n * ChatList\r\n *\r\n * Optional prop:\r\n *  - onOpen?: (chatId: string) => void    // if parent wants to handle opening\r\n *\r\n * Behavior:\r\n *  - If parent doesn't pass onOpen, ChatList will try to use useChatProvider()?.openChat()\r\n *    (keeps compatibility with existing provider-based flow).\r\n *  - Maintains local list of chats fetched from /api/chats and updates realtime via socket.\r\n *  - For DIRECT chats, the display name is computed per user from members.\r\n */\r\nexport default function ChatList({\r\n  onOpen,\r\n}: {\r\n  onOpen?: (id: string) => void;\r\n}) {\r\n  // Try to use existing ChatProvider (if your app already has one). It may return { chats, openChat, loading }\r\n  let chatProvider: any = null;\r\n  try {\r\n    chatProvider = useChatProvider?.();\r\n  } catch {\r\n    chatProvider = null;\r\n  }\r\n\r\n  const socket = useChatSocket();\r\n  const [chats, setChats] = useState<LocalChat[]>([]);\r\n  const [loading, setLoading] =\r\n    useState<boolean>(true);\r\n  const [error, setError] = useState<string | null>(\r\n    null\r\n  );\r\n  const [currentUser, setCurrentUser] =\r\n    useState<MinimalUser | null>(null);\r\n\r\n  // load current user (for \"other person\" name)\r\n  const loadMe = useCallback(async () => {\r\n    try {\r\n      const res = await fetch(\"/api/me\", {\r\n        credentials: \"same-origin\",\r\n      });\r\n      if (!res.ok) return;\r\n      const j = await res.json().catch(() => ({}));\r\n      const u = j?.user ?? null;\r\n      if (u && u.id) {\r\n        setCurrentUser({\r\n          id: String(u.id),\r\n          name: u.name ?? null,\r\n          email: u.email ?? null,\r\n          role: u.role ?? null,\r\n        });\r\n      }\r\n    } catch {\r\n      // non-fatal\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadMe();\r\n  }, [loadMe]);\r\n\r\n  // load chats from api (same endpoint pages use)\r\n  const loadChats = useCallback(async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await fetch(\"/api/chats\", {\r\n        credentials: \"same-origin\",\r\n      });\r\n      if (!res.ok)\r\n        throw new Error(`HTTP ${res.status}`);\r\n      const j = await res.json();\r\n      const payload = (j?.chats ?? []) as any[];\r\n\r\n      const normalized: LocalChat[] = payload.map(\r\n        (c) => ({\r\n          id: c.id,\r\n          name: c.name ?? null,\r\n          type: (c.type ?? c.chatType ?? null) as\r\n            | string\r\n            | undefined,\r\n          lastMessage: c.lastMessage\r\n            ? {\r\n                content:\r\n                  c.lastMessage.content ?? \"\",\r\n                createdAt:\r\n                  c.lastMessage.createdAt ??\r\n                  new Date().toISOString(),\r\n              }\r\n            : c.lastMessageAt\r\n            ? {\r\n                content: \"\",\r\n                createdAt: c.lastMessageAt,\r\n              }\r\n            : null,\r\n          unreadCount:\r\n            typeof c.unreadCount === \"number\"\r\n              ? c.unreadCount\r\n              : 0,\r\n          teamId: c.teamId ?? null,\r\n          meta: c.meta ?? c ?? null,\r\n          members: normalizeMembers(\r\n            c.members ?? c.participants\r\n          ) ?? null,\r\n        })\r\n      );\r\n\r\n      setChats(normalized);\r\n    } catch (err: any) {\r\n      console.warn(\r\n        \"ChatList: failed to load chats\",\r\n        err\r\n      );\r\n      setError(\"Could not load chats\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // If a ChatProvider is present and exposes chats, use it as source of truth\r\n    if (\r\n      chatProvider &&\r\n      Array.isArray(chatProvider.chats) &&\r\n      typeof chatProvider.loading !== \"undefined\"\r\n    ) {\r\n      const mapped: LocalChat[] = (\r\n        chatProvider.chats ?? []\r\n      ).map((c: any) => ({\r\n        id: c.id,\r\n        name: c.name ?? null,\r\n        type: c.type ?? null,\r\n        lastMessage: c.lastMessage\r\n          ? {\r\n              content:\r\n                c.lastMessage.content ?? \"\",\r\n              createdAt:\r\n                c.lastMessage.createdAt ??\r\n                new Date().toISOString(),\r\n            }\r\n          : null,\r\n        unreadCount:\r\n          typeof c.unreadCount === \"number\"\r\n            ? c.unreadCount\r\n            : 0,\r\n        teamId: c.teamId ?? null,\r\n        meta: c.meta ?? c ?? null,\r\n        members: normalizeMembers(\r\n          c.members ?? c.participants\r\n        ) ?? null,\r\n      }));\r\n\r\n      setChats(mapped);\r\n      setLoading(Boolean(chatProvider.loading));\r\n      return;\r\n    }\r\n\r\n    // Otherwise fetch from API\r\n    loadChats();\r\n  }, [chatProvider, loadChats]);\r\n\r\n  // Socket handlers: keep the list realtime\r\n  useEffect(() => {\r\n    if (!socket) return;\r\n\r\n    const handleTeamCreated = (payload: any) => {\r\n      const chatPayload =\r\n        payload?.chat ??\r\n        (payload?.team\r\n          ? {\r\n              id: payload.team.id,\r\n              name: payload.team.name,\r\n              teamId: payload.team.id,\r\n              members:\r\n                payload.team.members ??\r\n                payload.chat?.members ??\r\n                null,\r\n            }\r\n          : null);\r\n      if (!chatPayload) return;\r\n      setChats((prev) => {\r\n        if (\r\n          prev.find(\r\n            (p) => p.id === chatPayload.id\r\n          )\r\n        )\r\n          return prev;\r\n        const newRow: LocalChat = {\r\n          id: chatPayload.id,\r\n          name:\r\n            chatPayload.name ??\r\n            `Team ${chatPayload.teamId ?? \"\"}`,\r\n          type: \"GROUP\",\r\n          lastMessage: null,\r\n          unreadCount: 0,\r\n          teamId: chatPayload.teamId ?? null,\r\n          members:\r\n            normalizeMembers(\r\n              chatPayload.members\r\n            ) ?? null,\r\n        };\r\n        return [newRow, ...prev];\r\n      });\r\n    };\r\n\r\n    const handleChatMessage = (payload: any) => {\r\n      const chatId =\r\n        payload?.chatId ?? payload?.chat?.id ?? null;\r\n      if (!chatId) return;\r\n      const text =\r\n        payload?.message?.content ??\r\n        payload?.content ??\r\n        \"\";\r\n      const createdAt =\r\n        payload?.message?.createdAt ??\r\n        new Date().toISOString();\r\n      const membersFromPayload =\r\n        payload?.chat?.members ??\r\n        payload?.chat?.participants ??\r\n        null;\r\n\r\n      // update existing chat\r\n      setChats((prev) =>\r\n        prev.map((c) => {\r\n          if (c.id !== chatId) return c;\r\n          return {\r\n            ...c,\r\n            lastMessage: {\r\n              content: text,\r\n              createdAt,\r\n            },\r\n            unreadCount:\r\n              (c.unreadCount ?? 0) + 1,\r\n            members:\r\n              c.members ??\r\n              (normalizeMembers(\r\n                membersFromPayload\r\n              ) ?? null),\r\n          };\r\n        })\r\n      );\r\n\r\n      // if chat not present, add a stub\r\n      setChats((prev) => {\r\n        if (prev.find((c) => c.id === chatId))\r\n          return prev;\r\n        const stub: LocalChat = {\r\n          id: chatId,\r\n          name:\r\n            payload?.chat?.name ??\r\n            `Chat ${chatId}`,\r\n          type:\r\n            payload?.chat?.type ?? \"DIRECT\",\r\n          lastMessage: {\r\n            content: text,\r\n            createdAt,\r\n          },\r\n          unreadCount: 1,\r\n          teamId: payload?.chat?.teamId ?? null,\r\n          meta: payload?.chat ?? null,\r\n          members:\r\n            normalizeMembers(\r\n              membersFromPayload\r\n            ) ?? null,\r\n        };\r\n        return [stub, ...prev];\r\n      });\r\n    };\r\n\r\n    socket.on(\"team:created\", handleTeamCreated);\r\n    socket.on(\"chat:message\", handleChatMessage);\r\n\r\n    return () => {\r\n      socket.off(\"team:created\", handleTeamCreated);\r\n      socket.off(\"chat:message\", handleChatMessage);\r\n    };\r\n  }, [socket]);\r\n\r\n  // openChat handler â€” use parent prop if provided, otherwise fall back to chatProvider.openChat()\r\n  const handleOpen = useCallback(\r\n    async (id: string) => {\r\n      try {\r\n        try {\r\n          await socket.joinChat?.(id);\r\n        } catch {}\r\n\r\n        if (typeof onOpen === \"function\") {\r\n          onOpen(id);\r\n          return;\r\n        }\r\n\r\n        if (\r\n          chatProvider &&\r\n          typeof chatProvider.openChat ===\r\n            \"function\"\r\n        ) {\r\n          chatProvider.openChat(id);\r\n          return;\r\n        }\r\n\r\n        if (typeof window !== \"undefined\") {\r\n          try {\r\n            window.history.pushState(\r\n              {},\r\n              \"\",\r\n              `${window.location.pathname}?chatId=${encodeURIComponent(\r\n                id\r\n              )}`\r\n            );\r\n          } catch {}\r\n        }\r\n      } catch {\r\n        // ignore\r\n      }\r\n    },\r\n    [onOpen, chatProvider, socket]\r\n  );\r\n\r\n  if (loading)\r\n    return (\r\n      <div className=\"p-4\">\r\n        Loading chatsâ€¦\r\n      </div>\r\n    );\r\n  if (error)\r\n    return (\r\n      <div className=\"p-4 text-sm text-red-600\">\r\n        {error}\r\n      </div>\r\n    );\r\n  if (!chats.length)\r\n    return (\r\n      <div className=\"p-4 text-sm text-gray-600\">\r\n        No chats yet\r\n      </div>\r\n    );\r\n\r\n  return (\r\n    <div className=\"divide-y border-r\">\r\n      {chats.map((c) => (\r\n        <ChatRow\r\n          key={c.id}\r\n          chat={c}\r\n          onOpen={handleOpen}\r\n          currentUser={currentUser}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["c","_c","React","useEffect","useMemo","useState","useCallback","useChat","useChatProvider","useChatSocket","MinimalUser","id","name","email","role","LocalChat","type","lastMessage","content","createdAt","unreadCount","teamId","meta","members","normalizeMembers","raw","undefined","arr","Array","isArray","mapped","map","m","userId","user","_id","displayName","String","filter","Boolean","length","deriveDisplayName","chat","me","rawType","toString","toLowerCase","serverName","isGeneric","startsWith","isDirect","candidates","participants","other","find","p","isTeamOrGroup","ChatRow","t0","$","$i","Symbol","for","onOpen","currentUser","t1","t2","typeLabel","toUpperCase","includes","isGroupLike","t3","t4","ChatRow[<button>.onClick]","t5","t6","t7","Date","toLocaleTimeString","t8","t9","t10","t11","t12","t13","t14","ChatList","chatProvider","socket","chats","setChats","loading","setLoading","error","setError","setCurrentUser","loadMe","res","fetch","credentials","ok","j","json","catch","u","loadChats","Error","status","payload","normalized","chatType","toISOString","lastMessageAt","err","console","warn","handleTeamCreated","chatPayload","team","prev","newRow","handleChatMessage","chatId","text","message","membersFromPayload","stub","on","off","handleOpen","joinChat","openChat","window","history","pushState","location","pathname","encodeURIComponent"],"mappings":"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","ignoreList":[],"debugId":null}}]
}