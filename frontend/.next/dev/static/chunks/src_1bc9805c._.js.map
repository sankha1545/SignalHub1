{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/hooks/useChatSocket.ts"],"sourcesContent":["// src/hooks/useChatSocket.ts\r\n\"use client\";\r\n\r\nimport { useEffect, useRef, useState, useCallback } from \"react\";\r\nimport { io, Socket } from \"socket.io-client\";\r\nimport type { Chat, Message, UserSummary } from \"@/types/chat\";\r\n\r\ntype EventHandlers = {\r\n  onChatCreated?: (chat: Chat) => void;\r\n  onMessageNew?: (message: Message) => void;\r\n  onChatMemberAdded?: (chatId: string, user: UserSummary) => void;\r\n  onChatMemberRemoved?: (chatId: string, userId: string) => void;\r\n  onTyping?: (chatId: string, userId: string, isTyping: boolean) => void;\r\n};\r\n\r\nexport default function useChatSocket(\r\n  token: string | null,\r\n  handlers: EventHandlers = {}\r\n) {\r\n  const socketRef = useRef<Socket | null>(null);\r\n  const [connected, setConnected] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!token) return;\r\n    // connect to socketio endpoint; server should accept cookie or token auth\r\n    const socket = io(\"/api/socketio\", {\r\n      autoConnect: true,\r\n      auth: { token },\r\n      path: \"/api/socketio\", // in case server uses default\r\n    });\r\n\r\n    socketRef.current = socket;\r\n\r\n    socket.on(\"connect\", () => setConnected(true));\r\n    socket.on(\"disconnect\", () => setConnected(false));\r\n\r\n    socket.on(\"chat:created\", (payload: { chat: Chat }) => {\r\n      handlers.onChatCreated?.(payload.chat);\r\n    });\r\n\r\n    socket.on(\"message:new\", (payload: { message: Message }) => {\r\n      handlers.onMessageNew?.(payload.message);\r\n    });\r\n\r\n    socket.on(\"chat:member:added\", (payload: { chatId: string; user: UserSummary }) => {\r\n      handlers.onChatMemberAdded?.(payload.chatId, payload.user);\r\n    });\r\n\r\n    socket.on(\"chat:member:removed\", (payload: { chatId: string; userId: string }) => {\r\n      handlers.onChatMemberRemoved?.(payload.chatId, payload.userId);\r\n    });\r\n\r\n    socket.on(\"typing\", (payload: { chatId: string; userId: string; isTyping: boolean }) => {\r\n      handlers.onTyping?.(payload.chatId, payload.userId, payload.isTyping);\r\n    });\r\n\r\n    return () => {\r\n      socket.disconnect();\r\n      socketRef.current = null;\r\n    };\r\n  }, [token]);\r\n\r\n  const joinChat = useCallback((chatId: string) => {\r\n    socketRef.current?.emit(\"chat:join\", { chatId });\r\n  }, []);\r\n\r\n  const leaveChat = useCallback((chatId: string) => {\r\n    socketRef.current?.emit(\"chat:leave\", { chatId });\r\n  }, []);\r\n\r\n  const sendMessage = useCallback((chatId: string, content: string) => {\r\n    // prefer REST POST to /api/chats/[chatId]/messages for persistence,\r\n    // but also emit via socket for low-latency if server supports it.\r\n    socketRef.current?.emit(\"message:send\", { chatId, content });\r\n  }, []);\r\n\r\n  const emitTyping = useCallback((chatId: string, isTyping: boolean) => {\r\n    socketRef.current?.emit(\"typing\", { chatId, isTyping });\r\n  }, []);\r\n\r\n  return {\r\n    socket: socketRef.current,\r\n    connected,\r\n    joinChat,\r\n    leaveChat,\r\n    sendMessage,\r\n    emitTyping,\r\n  };\r\n}\r\n"],"names":["useEffect","useRef","useState","useCallback","io","Socket","Chat","Message","UserSummary","EventHandlers","onChatCreated","chat","onMessageNew","message","onChatMemberAdded","chatId","user","onChatMemberRemoved","userId","onTyping","isTyping","useChatSocket","token","handlers","socketRef","connected","setConnected","socket","autoConnect","auth","path","current","on","payload","disconnect","joinChat","emit","leaveChat","sendMessage","content","emitTyping"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 121, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/providers/ChatProvider.tsx"],"sourcesContent":["// src/providers/ChatProvider.tsx\r\n\"use client\";\r\n\r\nimport React, { createContext, useContext, useEffect, useMemo, useState } from \"react\";\r\nimport useChatSocket from \"@/hooks/useChatSocket\";\r\nimport type { Chat, Message, UserSummary } from \"@/types/chat\";\r\n\r\n/**\r\n * ChatProvider - holds chat list, active chat, unread counts, and provides helper actions.\r\n *\r\n * Usage:\r\n *  - Wrap your app (or dashboard pages) with <ChatProvider token={authToken}>...</ChatProvider>\r\n *  - Use useChat() hook to access chats, openChat(chatId), sendMessage, etc.\r\n */\r\n\r\ntype ChatContextValue = {\r\n  chats: Chat[];\r\n  setChats: (c: Chat[]) => void;\r\n  activeChatId: string | null;\r\n  openChat: (chatId: string) => void;\r\n  closeChat: () => void;\r\n  sendMessage: (chatId: string, content: string) => Promise<void>;\r\n  addMessageLocally: (message: Message) => void;\r\n  unreadTotal: number;\r\n  loading: boolean;\r\n};\r\n\r\nconst ChatContext = createContext<ChatContextValue | null>(null);\r\n\r\nexport function useChat() {\r\n  const ctx = useContext(ChatContext);\r\n  if (!ctx) throw new Error(\"useChat must be used within ChatProvider\");\r\n  return ctx;\r\n}\r\n\r\nexport function ChatProvider({ token, children }: { token: string | null; children: React.ReactNode }) {\r\n  const [chats, setChats] = useState<Chat[]>([]);\r\n  const [activeChatId, setActiveChatId] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const handlers = {\r\n    onChatCreated: (chat: Chat) => setChats((prev) => [chat, ...prev]),\r\n    onMessageNew: (message: Message) => {\r\n      // bump lastMessage + unread logic\r\n      setChats((prev) =>\r\n        prev.map((c) => {\r\n          if (c.id === message.chatId) {\r\n            const unread = (c.unreadCount ?? 0) + (activeChatId === c.id ? 0 : 1);\r\n            return { ...c, lastMessage: message, unreadCount: unread };\r\n          }\r\n          return c;\r\n        })\r\n      );\r\n    },\r\n    onChatMemberAdded: (chatId: string, user: UserSummary) => {\r\n      setChats((prev) => prev.map((c) => (c.id === chatId ? { ...c, members: [...(c.members ?? []), user] } : c)));\r\n    },\r\n    onChatMemberRemoved: (chatId: string, userId: string) => {\r\n      setChats((prev) => prev.map((c) => (c.id === chatId ? { ...c, members: (c.members ?? []).filter((m) => m.id !== userId) } : c)));\r\n    },\r\n  };\r\n\r\n  const { socket, connected, joinChat, leaveChat, sendMessage: socketSend } = useChatSocket(token, handlers);\r\n\r\n  // Fetch initial chat list\r\n  useEffect(() => {\r\n    if (!token) {\r\n      setChats([]);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    fetch(\"/api/chats\")\r\n      .then((r) => r.json())\r\n      .then((data) => {\r\n        if (data?.ok) {\r\n          setChats(data.chats || []);\r\n        } else {\r\n          setChats([]);\r\n        }\r\n      })\r\n      .catch(() => setChats([]))\r\n      .finally(() => setLoading(false));\r\n  }, [token]);\r\n\r\n  useEffect(() => {\r\n    // when opening activeChat, join via socket\r\n    if (activeChatId && socket) {\r\n      joinChat(activeChatId);\r\n    }\r\n    return () => {\r\n      if (activeChatId && socket) leaveChat(activeChatId);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [activeChatId]);\r\n\r\n  const openChat = (chatId: string) => {\r\n    setActiveChatId(chatId);\r\n    setChats((prev) => prev.map((c) => (c.id === chatId ? { ...c, unreadCount: 0 } : c)));\r\n  };\r\n\r\n  const closeChat = () => setActiveChatId(null);\r\n\r\n  const addMessageLocally = (message: Message) => {\r\n    setChats((prev) =>\r\n      prev.map((c) => (c.id === message.chatId ? { ...c, lastMessage: message } : c))\r\n    );\r\n  };\r\n\r\n  const sendMessage = async (chatId: string, content: string) => {\r\n    // Prefer REST API for durability and server ACLs; also emit socket for low latency.\r\n    try {\r\n      const res = await fetch(`/api/chats/${chatId}`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ content }),\r\n      });\r\n      const json = await res.json();\r\n      if (json?.ok && json?.message) {\r\n        // message will be broadcast by server; optionally also optimistically add\r\n        addMessageLocally(json.message);\r\n      } else {\r\n        // fallback to socket emit\r\n        socketSend(chatId, content);\r\n      }\r\n    } catch (e) {\r\n      // as fallback try socket\r\n      socketSend(chatId, content);\r\n    }\r\n  };\r\n\r\n  const unreadTotal = chats.reduce((sum, c) => sum + (c.unreadCount ?? 0), 0);\r\n\r\n  const ctxValue = useMemo(\r\n    () => ({\r\n      chats,\r\n      setChats,\r\n      activeChatId,\r\n      openChat,\r\n      closeChat,\r\n      sendMessage,\r\n      addMessageLocally,\r\n      unreadTotal,\r\n      loading,\r\n    }),\r\n    [chats, activeChatId, unreadTotal, loading]\r\n  );\r\n\r\n  return <ChatContext.Provider value={ctxValue}>{children}</ChatContext.Provider>;\r\n}\r\n"],"names":["c","_c","React","createContext","useContext","useEffect","useMemo","useState","useChatSocket","Chat","Message","UserSummary","ChatContextValue","chats","setChats","activeChatId","openChat","chatId","closeChat","sendMessage","content","Promise","addMessageLocally","message","unreadTotal","loading","ChatContext","useChat","$","$i","Symbol","for","ctx","Error","ChatProvider","token","children","ReactNode","setActiveChatId","setLoading","handlers","onChatCreated","chat","prev","onMessageNew","map","id","unread","unreadCount","lastMessage","onChatMemberAdded","user","members","onChatMemberRemoved","userId","filter","m","socket","connected","joinChat","leaveChat","socketSend","fetch","then","r","json","data","ok","catch","finally","res","method","headers","body","JSON","stringify","e","reduce","sum","ctxValue"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 322, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/components/chat/ChatList.tsx"],"sourcesContent":["// src/components/chat/ChatList.tsx\r\n\"use client\";\r\n\r\nimport React, { useEffect, useMemo, useState, useCallback } from \"react\";\r\n// try to use your existing useChat provider if present (keeps backwards compatibility)\r\nimport { useChat as useChatProvider } from \"@/providers/ChatProvider\";\r\nimport { useChatSocket } from \"@/app/dashboard/ChatSocketProvider\";\r\nimport type { Chat as ChatType } from \"@/types/chat\";\r\n\r\ntype LocalChat = {\r\n  id: string;\r\n  name?: string | null;\r\n  type?: string; // \"GROUP\" | \"PRIVATE\" | \"TEAM\" | \"DIRECT\"\r\n  lastMessage?: { content: string; createdAt: string } | null;\r\n  unreadCount?: number | null;\r\n  teamId?: string | null;\r\n  meta?: any;\r\n};\r\n\r\nfunction ChatRow({ chat, onOpen }: { chat: LocalChat; onOpen: (id: string) => void }) {\r\n  return (\r\n    <button\r\n      className=\"w-full text-left p-3 hover:bg-slate-50 flex items-center gap-3\"\r\n      onClick={() => onOpen(chat.id)}\r\n    >\r\n      <div className=\"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden\">\r\n        {String(chat.type ?? \"\").toUpperCase().includes(\"GROUP\") || String(chat.type ?? \"\").toUpperCase().includes(\"TEAM\") ? <span>ðŸ‘¥</span> : <span>ðŸ’¬</span>}\r\n      </div>\r\n      <div className=\"flex-1\">\r\n        <div className=\"flex justify-between\">\r\n          <div className=\"font-medium text-sm\">{chat.name ?? (String(chat.type ?? \"\").toUpperCase().includes(\"PRIVATE\") ? \"Direct\" : \"Group\")}</div>\r\n          <div className=\"text-xs text-gray-500\">{chat.lastMessage ? new Date(chat.lastMessage.createdAt).toLocaleTimeString() : \"\"}</div>\r\n        </div>\r\n        <div className=\"text-xs text-gray-600 truncate\">{chat.lastMessage?.content ?? \"No messages yet\"}</div>\r\n      </div>\r\n      {chat.unreadCount ? <div className=\"ml-3 text-sm px-2 py-1 bg-blue-600 text-white rounded-full\">{chat.unreadCount}</div> : null}\r\n    </button>\r\n  );\r\n}\r\n\r\n/**\r\n * ChatList\r\n *\r\n * Optional prop:\r\n *  - onOpen?: (chatId: string) => void    // if parent wants to handle opening\r\n *\r\n * Behavior:\r\n *  - If parent doesn't pass onOpen, ChatList will try to use useChatProvider()?.openChat()\r\n *    (keeps compatibility with existing provider-based flow).\r\n *  - Maintains local list of chats fetched from /api/chats and updates realtime via socket.\r\n */\r\nexport default function ChatList({ onOpen }: { onOpen?: (id: string) => void }) {\r\n  // Try to use existing ChatProvider (if your app already has one). It may return { chats, openChat, loading }\r\n  let chatProvider: any = null;\r\n  try {\r\n    chatProvider = useChatProvider?.();\r\n  } catch {\r\n    chatProvider = null;\r\n  }\r\n\r\n  const socket = useChatSocket();\r\n  const [chats, setChats] = useState<LocalChat[]>([]);\r\n  const [loading, setLoading] = useState<boolean>(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // load chats from api (same endpoint pages use)\r\n  const loadChats = useCallback(async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await fetch(\"/api/chats\", { credentials: \"same-origin\" });\r\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\r\n      const j = await res.json();\r\n      const payload = (j?.chats ?? []) as any[];\r\n      // normalize to LocalChat\r\n      const normalized = payload.map((c) => ({\r\n        id: c.id,\r\n        name: c.name ?? null,\r\n        type: (c.type ?? c.chatType ?? null) as string | undefined,\r\n        lastMessage: c.lastMessage\r\n          ? { content: c.lastMessage.content ?? \"\", createdAt: c.lastMessage.createdAt ?? new Date().toISOString() }\r\n          : c.lastMessageAt\r\n          ? { content: \"\", createdAt: c.lastMessageAt }\r\n          : null,\r\n        unreadCount: typeof c.unreadCount === \"number\" ? c.unreadCount : 0,\r\n        teamId: c.teamId ?? null,\r\n        meta: c.meta ?? null,\r\n      })) as LocalChat[];\r\n\r\n      setChats(normalized);\r\n    } catch (err: any) {\r\n      console.warn(\"ChatList: failed to load chats\", err);\r\n      setError(\"Could not load chats\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // If a ChatProvider is present and exposes chats, use it as source of truth\r\n    if (chatProvider && Array.isArray(chatProvider.chats) && typeof chatProvider.loading !== \"undefined\") {\r\n      // map provider chats to our local shape for socket merging\r\n      const mapped = (chatProvider.chats ?? []).map((c: any) => ({\r\n        id: c.id,\r\n        name: c.name ?? null,\r\n        type: c.type ?? null,\r\n        lastMessage: c.lastMessage ? { content: c.lastMessage.content ?? \"\", createdAt: c.lastMessage.createdAt ?? new Date().toISOString() } : null,\r\n        unreadCount: typeof c.unreadCount === \"number\" ? c.unreadCount : 0,\r\n        teamId: c.teamId ?? null,\r\n        meta: c.meta ?? null,\r\n      })) as LocalChat[];\r\n\r\n      setChats(mapped);\r\n      setLoading(Boolean(chatProvider.loading));\r\n      return;\r\n    }\r\n\r\n    // Otherwise fetch from API\r\n    loadChats();\r\n  }, [chatProvider, loadChats]);\r\n\r\n  // Socket handlers: keep the list realtime\r\n  useEffect(() => {\r\n    if (!socket) return;\r\n\r\n    const handleTeamCreated = (payload: any) => {\r\n      const chatPayload = payload?.chat ?? (payload?.team ? { id: payload.team.id, name: payload.team.name, teamId: payload.team.id } : null);\r\n      if (!chatPayload) return;\r\n      setChats((prev) => {\r\n        if (prev.find((p) => p.id === chatPayload.id)) return prev;\r\n        const newRow: LocalChat = {\r\n          id: chatPayload.id,\r\n          name: chatPayload.name ?? `Team ${chatPayload.teamId ?? \"\"}`,\r\n          type: \"GROUP\",\r\n          lastMessage: null,\r\n          unreadCount: 0,\r\n          teamId: chatPayload.teamId ?? null,\r\n        };\r\n        return [newRow, ...prev];\r\n      });\r\n    };\r\n\r\n    const handleChatMessage = (payload: any) => {\r\n      const chatId = payload?.chatId ?? payload?.chat?.id ?? null;\r\n      if (!chatId) return;\r\n      const text = payload?.message?.content ?? payload?.content ?? \"\";\r\n      const createdAt = payload?.message?.createdAt ?? new Date().toISOString();\r\n\r\n      setChats((prev) =>\r\n        prev.map((c) => {\r\n          if (c.id !== chatId) return c;\r\n          return {\r\n            ...c,\r\n            lastMessage: { content: text, createdAt },\r\n            unreadCount: (c.unreadCount ?? 0) + 1,\r\n          };\r\n        })\r\n      );\r\n\r\n      // if chat not present, optionally add a stub (helps admins monitoring)\r\n      setChats((prev) => {\r\n        if (prev.find((c) => c.id === chatId)) return prev;\r\n        const stub: LocalChat = {\r\n          id: chatId,\r\n          name: payload?.chat?.name ?? `Chat ${chatId}`,\r\n          type: payload?.chat?.type ?? \"DIRECT\",\r\n          lastMessage: { content: text, createdAt },\r\n          unreadCount: 1,\r\n          teamId: payload?.chat?.teamId ?? null,\r\n        };\r\n        return [stub, ...prev];\r\n      });\r\n    };\r\n\r\n    socket.on(\"team:created\", handleTeamCreated);\r\n    socket.on(\"chat:message\", handleChatMessage);\r\n\r\n    return () => {\r\n      socket.off(\"team:created\", handleTeamCreated);\r\n      socket.off(\"chat:message\", handleChatMessage);\r\n    };\r\n  }, [socket]);\r\n\r\n  // openChat handler â€” use parent prop if provided, otherwise fall back to chatProvider.openChat()\r\n  const handleOpen = useCallback(\r\n    async (id: string) => {\r\n      try {\r\n        // join the chat room so this client receives real-time messages for it\r\n        try {\r\n          await socket.joinChat?.(id);\r\n        } catch {}\r\n\r\n        if (typeof onOpen === \"function\") {\r\n          onOpen(id);\r\n          return;\r\n        }\r\n\r\n        if (chatProvider && typeof chatProvider.openChat === \"function\") {\r\n          chatProvider.openChat(id);\r\n          return;\r\n        }\r\n\r\n        // fallback: navigate to a route (if you use routes like /dashboard/chat/[id])\r\n        if (typeof window !== \"undefined\") {\r\n          try {\r\n            const base = window.location.pathname.split(\"/dashboard\")[0] || \"\";\r\n            // Do not assume routing scheme â€” only attempt safe history push\r\n            window.history.pushState({}, \"\", `${window.location.pathname}?chatId=${encodeURIComponent(id)}`);\r\n            // leave it to the parent to detect query param and open. This is a safe fallback.\r\n          } catch {}\r\n        }\r\n      } catch (e) {\r\n        // ignore individual failures\r\n      }\r\n    },\r\n    [onOpen, chatProvider, socket]\r\n  );\r\n\r\n  if (loading) return <div className=\"p-4\">Loading chatsâ€¦</div>;\r\n  if (!chats.length) return <div className=\"p-4 text-sm text-gray-600\">No chats yet</div>;\r\n\r\n  return (\r\n    <div className=\"divide-y border-r\">\r\n      {chats.map((c) => (\r\n        <ChatRow key={c.id} chat={c} onOpen={handleOpen} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["c","_c","React","useEffect","useMemo","useState","useCallback","useChat","useChatProvider","useChatSocket","Chat","ChatType","LocalChat","id","name","type","lastMessage","content","createdAt","unreadCount","teamId","meta","ChatRow","t0","$","$i","Symbol","for","chat","onOpen","t1","ChatRow[<button>.onClick]","t2","String","toUpperCase","includes","t3","t4","t5","Date","toLocaleTimeString","t6","t7","t8","t9","t10","t11","t12","ChatList","chatProvider","socket","chats","setChats","loading","setLoading","error","setError","loadChats","res","fetch","credentials","ok","Error","status","j","json","payload","normalized","map","chatType","toISOString","lastMessageAt","err","console","warn","Array","isArray","mapped","Boolean","handleTeamCreated","chatPayload","team","prev","find","p","newRow","handleChatMessage","chatId","text","message","stub","on","off","handleOpen","joinChat","openChat","window","base","location","pathname","split","history","pushState","encodeURIComponent","e","length"],"mappings":"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","ignoreList":[],"debugId":null}}]
}