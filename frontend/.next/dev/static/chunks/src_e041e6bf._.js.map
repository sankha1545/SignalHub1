{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/hooks/useChatSocket.ts"],"sourcesContent":["// src/hooks/useChatSocket.ts\r\n\"use client\";\r\n\r\nimport { useEffect, useRef, useState, useCallback } from \"react\";\r\nimport { io, Socket } from \"socket.io-client\";\r\nimport type { Chat, Message, UserSummary } from \"@/types/chat\";\r\n\r\ntype EventHandlers = {\r\n  onChatCreated?: (chat: Chat) => void;\r\n  onMessageNew?: (message: Message) => void;\r\n  onChatMemberAdded?: (chatId: string, user: UserSummary) => void;\r\n  onChatMemberRemoved?: (chatId: string, userId: string) => void;\r\n  onTyping?: (chatId: string, userId: string, isTyping: boolean) => void;\r\n};\r\n\r\nexport default function useChatSocket(\r\n  token: string | null,\r\n  handlers: EventHandlers = {}\r\n) {\r\n  const socketRef = useRef<Socket | null>(null);\r\n  const [connected, setConnected] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!token) return;\r\n    // connect to socketio endpoint; server should accept cookie or token auth\r\n    const socket = io(\"/api/socketio\", {\r\n      autoConnect: true,\r\n      auth: { token },\r\n      path: \"/api/socketio\", // in case server uses default\r\n    });\r\n\r\n    socketRef.current = socket;\r\n\r\n    socket.on(\"connect\", () => setConnected(true));\r\n    socket.on(\"disconnect\", () => setConnected(false));\r\n\r\n    socket.on(\"chat:created\", (payload: { chat: Chat }) => {\r\n      handlers.onChatCreated?.(payload.chat);\r\n    });\r\n\r\n    socket.on(\"message:new\", (payload: { message: Message }) => {\r\n      handlers.onMessageNew?.(payload.message);\r\n    });\r\n\r\n    socket.on(\"chat:member:added\", (payload: { chatId: string; user: UserSummary }) => {\r\n      handlers.onChatMemberAdded?.(payload.chatId, payload.user);\r\n    });\r\n\r\n    socket.on(\"chat:member:removed\", (payload: { chatId: string; userId: string }) => {\r\n      handlers.onChatMemberRemoved?.(payload.chatId, payload.userId);\r\n    });\r\n\r\n    socket.on(\"typing\", (payload: { chatId: string; userId: string; isTyping: boolean }) => {\r\n      handlers.onTyping?.(payload.chatId, payload.userId, payload.isTyping);\r\n    });\r\n\r\n    return () => {\r\n      socket.disconnect();\r\n      socketRef.current = null;\r\n    };\r\n  }, [token]);\r\n\r\n  const joinChat = useCallback((chatId: string) => {\r\n    socketRef.current?.emit(\"chat:join\", { chatId });\r\n  }, []);\r\n\r\n  const leaveChat = useCallback((chatId: string) => {\r\n    socketRef.current?.emit(\"chat:leave\", { chatId });\r\n  }, []);\r\n\r\n  const sendMessage = useCallback((chatId: string, content: string) => {\r\n    // prefer REST POST to /api/chats/[chatId]/messages for persistence,\r\n    // but also emit via socket for low-latency if server supports it.\r\n    socketRef.current?.emit(\"message:send\", { chatId, content });\r\n  }, []);\r\n\r\n  const emitTyping = useCallback((chatId: string, isTyping: boolean) => {\r\n    socketRef.current?.emit(\"typing\", { chatId, isTyping });\r\n  }, []);\r\n\r\n  return {\r\n    socket: socketRef.current,\r\n    connected,\r\n    joinChat,\r\n    leaveChat,\r\n    sendMessage,\r\n    emitTyping,\r\n  };\r\n}\r\n"],"names":["useEffect","useRef","useState","useCallback","io","Socket","Chat","Message","UserSummary","EventHandlers","onChatCreated","chat","onMessageNew","message","onChatMemberAdded","chatId","user","onChatMemberRemoved","userId","onTyping","isTyping","useChatSocket","token","handlers","socketRef","connected","setConnected","socket","autoConnect","auth","path","current","on","payload","disconnect","joinChat","emit","leaveChat","sendMessage","content","emitTyping"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 121, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/providers/ChatProvider.tsx"],"sourcesContent":["// src/providers/ChatProvider.tsx\r\n\"use client\";\r\n\r\nimport React, { createContext, useContext, useEffect, useMemo, useState } from \"react\";\r\nimport useChatSocket from \"@/hooks/useChatSocket\";\r\nimport type { Chat, Message, UserSummary } from \"@/types/chat\";\r\n\r\n/**\r\n * ChatProvider - holds chat list, active chat, unread counts, and provides helper actions.\r\n *\r\n * Usage:\r\n *  - Wrap your app (or dashboard pages) with <ChatProvider token={authToken}>...</ChatProvider>\r\n *  - Use useChat() hook to access chats, openChat(chatId), sendMessage, etc.\r\n */\r\n\r\ntype ChatContextValue = {\r\n  chats: Chat[];\r\n  setChats: (c: Chat[]) => void;\r\n  activeChatId: string | null;\r\n  openChat: (chatId: string) => void;\r\n  closeChat: () => void;\r\n  sendMessage: (chatId: string, content: string) => Promise<void>;\r\n  addMessageLocally: (message: Message) => void;\r\n  unreadTotal: number;\r\n  loading: boolean;\r\n};\r\n\r\nconst ChatContext = createContext<ChatContextValue | null>(null);\r\n\r\nexport function useChat() {\r\n  const ctx = useContext(ChatContext);\r\n  if (!ctx) throw new Error(\"useChat must be used within ChatProvider\");\r\n  return ctx;\r\n}\r\n\r\nexport function ChatProvider({ token, children }: { token: string | null; children: React.ReactNode }) {\r\n  const [chats, setChats] = useState<Chat[]>([]);\r\n  const [activeChatId, setActiveChatId] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const handlers = {\r\n    onChatCreated: (chat: Chat) => setChats((prev) => [chat, ...prev]),\r\n    onMessageNew: (message: Message) => {\r\n      // bump lastMessage + unread logic\r\n      setChats((prev) =>\r\n        prev.map((c) => {\r\n          if (c.id === message.chatId) {\r\n            const unread = (c.unreadCount ?? 0) + (activeChatId === c.id ? 0 : 1);\r\n            return { ...c, lastMessage: message, unreadCount: unread };\r\n          }\r\n          return c;\r\n        })\r\n      );\r\n    },\r\n    onChatMemberAdded: (chatId: string, user: UserSummary) => {\r\n      setChats((prev) => prev.map((c) => (c.id === chatId ? { ...c, members: [...(c.members ?? []), user] } : c)));\r\n    },\r\n    onChatMemberRemoved: (chatId: string, userId: string) => {\r\n      setChats((prev) => prev.map((c) => (c.id === chatId ? { ...c, members: (c.members ?? []).filter((m) => m.id !== userId) } : c)));\r\n    },\r\n  };\r\n\r\n  const { socket, connected, joinChat, leaveChat, sendMessage: socketSend } = useChatSocket(token, handlers);\r\n\r\n  // Fetch initial chat list\r\n  useEffect(() => {\r\n    if (!token) {\r\n      setChats([]);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    fetch(\"/api/chats\")\r\n      .then((r) => r.json())\r\n      .then((data) => {\r\n        if (data?.ok) {\r\n          setChats(data.chats || []);\r\n        } else {\r\n          setChats([]);\r\n        }\r\n      })\r\n      .catch(() => setChats([]))\r\n      .finally(() => setLoading(false));\r\n  }, [token]);\r\n\r\n  useEffect(() => {\r\n    // when opening activeChat, join via socket\r\n    if (activeChatId && socket) {\r\n      joinChat(activeChatId);\r\n    }\r\n    return () => {\r\n      if (activeChatId && socket) leaveChat(activeChatId);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [activeChatId]);\r\n\r\n  const openChat = (chatId: string) => {\r\n    setActiveChatId(chatId);\r\n    setChats((prev) => prev.map((c) => (c.id === chatId ? { ...c, unreadCount: 0 } : c)));\r\n  };\r\n\r\n  const closeChat = () => setActiveChatId(null);\r\n\r\n  const addMessageLocally = (message: Message) => {\r\n    setChats((prev) =>\r\n      prev.map((c) => (c.id === message.chatId ? { ...c, lastMessage: message } : c))\r\n    );\r\n  };\r\n\r\n  const sendMessage = async (chatId: string, content: string) => {\r\n    // Prefer REST API for durability and server ACLs; also emit socket for low latency.\r\n    try {\r\n      const res = await fetch(`/api/chats/${chatId}`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ content }),\r\n      });\r\n      const json = await res.json();\r\n      if (json?.ok && json?.message) {\r\n        // message will be broadcast by server; optionally also optimistically add\r\n        addMessageLocally(json.message);\r\n      } else {\r\n        // fallback to socket emit\r\n        socketSend(chatId, content);\r\n      }\r\n    } catch (e) {\r\n      // as fallback try socket\r\n      socketSend(chatId, content);\r\n    }\r\n  };\r\n\r\n  const unreadTotal = chats.reduce((sum, c) => sum + (c.unreadCount ?? 0), 0);\r\n\r\n  const ctxValue = useMemo(\r\n    () => ({\r\n      chats,\r\n      setChats,\r\n      activeChatId,\r\n      openChat,\r\n      closeChat,\r\n      sendMessage,\r\n      addMessageLocally,\r\n      unreadTotal,\r\n      loading,\r\n    }),\r\n    [chats, activeChatId, unreadTotal, loading]\r\n  );\r\n\r\n  return <ChatContext.Provider value={ctxValue}>{children}</ChatContext.Provider>;\r\n}\r\n"],"names":["c","_c","React","createContext","useContext","useEffect","useMemo","useState","useChatSocket","Chat","Message","UserSummary","ChatContextValue","chats","setChats","activeChatId","openChat","chatId","closeChat","sendMessage","content","Promise","addMessageLocally","message","unreadTotal","loading","ChatContext","useChat","$","$i","Symbol","for","ctx","Error","ChatProvider","token","children","ReactNode","setActiveChatId","setLoading","handlers","onChatCreated","chat","prev","onMessageNew","map","id","unread","unreadCount","lastMessage","onChatMemberAdded","user","members","onChatMemberRemoved","userId","filter","m","socket","connected","joinChat","leaveChat","socketSend","fetch","then","r","json","data","ok","catch","finally","res","method","headers","body","JSON","stringify","e","reduce","sum","ctxValue"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 322, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/components/chat/ComposeBox.tsx"],"sourcesContent":["// src/components/chat/ComposeBox.tsx\r\n\"use client\";\r\n\r\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport socketClient from \"@/lib/socketClient\";\r\nimport { useChat as useChatProvider } from \"@/providers/ChatProvider\";\r\nimport { useChatSocket } from \"@/app/dashboard/ChatSocketProvider\";\r\n\r\n/**\r\n * ComposeBox\r\n *\r\n * Responsibilities:\r\n * - Let user type and send messages (Enter to send, Shift+Enter newline)\r\n * - Emit optimistic socket events for low-latency UX (typing & message post)\r\n * - Upload attachments to /api/upload and include them in payload\r\n * - Prefer provider.sendMessage() if available; fallback to REST POST /api/chats/:id\r\n * - Call onSent for optimistic and server-confirmed messages so parent (TeamChat) can update list\r\n *\r\n * Props:\r\n *  - chatId: string (required)\r\n *  - onSent?: (message) => void  â€” receives optimistic message immediately and server-confirmed later\r\n *  - onError?: (err) => void\r\n */\r\n\r\ntype Sender = { id: string; name?: string | null; role?: string | null; avatarUrl?: string | null } | null;\r\n\r\nexport type Message = {\r\n  id: string;\r\n  chatId: string;\r\n  senderId?: string | null;\r\n  sender?: Sender;\r\n  content: string;\r\n  contentType?: string;\r\n  metadata?: any;\r\n  attachments?: Array<{ id?: string; url?: string; name?: string }>;\r\n  createdAt: string;\r\n};\r\n\r\nexport default function ComposeBox({\r\n  chatId,\r\n  onSent,\r\n  onError,\r\n}: {\r\n  chatId: string;\r\n  onSent?: (m: Message) => void;\r\n  onError?: (e: any) => void;\r\n}) {\r\n  const [text, setText] = useState(\"\");\r\n  const [sending, setSending] = useState(false);\r\n  const [files, setFiles] = useState<File[]>([]);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [status, setStatus] = useState<string | null>(null);\r\n\r\n  const textareaRef = useRef<HTMLTextAreaElement | null>(null);\r\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\r\n  const typingTimerRef = useRef<number | null>(null);\r\n  const lastTypedAtRef = useRef<number | null>(null);\r\n\r\n  // prefer your ChatProvider if available (sendMessage)\r\n  let providerSend: ((chatId: string, content: string, opts?: any) => Promise<any>) | null = null;\r\n  try {\r\n    const prov = useChatProvider?.();\r\n    if (prov && typeof prov.sendMessage === \"function\") providerSend = prov.sendMessage.bind(prov);\r\n  } catch {\r\n    providerSend = null;\r\n  }\r\n\r\n  // socket provider (preferred) or fallback to raw client\r\n  let chatSocket: any = null;\r\n  try {\r\n    chatSocket = useChatSocket();\r\n  } catch {\r\n    chatSocket = null;\r\n  }\r\n\r\n  // -------------------------\r\n  // Helpers\r\n  // -------------------------\r\n  const makeOptimisticMessage = useCallback(\r\n    (content: string, attachments?: Message[\"attachments\"]): Message => {\r\n      return {\r\n        id: `local-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\r\n        chatId,\r\n        senderId: \"me\",\r\n        sender: { id: \"me\", name: \"You\" },\r\n        content,\r\n        contentType: \"TEXT\",\r\n        metadata: { optimistic: true },\r\n        attachments: attachments ?? [],\r\n        createdAt: new Date().toISOString(),\r\n      };\r\n    },\r\n    [chatId]\r\n  );\r\n\r\n  const emitTyping = useCallback(\r\n    (isTyping: boolean) => {\r\n      try {\r\n        const payload = { chatId, user: { /* server-side will resolve real user */ }, typing: isTyping };\r\n        if (chatSocket && typeof chatSocket.emit === \"function\") {\r\n          chatSocket.emit(\"chat:typing\", payload);\r\n        } else {\r\n          socketClient.emit?.(\"chat:typing\", payload);\r\n        }\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n    },\r\n    [chatId, chatSocket]\r\n  );\r\n\r\n  // debounce typing â€” call on key press, stop after 1200ms idle\r\n  const notifyTyping = useCallback(() => {\r\n    lastTypedAtRef.current = Date.now();\r\n    // send \"typing\" once immediately\r\n    emitTyping(true);\r\n\r\n    if (typingTimerRef.current) {\r\n      window.clearTimeout(typingTimerRef.current);\r\n    }\r\n\r\n    typingTimerRef.current = window.setTimeout(() => {\r\n      const last = lastTypedAtRef.current ?? 0;\r\n      if (Date.now() - last >= 1100) {\r\n        emitTyping(false);\r\n        typingTimerRef.current = null;\r\n      }\r\n    }, 1200);\r\n  }, [emitTyping]);\r\n\r\n  // autosize textarea\r\n  useEffect(() => {\r\n    const el = textareaRef.current;\r\n    if (!el) return;\r\n    el.style.height = \"auto\";\r\n    const next = Math.min(240, el.scrollHeight);\r\n    el.style.height = `${next}px`;\r\n  }, [text]);\r\n\r\n  // -------------------------\r\n  // File handling & upload\r\n  // -------------------------\r\n  const onFilesSelected = (fl?: FileList | null) => {\r\n    if (!fl) return;\r\n    const arr = Array.from(fl);\r\n    // limit to 5 files to avoid abuse\r\n    const next = [...files, ...arr].slice(0, 5);\r\n    setFiles(next);\r\n  };\r\n\r\n  const removeFile = (idx: number) => setFiles((p) => p.filter((_, i) => i !== idx));\r\n\r\n  async function uploadFiles(): Promise<Message[\"attachments\"]> {\r\n    if (files.length === 0) return [];\r\n    setUploading(true);\r\n    const uploaded: Message[\"attachments\"] = [];\r\n    for (const f of files) {\r\n      try {\r\n        const fd = new FormData();\r\n        fd.append(\"file\", f);\r\n        const res = await fetch(\"/api/upload\", {\r\n          method: \"POST\",\r\n          body: fd,\r\n          credentials: \"same-origin\",\r\n        });\r\n        if (!res.ok) {\r\n          console.warn(\"upload failed\", res.status);\r\n          continue;\r\n        }\r\n        const j = await res.json().catch(() => ({}));\r\n        // try common shapes\r\n        if (j?.file) uploaded.push(j.file);\r\n        else if (j?.url) uploaded.push({ id: j.id ?? String(Date.now()), url: j.url, name: f.name });\r\n        else if (j?.data?.url) uploaded.push({ id: j.data.id ?? String(Date.now()), url: j.data.url, name: f.name });\r\n      } catch (e) {\r\n        console.warn(\"upload error\", e);\r\n      }\r\n    }\r\n    setUploading(false);\r\n    return uploaded;\r\n  }\r\n\r\n  // -------------------------\r\n  // Send flow\r\n  // -------------------------\r\n  const send = useCallback(\r\n    async (ev?: React.SyntheticEvent) => {\r\n      if (ev) ev.preventDefault();\r\n      if (!chatId) return;\r\n      const body = text.trim();\r\n      if (!body && files.length === 0) return;\r\n\r\n      setSending(true);\r\n      setStatus(\"sending\");\r\n\r\n      // optimistic message\r\n      let optimisticAttachments: Message[\"attachments\"] = [];\r\n      // We can show local file names immediately\r\n      if (files.length > 0) {\r\n        optimisticAttachments = files.map((f, idx) => ({ id: `local-file-${idx}-${Date.now()}`, name: f.name }));\r\n      }\r\n      const optimistic = makeOptimisticMessage(body || (files.length ? `(Attachment${files.length > 1 ? \"s\" : \"\"})` : \"\"), optimisticAttachments);\r\n\r\n      try {\r\n        // notify parent immediately with optimistic msg\r\n        try {\r\n          onSent?.(optimistic);\r\n        } catch (e) {\r\n          // swallow user callback errors\r\n          console.warn(\"onSent callback error\", e);\r\n        }\r\n\r\n        // optimistic socket emit so others see it fast\r\n        try {\r\n          const payload = { chatId, message: { content: body, attachments: optimisticAttachments, metadata: { optimistic: true } } };\r\n          if (chatSocket && typeof chatSocket.emit === \"function\") {\r\n            chatSocket.emit(\"chat:post\", payload);\r\n            chatSocket.emit(\"chat:message\", payload);\r\n          } else {\r\n            socketClient.emit?.(\"chat:post\", payload);\r\n            socketClient.emit?.(\"chat:message\", payload);\r\n            socketClient.emit?.(\"message\", payload);\r\n          }\r\n        } catch (e) {\r\n          // ignore emit errors\r\n        }\r\n\r\n        // Upload attachments first, then persist\r\n        const attachments = await uploadFiles();\r\n\r\n        // Build final payload\r\n        const payload = {\r\n          content: body,\r\n          metadata: attachments.length ? { attachments } : undefined,\r\n          attachments: attachments.length ? attachments : undefined,\r\n        };\r\n\r\n        // Prefer provider send if available\r\n        if (providerSend) {\r\n          try {\r\n            const result = await providerSend(chatId, body, { attachments });\r\n            // provider may return message; call onSent with normalized message\r\n            if (result && typeof result === \"object\") {\r\n              const created = result?.message ?? result ?? {};\r\n              const normalized: Message = {\r\n                id: String(created.id ?? created.messageId ?? `srv-${Date.now()}`),\r\n                chatId,\r\n                senderId: created.senderId ?? created.sender?.id ?? null,\r\n                sender: created.sender ?? null,\r\n                content: created.content ?? body,\r\n                contentType: created.contentType ?? \"TEXT\",\r\n                metadata: created.metadata ?? created.meta ?? null,\r\n                attachments: created.attachments ?? attachments ?? [],\r\n                createdAt: created.createdAt ?? new Date().toISOString(),\r\n              };\r\n              onSent?.(normalized);\r\n              setStatus(null);\r\n              setSending(false);\r\n              setText(\"\");\r\n              setFiles([]);\r\n              return;\r\n            }\r\n          } catch (err) {\r\n            console.warn(\"providerSend failed, falling back to REST\", err);\r\n            // fallthrough to REST\r\n          }\r\n        }\r\n\r\n        // REST fallback\r\n        try {\r\n          const res = await fetch(`/api/chats/${encodeURIComponent(chatId)}`, {\r\n            method: \"POST\",\r\n            credentials: \"same-origin\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify(payload),\r\n          });\r\n\r\n          if (res.ok) {\r\n            const j = await res.json().catch(() => ({}));\r\n            const created = j?.message ?? j ?? null;\r\n            if (created) {\r\n              const normalized: Message = {\r\n                id: String(created.id ?? created.messageId ?? `srv-${Date.now()}`),\r\n                chatId,\r\n                senderId: created.senderId ?? created.sender?.id ?? null,\r\n                sender: created.sender ?? null,\r\n                content: created.content ?? body,\r\n                contentType: created.contentType ?? \"TEXT\",\r\n                metadata: created.metadata ?? created.meta ?? null,\r\n                attachments: created.attachments ?? attachments ?? [],\r\n                createdAt: created.createdAt ?? new Date().toISOString(),\r\n              };\r\n              onSent?.(normalized);\r\n              setStatus(null);\r\n              setSending(false);\r\n              setText(\"\");\r\n              setFiles([]);\r\n              return;\r\n            }\r\n          } else {\r\n            console.warn(\"POST /api/chats returned non-OK\", res.status);\r\n            onError?.({ message: `Server error ${res.status}` });\r\n          }\r\n        } catch (err) {\r\n          console.warn(\"POST /api/chats failed\", err);\r\n          onError?.(err);\r\n        }\r\n      } catch (err) {\r\n        console.warn(\"send flow error\", err);\r\n        onError?.(err);\r\n      } finally {\r\n        setStatus(null);\r\n        setSending(false);\r\n      }\r\n    },\r\n    [chatId, text, files, makeOptimisticMessage, onSent, providerSend, chatSocket, onError]\r\n  );\r\n\r\n  // keyboard: Enter to send (no Shift)\r\n  const onKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n    if (e.key === \"Enter\" && !e.shiftKey) {\r\n      e.preventDefault();\r\n      void send();\r\n    } else {\r\n      // user typed â€” notify typing (debounced)\r\n      notifyTyping();\r\n    }\r\n  };\r\n\r\n  // cleanup on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (typingTimerRef.current) {\r\n        window.clearTimeout(typingTimerRef.current);\r\n        typingTimerRef.current = null;\r\n      }\r\n      emitTyping(false);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  // small visual: attachments list + accessible labels\r\n  return (\r\n    <form\r\n      onSubmit={(e) => {\r\n        e.preventDefault();\r\n        void send();\r\n      }}\r\n      className=\"space-y-2\"\r\n      aria-live=\"polite\"\r\n    >\r\n      {files.length > 0 && (\r\n        <div className=\"flex gap-2 items-center overflow-auto max-w-full\">\r\n          {files.map((f, i) => (\r\n            <div key={i} className=\"flex items-center gap-2 px-2 py-1 bg-slate-50 border rounded text-xs\">\r\n              <div className=\"truncate max-w-[200px]\" title={f.name}>\r\n                {f.name}\r\n              </div>\r\n              <button\r\n                type=\"button\"\r\n                aria-label={`Remove ${f.name}`}\r\n                onClick={() => removeFile(i)}\r\n                className=\"text-rose-600 font-bold px-1\"\r\n              >\r\n                Ã—\r\n              </button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"flex gap-2 items-end\">\r\n        <textarea\r\n          ref={textareaRef}\r\n          value={text}\r\n          onChange={(e) => setText(e.target.value)}\r\n          onKeyDown={onKeyDown}\r\n          placeholder=\"Write a message...\"\r\n          aria-label=\"Type a message\"\r\n          className=\"flex-1 min-h-[44px] max-h-[240px] resize-none border rounded p-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n          rows={2}\r\n          disabled={sending}\r\n        />\r\n\r\n        <div className=\"flex flex-col items-stretch gap-2\">\r\n          <input\r\n            ref={fileInputRef}\r\n            type=\"file\"\r\n            multiple\r\n            className=\"hidden\"\r\n            onChange={(e) => onFilesSelected(e.target.files)}\r\n            aria-hidden\r\n          />\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => fileInputRef.current?.click()}\r\n              className=\"px-3 py-2 bg-slate-50 border rounded hover:bg-slate-100\"\r\n              aria-label=\"Attach files\"\r\n              title=\"Attach files\"\r\n              disabled={uploading || sending}\r\n            >\r\n              ðŸ“Ž\r\n            </button>\r\n\r\n            <button\r\n              type=\"submit\"\r\n              disabled={sending || uploading || (!text.trim() && files.length === 0)}\r\n              className={`px-4 py-2 rounded text-white ${sending ? \"bg-slate-300 cursor-wait\" : \"bg-blue-600 hover:bg-blue-700\"}`}\r\n              aria-label=\"Send message\"\r\n            >\r\n              {sending ? \"Sendingâ€¦\" : \"Send\"}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* status text for screen readers & users */}\r\n      <div className=\"text-xs text-slate-500\" aria-live=\"polite\">\r\n        {uploading ? \"Uploading attachmentsâ€¦ \" : null}\r\n        {status ? status : null}\r\n      </div>\r\n    </form>\r\n  );\r\n}\r\n"],"names":["React","useCallback","useEffect","useRef","useState","socketClient","useChat","useChatProvider","useChatSocket","Sender","id","name","role","avatarUrl","Message","chatId","senderId","sender","content","contentType","metadata","attachments","Array","url","createdAt","ComposeBox","onSent","onError","m","e","text","setText","sending","setSending","files","setFiles","File","uploading","setUploading","status","setStatus","textareaRef","HTMLTextAreaElement","fileInputRef","HTMLInputElement","typingTimerRef","lastTypedAtRef","providerSend","opts","Promise","prov","sendMessage","bind","chatSocket","makeOptimisticMessage","Date","now","Math","random","toString","slice","optimistic","toISOString","emitTyping","isTyping","payload","user","typing","emit","notifyTyping","current","window","clearTimeout","setTimeout","last","el","style","height","next","min","scrollHeight","onFilesSelected","fl","FileList","arr","from","removeFile","idx","p","filter","_","i","uploadFiles","length","uploaded","f","fd","FormData","append","res","fetch","method","body","credentials","ok","console","warn","j","json","catch","file","push","String","data","send","ev","SyntheticEvent","preventDefault","trim","optimisticAttachments","map","message","undefined","result","created","normalized","messageId","meta","err","encodeURIComponent","headers","JSON","stringify","onKeyDown","KeyboardEvent","key","shiftKey","target","value","click"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 832, "column": 0}, "map": {"version":3,"sources":["E:/Attack Capital/SignalHub/frontend/src/components/chat/TeamChat.tsx"],"sourcesContent":["// src/components/chat/TeamChat.tsx\r\n\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport socketClient from \"@/lib/socketClient\";\r\nimport ComposeBox, { Message as OutgoingMessage } from \"@/components/chat/ComposeBox\";\r\nimport { useChatSocket } from \"@/app/dashboard/ChatSocketProvider\"; // your provider path\r\nimport type { ChatMessage as ServerChatMessage } from \"@/types/chat\"; // optional - keep if you have types\r\n\r\ntype MinimalUser = { id: string; role?: string; name?: string; email?: string };\r\n\r\nexport type ChatMessage = {\r\n  id: string;\r\n  chatId: string;\r\n  content: string;\r\n  metadata?: any;\r\n  externalId?: string | null;\r\n  createdAt?: string | null;\r\n  sender?: { id: string; name?: string | null; email?: string | null } | null;\r\n  attachments?: Array<{ id?: string; url?: string; name?: string }>;\r\n};\r\n\r\nexport default function TeamChat({\r\n  chatId,\r\n  currentUser,\r\n}: {\r\n  chatId: string;\r\n  currentUser?: MinimalUser;\r\n}) {\r\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\r\n  const [loading, setLoading] = useState<boolean>(true);\r\n  const [sending, setSending] = useState(false);\r\n  const listRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  // prefer provider socket\r\n  let chatSocket: any = null;\r\n  try {\r\n    chatSocket = useChatSocket();\r\n  } catch {\r\n    chatSocket = null;\r\n  }\r\n\r\n  // seen IDs to avoid duplicates\r\n  const seenIdsRef = useRef<Set<string>>(new Set());\r\n\r\n  // helper: mark chat read (best-effort)\r\n  const markRead = async () => {\r\n    try {\r\n      await fetch(`/api/chats/${encodeURIComponent(chatId)}/read`, {\r\n        method: \"POST\",\r\n        credentials: \"same-origin\",\r\n      });\r\n    } catch (err) {\r\n      // non-fatal\r\n      console.warn(\"markRead failed:\", err);\r\n    }\r\n  };\r\n\r\n  // load history and join room\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    const fetchHistory = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const res = await fetch(`/api/chats/${encodeURIComponent(chatId)}`, { credentials: \"same-origin\" });\r\n        if (!mounted) return;\r\n        const j = await res.json().catch(() => ({}));\r\n        const msgs: ChatMessage[] = (j?.messages ?? []) as ChatMessage[];\r\n        seenIdsRef.current = new Set(msgs.map((m) => m.id));\r\n        if (mounted) setMessages(msgs);\r\n        // mark read after loading\r\n        void markRead();\r\n      } catch (err) {\r\n        console.warn(\"Failed to load chat history:\", err);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchHistory();\r\n\r\n    // join via provider or fallback\r\n    (async () => {\r\n      try {\r\n        if (chatSocket && typeof chatSocket.joinChat === \"function\") {\r\n          await chatSocket.joinChat(chatId);\r\n        } else {\r\n          socketClient.emit?.(\"join-room\", chatId);\r\n          socketClient.emit?.(\"join\", chatId);\r\n        }\r\n      } catch (err) {\r\n        console.warn(\"join chat failed:\", err);\r\n      }\r\n    })();\r\n\r\n    return () => {\r\n      mounted = false;\r\n      try {\r\n        if (chatSocket && typeof chatSocket.leaveChat === \"function\") {\r\n          chatSocket.leaveChat(chatId).catch(() => {});\r\n        } else {\r\n          socketClient.emit?.(\"leave-room\", chatId);\r\n          socketClient.emit?.(\"leave\", chatId);\r\n        }\r\n      } catch (err) {\r\n        // ignore\r\n      }\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [chatId]);\r\n\r\n  // socket message & read listeners\r\n  useEffect(() => {\r\n    const handler = (payload: any) => {\r\n      try {\r\n        // server may send { chatId, message } or the message directly\r\n        const incomingChatId = payload?.chatId ?? payload?.message?.chatId ?? payload?.message?.chat_id;\r\n        const msg = payload?.message ?? (payload?.id ? payload : null);\r\n        if (!msg) return;\r\n        if (incomingChatId && incomingChatId !== chatId) return;\r\n\r\n        // dedupe\r\n        if (msg.id && seenIdsRef.current.has(msg.id)) return;\r\n        if (msg.id) seenIdsRef.current.add(msg.id);\r\n\r\n        setMessages((prev) => {\r\n          // replace optimistic if matching by content + sender\r\n          const optimisticIndex = prev.findIndex(\r\n            (p) =>\r\n              typeof p.id === \"string\" &&\r\n              p.id.startsWith(\"local-\") &&\r\n              p.content === msg.content &&\r\n              p.sender?.id === msg.sender?.id\r\n          );\r\n          if (optimisticIndex >= 0) {\r\n            const copy = [...prev];\r\n            // delete old local id from seen set\r\n            const oldId = copy[optimisticIndex].id;\r\n            copy[optimisticIndex] = msg;\r\n            if (oldId) seenIdsRef.current.delete(oldId);\r\n            if (msg.id) seenIdsRef.current.add(msg.id);\r\n            return copy;\r\n          }\r\n          return [...prev, msg];\r\n        });\r\n      } catch (e) {\r\n        console.warn(\"socket handler err:\", e);\r\n      }\r\n    };\r\n\r\n    const readHandler = (payload: any) => {\r\n      // payload may contain read receipts; currently no UI update, but kept for extension\r\n      // e.g. { chatId, userId, lastReadAt }\r\n    };\r\n\r\n    try {\r\n      if (chatSocket && typeof chatSocket.on === \"function\") {\r\n        chatSocket.on(\"chat:message\", handler);\r\n        chatSocket.on(\"message\", handler);\r\n        chatSocket.on(\"chat:read\", readHandler);\r\n      } else {\r\n        socketClient.on(\"chat:message\", handler);\r\n        socketClient.on(\"message\", handler);\r\n        socketClient.on(\"chat:read\", readHandler);\r\n      }\r\n    } catch (e) {\r\n      console.warn(\"socket subscribe failed:\", e);\r\n    }\r\n\r\n    return () => {\r\n      try {\r\n        if (chatSocket && typeof chatSocket.off === \"function\") {\r\n          chatSocket.off(\"chat:message\", handler);\r\n          chatSocket.off(\"message\", handler);\r\n          chatSocket.off(\"chat:read\", readHandler);\r\n        } else {\r\n          socketClient.off(\"chat:message\", handler);\r\n          socketClient.off(\"message\", handler);\r\n          socketClient.off(\"chat:read\", readHandler);\r\n        }\r\n      } catch {}\r\n    };\r\n  }, [chatId, chatSocket]);\r\n\r\n  // scroll to bottom when messages change\r\n  useEffect(() => {\r\n    if (!listRef.current) return;\r\n    requestAnimationFrame(() => {\r\n      try {\r\n        listRef.current!.scrollTop = listRef.current!.scrollHeight;\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n    });\r\n  }, [messages.length]);\r\n\r\n  // handle outgoing messages via ComposeBox -> onSent\r\n  const handleOutgoing = async (m: OutgoingMessage) => {\r\n    // ComposeBox will call onSent twice:\r\n    //  - first with optimistic local message (id starts with local-)\r\n    //  - later with server-normalized message (id from server)\r\n    // We'll merge/update messages accordingly.\r\n    try {\r\n      // If optimistic (local id), append if not present\r\n      if (typeof m.id === \"string\" && m.id.startsWith(\"local-\")) {\r\n        if (!seenIdsRef.current.has(m.id)) {\r\n          seenIdsRef.current.add(m.id);\r\n          setMessages((prev) => [...prev, m as unknown as ChatMessage]);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // server-confirmed message: replace any optimistic with same content+sender OR append\r\n      setMessages((prev) => {\r\n        const optIndex = prev.findIndex(\r\n          (p) => typeof p.id === \"string\" && p.id.startsWith(\"local-\") && p.content === m.content && p.sender?.id === m.senderId\r\n        );\r\n        if (optIndex >= 0) {\r\n          const copy = [...prev];\r\n          // remove optimistic id from seen set\r\n          const oldId = copy[optIndex].id;\r\n          copy[optIndex] = m as unknown as ChatMessage;\r\n          if (oldId) seenIdsRef.current.delete(oldId);\r\n          if (m.id) seenIdsRef.current.add(String(m.id));\r\n          return copy;\r\n        }\r\n        // avoid dup by server id\r\n        if (m.id && seenIdsRef.current.has(String(m.id))) return prev;\r\n        if (m.id) seenIdsRef.current.add(String(m.id));\r\n        return [...prev, m as unknown as ChatMessage];\r\n      });\r\n\r\n      // mark read for the author (they have read their own message)\r\n      void markRead();\r\n    } catch (e) {\r\n      console.warn(\"handleOutgoing error:\", e);\r\n    }\r\n  };\r\n\r\n  // optional: a minimal Message view; you can replace with a dedicated MessageBubble component\r\n  const MessageView = ({ msg }: { msg: ChatMessage }) => {\r\n    const isMine = currentUser && msg.sender?.id === currentUser.id;\r\n    return (\r\n      <div className={`flex gap-3 ${isMine ? \"justify-end\" : \"justify-start\"}`}>\r\n        {!isMine && (\r\n          <div className=\"w-9 h-9 rounded-full bg-slate-200 flex items-center justify-center text-sm\">\r\n            {msg.sender?.name ? msg.sender.name[0] : \"U\"}\r\n          </div>\r\n        )}\r\n\r\n        <div className={`max-w-[78%] p-3 rounded-xl ${isMine ? \"bg-blue-600 text-white\" : \"bg-slate-100 text-slate-800\"}`}>\r\n          <div className=\"text-sm whitespace-pre-wrap\">{msg.content}</div>\r\n          {msg.attachments?.length ? (\r\n            <div className=\"mt-2 space-y-1\">\r\n              {msg.attachments.map((a, i) => (\r\n                <a key={i} href={a.url} target=\"_blank\" rel=\"noreferrer\" className=\"text-xs underline\">\r\n                  {a.name ?? a.url}\r\n                </a>\r\n              ))}\r\n            </div>\r\n          ) : null}\r\n          <div className=\"text-[10px] text-slate-400 mt-1 text-right\">{msg.createdAt ? new Date(msg.createdAt).toLocaleString() : \"\"}</div>\r\n        </div>\r\n\r\n        {isMine && (\r\n          <div className=\"w-9 h-9 rounded-full bg-transparent\" />\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full min-h-[200px]\">\r\n      <div ref={listRef} className=\"flex-1 overflow-auto p-4 space-y-3\">\r\n        {loading ? (\r\n          <div className=\"text-sm text-slate-500\">Loading messagesâ€¦</div>\r\n        ) : messages.length === 0 ? (\r\n          <div className=\"text-sm text-slate-500\">No messages yet.</div>\r\n        ) : (\r\n          messages.map((m) => <MessageView key={m.id} msg={m} />)\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"p-3 border-t\">\r\n        <ComposeBox chatId={chatId} onSent={handleOutgoing} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["React","useEffect","useRef","useState","socketClient","ComposeBox","Message","OutgoingMessage","useChatSocket","ChatMessage","ServerChatMessage","MinimalUser","id","role","name","email","chatId","content","metadata","externalId","createdAt","sender","attachments","Array","url","TeamChat","currentUser","messages","setMessages","loading","setLoading","sending","setSending","listRef","HTMLDivElement","chatSocket","seenIdsRef","Set","markRead","fetch","encodeURIComponent","method","credentials","err","console","warn","mounted","fetchHistory","res","j","json","catch","msgs","current","map","m","joinChat","emit","leaveChat","handler","payload","incomingChatId","message","chat_id","msg","has","add","prev","optimisticIndex","findIndex","p","startsWith","copy","oldId","delete","e","readHandler","on","off","requestAnimationFrame","scrollTop","scrollHeight","length","handleOutgoing","optIndex","senderId","String","MessageView","isMine","a","i","Date","toLocaleString"],"mappings":"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","ignoreList":[],"debugId":null}}]
}