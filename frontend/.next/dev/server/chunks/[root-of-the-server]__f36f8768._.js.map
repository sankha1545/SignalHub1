{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  // prevent multiple instantiation in dev\r\n  // eslint-disable-next-line no-var\r\n  var prisma: PrismaClient | undefined;\r\n}\r\n\r\nexport const prisma =\r\n  global.prisma ??\r\n  new PrismaClient({\r\n    log: [\"query\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAQO,MAAM,SACX,OAAO,MAAM,IACb,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,OAAO,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/api/phone/send-otp/route.ts"],"sourcesContent":["// app/api/phone/send-otp/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\nconst OTP_TTL_MS = 5 * 60 * 1000; // 5 minutes\r\nconst OTP_LENGTH = 4;\r\n\r\nfunction genOtp(len = OTP_LENGTH) {\r\n  let s = \"\";\r\n  for (let i = 0; i < len; i++) s += Math.floor(Math.random() * 10).toString();\r\n  return s;\r\n}\r\n\r\n// send via Twilio if configured, otherwise console.log for dev\r\nasync function sendSms(phone: string, text: string) {\r\n  const sid = process.env.TWILIO_ACCOUNT_SID;\r\n  const token = process.env.TWILIO_AUTH_TOKEN;\r\n  const from = process.env.TWILIO_FROM;\r\n  if (sid && token && from) {\r\n    // only import twilio when configured (avoid requiring package if you're not using)\r\n    // make sure 'twilio' package is installed if you plan to use it.\r\n    // fallback: simple fetch to Twilio REST API using Basic auth\r\n    const resp = await fetch(`https://api.twilio.com/2010-04-01/Accounts/${sid}/Messages.json`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        Authorization: \"Basic \" + Buffer.from(`${sid}:${token}`).toString(\"base64\"),\r\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n      },\r\n      body: new URLSearchParams({\r\n        From: from,\r\n        To: phone,\r\n        Body: text,\r\n      }),\r\n    });\r\n    if (!resp.ok) {\r\n      const txt = await resp.text();\r\n      throw new Error(\"Twilio error: \" + txt);\r\n    }\r\n    return true;\r\n  } else {\r\n    // dev fallback\r\n    console.log(`[DEV SMS] To: ${phone} â€” OTP: ${text}`);\r\n    return true;\r\n  }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const body = await req.json().catch(() => ({}));\r\n    const { phone } = body as { phone?: string };\r\n\r\n    if (!phone || typeof phone !== \"string\") {\r\n      return NextResponse.json({ error: \"phone required\" }, { status: 400 });\r\n    }\r\n\r\n    // basic validation: E.164 starts with +\r\n    if (!phone.startsWith(\"+\") || phone.length < 6) {\r\n      return NextResponse.json({ error: \"phone must be E.164 (e.g. +919876543210)\" }, { status: 400 });\r\n    }\r\n\r\n    // generate OTP\r\n    const otp = genOtp();\r\n\r\n    // Create OTP record\r\n    await prisma.phoneOtp.create({\r\n      data: {\r\n        phone,\r\n        otp,\r\n        used: false,\r\n      },\r\n    });\r\n\r\n    // send SMS (async)\r\n    try {\r\n      await sendSms(phone, `Your verification code is ${otp}. It will expire in 5 minutes.`);\r\n    } catch (err) {\r\n      console.error(\"Failed to send SMS:\", err);\r\n      // do not reveal Twilio errors to client\r\n      return NextResponse.json({ error: \"Failed to send SMS\" }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ ok: true, message: \"OTP sent\" });\r\n  } catch (err) {\r\n    console.error(err);\r\n    return NextResponse.json({ error: \"Server error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,kCAAkC;;;;;AAClC;AACA;;;AAEA,MAAM,aAAa,IAAI,KAAK,MAAM,YAAY;AAC9C,MAAM,aAAa;AAEnB,SAAS,OAAO,MAAM,UAAU;IAC9B,IAAI,IAAI;IACR,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,IAAK,KAAK,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,IAAI,QAAQ;IAC1E,OAAO;AACT;AAEA,+DAA+D;AAC/D,eAAe,QAAQ,KAAa,EAAE,IAAY;IAChD,MAAM,MAAM,QAAQ,GAAG,CAAC,kBAAkB;IAC1C,MAAM,QAAQ,QAAQ,GAAG,CAAC,iBAAiB;IAC3C,MAAM,OAAO,QAAQ,GAAG,CAAC,WAAW;IACpC,IAAI,OAAO,SAAS,MAAM;QACxB,mFAAmF;QACnF,iEAAiE;QACjE,6DAA6D;QAC7D,MAAM,OAAO,MAAM,MAAM,CAAC,2CAA2C,EAAE,IAAI,cAAc,CAAC,EAAE;YAC1F,QAAQ;YACR,SAAS;gBACP,eAAe,WAAW,OAAO,IAAI,CAAC,GAAG,IAAI,CAAC,EAAE,OAAO,EAAE,QAAQ,CAAC;gBAClE,gBAAgB;YAClB;YACA,MAAM,IAAI,gBAAgB;gBACxB,MAAM;gBACN,IAAI;gBACJ,MAAM;YACR;QACF;QACA,IAAI,CAAC,KAAK,EAAE,EAAE;YACZ,MAAM,MAAM,MAAM,KAAK,IAAI;YAC3B,MAAM,IAAI,MAAM,mBAAmB;QACrC;QACA,OAAO;IACT,OAAO;QACL,eAAe;QACf,QAAQ,GAAG,CAAC,CAAC,cAAc,EAAE,MAAM,QAAQ,EAAE,MAAM;QACnD,OAAO;IACT;AACF;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC7C,MAAM,EAAE,KAAK,EAAE,GAAG;QAElB,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU;YACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,wCAAwC;QACxC,IAAI,CAAC,MAAM,UAAU,CAAC,QAAQ,MAAM,MAAM,GAAG,GAAG;YAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2C,GAAG;gBAAE,QAAQ;YAAI;QAChG;QAEA,eAAe;QACf,MAAM,MAAM;QAEZ,oBAAoB;QACpB,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;YAC3B,MAAM;gBACJ;gBACA;gBACA,MAAM;YACR;QACF;QAEA,mBAAmB;QACnB,IAAI;YACF,MAAM,QAAQ,OAAO,CAAC,0BAA0B,EAAE,IAAI,8BAA8B,CAAC;QACvF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,uBAAuB;YACrC,wCAAwC;YACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,SAAS;QAAW;IAC3D,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF","debugId":null}}]
}