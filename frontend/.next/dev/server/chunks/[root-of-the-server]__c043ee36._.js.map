{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line\r\n  var __prisma__: PrismaClient | undefined;\r\n}\r\nexport const prisma =\r\n  global.__prisma__ ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"warn\", \"error\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.__prisma__ = prisma;\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;;AAMO,MAAM,SACX,OAAO,UAAU,IACjB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAQ;KAAQ,GAAG;AAC7E;AAEF,wCAA2C,OAAO,UAAU,GAAG","debugId":null}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/jwt.ts"],"sourcesContent":["// src/lib/jwt.ts\r\nimport jwt, { JwtPayload } from \"jsonwebtoken\";\r\n\r\nconst SECRET = process.env.JWT_SECRET;\r\nif (!SECRET) {\r\n  if (process.env.NODE_ENV === \"production\") {\r\n    throw new Error(\"JWT_SECRET environment variable must be set in production!\");\r\n  } else {\r\n    console.warn(\"[JWT] Using fallback secret for development\");\r\n  }\r\n}\r\n\r\n/**\r\n * üîê Create a short-lived temp token (email/phone verification)\r\n */\r\nexport function signTemp(payload: Record<string, any>, expiresIn: string = \"15m\"): string {\r\n  const safePayload = { ...payload };\r\n  delete safePayload.exp;\r\n  return jwt.sign(safePayload, SECRET!, { expiresIn });\r\n}\r\n\r\n/**\r\n * ‚úÖ Verify short-lived temp tokens\r\n * Returns payload object or null if invalid/expired\r\n */\r\nexport function verifyTemp(token: string): Record<string, any> | null {\r\n  try {\r\n    return jwt.verify(token, SECRET!) as Record<string, any>;\r\n  } catch (err) {\r\n    console.warn(\"[JWT] verifyTemp failed:\", (err as Error).message);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * üíæ Create a long-lived session token for logged-in users\r\n */\r\nexport function signSession(payload: Record<string, any>, expiresIn: string = \"7d\"): string {\r\n  const safePayload = { ...payload };\r\n  delete safePayload.exp;\r\n  return jwt.sign(safePayload, SECRET!, { expiresIn });\r\n}\r\n\r\n/**\r\n * üîé Verify a session token\r\n * Returns payload object or null if invalid/expired\r\n */\r\nexport function verifySession(token: string): Record<string, any> | null {\r\n  try {\r\n    return jwt.verify(token, SECRET!) as Record<string, any>;\r\n  } catch (err) {\r\n    console.warn(\"[JWT] verifySession failed:\", (err as Error).message);\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,iBAAiB;;;;;;;;;;;AACjB;;AAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;AACrC,IAAI,CAAC,QAAQ;IACX;;SAEO;QACL,QAAQ,IAAI,CAAC;IACf;AACF;AAKO,SAAS,SAAS,OAA4B,EAAE,YAAoB,KAAK;IAC9E,MAAM,cAAc;QAAE,GAAG,OAAO;IAAC;IACjC,OAAO,YAAY,GAAG;IACtB,OAAO,kJAAG,CAAC,IAAI,CAAC,aAAa,QAAS;QAAE;IAAU;AACpD;AAMO,SAAS,WAAW,KAAa;IACtC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,QAAQ,IAAI,CAAC,4BAA4B,AAAC,IAAc,OAAO;QAC/D,OAAO;IACT;AACF;AAKO,SAAS,YAAY,OAA4B,EAAE,YAAoB,IAAI;IAChF,MAAM,cAAc;QAAE,GAAG,OAAO;IAAC;IACjC,OAAO,YAAY,GAAG;IACtB,OAAO,kJAAG,CAAC,IAAI,CAAC,aAAa,QAAS;QAAE;IAAU;AACpD;AAMO,SAAS,cAAc,KAAa;IACzC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,QAAQ,IAAI,CAAC,+BAA+B,AAAC,IAAc,OAAO;QAClE,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 154, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/auth.ts"],"sourcesContent":["// src/lib/auth.ts\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { verifySession } from \"@/lib/jwt\";\r\n\r\nexport type SessionUser = {\r\n  id: string;\r\n  email?: string | null;\r\n  role: string;\r\n  organizationId?: string | null;\r\n};\r\n\r\nexport async function getSessionUser(req: Request): Promise<SessionUser | null> {\r\n  try {\r\n    // 1Ô∏è‚É£ Prefer Authorization header: \"Bearer <token>\"\r\n    let token: string | null = null;\r\n    const authHeader = req.headers.get(\"authorization\");\r\n    if (authHeader?.startsWith(\"Bearer \")) {\r\n      token = authHeader.slice(\"Bearer \".length).trim();\r\n    }\r\n\r\n    // 2Ô∏è‚É£ Fallback to cookies\r\n    if (!token) {\r\n      const cookieHeader = req.headers.get(\"cookie\") || \"\";\r\n      const cookies: Record<string, string> = Object.fromEntries(\r\n        cookieHeader\r\n          .split(\";\")\r\n          .map(c => c.trim().split(\"=\"))\r\n          .map(([k, v]) => [decodeURIComponent(k), decodeURIComponent(v)])\r\n      );\r\n      token = cookies[\"session\"] || cookies[\"token\"] || null;\r\n    }\r\n\r\n    if (!token) return null;\r\n\r\n    // 3Ô∏è‚É£ Verify token safely\r\n    const payload = verifySession(token);\r\n    if (!payload?.id) return null;\r\n\r\n    // 4Ô∏è‚É£ Fetch user from DB\r\n    const user = await prisma.user.findUnique({ where: { id: payload.id } });\r\n    if (!user) return null;\r\n\r\n    return {\r\n      id: user.id,\r\n      email: user.email ?? null,\r\n      role: user.role,\r\n      organizationId: user.organizationId,\r\n    };\r\n  } catch (err: any) {\r\n    console.warn(\"[getSessionUser] error:\", err?.message || err);\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,kBAAkB;;;;;AAClB;AACA;;;AASO,eAAe,eAAe,GAAY;IAC/C,IAAI;QACF,oDAAoD;QACpD,IAAI,QAAuB;QAC3B,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;QACnC,IAAI,YAAY,WAAW,YAAY;YACrC,QAAQ,WAAW,KAAK,CAAC,UAAU,MAAM,EAAE,IAAI;QACjD;QAEA,0BAA0B;QAC1B,IAAI,CAAC,OAAO;YACV,MAAM,eAAe,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;YAClD,MAAM,UAAkC,OAAO,WAAW,CACxD,aACG,KAAK,CAAC,KACN,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,GAAG,KAAK,CAAC,MACxB,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAK;oBAAC,mBAAmB;oBAAI,mBAAmB;iBAAG;YAEnE,QAAQ,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,QAAQ,IAAI;QACpD;QAEA,IAAI,CAAC,OAAO,OAAO;QAEnB,0BAA0B;QAC1B,MAAM,UAAU,IAAA,oIAAa,EAAC;QAC9B,IAAI,CAAC,SAAS,IAAI,OAAO;QAEzB,yBAAyB;QACzB,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,IAAI,QAAQ,EAAE;YAAC;QAAE;QACtE,IAAI,CAAC,MAAM,OAAO;QAElB,OAAO;YACL,IAAI,KAAK,EAAE;YACX,OAAO,KAAK,KAAK,IAAI;YACrB,MAAM,KAAK,IAAI;YACf,gBAAgB,KAAK,cAAc;QACrC;IACF,EAAE,OAAO,KAAU;QACjB,QAAQ,IAAI,CAAC,2BAA2B,KAAK,WAAW;QACxD,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 206, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/rbac.ts"],"sourcesContent":["// src/lib/rbac.ts\r\nimport { prisma } from '@/lib/prisma';\r\nimport type { SessionUser } from './auth';\r\nimport { getSessionUser } from './auth';\r\n\r\n/**\r\n * Extract user from request and return SessionUser\r\n */\r\nexport async function getUserFromRequest(req: Request): Promise<SessionUser | null> {\r\n  return await getSessionUser(req);\r\n}\r\n\r\n/**\r\n * Ensure user is logged in\r\n */\r\nexport function requireAuth(user: SessionUser | null) {\r\n  if (!user) throw new Error('unauthenticated');\r\n}\r\n\r\n/**\r\n * Ensure user has the required role\r\n */\r\nexport function requireRole(\r\n  user: SessionUser | null,\r\n  role: 'ADMIN' | 'MANAGER' | 'EMPLOYEE'\r\n) {\r\n  requireAuth(user);\r\n  if (user!.role !== role) throw new Error('forbidden');\r\n}\r\n\r\n/**\r\n * Check if user is admin of the organization\r\n */\r\nexport async function isOrgAdmin(userId: string, orgId: string) {\r\n  const user = await prisma.user.findUnique({ where: { id: userId } });\r\n  return !!user && user.role === 'ADMIN' && user.organizationId === orgId;\r\n}\r\n\r\n/**\r\n * Check if user is manager of the team\r\n */\r\nexport async function isTeamManager(userId: string, teamId: string) {\r\n  const tm = await prisma.teamMember.findFirst({\r\n    where: { userId, teamId, role: 'MANAGER' },\r\n  });\r\n  return !!tm;\r\n}\r\n\r\n/**\r\n * Check if user can view a team\r\n * Admins of org or members of team\r\n */\r\nexport async function canViewTeam(userId: string, teamId: string) {\r\n  const tm = await prisma.teamMember.findFirst({ where: { userId, teamId } });\r\n  if (tm) return true;\r\n\r\n  const user = await prisma.user.findUnique({ where: { id: userId } });\r\n  return !!user && user.role === 'ADMIN' && !!user.organizationId;\r\n}\r\n"],"names":[],"mappings":"AAAA,kBAAkB;;;;;;;;;;;;;;;AAClB;AAEA;;;AAKO,eAAe,mBAAmB,GAAY;IACnD,OAAO,MAAM,IAAA,sIAAc,EAAC;AAC9B;AAKO,SAAS,YAAY,IAAwB;IAClD,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;AAC7B;AAKO,SAAS,YACd,IAAwB,EACxB,IAAsC;IAEtC,YAAY;IACZ,IAAI,KAAM,IAAI,KAAK,MAAM,MAAM,IAAI,MAAM;AAC3C;AAKO,eAAe,WAAW,MAAc,EAAE,KAAa;IAC5D,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QAAE,OAAO;YAAE,IAAI;QAAO;IAAE;IAClE,OAAO,CAAC,CAAC,QAAQ,KAAK,IAAI,KAAK,WAAW,KAAK,cAAc,KAAK;AACpE;AAKO,eAAe,cAAc,MAAc,EAAE,MAAc;IAChE,MAAM,KAAK,MAAM,gIAAM,CAAC,UAAU,CAAC,SAAS,CAAC;QAC3C,OAAO;YAAE;YAAQ;YAAQ,MAAM;QAAU;IAC3C;IACA,OAAO,CAAC,CAAC;AACX;AAMO,eAAe,YAAY,MAAc,EAAE,MAAc;IAC9D,MAAM,KAAK,MAAM,gIAAM,CAAC,UAAU,CAAC,SAAS,CAAC;QAAE,OAAO;YAAE;YAAQ;QAAO;IAAE;IACzE,IAAI,IAAI,OAAO;IAEf,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QAAE,OAAO;YAAE,IAAI;QAAO;IAAE;IAClE,OAAO,CAAC,CAAC,QAAQ,KAAK,IAAI,KAAK,WAAW,CAAC,CAAC,KAAK,cAAc;AACjE","debugId":null}},
    {"offset": {"line": 272, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/api/dashboard/unified-inbox/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { getUserFromRequest } from \"@/lib/rbac\";\r\n\r\nexport async function GET(req: Request) {\r\n  const user = await getUserFromRequest(req);\r\n\r\n  const messages = await prisma.message.findMany({\r\n    where: {\r\n      OR: [\r\n        { senderId: user.id },\r\n        { recipientId: user.id },\r\n      ],\r\n    },\r\n    include: { sender: true, recipient: true },\r\n    orderBy: { createdAt: \"desc\" },\r\n  });\r\n\r\n  return NextResponse.json({ ok: true, messages });\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  const user = await getUserFromRequest(req);\r\n  const { recipientId, content, channel } = await req.json();\r\n\r\n  const message = await prisma.message.create({\r\n    data: {\r\n      senderId: user.id,\r\n      recipientId,\r\n      content,\r\n      channel: channel || \"IN_APP\",\r\n    },\r\n  });\r\n\r\n  return NextResponse.json({ ok: true, message });\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,GAAY;IACpC,MAAM,OAAO,MAAM,IAAA,0IAAkB,EAAC;IAEtC,MAAM,WAAW,MAAM,gIAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;QAC7C,OAAO;YACL,IAAI;gBACF;oBAAE,UAAU,KAAK,EAAE;gBAAC;gBACpB;oBAAE,aAAa,KAAK,EAAE;gBAAC;aACxB;QACH;QACA,SAAS;YAAE,QAAQ;YAAM,WAAW;QAAK;QACzC,SAAS;YAAE,WAAW;QAAO;IAC/B;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAM;IAAS;AAChD;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAO,MAAM,IAAA,0IAAkB,EAAC;IACtC,MAAM,EAAE,WAAW,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,MAAM,IAAI,IAAI;IAExD,MAAM,UAAU,MAAM,gIAAM,CAAC,OAAO,CAAC,MAAM,CAAC;QAC1C,MAAM;YACJ,UAAU,KAAK,EAAE;YACjB;YACA;YACA,SAAS,WAAW;QACtB;IACF;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAM;IAAQ;AAC/C","debugId":null}}]
}