{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/api/invites/creates/route.ts"],"sourcesContent":["// src/app/api/invites/creates/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport type { NextRequest } from \"next/server\";\r\nimport nodemailer from \"nodemailer\";\r\nimport crypto from \"crypto\";\r\n\r\n/**\r\n * Required env variables (set in .env.local):\r\n * HMAIL_HOST=127.0.0.1\r\n * HMAIL_PORT=25\r\n * HMAIL_SECURE=false\r\n * HMAIL_USER=your_smtp_user (optional)\r\n * HMAIL_PASS=your_smtp_pass (optional)\r\n * NEXT_PUBLIC_APP_URL=http://localhost:3000\r\n *\r\n * (If hMailServer doesn't require auth, leave HMAIL_USER/HMAIL_PASS blank)\r\n */\r\n\r\nfunction isValidEmail(email: string) {\r\n  return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const body = await req.json();\r\n    const email = (body?.email || \"\").toString().trim().toLowerCase();\r\n    if (!email || !isValidEmail(email)) {\r\n      return NextResponse.json({ message: \"Invalid email\" }, { status: 400 });\r\n    }\r\n\r\n    // generate a secure token\r\n    const token = crypto.randomBytes(24).toString(\"hex\"); // 48 hex chars\r\n    const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24 hours\r\n\r\n    // Persist the invite in DB:\r\n    // Option A - Prisma (recommended). Uncomment and adapt if you have Prisma set up.\r\n    /*\r\n    import { PrismaClient } from \"@prisma/client\";\r\n    const prisma = new PrismaClient();\r\n    await prisma.invite.create({\r\n      data: {\r\n        email,\r\n        token,\r\n        expiresAt,\r\n        role: \"manager\", // optional\r\n        createdAt: new Date(),\r\n      },\r\n    });\r\n    */\r\n\r\n    // Option B - If you don't have DB yet, store in a file or a cache.\r\n    // Warning: file/in-memory stores are ephemeral (not suitable for production).\r\n    // Example (serverless caution): write to a JSON file / use Redis / DB in production.\r\n\r\n    // Build invitation link\r\n    const appUrl = process.env.NEXT_PUBLIC_APP_URL || \"http://localhost:3000\";\r\n    const inviteLink = `${appUrl}/auth/invite/accept?token=${token}`;\r\n\r\n    // Configure nodemailer to use hMailServer (SMTP)\r\n    const transporter = nodemailer.createTransport({\r\n      host: process.env.HMAIL_HOST || \"127.0.0.1\",\r\n      port: Number(process.env.HMAIL_PORT || 25),\r\n      secure: (process.env.HMAIL_SECURE === \"true\") || false, // true for port 465\r\n      auth: process.env.HMAIL_USER\r\n        ? { user: process.env.HMAIL_USER, pass: process.env.HMAIL_PASS || \"\" }\r\n        : undefined,\r\n      // tls: { rejectUnauthorized: false }, // if you need to allow self-signed certs\r\n    });\r\n\r\n    // Compose email\r\n    const mailOptions = {\r\n      from: `\"SignalHub\" <no-reply@yourdomain.com>`,\r\n      to: email,\r\n      subject: \"You're invited to join as a manager â€” SignalHub\",\r\n      html: `\r\n        <div style=\"font-family: Inter, Arial, sans-serif; color:#0f172a;\">\r\n          <h2>You're invited to join SignalHub</h2>\r\n          <p>Hello,</p>\r\n          <p>You were invited to join as a <strong>manager</strong>. Click the link below to accept the invitation and complete your account setup.</p>\r\n          <p style=\"margin: 18px 0;\">\r\n            <a href=\"${inviteLink}\" style=\"display:inline-block;padding:10px 14px;background:#0f172a;color:#fff;border-radius:8px;text-decoration:none;\">Accept invitation</a>\r\n          </p>\r\n          <p>This link will expire on <strong>${expiresAt.toUTCString()}</strong> (24 hours).</p>\r\n          <p>If you didn't request this, you can ignore this email.</p>\r\n          <hr />\r\n          <p style=\"font-size:12px;color:#6b7280\">Sent by SignalHub</p>\r\n        </div>\r\n      `,\r\n    };\r\n\r\n    // send mail\r\n    await transporter.sendMail(mailOptions);\r\n\r\n    // optionally persist token/expiry if not using Prisma\r\n    // e.g. save to Redis: SET invite:token ... EX 86400\r\n\r\n    return NextResponse.json({ ok: true, message: \"Invite sent\", token: token, expiresAt: expiresAt.toISOString() });\r\n  } catch (err: any) {\r\n    console.error(\"Invite create error:\", err);\r\n    return NextResponse.json({ ok: false, message: err?.message || \"Server error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,uCAAuC;;;;;AACvC;AAEA;AACA;;;;AAEA;;;;;;;;;;CAUC,GAED,SAAS,aAAa,KAAa;IACjC,OAAO,6BAA6B,IAAI,CAAC;AAC3C;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,QAAQ,CAAC,MAAM,SAAS,EAAE,EAAE,QAAQ,GAAG,IAAI,GAAG,WAAW;QAC/D,IAAI,CAAC,SAAS,CAAC,aAAa,QAAQ;YAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,0BAA0B;QAC1B,MAAM,QAAQ,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC,QAAQ,eAAe;QACrE,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK,OAAO,WAAW;QAEzE,4BAA4B;QAC5B,kFAAkF;QAClF;;;;;;;;;;;;IAYA,GAEA,mEAAmE;QACnE,8EAA8E;QAC9E,qFAAqF;QAErF,wBAAwB;QACxB,MAAM,SAAS,6DAAmC;QAClD,MAAM,aAAa,GAAG,OAAO,0BAA0B,EAAE,OAAO;QAEhE,iDAAiD;QACjD,MAAM,cAAc,4JAAU,CAAC,eAAe,CAAC;YAC7C,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI;YAChC,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI;YACvC,QAAQ,AAAC,QAAQ,GAAG,CAAC,YAAY,KAAK,UAAW;YACjD,MAAM,QAAQ,GAAG,CAAC,UAAU,GACxB;gBAAE,MAAM,QAAQ,GAAG,CAAC,UAAU;gBAAE,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI;YAAG,IACnE;QAEN;QAEA,gBAAgB;QAChB,MAAM,cAAc;YAClB,MAAM,CAAC,qCAAqC,CAAC;YAC7C,IAAI;YACJ,SAAS;YACT,MAAM,CAAC;;;;;;qBAMQ,EAAE,WAAW;;8CAEY,EAAE,UAAU,WAAW,GAAG;;;;;MAKlE,CAAC;QACH;QAEA,YAAY;QACZ,MAAM,YAAY,QAAQ,CAAC;QAE3B,sDAAsD;QACtD,oDAAoD;QAEpD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,SAAS;YAAe,OAAO;YAAO,WAAW,UAAU,WAAW;QAAG;IAChH,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,SAAS,KAAK,WAAW;QAAe,GAAG;YAAE,QAAQ;QAAI;IACjG;AACF","debugId":null}}]
}