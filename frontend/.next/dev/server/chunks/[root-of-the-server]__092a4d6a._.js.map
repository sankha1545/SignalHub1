{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line\r\n  var __prisma__: PrismaClient | undefined;\r\n}\r\nexport const prisma =\r\n  global.__prisma__ ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"warn\", \"error\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.__prisma__ = prisma;\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;;AAMO,MAAM,SACX,OAAO,UAAU,IACjB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAQ;KAAQ,GAAG;AAC7E;AAEF,wCAA2C,OAAO,UAAU,GAAG","debugId":null}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\nimport { prisma } from '@/lib/prisma';\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'supersecret';\r\n\r\nexport type SessionUser = {\r\n  id: string;\r\n  email?: string | null;\r\n  role: string;\r\n  organizationId?: string | null;\r\n};\r\n\r\nexport async function getSessionUser(req: Request): Promise<SessionUser | null> {\r\n  try {\r\n    const authHeader = req.headers.get('authorization');\r\n    let token: string | null = authHeader?.startsWith('Bearer ')\r\n      ? authHeader.slice('Bearer '.length).trim()\r\n      : null;\r\n\r\n    if (!token) {\r\n      const cookieHeader = req.headers.get('cookie') || '';\r\n      const cookies = Object.fromEntries(\r\n        cookieHeader.split(';').map(c => c.trim().split('=').map(decodeURIComponent))\r\n      );\r\n      token = cookies['session'] || cookies['token'] || null;\r\n    }\r\n\r\n    if (!token) return null;\r\n\r\n    const payload: any = jwt.verify(token, JWT_SECRET);\r\n    if (!payload?.id) return null;\r\n\r\n    const user = await prisma.user.findUnique({ where: { id: payload.id } });\r\n    if (!user) return null;\r\n\r\n    return {\r\n      id: user.id,\r\n      email: user.email ?? null,\r\n      role: user.role,\r\n      organizationId: user.organizationId,\r\n    };\r\n  } catch (err) {\r\n    console.warn('getSessionUser error', err);\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAStC,eAAe,eAAe,GAAY;IAC/C,IAAI;QACF,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;QACnC,IAAI,QAAuB,YAAY,WAAW,aAC9C,WAAW,KAAK,CAAC,UAAU,MAAM,EAAE,IAAI,KACvC;QAEJ,IAAI,CAAC,OAAO;YACV,MAAM,eAAe,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;YAClD,MAAM,UAAU,OAAO,WAAW,CAChC,aAAa,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,GAAG,KAAK,CAAC,KAAK,GAAG,CAAC;YAE3D,QAAQ,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,QAAQ,IAAI;QACpD;QAEA,IAAI,CAAC,OAAO,OAAO;QAEnB,MAAM,UAAe,kJAAG,CAAC,MAAM,CAAC,OAAO;QACvC,IAAI,CAAC,SAAS,IAAI,OAAO;QAEzB,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,IAAI,QAAQ,EAAE;YAAC;QAAE;QACtE,IAAI,CAAC,MAAM,OAAO;QAElB,OAAO;YACL,IAAI,KAAK,EAAE;YACX,OAAO,KAAK,KAAK,IAAI;YACrB,MAAM,KAAK,IAAI;YACf,gBAAgB,KAAK,cAAc;QACrC;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,IAAI,CAAC,wBAAwB;QACrC,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 137, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/api/me/route.ts"],"sourcesContent":["// src/app/api/me/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { getSessionUser } from \"@/lib/auth\";\r\n\r\n/**\r\n * GET /api/me  -> returns { ok: true, user: { id, name, email, role, phone, organizationId, profile } }\r\n * PATCH /api/me -> accepts { name?, phone?, profile?: { displayName?, avatarUrl?, bio? } }\r\n */\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const user = await getSessionUser(req);\r\n    if (!user) return NextResponse.json({ ok: false, error: \"unauthenticated\" }, { status: 401 });\r\n\r\n    const u = await prisma.user.findUnique({\r\n      where: { id: user.id },\r\n      include: { profile: true, organization: true },\r\n    });\r\n\r\n    if (!u) return NextResponse.json({ ok: false, error: \"user_not_found\" }, { status: 404 });\r\n\r\n    return NextResponse.json({\r\n      ok: true,\r\n      user: {\r\n        id: u.id,\r\n        name: u.name,\r\n        email: u.email,\r\n        role: u.role,\r\n        phone: u.phone,\r\n        organizationId: u.organizationId,\r\n        organizationName: u.organization?.name ?? null,\r\n        profile: u.profile ?? null,\r\n        createdAt: u.createdAt,\r\n      },\r\n    });\r\n  } catch (err: any) {\r\n    console.error(\"[/api/me GET] error\", err);\r\n    return NextResponse.json({ ok: false, error: err.message || \"internal_server_error\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PATCH(req: Request) {\r\n  try {\r\n    const session = await getSessionUser(req);\r\n    if (!session) return NextResponse.json({ ok: false, error: \"unauthenticated\" }, { status: 401 });\r\n    const body = await req.json();\r\n    const { name, phone, profile } = body;\r\n\r\n    // simple validation\r\n    const updates: any = {};\r\n    if (typeof name === \"string\") updates.name = name.trim();\r\n    if (typeof phone === \"string\") updates.phone = phone.trim();\r\n\r\n    // Update user and (optionally) profile\r\n    const updatedUser = await prisma.user.update({\r\n      where: { id: session.id },\r\n      data: {\r\n        ...updates,\r\n        profile: profile\r\n          ? {\r\n              upsert: {\r\n                create: {\r\n                  displayName: profile.displayName ?? updates.name ?? undefined,\r\n                  avatarUrl: profile.avatarUrl ?? null,\r\n                  bio: profile.bio ?? null,\r\n                  phoneNumber: profile.phoneNumber ?? phone ?? null,\r\n                },\r\n                update: {\r\n                  displayName: profile.displayName ?? undefined,\r\n                  avatarUrl: profile.avatarUrl ?? undefined,\r\n                  bio: profile.bio ?? undefined,\r\n                  phoneNumber: profile.phoneNumber ?? undefined,\r\n                },\r\n              },\r\n            }\r\n          : undefined,\r\n      },\r\n      include: { profile: true, organization: true },\r\n    });\r\n\r\n    return NextResponse.json({ ok: true, user: updatedUser });\r\n  } catch (err: any) {\r\n    console.error(\"[/api/me PATCH] error\", err);\r\n    return NextResponse.json({ ok: false, error: err.message || \"internal_server_error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,0BAA0B;;;;;;;AAC1B;AACA;AACA;;;;AAOO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,sIAAc,EAAC;QAClC,IAAI,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAkB,GAAG;YAAE,QAAQ;QAAI;QAE3F,MAAM,IAAI,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACrC,OAAO;gBAAE,IAAI,KAAK,EAAE;YAAC;YACrB,SAAS;gBAAE,SAAS;gBAAM,cAAc;YAAK;QAC/C;QAEA,IAAI,CAAC,GAAG,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;QAEvF,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,IAAI;YACJ,MAAM;gBACJ,IAAI,EAAE,EAAE;gBACR,MAAM,EAAE,IAAI;gBACZ,OAAO,EAAE,KAAK;gBACd,MAAM,EAAE,IAAI;gBACZ,OAAO,EAAE,KAAK;gBACd,gBAAgB,EAAE,cAAc;gBAChC,kBAAkB,EAAE,YAAY,EAAE,QAAQ;gBAC1C,SAAS,EAAE,OAAO,IAAI;gBACtB,WAAW,EAAE,SAAS;YACxB;QACF;IACF,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO,IAAI,OAAO,IAAI;QAAwB,GAAG;YAAE,QAAQ;QAAI;IACvG;AACF;AAEO,eAAe,MAAM,GAAY;IACtC,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,sIAAc,EAAC;QACrC,IAAI,CAAC,SAAS,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAkB,GAAG;YAAE,QAAQ;QAAI;QAC9F,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG;QAEjC,oBAAoB;QACpB,MAAM,UAAe,CAAC;QACtB,IAAI,OAAO,SAAS,UAAU,QAAQ,IAAI,GAAG,KAAK,IAAI;QACtD,IAAI,OAAO,UAAU,UAAU,QAAQ,KAAK,GAAG,MAAM,IAAI;QAEzD,uCAAuC;QACvC,MAAM,cAAc,MAAM,gIAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YAC3C,OAAO;gBAAE,IAAI,QAAQ,EAAE;YAAC;YACxB,MAAM;gBACJ,GAAG,OAAO;gBACV,SAAS,UACL;oBACE,QAAQ;wBACN,QAAQ;4BACN,aAAa,QAAQ,WAAW,IAAI,QAAQ,IAAI,IAAI;4BACpD,WAAW,QAAQ,SAAS,IAAI;4BAChC,KAAK,QAAQ,GAAG,IAAI;4BACpB,aAAa,QAAQ,WAAW,IAAI,SAAS;wBAC/C;wBACA,QAAQ;4BACN,aAAa,QAAQ,WAAW,IAAI;4BACpC,WAAW,QAAQ,SAAS,IAAI;4BAChC,KAAK,QAAQ,GAAG,IAAI;4BACpB,aAAa,QAAQ,WAAW,IAAI;wBACtC;oBACF;gBACF,IACA;YACN;YACA,SAAS;gBAAE,SAAS;gBAAM,cAAc;YAAK;QAC/C;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,MAAM;QAAY;IACzD,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO,IAAI,OAAO,IAAI;QAAwB,GAAG;YAAE,QAAQ;QAAI;IACvG;AACF","debugId":null}}]
}