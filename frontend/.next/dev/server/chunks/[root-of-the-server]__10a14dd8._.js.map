{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line\r\n  var __prisma__: PrismaClient | undefined;\r\n}\r\nexport const prisma =\r\n  global.__prisma__ ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"warn\", \"error\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.__prisma__ = prisma;\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;;AAMO,MAAM,SACX,OAAO,UAAU,IACjB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAQ;KAAQ,GAAG;AAC7E;AAEF,wCAA2C,OAAO,UAAU,GAAG","debugId":null}},
    {"offset": {"line": 137, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/jwt.ts"],"sourcesContent":["// src/lib/jwt.ts\r\nimport jwt, { JwtPayload } from \"jsonwebtoken\";\r\n\r\nconst SECRET = process.env.JWT_SECRET;\r\nif (!SECRET) {\r\n  if (process.env.NODE_ENV === \"production\") {\r\n    throw new Error(\"JWT_SECRET environment variable must be set in production!\");\r\n  } else {\r\n    console.warn(\"[JWT] Using fallback secret for development\");\r\n  }\r\n}\r\n\r\n/**\r\n * üîê Create a short-lived temp token (email/phone verification)\r\n */\r\nexport function signTemp(payload: Record<string, any>, expiresIn: string = \"15m\"): string {\r\n  const safePayload = { ...payload };\r\n  delete safePayload.exp;\r\n  return jwt.sign(safePayload, SECRET!, { expiresIn });\r\n}\r\n\r\n/**\r\n * ‚úÖ Verify short-lived temp tokens\r\n * Returns payload object or null if invalid/expired\r\n */\r\nexport function verifyTemp(token: string): Record<string, any> | null {\r\n  try {\r\n    return jwt.verify(token, SECRET!) as Record<string, any>;\r\n  } catch (err) {\r\n    console.warn(\"[JWT] verifyTemp failed:\", (err as Error).message);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * üíæ Create a long-lived session token for logged-in users\r\n */\r\nexport function signSession(payload: Record<string, any>, expiresIn: string = \"7d\"): string {\r\n  const safePayload = { ...payload };\r\n  delete safePayload.exp;\r\n  return jwt.sign(safePayload, SECRET!, { expiresIn });\r\n}\r\n\r\n/**\r\n * üîé Verify a session token\r\n * Returns payload object or null if invalid/expired\r\n */\r\nexport function verifySession(token: string): Record<string, any> | null {\r\n  try {\r\n    return jwt.verify(token, SECRET!) as Record<string, any>;\r\n  } catch (err) {\r\n    console.warn(\"[JWT] verifySession failed:\", (err as Error).message);\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,iBAAiB;;;;;;;;;;;AACjB;;AAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;AACrC,IAAI,CAAC,QAAQ;IACX;;SAEO;QACL,QAAQ,IAAI,CAAC;IACf;AACF;AAKO,SAAS,SAAS,OAA4B,EAAE,YAAoB,KAAK;IAC9E,MAAM,cAAc;QAAE,GAAG,OAAO;IAAC;IACjC,OAAO,YAAY,GAAG;IACtB,OAAO,kJAAG,CAAC,IAAI,CAAC,aAAa,QAAS;QAAE;IAAU;AACpD;AAMO,SAAS,WAAW,KAAa;IACtC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,QAAQ,IAAI,CAAC,4BAA4B,AAAC,IAAc,OAAO;QAC/D,OAAO;IACT;AACF;AAKO,SAAS,YAAY,OAA4B,EAAE,YAAoB,IAAI;IAChF,MAAM,cAAc;QAAE,GAAG,OAAO;IAAC;IACjC,OAAO,YAAY,GAAG;IACtB,OAAO,kJAAG,CAAC,IAAI,CAAC,aAAa,QAAS;QAAE;IAAU;AACpD;AAMO,SAAS,cAAc,KAAa;IACzC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,QAAQ,IAAI,CAAC,+BAA+B,AAAC,IAAc,OAAO;QAClE,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/auth.ts"],"sourcesContent":["// src/lib/auth.ts\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { verifySession } from \"@/lib/jwt\";\r\n\r\nexport type SessionUser = {\r\n  id: string;\r\n  email?: string | null;\r\n  role: string;\r\n  organizationId?: string | null;\r\n};\r\n\r\nexport async function getSessionUser(req: Request): Promise<SessionUser | null> {\r\n  try {\r\n    // 1Ô∏è‚É£ Prefer Authorization header: \"Bearer <token>\"\r\n    let token: string | null = null;\r\n    const authHeader = req.headers.get(\"authorization\");\r\n    if (authHeader?.startsWith(\"Bearer \")) {\r\n      token = authHeader.slice(\"Bearer \".length).trim();\r\n    }\r\n\r\n    // 2Ô∏è‚É£ Fallback to cookies\r\n    if (!token) {\r\n      const cookieHeader = req.headers.get(\"cookie\") || \"\";\r\n      const cookies: Record<string, string> = Object.fromEntries(\r\n        cookieHeader\r\n          .split(\";\")\r\n          .map(c => c.trim().split(\"=\"))\r\n          .map(([k, v]) => [decodeURIComponent(k), decodeURIComponent(v)])\r\n      );\r\n      token = cookies[\"session\"] || cookies[\"token\"] || null;\r\n    }\r\n\r\n    if (!token) return null;\r\n\r\n    // 3Ô∏è‚É£ Verify token safely\r\n    const payload = verifySession(token);\r\n    if (!payload?.id) return null;\r\n\r\n    // 4Ô∏è‚É£ Fetch user from DB\r\n    const user = await prisma.user.findUnique({ where: { id: payload.id } });\r\n    if (!user) return null;\r\n\r\n    return {\r\n      id: user.id,\r\n      email: user.email ?? null,\r\n      role: user.role,\r\n      organizationId: user.organizationId,\r\n    };\r\n  } catch (err: any) {\r\n    console.warn(\"[getSessionUser] error:\", err?.message || err);\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,kBAAkB;;;;;AAClB;AACA;;;AASO,eAAe,eAAe,GAAY;IAC/C,IAAI;QACF,oDAAoD;QACpD,IAAI,QAAuB;QAC3B,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;QACnC,IAAI,YAAY,WAAW,YAAY;YACrC,QAAQ,WAAW,KAAK,CAAC,UAAU,MAAM,EAAE,IAAI;QACjD;QAEA,0BAA0B;QAC1B,IAAI,CAAC,OAAO;YACV,MAAM,eAAe,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;YAClD,MAAM,UAAkC,OAAO,WAAW,CACxD,aACG,KAAK,CAAC,KACN,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,GAAG,KAAK,CAAC,MACxB,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAK;oBAAC,mBAAmB;oBAAI,mBAAmB;iBAAG;YAEnE,QAAQ,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,QAAQ,IAAI;QACpD;QAEA,IAAI,CAAC,OAAO,OAAO;QAEnB,0BAA0B;QAC1B,MAAM,UAAU,IAAA,oIAAa,EAAC;QAC9B,IAAI,CAAC,SAAS,IAAI,OAAO;QAEzB,yBAAyB;QACzB,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,IAAI,QAAQ,EAAE;YAAC;QAAE;QACtE,IAAI,CAAC,MAAM,OAAO;QAElB,OAAO;YACL,IAAI,KAAK,EAAE;YACX,OAAO,KAAK,KAAK,IAAI;YACrB,MAAM,KAAK,IAAI;YACf,gBAAgB,KAAK,cAAc;QACrC;IACF,EAAE,OAAO,KAAU;QACjB,QAAQ,IAAI,CAAC,2BAA2B,KAAK,WAAW;QACxD,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 248, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/api/me/route.ts"],"sourcesContent":["// src/app/api/me/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\n// --- Adapt this import according to your auth system ---\r\n// Example with NextAuth (server-side)\r\nimport { getServerSession } from \"next-auth\";\r\nimport { authOptions } from \"@/lib/auth\"; // <-- adjust path if your NextAuth options are located elsewhere\r\n\r\nconst prisma = new PrismaClient();\r\n\r\n// helper that returns current user id (adapt if you don't use NextAuth)\r\nasync function getCurrentUserId(req: Request) {\r\n  try {\r\n    // NextAuth example:\r\n    // Note: App Router server functions can't directly call getServerSession(req) without some wrappers.\r\n    // If using NextAuth with App Router, you should implement server-only helper according to NextAuth docs.\r\n    // Here is a try/catch that attempts NextAuth and otherwise returns null.\r\n    const session = await getServerSession(authOptions as any);\r\n    if (session?.user?.email) {\r\n      // find user by email\r\n      const u = await prisma.user.findUnique({ where: { email: session.user.email } });\r\n      return u?.id ?? null;\r\n    }\r\n  } catch (e) {\r\n    // ignore; fallback below\r\n  }\r\n\r\n  // fallback: parse Authorization header for a Bearer token, or cookie-based JWT logic here.\r\n  // For development you can return a static id (NOT for production).\r\n  return null;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  const userId = await getCurrentUserId(req);\r\n  if (!userId) return NextResponse.json({ ok: false, error: \"Unauthorized\" }, { status: 401 });\r\n\r\n  try {\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: userId },\r\n      select: { id: true, name: true, email: true, phone: true, role: true, createdAt: true, profile: true },\r\n    });\r\n    if (!user) return NextResponse.json({ ok: false, error: \"Not found\" }, { status: 404 });\r\n    return NextResponse.json({ ok: true, user }, { status: 200 });\r\n  } catch (err) {\r\n    console.error(\"GET /api/me error\", err);\r\n    return NextResponse.json({ ok: false, error: \"Internal\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PATCH(req: Request) {\r\n  const userId = await getCurrentUserId(req);\r\n  if (!userId) return NextResponse.json({ ok: false, error: \"Unauthorized\" }, { status: 401 });\r\n\r\n  try {\r\n    const body = await req.json().catch(() => ({}));\r\n\r\n    const name = typeof body.name === \"string\" ? body.name : undefined;\r\n    const phone = typeof body.phone === \"string\" ? body.phone : undefined;\r\n    const incomingProfile = typeof body.profile === \"object\" && body.profile ? body.profile : {};\r\n\r\n    // sanity check\r\n    if (!name || name.trim().length === 0) {\r\n      // require a name to avoid accidentally blanking\r\n      return NextResponse.json({ ok: false, error: \"Name is required\" }, { status: 400 });\r\n    }\r\n\r\n    // load existing profile (so we merge instead of replacing)\r\n    const existing = await prisma.user.findUnique({ where: { id: userId }, select: { profile: true } });\r\n    const existingProfile = (existing?.profile as any) ?? {};\r\n\r\n    // merge - incoming fields override existing\r\n    const mergedProfile = {\r\n      ...existingProfile,\r\n      ...incomingProfile,\r\n    };\r\n\r\n    // Optionally validate postal code length or other rules here\r\n    // e.g. if (mergedProfile.postalCode && mergedProfile.postalCode.length > 50) -> error\r\n\r\n    const updated = await prisma.user.update({\r\n      where: { id: userId },\r\n      data: {\r\n        name,\r\n        phone,\r\n        profile: mergedProfile,\r\n      },\r\n      select: { id: true, name: true, email: true, phone: true, role: true, createdAt: true, profile: true },\r\n    });\r\n\r\n    return NextResponse.json({ ok: true, user: updated }, { status: 200 });\r\n  } catch (err) {\r\n    console.error(\"PATCH /api/me error\", err);\r\n    return NextResponse.json({ ok: false, error: \"Internal\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}