{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/crypto.ts"],"sourcesContent":["// lib/crypto.ts\r\nimport crypto from \"crypto\";\r\nimport bcrypt from \"bcrypt\";\r\n\r\nexport function genRandomToken(bytes = 32) {\r\n  return crypto.randomBytes(bytes).toString(\"hex\");\r\n}\r\n\r\nexport async function hashToken(token: string) {\r\n  const saltRounds = 10;\r\n  return bcrypt.hash(token, saltRounds);\r\n}\r\n\r\nexport async function verifyHash(token: string, hash: string) {\r\n  return bcrypt.compare(token, hash);\r\n}\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;;;AAChB;AACA;;;AAEO,SAAS,eAAe,QAAQ,EAAE;IACvC,OAAO,gHAAM,CAAC,WAAW,CAAC,OAAO,QAAQ,CAAC;AAC5C;AAEO,eAAe,UAAU,KAAa;IAC3C,MAAM,aAAa;IACnB,OAAO,gHAAM,CAAC,IAAI,CAAC,OAAO;AAC5B;AAEO,eAAe,WAAW,KAAa,EAAE,IAAY;IAC1D,OAAO,gHAAM,CAAC,OAAO,CAAC,OAAO;AAC/B","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line\r\n  var __prisma__: PrismaClient | undefined;\r\n}\r\nexport const prisma =\r\n  global.__prisma__ ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"warn\", \"error\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.__prisma__ = prisma;\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;;AAMO,MAAM,SACX,OAAO,UAAU,IACjB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAQ;KAAQ,GAAG;AAC7E;AAEF,wCAA2C,OAAO,UAAU,GAAG","debugId":null}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/otp.ts"],"sourcesContent":["// lib/otp.ts\r\nimport { genRandomToken, hashToken, verifyHash } from \"./crypto\";\r\nimport { prisma } from \"./prisma\";\r\n\r\nfunction generate6Digit() {\r\n  return (Math.floor(Math.random() * 900000) + 100000).toString();\r\n}\r\n\r\nexport async function createEmailOtp(email: string) {\r\n  const code = generate6Digit();\r\n  const hash = await hashToken(code);\r\n  const rec = await prisma.emailOtp.create({\r\n    data: { email, otp: hash, verified: false },\r\n  });\r\n  return { id: rec.id, code }; // return raw code for sending\r\n}\r\n\r\nexport async function verifyEmailOtp(email: string, code: string) {\r\n  const rec = await prisma.emailOtp.findFirst({\r\n    where: { email },\r\n    orderBy: { createdAt: \"desc\" },\r\n  });\r\n  if (!rec) return false;\r\n  const ok = await verifyHash(code, rec.otp);\r\n  if (!ok) return false;\r\n  await prisma.emailOtp.update({ where: { id: rec.id }, data: { verified: true } });\r\n  return true;\r\n}\r\n\r\n// Phone OTP\r\nexport async function createPhoneOtp(phone: string) {\r\n  const code = generate6Digit();\r\n  const hash = await hashToken(code);\r\n  const rec = await prisma.phoneOtp.create({\r\n    data: { phone, otp: hash, used: false, attempts: 0 },\r\n  });\r\n  return { id: rec.id, code };\r\n}\r\n\r\nexport async function verifyPhoneOtp(phone: string, code: string) {\r\n  const rec = await prisma.phoneOtp.findFirst({\r\n    where: { phone },\r\n    orderBy: { createdAt: \"desc\" },\r\n  });\r\n  if (!rec) return { ok: false, reason: \"no-otp\" };\r\n  const ok = await verifyHash(code, rec.otp);\r\n  if (!ok) {\r\n    await prisma.phoneOtp.update({ where: { id: rec.id }, data: { attempts: { increment: 1 } } });\r\n    return { ok: false, reason: \"wrong-code\" };\r\n  }\r\n  await prisma.phoneOtp.update({ where: { id: rec.id }, data: { used: true } });\r\n  return { ok: true };\r\n}\r\n"],"names":[],"mappings":"AAAA,aAAa;;;;;;;;;;;AACb;AACA;;;AAEA,SAAS;IACP,OAAO,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,UAAU,MAAM,EAAE,QAAQ;AAC/D;AAEO,eAAe,eAAe,KAAa;IAChD,MAAM,OAAO;IACb,MAAM,OAAO,MAAM,IAAA,mIAAS,EAAC;IAC7B,MAAM,MAAM,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QACvC,MAAM;YAAE;YAAO,KAAK;YAAM,UAAU;QAAM;IAC5C;IACA,OAAO;QAAE,IAAI,IAAI,EAAE;QAAE;IAAK,GAAG,8BAA8B;AAC7D;AAEO,eAAe,eAAe,KAAa,EAAE,IAAY;IAC9D,MAAM,MAAM,MAAM,gIAAM,CAAC,QAAQ,CAAC,SAAS,CAAC;QAC1C,OAAO;YAAE;QAAM;QACf,SAAS;YAAE,WAAW;QAAO;IAC/B;IACA,IAAI,CAAC,KAAK,OAAO;IACjB,MAAM,KAAK,MAAM,IAAA,oIAAU,EAAC,MAAM,IAAI,GAAG;IACzC,IAAI,CAAC,IAAI,OAAO;IAChB,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QAAE,OAAO;YAAE,IAAI,IAAI,EAAE;QAAC;QAAG,MAAM;YAAE,UAAU;QAAK;IAAE;IAC/E,OAAO;AACT;AAGO,eAAe,eAAe,KAAa;IAChD,MAAM,OAAO;IACb,MAAM,OAAO,MAAM,IAAA,mIAAS,EAAC;IAC7B,MAAM,MAAM,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QACvC,MAAM;YAAE;YAAO,KAAK;YAAM,MAAM;YAAO,UAAU;QAAE;IACrD;IACA,OAAO;QAAE,IAAI,IAAI,EAAE;QAAE;IAAK;AAC5B;AAEO,eAAe,eAAe,KAAa,EAAE,IAAY;IAC9D,MAAM,MAAM,MAAM,gIAAM,CAAC,QAAQ,CAAC,SAAS,CAAC;QAC1C,OAAO;YAAE;QAAM;QACf,SAAS;YAAE,WAAW;QAAO;IAC/B;IACA,IAAI,CAAC,KAAK,OAAO;QAAE,IAAI;QAAO,QAAQ;IAAS;IAC/C,MAAM,KAAK,MAAM,IAAA,oIAAU,EAAC,MAAM,IAAI,GAAG;IACzC,IAAI,CAAC,IAAI;QACP,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;YAAE,OAAO;gBAAE,IAAI,IAAI,EAAE;YAAC;YAAG,MAAM;gBAAE,UAAU;oBAAE,WAAW;gBAAE;YAAE;QAAE;QAC3F,OAAO;YAAE,IAAI;YAAO,QAAQ;QAAa;IAC3C;IACA,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QAAE,OAAO;YAAE,IAAI,IAAI,EAAE;QAAC;QAAG,MAAM;YAAE,MAAM;QAAK;IAAE;IAC3E,OAAO;QAAE,IAAI;IAAK;AACpB","debugId":null}},
    {"offset": {"line": 227, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/api/auth/phone/send/route.ts"],"sourcesContent":["// File: app/api/auth/phone/send/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport Twilio from \"twilio\";\r\nimport { createPhoneOtp } from \"@/lib/otp\";\r\n\r\n// Optional: define a TypeScript interface for clarity\r\ninterface PhoneRequest {\r\n  phone: string;\r\n}\r\n\r\n// ✅ Initialize Twilio client once\r\nconst twilioClient = Twilio(\r\n  process.env.TWILIO_ACCOUNT_SID!,\r\n  process.env.TWILIO_AUTH_TOKEN!\r\n);\r\n\r\n/**\r\n * POST /api/auth/phone/send\r\n * Body: { phone: \"+91XXXXXXXXXX\" }\r\n * Generates OTP, sends SMS, and returns { ok, id, sid, status }.\r\n */\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const body: PhoneRequest = await req.json();\r\n    const phone = body?.phone?.trim();\r\n\r\n    if (!phone) {\r\n      return NextResponse.json({ ok: false, error: \"phone_required\" }, { status: 400 });\r\n    }\r\n\r\n    // ✅ Generate OTP and store in DB / cache via createPhoneOtp\r\n    const { id, code } = await createPhoneOtp(phone);\r\n\r\n    // ✅ Build message text\r\n    const messageText = `Your SignalHub verification code is ${code}. It expires in 10 minutes.`;\r\n\r\n    // ✅ Send SMS via Twilio (if configured)\r\n    let sid: string | null = null;\r\n    let status: string | null = null;\r\n\r\n    if (process.env.TWILIO_ACCOUNT_SID && process.env.TWILIO_AUTH_TOKEN && process.env.TWILIO_PHONE_NUMBER) {\r\n      try {\r\n        const message = await twilioClient.messages.create({\r\n          body: messageText,\r\n          from: process.env.TWILIO_PHONE_NUMBER!,\r\n          to: phone,\r\n        });\r\n\r\n        sid = message.sid;\r\n        status = message.status;\r\n\r\n        console.log(\"[Twilio SMS Sent]\", {\r\n          sid: message.sid,\r\n          status: message.status,\r\n          to: message.to,\r\n          errorCode: message.errorCode,\r\n          errorMessage: message.errorMessage,\r\n        });\r\n      } catch (twilioErr: any) {\r\n        console.error(\"[Twilio SMS Error]\", twilioErr?.message || twilioErr);\r\n        return NextResponse.json(\r\n          { ok: false, error: \"sms_send_failed\", details: twilioErr?.message || \"Unknown Twilio error\" },\r\n          { status: 500 }\r\n        );\r\n      }\r\n    } else {\r\n      // ⚠️ Fallback — Twilio not configured\r\n      console.warn(\"[SMS Fallback] Twilio credentials missing — logging message instead\");\r\n      console.log(`[SMS to ${phone}] ${messageText}`);\r\n    }\r\n\r\n    // ✅ Respond to client\r\n    return NextResponse.json({\r\n      ok: true,\r\n      id, // your OTP record id\r\n      sid, // Twilio message SID (if sent)\r\n      status: status || (sid ? \"queued\" : \"mocked\"),\r\n    });\r\n  } catch (err: any) {\r\n    console.error(\"[API Error] /api/auth/phone/send\", err);\r\n    return NextResponse.json(\r\n      { ok: false, error: String(err?.message || err) },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,yCAAyC;;;;;AACzC;;;;;;AAEA;;;;AAOA,kCAAkC;AAClC,MAAM,eAAe,OACnB,QAAQ,GAAG,CAAC,kBAAkB,EAC9B,QAAQ,GAAG,CAAC,iBAAiB;AAQxB,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAqB,MAAM,IAAI,IAAI;QACzC,MAAM,QAAQ,MAAM,OAAO;QAE3B,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,4DAA4D;QAC5D,MAAM,EAAE,EAAE,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,qIAAc,EAAC;QAE1C,uBAAuB;QACvB,MAAM,cAAc,CAAC,oCAAoC,EAAE,KAAK,2BAA2B,CAAC;QAE5F,wCAAwC;QACxC,IAAI,MAAqB;QACzB,IAAI,SAAwB;QAE5B,IAAI,QAAQ,GAAG,CAAC,kBAAkB,IAAI,QAAQ,GAAG,CAAC,iBAAiB,IAAI,QAAQ,GAAG,CAAC,mBAAmB,EAAE;YACtG,IAAI;gBACF,MAAM,UAAU,MAAM,aAAa,QAAQ,CAAC,MAAM,CAAC;oBACjD,MAAM;oBACN,MAAM,QAAQ,GAAG,CAAC,mBAAmB;oBACrC,IAAI;gBACN;gBAEA,MAAM,QAAQ,GAAG;gBACjB,SAAS,QAAQ,MAAM;gBAEvB,QAAQ,GAAG,CAAC,qBAAqB;oBAC/B,KAAK,QAAQ,GAAG;oBAChB,QAAQ,QAAQ,MAAM;oBACtB,IAAI,QAAQ,EAAE;oBACd,WAAW,QAAQ,SAAS;oBAC5B,cAAc,QAAQ,YAAY;gBACpC;YACF,EAAE,OAAO,WAAgB;gBACvB,QAAQ,KAAK,CAAC,sBAAsB,WAAW,WAAW;gBAC1D,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,IAAI;oBAAO,OAAO;oBAAmB,SAAS,WAAW,WAAW;gBAAuB,GAC7F;oBAAE,QAAQ;gBAAI;YAElB;QACF,OAAO;YACL,sCAAsC;YACtC,QAAQ,IAAI,CAAC;YACb,QAAQ,GAAG,CAAC,CAAC,QAAQ,EAAE,MAAM,EAAE,EAAE,aAAa;QAChD;QAEA,sBAAsB;QACtB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,IAAI;YACJ;YACA;YACA,QAAQ,UAAU,CAAC,MAAM,WAAW,QAAQ;QAC9C;IACF,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,IAAI;YAAO,OAAO,OAAO,KAAK,WAAW;QAAK,GAChD;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}