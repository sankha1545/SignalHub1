{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line\r\n  var __prisma__: PrismaClient | undefined;\r\n}\r\nexport const prisma =\r\n  global.__prisma__ ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"warn\", \"error\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.__prisma__ = prisma;\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;;AAMO,MAAM,SACX,OAAO,UAAU,IACjB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAQ;KAAQ,GAAG;AAC7E;AAEF,wCAA2C,OAAO,UAAU,GAAG","debugId":null}},
    {"offset": {"line": 131, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/auth.ts"],"sourcesContent":["// src/app/api/me/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { getSessionUser } from \"@/lib/auth\";\r\n\r\n/**\r\n * GET /api/me\r\n * - Returns the currently authenticated user (canonical copy from DB)\r\n */\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const sessionUser = await getSessionUser(req);\r\n    if (!sessionUser) return NextResponse.json({ ok: false, error: \"Unauthorized\" }, { status: 401 });\r\n\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: sessionUser.id },\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        email: true,\r\n        phone: true,\r\n        role: true,\r\n        createdAt: true,\r\n        updatedAt: true,\r\n        profile: true,\r\n      },\r\n    });\r\n\r\n    if (!user) return NextResponse.json({ ok: false, error: \"User not found\" }, { status: 404 });\r\n\r\n    return NextResponse.json({ ok: true, user }, { status: 200 });\r\n  } catch (err) {\r\n    console.error(\"GET /api/me error:\", err);\r\n    return NextResponse.json({ ok: false, error: \"Internal server error\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n/**\r\n * PATCH /api/me\r\n * Accepts: { name?, phone?, profile? }\r\n * Where profile can include: displayName, avatarUrl, bio, country, region, district, postalCode, language, etc.\r\n *\r\n * Behavior:\r\n * - Ensures user is authenticated via getSessionUser\r\n * - Validates basic constraints (e.g. name present and not blank)\r\n * - Safely merges incoming profile object into existing profile JSON (doesn't wipe unknown keys)\r\n * - Updates user row in DB and returns updated canonical user object\r\n */\r\nexport async function PATCH(req: Request) {\r\n  try {\r\n    const sessionUser = await getSessionUser(req);\r\n    if (!sessionUser) return NextResponse.json({ ok: false, error: \"Unauthorized\" }, { status: 401 });\r\n\r\n    const body = await req.json().catch(() => ({}));\r\n\r\n    // Extract and sanitize top-level fields\r\n    const name = typeof body.name === \"string\" ? body.name.trim() : undefined;\r\n    const phone = typeof body.phone === \"string\" ? body.phone.trim() : undefined;\r\n    const incomingProfile = typeof body.profile === \"object\" && body.profile ? body.profile : {};\r\n\r\n    // Validation: require name (you can relax this if not desired)\r\n    if (typeof name === \"undefined\" || name.length === 0) {\r\n      return NextResponse.json({ ok: false, error: \"Name is required\" }, { status: 400 });\r\n    }\r\n    // Optional: validate postal code length if provided\r\n    if (incomingProfile.postalCode && typeof incomingProfile.postalCode === \"string\" && incomingProfile.postalCode.length > 100) {\r\n      return NextResponse.json({ ok: false, error: \"Postal code too long\" }, { status: 400 });\r\n    }\r\n\r\n    // Load existing profile (so we merge rather than overwrite)\r\n    const existing = await prisma.user.findUnique({ where: { id: sessionUser.id }, select: { profile: true } });\r\n    const existingProfile = (existing?.profile as any) ?? {};\r\n\r\n    // Merge incoming profile into existing (incoming fields override)\r\n    const mergedProfile = {\r\n      ...existingProfile,\r\n      // normalize keys: accept both postalCode and postal_code from clients, prefer postalCode\r\n      ...(incomingProfile.postal_code && !incomingProfile.postalCode ? { postalCode: incomingProfile.postal_code } : {}),\r\n      ...incomingProfile,\r\n    };\r\n\r\n    // If avatarUrl was provided as empty string, keep as empty (user removed preview)\r\n    // If you want to protect certain keys from being set to empty values, add logic here.\r\n\r\n    // Update DB\r\n    const updatedUser = await prisma.user.update({\r\n      where: { id: sessionUser.id },\r\n      data: {\r\n        name,\r\n        phone,\r\n        profile: mergedProfile as any, // Prisma Json accepts `any`\r\n      },\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        email: true,\r\n        phone: true,\r\n        role: true,\r\n        createdAt: true,\r\n        updatedAt: true,\r\n        profile: true,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({ ok: true, user: updatedUser }, { status: 200 });\r\n  } catch (err) {\r\n    console.error(\"PATCH /api/me error:\", err);\r\n    return NextResponse.json({ ok: false, error: \"Internal server error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 284, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/api/me/route.ts"],"sourcesContent":["// src/app/api/me/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\n// --- Adapt this import according to your auth system ---\r\n// Example with NextAuth (server-side)\r\nimport { getServerSession } from \"next-auth\";\r\nimport { authOptions } from \"@/lib/auth\"; // <-- adjust path if your NextAuth options are located elsewhere\r\n\r\nconst prisma = new PrismaClient();\r\n\r\n// helper that returns current user id (adapt if you don't use NextAuth)\r\nasync function getCurrentUserId(req: Request) {\r\n  try {\r\n    // NextAuth example:\r\n    // Note: App Router server functions can't directly call getServerSession(req) without some wrappers.\r\n    // If using NextAuth with App Router, you should implement server-only helper according to NextAuth docs.\r\n    // Here is a try/catch that attempts NextAuth and otherwise returns null.\r\n    const session = await getServerSession(authOptions as any);\r\n    if (session?.user?.email) {\r\n      // find user by email\r\n      const u = await prisma.user.findUnique({ where: { email: session.user.email } });\r\n      return u?.id ?? null;\r\n    }\r\n  } catch (e) {\r\n    // ignore; fallback below\r\n  }\r\n\r\n  // fallback: parse Authorization header for a Bearer token, or cookie-based JWT logic here.\r\n  // For development you can return a static id (NOT for production).\r\n  return null;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  const userId = await getCurrentUserId(req);\r\n  if (!userId) return NextResponse.json({ ok: false, error: \"Unauthorized\" }, { status: 401 });\r\n\r\n  try {\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: userId },\r\n      select: { id: true, name: true, email: true, phone: true, role: true, createdAt: true, profile: true },\r\n    });\r\n    if (!user) return NextResponse.json({ ok: false, error: \"Not found\" }, { status: 404 });\r\n    return NextResponse.json({ ok: true, user }, { status: 200 });\r\n  } catch (err) {\r\n    console.error(\"GET /api/me error\", err);\r\n    return NextResponse.json({ ok: false, error: \"Internal\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PATCH(req: Request) {\r\n  const userId = await getCurrentUserId(req);\r\n  if (!userId) return NextResponse.json({ ok: false, error: \"Unauthorized\" }, { status: 401 });\r\n\r\n  try {\r\n    const body = await req.json().catch(() => ({}));\r\n\r\n    const name = typeof body.name === \"string\" ? body.name : undefined;\r\n    const phone = typeof body.phone === \"string\" ? body.phone : undefined;\r\n    const incomingProfile = typeof body.profile === \"object\" && body.profile ? body.profile : {};\r\n\r\n    // sanity check\r\n    if (!name || name.trim().length === 0) {\r\n      // require a name to avoid accidentally blanking\r\n      return NextResponse.json({ ok: false, error: \"Name is required\" }, { status: 400 });\r\n    }\r\n\r\n    // load existing profile (so we merge instead of replacing)\r\n    const existing = await prisma.user.findUnique({ where: { id: userId }, select: { profile: true } });\r\n    const existingProfile = (existing?.profile as any) ?? {};\r\n\r\n    // merge - incoming fields override existing\r\n    const mergedProfile = {\r\n      ...existingProfile,\r\n      ...incomingProfile,\r\n    };\r\n\r\n    // Optionally validate postal code length or other rules here\r\n    // e.g. if (mergedProfile.postalCode && mergedProfile.postalCode.length > 50) -> error\r\n\r\n    const updated = await prisma.user.update({\r\n      where: { id: userId },\r\n      data: {\r\n        name,\r\n        phone,\r\n        profile: mergedProfile,\r\n      },\r\n      select: { id: true, name: true, email: true, phone: true, role: true, createdAt: true, profile: true },\r\n    });\r\n\r\n    return NextResponse.json({ ok: true, user: updated }, { status: 200 });\r\n  } catch (err) {\r\n    console.error(\"PATCH /api/me error\", err);\r\n    return NextResponse.json({ ok: false, error: \"Internal\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}