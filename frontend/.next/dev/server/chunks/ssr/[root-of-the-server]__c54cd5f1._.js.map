{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/components/profile/EditProfile.tsx"],"sourcesContent":["// components/profile/EditProfile.tsx\r\n\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\n/**\r\n * NOTE: replace GEONAMES_USERNAME with your GeoNames username if you want live country/state lists.\r\n */\r\nconst GEONAMES_USERNAME = \"sankha\"; // <-- replace or leave\r\n\r\nconst TIMEZONES_38 = [\r\n  \"UTC-12:00 - Baker Island\",\r\n  \"UTC-11:00 - Niue / American Samoa\",\r\n  \"UTC-10:00 - Hawaii-Aleutian Standard Time\",\r\n  \"UTC-09:00 - Alaska Standard Time\",\r\n  \"UTC-08:00 - Pacific Standard Time\",\r\n  \"UTC-07:00 - Mountain Standard Time\",\r\n  \"UTC-06:00 - Central Standard Time\",\r\n  \"UTC-05:00 - Eastern Standard Time\",\r\n  \"UTC-04:00 - Atlantic Standard Time\",\r\n  \"UTC-03:30 - Newfoundland Standard Time\",\r\n  \"UTC-03:00 - Argentina / Brasilia\",\r\n  \"UTC-02:00 - South Georgia Time\",\r\n  \"UTC-01:00 - Azores\",\r\n  \"UTC+00:00 - Greenwich Mean Time\",\r\n  \"UTC+01:00 - Central European Time\",\r\n  \"UTC+02:00 - Eastern European Time\",\r\n  \"UTC+03:00 - Moscow / Arabia\",\r\n  \"UTC+03:30 - Iran Standard Time\",\r\n  \"UTC+04:00 - Azerbaijan / UAE\",\r\n  \"UTC+04:30 - Afghanistan\",\r\n  \"UTC+05:00 - Pakistan Standard Time\",\r\n  \"UTC+05:30 - India Standard Time\",\r\n  \"UTC+05:45 - Nepal Time\",\r\n  \"UTC+06:00 - Bangladesh / Bhutan\",\r\n  \"UTC+06:30 - Cocos / Myanmar\",\r\n  \"UTC+07:00 - Indochina Time\",\r\n  \"UTC+08:00 - China / Singapore\",\r\n  \"UTC+09:00 - Japan / Korea\",\r\n  \"UTC+09:30 - Australian Central Standard Time\",\r\n  \"UTC+10:00 - Australian Eastern Standard Time\",\r\n  \"UTC+10:30 - Lord Howe\",\r\n  \"UTC+11:00 - Solomon Is. / New Caledonia\",\r\n  \"UTC+12:00 - Fiji / New Zealand\",\r\n  \"UTC+12:45 - Chatham Islands\",\r\n  \"UTC+13:00 - Tonga / Phoenix Is.\",\r\n  \"UTC+14:00 - Line Islands\"\r\n];\r\n\r\ntype CountryEntry = {\r\n  geonameId: number;\r\n  countryName: string;\r\n  countryCode: string;\r\n};\r\n\r\ntype StateEntry = {\r\n  geonameId: number;\r\n  name: string;\r\n};\r\n\r\ntype User = {\r\n  id: string;\r\n  email: string;\r\n  name?: string | null;\r\n  profile?: any;\r\n};\r\n\r\ntype Props = {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  user: User | null;\r\n  // onSave should ideally return boolean or Promise<boolean>. This component will\r\n  // accept either boolean, Promise<boolean>, or a returned updated user object.\r\n  onSave: (payload: Partial<User & { profile?: any }>) => Promise<boolean | any> | boolean | any;\r\n};\r\n\r\nconst MAX_AVATAR_BYTES = 2 * 1024 * 1024; // 2 MB\r\nconst COOKIE_CANDIDATES = [\"session\", \"token\", \"auth_token\", \"authToken\", \"auth\"];\r\n\r\nexport default function EditProfile({ open, onClose, user, onSave }: Props) {\r\n  const [saving, setSaving] = useState(false);\r\n\r\n  const [fullName, setFullName] = useState(\"\");\r\n  const [displayName, setDisplayName] = useState(\"\");\r\n  const [gender, setGender] = useState(\"\");\r\n  const [countryGeonameId, setCountryGeonameId] = useState<number | \"\">(\"\");\r\n  const [countryCode, setCountryCode] = useState(\"\");\r\n  const [countryName, setCountryName] = useState(\"\");\r\n  const [stateGeonameId, setStateGeonameId] = useState<number | \"\">(\"\");\r\n  const [stateName, setStateName] = useState(\"\");\r\n  const [language, setLanguage] = useState(\"\");\r\n  const [timezone, setTimezone] = useState(\"\");\r\n\r\n  const [avatarPreview, setAvatarPreview] = useState<string | null>(null);\r\n  const [avatarFileSize, setAvatarFileSize] = useState<number | null>(null);\r\n  const [avatarRemoved, setAvatarRemoved] = useState(false);\r\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\r\n\r\n  const [countries, setCountries] = useState<CountryEntry[]>([]);\r\n  const [states, setStates] = useState<StateEntry[]>([]);\r\n  const [loadingCountries, setLoadingCountries] = useState(false);\r\n  const [loadingStates, setLoadingStates] = useState(false);\r\n\r\n  const primaryRef = useRef<HTMLButtonElement | null>(null);\r\n\r\n  // init form from user\r\n  useEffect(() => {\r\n    if (!user) return;\r\n    setFullName(user.name ?? \"\");\r\n    const p = user.profile ?? {};\r\n    setDisplayName(p.displayName ?? \"\");\r\n    setGender(p.gender ?? \"\");\r\n    setCountryGeonameId(p.countryGeonameId ?? \"\");\r\n    setCountryCode(p.countryCode ?? \"\");\r\n    setCountryName(p.countryName ?? \"\");\r\n    setStateGeonameId(p.stateGeonameId ?? \"\");\r\n    setStateName(p.stateName ?? \"\");\r\n    setLanguage(p.language ?? \"\");\r\n    setTimezone(p.timezone ?? \"\");\r\n    setAvatarPreview(p.avatarUrl ?? p.avatarBase64 ?? null);\r\n    setAvatarFileSize(null);\r\n    setAvatarRemoved(false);\r\n    console.debug(\"[EditProfile] initialized form from user:\", { id: user.id, name: user.name, profile: user.profile });\r\n  }, [user, open]);\r\n\r\n  // load countries (cached)\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function loadCountries() {\r\n      setLoadingCountries(true);\r\n      try {\r\n        const cached = sessionStorage.getItem(\"geonames_countries_v1\");\r\n        if (cached) {\r\n          const parsed: CountryEntry[] = JSON.parse(cached);\r\n          if (mounted) setCountries(parsed);\r\n          setLoadingCountries(false);\r\n          return;\r\n        }\r\n\r\n        if (!GEONAMES_USERNAME) {\r\n          setCountries([]);\r\n          setLoadingCountries(false);\r\n          return;\r\n        }\r\n\r\n        const res = await fetch(`http://api.geonames.org/countryInfoJSON?username=${GEONAMES_USERNAME}`);\r\n        if (!res.ok) throw new Error(\"Failed to fetch countries from GeoNames\");\r\n        const json = await res.json();\r\n        const list: CountryEntry[] = (json.geonames || []).map((c: any) => ({\r\n          geonameId: c.geonameId,\r\n          countryName: c.countryName,\r\n          countryCode: c.countryCode\r\n        }));\r\n        sessionStorage.setItem(\"geonames_countries_v1\", JSON.stringify(list));\r\n        if (mounted) setCountries(list);\r\n      } catch (err) {\r\n        console.error(\"[EditProfile] Error loading countries:\", err);\r\n        if (mounted) setCountries([]);\r\n      } finally {\r\n        if (mounted) setLoadingCountries(false);\r\n      }\r\n    }\r\n    loadCountries();\r\n    return () => { mounted = false; };\r\n  }, []);\r\n\r\n  // load states when country changes\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function loadStates() {\r\n      if (!countryGeonameId) {\r\n        if (mounted) {\r\n          setStates([]);\r\n          setStateGeonameId(\"\");\r\n          setStateName(\"\");\r\n        }\r\n        return;\r\n      }\r\n\r\n      setLoadingStates(true);\r\n      setStates([]);\r\n      try {\r\n        if (!GEONAMES_USERNAME) {\r\n          setStates([]);\r\n          setLoadingStates(false);\r\n          return;\r\n        }\r\n        const res = await fetch(`http://api.geonames.org/childrenJSON?geonameId=${countryGeonameId}&username=${GEONAMES_USERNAME}`);\r\n        if (!res.ok) throw new Error(\"Failed to fetch states from GeoNames\");\r\n        const json = await res.json();\r\n        const st: StateEntry[] = (json.geonames || []).map((g: any) => ({ geonameId: g.geonameId, name: g.name }));\r\n        if (mounted) {\r\n          setStates(st);\r\n          setLoadingStates(false);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"[EditProfile] Error loading states:\", err);\r\n        if (mounted) setLoadingStates(false);\r\n      }\r\n    }\r\n\r\n    if (countryGeonameId) {\r\n      const found = countries.find((c) => c.geonameId === countryGeonameId);\r\n      if (found) {\r\n        setCountryCode(found.countryCode);\r\n        setCountryName(found.countryName);\r\n      }\r\n    } else {\r\n      setCountryCode(\"\");\r\n      setCountryName(\"\");\r\n    }\r\n\r\n    loadStates();\r\n    return () => { mounted = false; };\r\n  }, [countryGeonameId, countries]);\r\n\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    const prev = document.body.style.overflow;\r\n    document.body.style.overflow = \"hidden\";\r\n    const t = setTimeout(() => primaryRef.current?.focus(), 80);\r\n    return () => {\r\n      document.body.style.overflow = prev;\r\n      clearTimeout(t);\r\n    };\r\n  }, [open]);\r\n\r\n  useEffect(() => {\r\n    function onKey(e: KeyboardEvent) {\r\n      if (e.key === \"Escape\") onClose();\r\n    }\r\n    if (open) window.addEventListener(\"keydown\", onKey);\r\n    return () => window.removeEventListener(\"keydown\", onKey);\r\n  }, [open, onClose]);\r\n\r\n  if (!open) return null;\r\n\r\n  // avatar helpers\r\n  function handleFileChange(e: React.ChangeEvent<HTMLInputElement>) {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n    pickAvatarFile(file);\r\n  }\r\n\r\n  function pickAvatarFile(file: File) {\r\n    if (!file.type.startsWith(\"image/\")) {\r\n      alert(\"Please select an image file.\");\r\n      return;\r\n    }\r\n    if (file.size > MAX_AVATAR_BYTES) {\r\n      alert(\"Avatar must be 2 MB or smaller.\");\r\n      return;\r\n    }\r\n    const reader = new FileReader();\r\n    reader.onload = () => {\r\n      const dataUrl = reader.result as string;\r\n      setAvatarPreview(dataUrl);\r\n      setAvatarFileSize(file.size);\r\n      setAvatarRemoved(false);\r\n      console.debug(\"[EditProfile] avatar picked, size:\", file.size);\r\n    };\r\n    reader.onerror = (err) => {\r\n      console.error(\"[EditProfile] Failed to read avatar file:\", err);\r\n      alert(\"Failed to read the selected file.\");\r\n    };\r\n    reader.readAsDataURL(file);\r\n  }\r\n\r\n  function triggerFilePicker() {\r\n    fileInputRef.current?.click();\r\n  }\r\n\r\n  function removeAvatar() {\r\n    setAvatarPreview(null);\r\n    setAvatarFileSize(null);\r\n    setAvatarRemoved(true);\r\n    if (fileInputRef.current) fileInputRef.current.value = \"\";\r\n    console.debug(\"[EditProfile] avatar removed by user\");\r\n  }\r\n\r\n  // ---------- submit handler (with debug + robust fallback) ----------\r\nasync function submit(e?: React.FormEvent) {\r\n  e?.preventDefault();\r\n  if (!user) {\r\n    console.warn(\"[EditProfile] submit called but user is null\");\r\n    return;\r\n  }\r\n  if (!fullName || typeof fullName !== \"string\") {\r\n    alert(\"Full name is required.\");\r\n    return;\r\n  }\r\n\r\n  setSaving(true);\r\n  try {\r\n    const profilePatch: any = {\r\n      displayName: displayName || undefined,\r\n      gender: gender || undefined,\r\n      countryGeonameId: countryGeonameId || null,\r\n      countryCode: countryCode || null,\r\n      countryName: countryName || null,\r\n      stateGeonameId: stateGeonameId || null,\r\n      stateName: stateName || null,\r\n      language: language || undefined,\r\n      timezone: timezone || undefined\r\n    };\r\n\r\n    if (avatarRemoved) {\r\n      profilePatch.avatarBase64 = null;\r\n      profilePatch.avatarUrl = null;\r\n    } else if (avatarPreview && avatarPreview.startsWith(\"data:\")) {\r\n      profilePatch.avatarBase64 = avatarPreview;\r\n      profilePatch.avatarUrl = avatarPreview;\r\n    }\r\n\r\n    const payload: any = {\r\n      name: fullName,\r\n      profile: profilePatch\r\n    };\r\n\r\n    console.debug(\"[EditProfile] submit payload:\", payload);\r\n\r\n    // Call parent onSave and capture result\r\n    let okResult: boolean | any = false;\r\n    try {\r\n      const maybe = onSave(payload);\r\n      okResult = typeof maybe === \"boolean\" ? maybe : await maybe;\r\n      console.debug(\"[EditProfile] onSave returned:\", okResult);\r\n    } catch (err) {\r\n      console.error(\"[EditProfile] onSave threw error:\", err);\r\n      okResult = false;\r\n    }\r\n\r\n    // If parent returned a truthy object (updated user), use it; if boolean true, proceed to fetch /api/me.\r\n    let updatedUser: any = null;\r\n    if (okResult && typeof okResult === \"object\") {\r\n      updatedUser = okResult;\r\n      console.debug(\"[EditProfile] using updated user returned by parent onSave\");\r\n    } else if (okResult === true) {\r\n      // parent signalled success but didn't return user => fetch authoritative /api/me\r\n      try {\r\n        const r = await fetch(\"/api/me\", { method: \"GET\", credentials: \"include\", cache: \"no-store\" });\r\n        console.debug(\"[EditProfile] GET /api/me after save status:\", r.status);\r\n        if (r.ok) {\r\n          const b = await r.json().catch(() => null);\r\n          updatedUser = b?.user ?? null;\r\n          console.debug(\"[EditProfile] GET /api/me returned:\", updatedUser);\r\n        } else {\r\n          console.warn(\"[EditProfile] GET /api/me after save returned non-ok:\", r.status);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"[EditProfile] failed to fetch /api/me after save:\", err);\r\n      }\r\n    } else {\r\n      // Parent returned falsy value or failure — attempt direct PATCH as a fallback\r\n      try {\r\n        console.debug(\"[EditProfile] parent onSave failed or returned falsy — trying direct PATCH to /api/me\");\r\n        const r = await fetch(\"/api/me\", {\r\n          method: \"PATCH\",\r\n          credentials: \"include\",\r\n          headers: { \"Content-Type\": \"application/json\", Accept: \"application/json\" },\r\n          body: JSON.stringify(payload),\r\n        });\r\n        console.debug(\"[EditProfile] direct PATCH /api/me status:\", r.status);\r\n        if (r.ok) {\r\n          const b = await r.json().catch(() => null);\r\n          updatedUser = b?.user ?? null;\r\n          console.debug(\"[EditProfile] direct PATCH response body:\", b);\r\n        } else {\r\n          const txt = await r.text().catch(() => null);\r\n          console.warn(\"[EditProfile] direct PATCH returned non-ok:\", r.status, txt);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"[EditProfile] direct PATCH failed:\", err);\r\n      }\r\n    }\r\n\r\n    // If we have updatedUser, dispatch event so app can update global state\r\n    if (updatedUser) {\r\n      try {\r\n        window.dispatchEvent(new CustomEvent(\"user:updated\", { detail: updatedUser }));\r\n        console.debug(\"[EditProfile] dispatched user:updated event\", updatedUser);\r\n      } catch (e) {\r\n        console.error(\"[EditProfile] dispatch user:updated failed:\", e);\r\n      }\r\n\r\n      // close modal\r\n      onClose?.();\r\n      return;\r\n    }\r\n\r\n    // Nothing worked — dispatch null detail and reload as last resort\r\n    try {\r\n      window.dispatchEvent(new CustomEvent(\"user:updated\", { detail: null }));\r\n      console.debug(\"[EditProfile] dispatched user:updated null fallback\");\r\n    } catch (e) {\r\n      console.debug(\"[EditProfile] dispatch fallback failed\", e);\r\n    }\r\n\r\n    console.warn(\"[EditProfile] could not obtain updated user after save; reloading page as fallback\");\r\n    // Reload to show server-side updated state as a last resort\r\n    window.location.reload();\r\n  } catch (err) {\r\n    console.error(\"[EditProfile] submit unexpected error:\", err);\r\n  } finally {\r\n    setSaving(false);\r\n  }\r\n}\r\n\r\n  // end submit\r\n  // ---------- JSX below ----------\r\n  return ReactDOM.createPortal(\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n      <div className=\"absolute inset-0 bg-black/40\" onClick={onClose} aria-hidden />\r\n      <div\r\n        role=\"dialog\"\r\n        aria-modal=\"true\"\r\n        aria-labelledby=\"edit-profile-title\"\r\n        className=\"relative z-10 w-full max-w-2xl bg-white rounded-2xl p-6 shadow-lg border\"\r\n      >\r\n        <div className=\"flex items-start justify-between gap-4\">\r\n          <div>\r\n            <h3 id=\"edit-profile-title\" className=\"text-lg font-semibold\">Edit profile</h3>\r\n            <p className=\"text-sm text-slate-600 mt-1\">Update your name, display name, timezone and country/state. Email is read-only.</p>\r\n          </div>\r\n          <div>\r\n            <button onClick={onClose} className=\"text-slate-500 hover:text-slate-700\" aria-label=\"Close\">✕</button>\r\n          </div>\r\n        </div>\r\n\r\n        <form className=\"mt-6 space-y-4\" onSubmit={submit}>\r\n          <div className=\"flex items-start gap-6\">\r\n            <div className=\"flex flex-col items-center gap-3\">\r\n              <div className=\"relative\">\r\n                <div className=\"w-24 h-24 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center border\">\r\n                  {avatarPreview ? (\r\n                    // eslint-disable-next-line @next/next/no-img-element\r\n                    <img src={avatarPreview} alt=\"avatar preview\" className=\"w-full h-full object-cover\" />\r\n                  ) : (\r\n                    <div className=\"text-3xl font-semibold text-slate-700\">\r\n                      {(user?.name || user?.email || \"U\").charAt(0).toUpperCase()}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"absolute -bottom-2 -right-2 flex gap-1\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={triggerFilePicker}\r\n                    className=\"bg-white border rounded-full p-1 shadow hover:bg-slate-50\"\r\n                    title=\"Change avatar\"\r\n                  >\r\n                    <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden>\r\n                      <path d=\"M12 5v14\" stroke=\"#0F172A\" strokeWidth=\"1.5\" strokeLinecap=\"round\" />\r\n                      <path d=\"M5 12h14\" stroke=\"#0F172A\" strokeWidth=\"1.5\" strokeLinecap=\"round\" />\r\n                    </svg>\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={removeAvatar}\r\n                    className=\"bg-white border rounded-full p-1 shadow hover:bg-slate-50\"\r\n                    title=\"Remove avatar\"\r\n                  >\r\n                    <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden>\r\n                      <path d=\"M6 6l12 12M6 18L18 6\" stroke=\"#ef4444\" strokeWidth=\"1.5\" strokeLinecap=\"round\" />\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"text-xs text-slate-500 text-center\">\r\n                {avatarFileSize ? `${Math.round(avatarFileSize / 1024)} KB` : \"Max 2 MB\"}\r\n              </div>\r\n\r\n              <input\r\n                ref={fileInputRef}\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                onChange={handleFileChange}\r\n                className=\"sr-only\"\r\n                aria-hidden\r\n              />\r\n            </div>\r\n\r\n            <div className=\"flex-1 grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"text-xs text-slate-600 block\">Full name</label>\r\n                <input\r\n                  className=\"mt-1 w-full rounded-lg border px-3 py-2\"\r\n                  value={fullName}\r\n                  onChange={(e) => setFullName(e.target.value)}\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"text-xs text-slate-600 block\">Display name</label>\r\n                <input\r\n                  className=\"mt-1 w-full rounded-lg border px-3 py-2\"\r\n                  value={displayName}\r\n                  onChange={(e) => setDisplayName(e.target.value)}\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"text-xs text-slate-600 block\">Email (read-only)</label>\r\n                <input className=\"mt-1 w-full rounded-lg border px-3 py-2 bg-slate-50\" value={user?.email ?? \"\"} readOnly />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"text-xs text-slate-600 block\">Gender</label>\r\n                <select className=\"mt-1 w-full rounded-lg border px-3 py-2\" value={gender} onChange={(e) => setGender(e.target.value)}>\r\n                  <option value=\"\">Prefer not to say</option>\r\n                  <option value=\"female\">Female</option>\r\n                  <option value=\"male\">Male</option>\r\n                  <option value=\"other\">Other</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"text-xs text-slate-600 block\">Country/Region</label>\r\n                <select\r\n                  value={countryGeonameId || \"\"}\r\n                  onChange={(e) => {\r\n                    const val = e.target.value;\r\n                    setCountryGeonameId(val ? Number(val) : \"\");\r\n                    setStateGeonameId(\"\");\r\n                    setStateName(\"\");\r\n                  }}\r\n                  className=\"mt-1 w-full rounded-lg border px-3 py-2\"\r\n                >\r\n                  <option value=\"\">Select Country</option>\r\n                  {loadingCountries ? (\r\n                    <option value=\"\">Loading countries...</option>\r\n                  ) : (\r\n                    countries.map((c) => (\r\n                      <option key={c.geonameId} value={c.geonameId}>\r\n                        {c.countryName} ({c.countryCode})\r\n                      </option>\r\n                    ))\r\n                  )}\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"text-xs text-slate-600 block\">State</label>\r\n                <select\r\n                  value={stateGeonameId || \"\"}\r\n                  onChange={(e) => {\r\n                    const val = e.target.value;\r\n                    setStateGeonameId(val ? Number(val) : \"\");\r\n                    const found = states.find((s) => s.geonameId === Number(val));\r\n                    setStateName(found ? found.name : \"\");\r\n                  }}\r\n                  className=\"mt-1 w-full rounded-lg border px-3 py-2\"\r\n                  disabled={!countryGeonameId || loadingStates || states.length === 0}\r\n                >\r\n                  <option value=\"\">{countryGeonameId ? (loadingStates ? \"Loading states...\" : \"Select State\") : \"Select Country First\"}</option>\r\n                  {states.map((s) => (\r\n                    <option key={s.geonameId} value={s.geonameId}>\r\n                      {s.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"text-xs text-slate-600 block\">Language</label>\r\n                <input value={language} onChange={(e) => setLanguage(e.target.value)} className=\"mt-1 w-full rounded-lg border px-3 py-2\" />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"text-xs text-slate-600 block\">Time zone</label>\r\n                <select value={timezone} onChange={(e) => setTimezone(e.target.value)} className=\"mt-1 w-full rounded-lg border px-3 py-2\">\r\n                  <option value=\"\">Select timezone</option>\r\n                  {TIMEZONES_38.map((tz) => (\r\n                    <option key={tz} value={tz}>\r\n                      {tz}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex justify-end gap-3 mt-2\">\r\n            <button type=\"button\" onClick={onClose} className=\"px-4 py-2 rounded-lg border\">Cancel</button>\r\n            <button\r\n              ref={primaryRef}\r\n              type=\"submit\"\r\n              disabled={saving}\r\n              className=\"px-4 py-2 rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 text-white\"\r\n            >\r\n              {saving ? \"Saving...\" : \"Save changes\"}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>,\r\n    document.body\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1016, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/components/modals/ConfirmModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useRef } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\ntype ConfirmModalProps = {\r\n  open: boolean;\r\n  title?: string;\r\n  message?: string;\r\n  confirmLabel?: string;\r\n  cancelLabel?: string;\r\n  onConfirm: () => Promise<void> | void;\r\n  onCancel: () => void;\r\n};\r\n\r\nexport default function ConfirmModal({\r\n  open,\r\n  title = \"Confirm\",\r\n  message = \"Are you sure?\",\r\n  confirmLabel = \"Yes\",\r\n  cancelLabel = \"Cancel\",\r\n  onConfirm,\r\n  onCancel,\r\n}: ConfirmModalProps) {\r\n  const ref = useRef<HTMLDivElement | null>(null);\r\n  const primaryBtnRef = useRef<HTMLButtonElement | null>(null);\r\n\r\n  // prevent background scroll\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    const prev = document.body.style.overflow;\r\n    document.body.style.overflow = \"hidden\";\r\n    primaryBtnRef.current?.focus();\r\n    return () => {\r\n      document.body.style.overflow = prev;\r\n    };\r\n  }, [open]);\r\n\r\n  // close on ESC\r\n  useEffect(() => {\r\n    function onKey(e: KeyboardEvent) {\r\n      if (e.key === \"Escape\") onCancel();\r\n    }\r\n    if (open) window.addEventListener(\"keydown\", onKey);\r\n    return () => window.removeEventListener(\"keydown\", onKey);\r\n  }, [open, onCancel]);\r\n\r\n  if (!open) return null;\r\n\r\n  return ReactDOM.createPortal(\r\n    <div\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      aria-labelledby=\"confirm-title\"\r\n      className=\"fixed inset-0 z-50 flex items-center justify-center p-4\"\r\n    >\r\n      <div\r\n        className=\"absolute inset-0 bg-black/40 backdrop-blur-sm\"\r\n        onClick={onCancel}\r\n        aria-hidden\r\n      />\r\n      <div\r\n        ref={ref}\r\n        className=\"relative z-10 max-w-lg w-full bg-white rounded-2xl shadow-xl border p-6\"\r\n      >\r\n        <h3 id=\"confirm-title\" className=\"text-lg font-semibold text-slate-900\">\r\n          {title}\r\n        </h3>\r\n        <p className=\"mt-2 text-sm text-slate-600\">{message}</p>\r\n\r\n        <div className=\"mt-6 flex justify-end gap-3\">\r\n          <button\r\n            onClick={onCancel}\r\n            className=\"px-4 py-2 rounded-lg border text-sm text-slate-700 hover:bg-slate-50\"\r\n          >\r\n            {cancelLabel}\r\n          </button>\r\n          <button\r\n            ref={primaryBtnRef}\r\n            onClick={() => void onConfirm()}\r\n            className=\"px-4 py-2 rounded-lg bg-red-600 text-white text-sm hover:opacity-95\"\r\n          >\r\n            {confirmLabel}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>,\r\n    document.body\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAee,SAAS,aAAa,EACnC,IAAI,EACJ,QAAQ,SAAS,EACjB,UAAU,eAAe,EACzB,eAAe,KAAK,EACpB,cAAc,QAAQ,EACtB,SAAS,EACT,QAAQ,EACU;IAClB,MAAM,MAAM,IAAA,+MAAM,EAAwB;IAC1C,MAAM,gBAAgB,IAAA,+MAAM,EAA2B;IAEvD,4BAA4B;IAC5B,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,MAAM;QACX,MAAM,OAAO,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ;QACzC,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QAC/B,cAAc,OAAO,EAAE;QACvB,OAAO;YACL,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QACjC;IACF,GAAG;QAAC;KAAK;IAET,eAAe;IACf,IAAA,kNAAS,EAAC;QACR,SAAS,MAAM,CAAgB;YAC7B,IAAI,EAAE,GAAG,KAAK,UAAU;QAC1B;QACA,IAAI,MAAM,OAAO,gBAAgB,CAAC,WAAW;QAC7C,OAAO,IAAM,OAAO,mBAAmB,CAAC,WAAW;IACrD,GAAG;QAAC;QAAM;KAAS;IAEnB,IAAI,CAAC,MAAM,OAAO;IAElB,qBAAO,uNAAQ,CAAC,YAAY,eAC1B,8OAAC;QACC,MAAK;QACL,cAAW;QACX,mBAAgB;QAChB,WAAU;;0BAEV,8OAAC;gBACC,WAAU;gBACV,SAAS;gBACT,aAAW;;;;;;0BAEb,8OAAC;gBACC,KAAK;gBACL,WAAU;;kCAEV,8OAAC;wBAAG,IAAG;wBAAgB,WAAU;kCAC9B;;;;;;kCAEH,8OAAC;wBAAE,WAAU;kCAA+B;;;;;;kCAE5C,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCACC,SAAS;gCACT,WAAU;0CAET;;;;;;0CAEH,8OAAC;gCACC,KAAK;gCACL,SAAS,IAAM,KAAK;gCACpB,WAAU;0CAET;;;;;;;;;;;;;;;;;;;;;;;cAKT,SAAS,IAAI;AAEjB","debugId":null}},
    {"offset": {"line": 1135, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/components/profile/ProfileMenu.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport ConfirmModal from \"../modals/ConfirmModal\";\r\n\r\nexport default function ProfileMenu({ avatarUrl, email }: { avatarUrl?: string; email?: string }) {\r\n  const router = useRouter();\r\n  const [open, setOpen] = useState(false);\r\n  const [confirmOpen, setConfirmOpen] = useState(false);\r\n  const [loggingOut, setLoggingOut] = useState(false);\r\n  const menuRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  // close on outside click\r\n  useEffect(() => {\r\n    function onDocClick(e: MouseEvent) {\r\n      if (!menuRef.current) return;\r\n      if (!(e.target instanceof Node)) return;\r\n      if (!menuRef.current.contains(e.target)) setOpen(false);\r\n    }\r\n    document.addEventListener(\"mousedown\", onDocClick);\r\n    return () => document.removeEventListener(\"mousedown\", onDocClick);\r\n  }, []);\r\n\r\n  // keyboard support\r\n  useEffect(() => {\r\n    function onKey(e: KeyboardEvent) {\r\n      if (e.key === \"Escape\") setOpen(false);\r\n    }\r\n    if (open) window.addEventListener(\"keydown\", onKey);\r\n    return () => window.removeEventListener(\"keydown\", onKey);\r\n  }, [open]);\r\n\r\n  async function handleLogout() {\r\n    try {\r\n      setLoggingOut(true);\r\n      const res = await fetch(\"/api/auth/logout\", { method: \"POST\" });\r\n      // ignore body; route clears cookie\r\n      setConfirmOpen(false);\r\n      setOpen(false);\r\n      // redirect to login page\r\n      router.replace(\"/auth/login\");\r\n    } catch (err) {\r\n      console.error(\"Logout failed\", err);\r\n      setLoggingOut(false);\r\n      setConfirmOpen(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"relative\" ref={menuRef}>\r\n      <button\r\n        aria-haspopup=\"menu\"\r\n        aria-expanded={open}\r\n        onClick={() => setOpen((v) => !v)}\r\n        className=\"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center shadow-sm hover:opacity-95\"\r\n        title=\"Account menu\"\r\n      >\r\n        {avatarUrl ? (\r\n          <img src={avatarUrl} alt=\"avatar\" className=\"w-10 h-10 rounded-full object-cover\" />\r\n        ) : (\r\n          <span className=\"text-sm font-medium text-slate-700\">{(email || \"U\").charAt(0).toUpperCase()}</span>\r\n        )}\r\n      </button>\r\n\r\n      {open && (\r\n        <div\r\n          role=\"menu\"\r\n          aria-label=\"Profile\"\r\n          className=\"absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border py-2 z-20\"\r\n        >\r\n          <button\r\n            role=\"menuitem\"\r\n            onClick={() => {\r\n              setOpen(false);\r\n              router.push(\"/profile\");\r\n            }}\r\n            className=\"w-full text-left px-3 py-2 hover:bg-slate-50 text-sm text-slate-700\"\r\n          >\r\n            View profile\r\n          </button>\r\n\r\n          <button\r\n            role=\"menuitem\"\r\n            onClick={() => {\r\n              setConfirmOpen(true);\r\n            }}\r\n            className=\"w-full text-left px-3 py-2 hover:bg-slate-50 text-sm text-slate-700\"\r\n          >\r\n            Logout\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      <ConfirmModal\r\n        open={confirmOpen}\r\n        title=\"Log out?\"\r\n        message=\"Do you want to logout?\"\r\n        confirmLabel={loggingOut ? \"Logging out...\" : \"Yes, log out\"}\r\n        cancelLabel=\"Cancel\"\r\n        onCancel={() => setConfirmOpen(false)}\r\n        onConfirm={async () => {\r\n          await handleLogout();\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS,YAAY,EAAE,SAAS,EAAE,KAAK,EAA0C;IAC9F,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAC;IACjC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAC/C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAC7C,MAAM,UAAU,IAAA,+MAAM,EAAwB;IAE9C,yBAAyB;IACzB,IAAA,kNAAS,EAAC;QACR,SAAS,WAAW,CAAa;YAC/B,IAAI,CAAC,QAAQ,OAAO,EAAE;YACtB,IAAI,CAAC,CAAC,EAAE,MAAM,YAAY,IAAI,GAAG;YACjC,IAAI,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,EAAE,MAAM,GAAG,QAAQ;QACnD;QACA,SAAS,gBAAgB,CAAC,aAAa;QACvC,OAAO,IAAM,SAAS,mBAAmB,CAAC,aAAa;IACzD,GAAG,EAAE;IAEL,mBAAmB;IACnB,IAAA,kNAAS,EAAC;QACR,SAAS,MAAM,CAAgB;YAC7B,IAAI,EAAE,GAAG,KAAK,UAAU,QAAQ;QAClC;QACA,IAAI,MAAM,OAAO,gBAAgB,CAAC,WAAW;QAC7C,OAAO,IAAM,OAAO,mBAAmB,CAAC,WAAW;IACrD,GAAG;QAAC;KAAK;IAET,eAAe;QACb,IAAI;YACF,cAAc;YACd,MAAM,MAAM,MAAM,MAAM,oBAAoB;gBAAE,QAAQ;YAAO;YAC7D,mCAAmC;YACnC,eAAe;YACf,QAAQ;YACR,yBAAyB;YACzB,OAAO,OAAO,CAAC;QACjB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,cAAc;YACd,eAAe;QACjB;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;QAAW,KAAK;;0BAC7B,8OAAC;gBACC,iBAAc;gBACd,iBAAe;gBACf,SAAS,IAAM,QAAQ,CAAC,IAAM,CAAC;gBAC/B,WAAU;gBACV,OAAM;0BAEL,0BACC,8OAAC;oBAAI,KAAK;oBAAW,KAAI;oBAAS,WAAU;;;;;yCAE5C,8OAAC;oBAAK,WAAU;8BAAsC,CAAC,SAAS,GAAG,EAAE,MAAM,CAAC,GAAG,WAAW;;;;;;;;;;;YAI7F,sBACC,8OAAC;gBACC,MAAK;gBACL,cAAW;gBACX,WAAU;;kCAEV,8OAAC;wBACC,MAAK;wBACL,SAAS;4BACP,QAAQ;4BACR,OAAO,IAAI,CAAC;wBACd;wBACA,WAAU;kCACX;;;;;;kCAID,8OAAC;wBACC,MAAK;wBACL,SAAS;4BACP,eAAe;wBACjB;wBACA,WAAU;kCACX;;;;;;;;;;;;0BAML,8OAAC,uJAAY;gBACX,MAAM;gBACN,OAAM;gBACN,SAAQ;gBACR,cAAc,aAAa,mBAAmB;gBAC9C,aAAY;gBACZ,UAAU,IAAM,eAAe;gBAC/B,WAAW;oBACT,MAAM;gBACR;;;;;;;;;;;;AAIR","debugId":null}},
    {"offset": {"line": 1284, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/components/profile/AddEmailModal.tsx"],"sourcesContent":["// components/profile/AddEmailModal.tsx\r\n\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\ntype Props = {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onAdd: (email: string) => Promise<boolean> | boolean;\r\n};\r\n\r\nexport default function AddEmailModal({ open, onClose, onAdd }: Props) {\r\n  const [email, setEmail] = useState(\"\");\r\n  const [saving, setSaving] = useState(false);\r\n  const primaryRef = useRef<HTMLButtonElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    const prev = document.body.style.overflow;\r\n    document.body.style.overflow = \"hidden\";\r\n    const t = setTimeout(() => primaryRef.current?.focus(), 80);\r\n    return () => {\r\n      document.body.style.overflow = prev;\r\n      clearTimeout(t);\r\n    };\r\n  }, [open]);\r\n\r\n  useEffect(() => {\r\n    function onKey(e: KeyboardEvent) {\r\n      if (e.key === \"Escape\") onClose();\r\n    }\r\n    if (open) window.addEventListener(\"keydown\", onKey);\r\n    return () => window.removeEventListener(\"keydown\", onKey);\r\n  }, [open, onClose]);\r\n\r\n  if (!open) return null;\r\n\r\n  function validEmail(e: string) {\r\n    return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(e);\r\n  }\r\n\r\n  async function submit(e?: React.FormEvent) {\r\n    e?.preventDefault();\r\n    if (!validEmail(email)) {\r\n      alert(\"Enter a valid email address.\");\r\n      return;\r\n    }\r\n    setSaving(true);\r\n    try {\r\n      const ok = await onAdd(email);\r\n      if (!ok) {\r\n        // onAdd handles error messages\r\n      }\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  }\r\n\r\n  return ReactDOM.createPortal(\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n      <div className=\"absolute inset-0 bg-black/40\" onClick={onClose} aria-hidden />\r\n      <div className=\"relative z-10 w-full max-w-md bg-white rounded-2xl p-6 shadow-lg border\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <h3 className=\"text-lg font-semibold\">Add an email address</h3>\r\n          <button onClick={onClose} className=\"text-slate-500 hover:text-slate-700\">✕</button>\r\n        </div>\r\n\r\n        <form className=\"mt-4 space-y-4\" onSubmit={submit}>\r\n          <div>\r\n            <label className=\"text-xs text-slate-600 block\">Email</label>\r\n            <input className=\"mt-1 w-full rounded-lg border px-3 py-2\" value={email} onChange={(e) => setEmail(e.target.value)} required />\r\n          </div>\r\n\r\n          <div className=\"flex justify-end gap-3\">\r\n            <button type=\"button\" onClick={onClose} className=\"px-4 py-2 rounded-lg border\">Cancel</button>\r\n            <button ref={primaryRef} type=\"submit\" disabled={saving} className=\"px-4 py-2 rounded-lg bg-blue-600 text-white\">\r\n              {saving ? \"Adding...\" : \"Add email\"}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>,\r\n    document.body\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,uCAAuC;;;;;;AAGvC;AACA;AAHA;;;;AAWe,SAAS,cAAc,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAS;IACnE,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,aAAa,IAAA,+MAAM,EAA2B;IAEpD,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,MAAM;QACX,MAAM,OAAO,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ;QACzC,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QAC/B,MAAM,IAAI,WAAW,IAAM,WAAW,OAAO,EAAE,SAAS;QACxD,OAAO;YACL,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;YAC/B,aAAa;QACf;IACF,GAAG;QAAC;KAAK;IAET,IAAA,kNAAS,EAAC;QACR,SAAS,MAAM,CAAgB;YAC7B,IAAI,EAAE,GAAG,KAAK,UAAU;QAC1B;QACA,IAAI,MAAM,OAAO,gBAAgB,CAAC,WAAW;QAC7C,OAAO,IAAM,OAAO,mBAAmB,CAAC,WAAW;IACrD,GAAG;QAAC;QAAM;KAAQ;IAElB,IAAI,CAAC,MAAM,OAAO;IAElB,SAAS,WAAW,CAAS;QAC3B,OAAO,6BAA6B,IAAI,CAAC;IAC3C;IAEA,eAAe,OAAO,CAAmB;QACvC,GAAG;QACH,IAAI,CAAC,WAAW,QAAQ;YACtB,MAAM;YACN;QACF;QACA,UAAU;QACV,IAAI;YACF,MAAM,KAAK,MAAM,MAAM;YACvB,IAAI,CAAC,IAAI;YACP,+BAA+B;YACjC;QACF,SAAU;YACR,UAAU;QACZ;IACF;IAEA,qBAAO,uNAAQ,CAAC,YAAY,eAC1B,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;gBAA+B,SAAS;gBAAS,aAAW;;;;;;0BAC3E,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAG,WAAU;0CAAwB;;;;;;0CACtC,8OAAC;gCAAO,SAAS;gCAAS,WAAU;0CAAsC;;;;;;;;;;;;kCAG5E,8OAAC;wBAAK,WAAU;wBAAiB,UAAU;;0CACzC,8OAAC;;kDACC,8OAAC;wCAAM,WAAU;kDAA+B;;;;;;kDAChD,8OAAC;wCAAM,WAAU;wCAA0C,OAAO;wCAAO,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;wCAAG,QAAQ;;;;;;;;;;;;0CAG9H,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAO,MAAK;wCAAS,SAAS;wCAAS,WAAU;kDAA8B;;;;;;kDAChF,8OAAC;wCAAO,KAAK;wCAAY,MAAK;wCAAS,UAAU;wCAAQ,WAAU;kDAChE,SAAS,cAAc;;;;;;;;;;;;;;;;;;;;;;;;;;;;;cAMlC,SAAS,IAAI;AAEjB","debugId":null}},
    {"offset": {"line": 1466, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/profile/page.tsx"],"sourcesContent":["// app/profile/page.tsx\r\n\"use client\";\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport EditProfileModal from \"@/components/profile/EditProfile\";\r\nimport ProfileMenu from \"@/components/profile/ProfileMenu\";\r\nimport AddEmailModal from \"@/components/profile/AddEmailModal\";\r\n\r\n/**\r\n * Profile page (Next.js client component)\r\n *\r\n * Notes:\r\n * - Inline PhoneVerifyModal defined at bottom of file for convenience.\r\n * - Server endpoints expected:\r\n *    GET  /api/me           -> { user, activity? }\r\n *    PATCH /api/me          -> accepts partial { profile, name, ... } and returns { user, activity? }\r\n *    POST  /api/phone/send-otp  -> { ok: true } or { error }\r\n *    POST  /api/phone/verify-otp-> { ok: true, user? } or { error }\r\n */\r\n\r\ntype Profile = {\r\n  displayName?: string;\r\n  gender?: string;\r\n  country?: string;\r\n  state?: string;\r\n  language?: string;\r\n  timezone?: string;\r\n  avatarUrl?: string;\r\n  avatarBase64?: string;\r\n  extraEmail?: string | null;\r\n  phoneNumber?: string | null;\r\n  phoneVerified?: boolean;\r\n  phoneVerifiedAt?: string | null;\r\n  countryCode?: string | null; // ISO alpha-2\r\n  // possible server names:\r\n  countryName?: string | null;\r\n  stateName?: string | null;\r\n  countryGeonameId?: number | null;\r\n  stateGeonameId?: number | null;\r\n};\r\n\r\ntype User = {\r\n  id: string;\r\n  email: string;\r\n  name?: string;\r\n  role?: string;\r\n  profile?: Profile | any;\r\n  updatedAt?: string; // ISO timestamp\r\n};\r\n\r\nconst DEFAULT_DIAL = \"+1\";\r\nconst DEFAULT_NATIONAL_LENGTH = 10;\r\nconst OTP_LEN = 4;\r\n\r\n/** Format time relative with extended granularity:\r\n *  ... (kept as original)\r\n */\r\nfunction formatRelativeExtended(iso?: string | null) {\r\n  if (!iso) return \"—\";\r\n  const then = new Date(iso).getTime();\r\n  if (isNaN(then)) return \"—\";\r\n  const diffMs = Date.now() - then;\r\n  const diffMins = Math.floor(diffMs / 60000);\r\n  if (diffMins < 1) return \"just now\";\r\n  if (diffMins < 60) return `${diffMins}m ago`;\r\n  const diffHours = Math.floor(diffMins / 60);\r\n  if (diffHours < 24) return `${diffHours}h ago`;\r\n  const diffDays = Math.floor(diffHours / 24);\r\n  if (diffDays < 7) return `${diffDays}d ago`;\r\n  if (diffDays < 30) {\r\n    const weeks = Math.floor(diffDays / 7);\r\n    return `${weeks}w ago`;\r\n  }\r\n  if (diffDays < 365) {\r\n    const months = Math.floor(diffDays / 30);\r\n    return `${months}mo ago`;\r\n  }\r\n  const years = Math.floor(diffDays / 365);\r\n  return `${years}y ago`;\r\n}\r\n\r\n/** Small fallback table for national length where restcountries can't tell us */\r\nconst FALLBACK_LENGTH: Record<string, number> = {\r\n  IN: 10,\r\n  US: 10,\r\n  CA: 10,\r\n  GB: 10,\r\n  AU: 9,\r\n  SG: 8,\r\n  BD: 10,\r\n  NP: 10,\r\n  PK: 10,\r\n};\r\n\r\n/**\r\n * normalizeUser:\r\n * - maps server-returned profile.countryName / profile.stateName -> profile.country / profile.state\r\n * - ensures UI always reads from profile.country / profile.state\r\n */\r\nfunction normalizeUser(user: any): any {\r\n  if (!user) return user;\r\n  const p = user.profile ?? {};\r\n  const normalizedProfile = {\r\n    ...p,\r\n    country: p.country ?? p.countryName ?? p.country_name ?? null,\r\n    state: p.state ?? p.stateName ?? p.state_name ?? null,\r\n  };\r\n  return { ...user, profile: normalizedProfile };\r\n}\r\n\r\nexport default function ProfilePage() {\r\n  const router = useRouter();\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [editOpen, setEditOpen] = useState(false);\r\n  const [addEmailOpen, setAddEmailOpen] = useState(false);\r\n  const [activity, setActivity] = useState<{ logins30d: number; changes30d: number } | null>(null);\r\n\r\n  // phone verify modal state\r\n  const [verifyOpen, setVerifyOpen] = useState(false);\r\n\r\n  // tick to refresh relative labels (every 30s)\r\n  const [, setTick] = useState(0);\r\n  useEffect(() => {\r\n    const id = setInterval(() => setTick((s) => s + 1), 30000);\r\n    return () => clearInterval(id);\r\n  }, []);\r\n\r\n  // fetch /api/me on mount — include credentials so cookies are sent\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    const ac = new AbortController();\r\n\r\n    async function load() {\r\n      try {\r\n        const res = await fetch(\"/api/me\", { signal: ac.signal, credentials: \"include\" });\r\n        if (!res.ok) {\r\n          if (!mounted) return;\r\n          setUser(null);\r\n          setActivity(null);\r\n          return;\r\n        }\r\n        const json = await res.json();\r\n        if (!mounted) return;\r\n        // normalize so UI always has profile.country / profile.state\r\n        setUser(normalizeUser(json.user ?? null));\r\n        setActivity(json.activity ?? null);\r\n      } catch (err: any) {\r\n        if (err?.name === \"AbortError\") return;\r\n        console.error(\"fetch /api/me error\", err);\r\n        if (!mounted) return;\r\n        setUser(null);\r\n        setActivity(null);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n\r\n    load();\r\n    return () => {\r\n      mounted = false;\r\n      ac.abort();\r\n    };\r\n  }, []);\r\n\r\n  // unified save handler used by EditProfileModal (and other callers)\r\n  async function handleSave(updated: Partial<User & { profile?: any }>) {\r\n    const prev = user;\r\n    // optimistic update: merge shallow\r\n    setUser((prevU) => (prevU ? { ...prevU, ...updated } : prevU));\r\n\r\n    try {\r\n      const res = await fetch(\"/api/me\", {\r\n        method: \"PATCH\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        credentials: \"include\",\r\n        body: JSON.stringify(updated),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const txt = await res.text().catch(() => \"(no body)\");\r\n        console.error(\"Save failed:\", txt);\r\n        setUser(prev ?? null);\r\n        alert(\"Save failed. See console for details.\");\r\n        return false;\r\n      }\r\n\r\n      const json = await res.json().catch(() => null);\r\n      console.debug(\"PATCH response :\", json);\r\n      if (json?.user) {\r\n        setUser(normalizeUser(json.user));\r\n      } else if (json) {\r\n        // merge partial response\r\n        setUser((u) => (u ? { ...u, ...json } : u));\r\n      } else {\r\n        setUser(prev ?? null);\r\n      }\r\n\r\n      if (json?.activity) setActivity(json.activity);\r\n      return true;\r\n    } catch (err) {\r\n      console.error(\"handleSave error:\", err);\r\n      setUser(prev ?? null);\r\n      alert(\"Save failed due to network/server error.\");\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Add extra email (only one allowed)\r\n  async function handleAddEmail(email: string) {\r\n    if (!user) return false;\r\n    if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) {\r\n      alert(\"Invalid email\");\r\n      return false;\r\n    }\r\n    const prev = user;\r\n    const updatedProfile = { ...(user.profile ?? {}), extraEmail: email };\r\n    setUser({ ...user, profile: updatedProfile });\r\n\r\n    try {\r\n      const res = await fetch(\"/api/me\", {\r\n        method: \"PATCH\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        credentials: \"include\",\r\n        body: JSON.stringify({ profile: updatedProfile }),\r\n      });\r\n      if (!res.ok) {\r\n        const txt = await res.text().catch(() => \"(no body)\");\r\n        console.error(\"Add email failed:\", txt);\r\n        setUser(prev);\r\n        alert(\"Failed to add email.\");\r\n        return false;\r\n      }\r\n      const json = await res.json().catch(() => null);\r\n      if (json?.user) setUser(normalizeUser(json.user));\r\n      if (json?.activity) setActivity(json.activity);\r\n      setAddEmailOpen(false);\r\n      return true;\r\n    } catch (err) {\r\n      console.error(err);\r\n      setUser(prev);\r\n      alert(\"Failed to add email (network).\");\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Remove extra email (send explicit null so backend can remove the field)\r\n  async function handleRemoveExtraEmail() {\r\n    if (!user) return false;\r\n    const prev = user;\r\n    const updatedProfile = { ...(user.profile ?? {}), extraEmail: null };\r\n    setUser({ ...user, profile: updatedProfile });\r\n\r\n    try {\r\n      const res = await fetch(\"/api/me\", {\r\n        method: \"PATCH\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        credentials: \"include\",\r\n        body: JSON.stringify({ profile: updatedProfile }),\r\n      });\r\n      if (!res.ok) {\r\n        const txt = await res.text().catch(() => \"(no body)\");\r\n        console.error(\"Remove email failed:\", txt);\r\n        setUser(prev);\r\n        alert(\"Failed to remove email.\");\r\n        return false;\r\n      }\r\n      const json = await res.json().catch(() => null);\r\n      if (json?.user) setUser(normalizeUser(json.user));\r\n      if (json?.activity) setActivity(json.activity);\r\n      return true;\r\n    } catch (err) {\r\n      console.error(err);\r\n      setUser(prev);\r\n      alert(\"Failed to remove email (network).\");\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // When child modal returns an updated user object, accept it; otherwise re-fetch /api/me\r\n  async function applyUpdatedUserFromChild(updatedUser: any) {\r\n    if (updatedUser && updatedUser.id && updatedUser.email) {\r\n      setUser(normalizeUser(updatedUser));\r\n      if (updatedUser.activity) setActivity(updatedUser.activity);\r\n      return;\r\n    }\r\n    // fallback refetch\r\n    try {\r\n      const r = await fetch(\"/api/me\", { credentials: \"include\", cache: \"no-store\" });\r\n      if (!r.ok) return;\r\n      const j = await r.json().catch(() => null);\r\n      if (j?.user) setUser(normalizeUser(j.user));\r\n      if (j?.activity) setActivity(j.activity);\r\n    } catch (err) {\r\n      console.error(\"refetch after child update failed\", err);\r\n    }\r\n  }\r\n\r\n  if (loading) return <div className=\"p-6\">Loading...</div>;\r\n  if (!user) return <div className=\"p-6\">Not logged in</div>;\r\n\r\n  const profile = (user.profile ?? {}) as Profile;\r\n  const role = (user.role ?? \"viewer\").toString().toUpperCase();\r\n\r\n  // compute updated label live (updates via tick)\r\n  const lastUpdatedISO = user.updatedAt ?? profile?.updatedAt ?? null;\r\n  const lastUpdatedLabel = formatRelativeExtended(lastUpdatedISO);\r\n  const headerUpdatedLabel = lastUpdatedLabel === \"just now\" ? \"Updated just now\" : `Updated ${lastUpdatedLabel}`;\r\n\r\n  return (\r\n    <main className=\"min-h-screen bg-gradient-to-b from-slate-50 via-white to-slate-50\">\r\n      <div className=\"max-w-7xl mx-auto px-6 py-8\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"h-12 w-12 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center shadow-md\">\r\n              <svg width=\"26\" height=\"26\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden>\r\n                <path d=\"M3 12h18\" stroke=\"white\" strokeWidth=\"2\" strokeLinecap=\"round\" />\r\n                <path d=\"M7 6v12\" stroke=\"white\" strokeWidth=\"2\" strokeLinecap=\"round\" />\r\n              </svg>\r\n            </div>\r\n            <div>\r\n              <div className=\"text-lg font-semibold text-slate-900\">Profile</div>\r\n              <div className=\"text-xs text-slate-500\">Manage your personal details and contact info</div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"hidden sm:inline-flex items-center gap-2 rounded-full px-3 py-1 bg-slate-100 text-slate-800 text-sm\">\r\n              <strong className=\"uppercase\">{role}</strong>\r\n              <span className=\"text-xs text-slate-600\">access</span>\r\n            </div>\r\n\r\n            <ProfileMenu email={user.email} avatarUrl={profile?.avatarUrl} />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-6\">\r\n          {/* Left column: profile card + contacts */}\r\n          <div className=\"lg:col-span-8\">\r\n            <section className=\"bg-white/60 backdrop-blur-md rounded-3xl p-8 shadow-lg border border-slate-100\">\r\n              <div className=\"flex items-start gap-6\">\r\n                <div className=\"w-24 h-24 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center\">\r\n                  {profile?.avatarUrl ? (\r\n                    // eslint-disable-next-line @next/next/no-img-element\r\n                    <img src={profile.avatarUrl} alt=\"avatar\" className=\"w-full h-full object-cover\" />\r\n                  ) : (\r\n                    <div className=\"text-3xl font-semibold text-slate-700\">{(user.name || user.email || \"U\").charAt(0).toUpperCase()}</div>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"flex-1\">\r\n                  <div className=\"flex items-center gap-4\">\r\n                    <div>\r\n                      <h1 className=\"text-2xl font-bold text-slate-900\">{user.name ?? \"—\"}</h1>\r\n                      <div className=\"text-sm text-slate-500\">{user.email}</div>\r\n                    </div>\r\n\r\n                    <div className=\"ml-auto flex items-center gap-3\">\r\n                      <button onClick={() => setEditOpen(true)} className=\"px-4 py-2 rounded-lg bg-blue-700 text-white shadow hover:opacity-95\">\r\n                        Edit\r\n                      </button>\r\n                      {/* Settings removed per request */}\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"mt-4 text-xs text-slate-500\">\r\n                    Last profile update: <span className=\"font-medium text-slate-700\">{lastUpdatedLabel}</span>\r\n                  </div>\r\n\r\n                  <div className=\"mt-6 grid grid-cols-2 gap-4 text-sm text-slate-600\">\r\n                    <div>\r\n                      <div className=\"text-xs text-slate-400\">Full Name</div>\r\n                      <div className=\"mt-1\">{user.name ?? \"—\"}</div>\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"text-xs text-slate-400\">Display Name</div>\r\n                      <div className=\"mt-1\">{profile.displayName ?? user.name ?? \"—\"}</div>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <div className=\"text-xs text-slate-400\">Gender</div>\r\n                      <div className=\"mt-1\">{profile.gender ?? \"I'd prefer not to say\"}</div>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <div className=\"text-xs text-slate-400\">Country/Region</div>\r\n                      <div className=\"mt-1\">{profile.country ?? \"—\"}</div>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <div className=\"text-xs text-slate-400\">State</div>\r\n                      <div className=\"mt-1\">{profile.state ?? \"—\"}</div>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <div className=\"text-xs text-slate-400\">Language</div>\r\n                      <div className=\"mt-1\">{profile.language ?? \"English\"}</div>\r\n                    </div>\r\n\r\n                    <div className=\"col-span-2\">\r\n                      <div className=\"text-xs text-slate-400\">Time zone</div>\r\n                      <div className=\"mt-1 text-sm text-slate-600\">{profile.timezone ?? \"(GMT +05:30) India Standard Time (Asia/Kolkata)\"}</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"mt-6\">\r\n                <h3 className=\"text-sm font-semibold text-slate-700 mb-2\">About</h3>\r\n                <p className=\"text-sm text-slate-600\">Use this profile page to keep your contact details up to date. Your name, display name and timezone are used across the app for messaging and notifications.</p>\r\n              </div>\r\n            </section>\r\n\r\n            {/* Email Addresses */}\r\n            <section className=\"mt-6 bg-white rounded-3xl p-6 shadow border border-slate-100\">\r\n              <div className=\"flex items-start justify-between\">\r\n                <div>\r\n                  <h2 className=\"text-lg font-semibold mb-1\">My Email Addresses</h2>\r\n                  <p className=\"text-sm text-slate-500 mb-4\">View and manage the email addresses associated with your account.</p>\r\n                </div>\r\n\r\n                <div className=\"text-sm text-slate-500\">{headerUpdatedLabel}</div>\r\n              </div>\r\n\r\n              <div className=\"border rounded-lg p-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 rounded-full bg-rose-100 flex items-center justify-center text-rose-600\">📧</div>\r\n                    <div>\r\n                      <div className=\"font-medium\">{user.email}</div>\r\n                      <div className=\"text-xs text-slate-400\">primary • added on account creation</div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center gap-3\">\r\n                    {/* Extra email flow: only one extra allowed */}\r\n                    {!profile?.extraEmail ? (\r\n                      <button className=\"px-3 py-2 text-sm rounded bg-slate-50 text-blue-600\" onClick={() => setAddEmailOpen(true)}>\r\n                        + Add Email Address\r\n                      </button>\r\n                    ) : (\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <div className=\"text-sm\">{profile.extraEmail}</div>\r\n                        <button className=\"px-3 py-2 text-sm rounded bg-red-50 text-red-600\" onClick={() => void handleRemoveExtraEmail()}>\r\n                          Remove\r\n                        </button>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </section>\r\n\r\n            {/* Mobile Numbers — display + verify modal */}\r\n            <section className=\"mt-6 bg-white rounded-3xl p-6 shadow border border-slate-100\">\r\n              <h2 className=\"text-lg font-semibold mb-2\">My Mobile Numbers</h2>\r\n              <p className=\"text-sm text-slate-500 mb-4\">View and manage the mobile numbers associated with your account.</p>\r\n\r\n              <div className=\"border rounded-lg p-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center text-amber-600\">📞</div>\r\n                    <div>\r\n                      <div className=\"font-medium\">{profile?.phoneNumber ?? \"—\"}</div>\r\n                      <div className={`text-xs ${profile?.phoneVerified ? \"text-green-600\" : \"text-slate-400\"}`}>\r\n                        {profile?.phoneVerified ? `verified • ${profile.phoneVerifiedAt ? new Date(profile.phoneVerifiedAt).toLocaleString() : \"\"}` : \"not verified\"}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center gap-3\">\r\n                    {!profile?.phoneVerified ? (\r\n                      <button className=\"px-3 py-2 text-sm rounded bg-blue-600 text-white\" onClick={() => setVerifyOpen(true)}>\r\n                        Verify number\r\n                      </button>\r\n                    ) : (\r\n                      <button className=\"px-3 py-2 text-sm rounded bg-slate-50 text-slate-700\" onClick={() => setVerifyOpen(true)}>\r\n                        Manage\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </section>\r\n          </div>\r\n\r\n          {/* Right column: activity & quick actions */}\r\n          <aside className=\"lg:col-span-4 space-y-4\">\r\n            <div className=\"bg-white rounded-2xl p-4 shadow-sm border border-slate-100\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <h3 className=\"text-sm font-semibold text-slate-700\">Profile Activity (30 days)</h3>\r\n                <span className=\"text-xs text-slate-500\">{headerUpdatedLabel}</span>\r\n              </div>\r\n\r\n              <div className=\"mt-3\">\r\n                <div className=\"flex items-end gap-6\">\r\n                  <div>\r\n                    <div className=\"text-2xl font-bold\">{activity ? activity.logins30d : \"—\"}</div>\r\n                    <div className=\"text-xs text-slate-500\">Logins (30d)</div>\r\n                  </div>\r\n                  <div>\r\n                    <div className=\"text-2xl font-bold\">{activity ? activity.changes30d : \"—\"}</div>\r\n                    <div className=\"text-xs text-slate-500\">Profile changes (30d)</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-2xl p-4 shadow-sm border border-slate-100\">\r\n              <h4 className=\"text-sm font-semibold text-slate-700 mb-2\">Quick actions</h4>\r\n              <div className=\"flex flex-col gap-2\">\r\n                <button className=\"text-left px-3 py-2 rounded-lg bg-slate-50\" onClick={() => router.push(\"/inbox\")}>Open Inbox</button>\r\n                <Link className=\"text-left px-3 py-2 rounded-lg bg-slate-50\" href=\"/settings\">Settings & Integrations</Link>\r\n                <Link className=\"text-left px-3 py-2 rounded-lg bg-slate-50\" href=\"/security\">Security</Link>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"text-center text-sm text-slate-500\">Built for the Attack Capital assignment — profile management UI.</div>\r\n          </aside>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Edit modal */}\r\n      <EditProfileModal\r\n        open={editOpen}\r\n        onClose={() => setEditOpen(false)}\r\n        user={user}\r\n        onSave={async (payload) => {\r\n          const ok = await handleSave(payload);\r\n          if (ok) setEditOpen(false);\r\n          return ok;\r\n        }}\r\n      />\r\n\r\n      {/* Add email modal */}\r\n      <AddEmailModal\r\n        open={addEmailOpen}\r\n        onClose={() => setAddEmailOpen(false)}\r\n        onAdd={handleAddEmail}\r\n      />\r\n\r\n      {/* Phone verify modal (inline component) */}\r\n      {verifyOpen && (\r\n        <PhoneVerifyModal\r\n          initialProfile={profile}\r\n          onClose={() => setVerifyOpen(false)}\r\n          onVerified={(updatedUser) => {\r\n            applyUpdatedUserFromChild(updatedUser);\r\n            setVerifyOpen(false);\r\n          }}\r\n        />\r\n      )}\r\n    </main>\r\n  );\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* Inline PhoneVerifyModal\r\n   - client-side restcountries for dial codes (fallback to local table)\r\n   - responsive layout (stack on narrow, inline on wide)\r\n   - 6-digit OTP, paste support, focus management\r\n   - expects /api/phone/send-otp and /api/phone/verify-otp endpoints\r\n/* -------------------------------------------------------------------------- */\r\n\r\nfunction PhoneVerifyModal({\r\n  initialProfile,\r\n  onClose,\r\n  onVerified,\r\n}: {\r\n  initialProfile: Profile;\r\n  onClose: () => void;\r\n  onVerified: (updatedUser: any) => void;\r\n}) {\r\n  const [countries, setCountries] = useState<Array<{ cca2: string; name: string; dial?: string }>>([]);\r\n  const [loadingCountries, setLoadingCountries] = useState(true);\r\n  const [countriesError, setCountriesError] = useState<string | null>(null);\r\n\r\n  const initialCca2 = ((initialProfile?.countryCode ?? \"IN\") as string).toUpperCase() ?? \"IN\";\r\n  const [countryCca2, setCountryCca2] = useState<string>(initialCca2);\r\n\r\n  const [dialCode, setDialCode] = useState<string>(DEFAULT_DIAL);\r\n  const [digitCount, setDigitCount] = useState<number>(FALLBACK_LENGTH[initialCca2] ?? DEFAULT_NATIONAL_LENGTH);\r\n\r\n  // digits local state => ensure it resizes when digitCount changes\r\n  const [digits, setDigits] = useState<string[]>(() => Array(digitCount).fill(\"\"));\r\n  useEffect(() => {\r\n    setDigits((prev) => {\r\n      const next = Array(digitCount).fill(\"\");\r\n      for (let i = 0; i < Math.min(prev.length, next.length); i++) next[i] = prev[i];\r\n      return next;\r\n    });\r\n  }, [digitCount]);\r\n\r\n  const digitInputsRef = React.useRef<Array<HTMLInputElement | null>>([]);\r\n\r\n  // store e164 phone used for verification\r\n  const [phoneE164, setPhoneE164] = useState<string | null>(initialProfile?.phoneNumber ?? null);\r\n\r\n  const [otpSent, setOtpSent] = useState(false);\r\n  const [otpExpiry, setOtpExpiry] = useState<number | null>(null);\r\n  const [otpDigits, setOtpDigits] = useState<string[]>(() => Array(OTP_LEN).fill(\"\"));\r\n  const otpInputsRef = React.useRef<Array<HTMLInputElement | null>>([]);\r\n  const [sending, setSending] = useState(false);\r\n  const [verifying, setVerifying] = useState(false);\r\n  const [message, setMessage] = useState<{ text: string; ok: boolean } | null>(null);\r\n\r\n  // load countries (restcountries). lightweight fields\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    setLoadingCountries(true);\r\n    setCountriesError(null);\r\n    (async () => {\r\n      try {\r\n        const res = await fetch(\"https://restcountries.com/v3.1/all?fields=cca2,name,idd\");\r\n        if (!res.ok) throw new Error(\"Failed to load countries\");\r\n        const arr = await res.json();\r\n        if (cancelled) return;\r\n        const list = arr\r\n          .map((c: any) => {\r\n            const cca2 = (c.cca2 || \"\").toString().toUpperCase();\r\n            const name = (c.name && (c.name.common || c.name.official)) || cca2;\r\n            let dial: string | undefined = undefined;\r\n            try {\r\n              const idd = c.idd || {};\r\n              const root = idd.root ?? \"\";\r\n              const suffixes: string[] = idd.suffixes ?? [];\r\n              if (root) {\r\n                dial = suffixes && suffixes.length > 0 && suffixes[0] ? `${root}${suffixes[0]}` : root;\r\n              }\r\n            } catch (e) {\r\n              dial = undefined;\r\n            }\r\n            return { cca2, name, dial };\r\n          })\r\n          .filter(Boolean)\r\n          .sort((a: any, b: any) => a.name.localeCompare(b.name));\r\n        setCountries(list);\r\n      } catch (err) {\r\n        console.error(\"load countries error:\", err);\r\n        setCountriesError(\"Failed to load countries\");\r\n      } finally {\r\n        if (!cancelled) setLoadingCountries(false);\r\n      }\r\n    })();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, []);\r\n\r\n  // when countries list or selected country changes, update dial and digitCount\r\n  useEffect(() => {\r\n    const info = countries.find((c) => c.cca2 === countryCca2);\r\n    if (info && info.dial) setDialCode(info.dial);\r\n    else setDialCode(DEFAULT_DIAL);\r\n\r\n    const len = FALLBACK_LENGTH[countryCca2] ?? DEFAULT_NATIONAL_LENGTH;\r\n    setDigitCount(len);\r\n  }, [countryCca2, countries]);\r\n\r\n  // focus management & ESC to close\r\n  useEffect(() => {\r\n    const t = setTimeout(() => digitInputsRef.current[0]?.focus(), 80);\r\n    function onKey(e: KeyboardEvent) {\r\n      if (e.key === \"Escape\") onClose();\r\n    }\r\n    window.addEventListener(\"keydown\", onKey);\r\n    return () => {\r\n      clearTimeout(t);\r\n      window.removeEventListener(\"keydown\", onKey);\r\n    };\r\n  }, [onClose]);\r\n\r\n  const onlyDigits = (s: string) => s.replace(/\\D/g, \"\");\r\n  const setLocalDigit = (i: number, val: string) => {\r\n    const d = onlyDigits(val).slice(0, 1);\r\n    setDigits((prev) => {\r\n      const next = prev.slice();\r\n      next[i] = d;\r\n      return next;\r\n    });\r\n    if (d && i < digitCount - 1) digitInputsRef.current[i + 1]?.focus();\r\n  };\r\n  const onDigitKey = (i: number, e: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (e.key === \"Backspace\" && digits[i] === \"\" && i > 0) digitInputsRef.current[i - 1]?.focus();\r\n  };\r\n\r\n  const localNumber = digits.join(\"\");\r\n  const localComplete = localNumber.length === digitCount;\r\n\r\n  // OTP handlers\r\n  const onOtpChange = (i: number, v: string) => {\r\n    const d = onlyDigits(v).slice(0, 1);\r\n    setOtpDigits((prev) => {\r\n      const next = prev.slice();\r\n      next[i] = d;\r\n      return next;\r\n    });\r\n    if (d && i < OTP_LEN - 1) otpInputsRef.current[i + 1]?.focus();\r\n  };\r\n  const onOtpKey = (i: number, e: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (e.key === \"Backspace\" && otpDigits[i] === \"\" && i > 0) otpInputsRef.current[i - 1]?.focus();\r\n    if (e.key === \"Enter\") tryVerifyOtp();\r\n  };\r\n  const otpValue = otpDigits.join(\"\");\r\n\r\n  async function sendOtp() {\r\n    if (!localComplete) {\r\n      setMessage({ text: `Enter ${digitCount} digits`, ok: false });\r\n      return;\r\n    }\r\n    const e164 = `${dialCode}${localNumber}`;\r\n    // persist e164 so tryVerifyOtp can reference it\r\n    setPhoneE164(e164);\r\n\r\n    setSending(true);\r\n    setMessage(null);\r\n    try {\r\n      const res = await fetch(\"/api/phone/send-otp\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        credentials: \"include\",\r\n        body: JSON.stringify({ phone: e164, otpLen: OTP_LEN }),\r\n      });\r\n      const json = await res.json().catch(() => null);\r\n      console.debug(\"[PhoneVerifyModal] send-otp response:\", res.status, json);\r\n      if (!res.ok || json?.error) {\r\n        setMessage({ text: json?.error || \"Failed to send OTP\", ok: false });\r\n        setOtpSent(false);\r\n      } else {\r\n        setMessage({ text: \"OTP sent — check your phone (or console in dev)\", ok: true });\r\n        setOtpSent(true);\r\n        setOtpExpiry(Date.now() + 5 * 60 * 1000);\r\n        setTimeout(() => otpInputsRef.current[0]?.focus(), 120);\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      setMessage({ text: \"Network error sending OTP\", ok: false });\r\n      setOtpSent(false);\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  }\r\n\r\n  async function tryVerifyOtp() {\r\n    if (!phoneE164) {\r\n      setMessage({ text: \"Send OTP first\", ok: false });\r\n      return;\r\n    }\r\n\r\n    const otpValueLocal = otpDigits.join(\"\");\r\n    if (otpValueLocal.length !== OTP_LEN) {\r\n      setMessage({ text: `Enter ${OTP_LEN}-digit code`, ok: false });\r\n      return;\r\n    }\r\n\r\n    setVerifying(true);\r\n    setMessage(null);\r\n\r\n    const payload = { phone: phoneE164, otp: otpValueLocal };\r\n    console.debug(\"[PhoneVerifyModal] verify payload:\", payload);\r\n\r\n    try {\r\n      const res = await fetch(\"/api/phone/verify-otp\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        credentials: \"include\",\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      let body: any = null;\r\n      try {\r\n        body = await res.json().catch(() => null);\r\n      } catch (e) {\r\n        body = null;\r\n      }\r\n\r\n      console.debug(\"[PhoneVerifyModal] verify response status:\", res.status, \"body:\", body);\r\n\r\n      if (!res.ok) {\r\n        const errMsg =\r\n          (body && (body.error || body.message)) ||\r\n          (await res.text().catch(() => null)) ||\r\n          `HTTP ${res.status}`;\r\n        setMessage({ text: errMsg, ok: false });\r\n        setOtpDigits(Array(OTP_LEN).fill(\"\"));\r\n        otpInputsRef.current[0]?.focus();\r\n        return;\r\n      }\r\n\r\n      // success\r\n      setMessage({ text: \"Phone number verified\", ok: true });\r\n      setOtpSent(false);\r\n      setOtpDigits(Array(OTP_LEN).fill(\"\"));\r\n\r\n      if (body && body.user) {\r\n        // call parent callback that the caller passed (onVerified)\r\n        try {\r\n          onVerified(body.user);\r\n        } catch (e) {\r\n          console.warn(\"[PhoneVerifyModal] onVerified threw:\", e);\r\n        }\r\n      } else {\r\n        // fallback: try re-fetch /api/me and call onVerified with the new user (or null)\r\n        try {\r\n          const r = await fetch(\"/api/me\", { credentials: \"include\", cache: \"no-store\" });\r\n          if (r.ok) {\r\n            const j = await r.json().catch(() => null);\r\n            onVerified(j?.user ?? null);\r\n          } else {\r\n            onVerified(null);\r\n          }\r\n        } catch (err) {\r\n          console.error(\"[PhoneVerifyModal] fallback fetch /api/me failed:\", err);\r\n          onVerified(null);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error(\"[PhoneVerifyModal] verify network error:\", err);\r\n      setMessage({ text: \"Network error verifying OTP\", ok: false });\r\n    } finally {\r\n      setVerifying(false);\r\n    }\r\n  }\r\n\r\n  function resetOtp() {\r\n    setOtpSent(false);\r\n    setOtpDigits(Array(OTP_LEN).fill(\"\"));\r\n    setOtpExpiry(null);\r\n    setMessage(null);\r\n    setTimeout(() => digitInputsRef.current[0]?.focus(), 80);\r\n  }\r\n\r\n  function handlePasteNumber(e: React.ClipboardEvent<HTMLInputElement>) {\r\n    const text = e.clipboardData.getData(\"Text\");\r\n    const only = onlyDigits(text).slice(0, digitCount);\r\n    if (only.length === digitCount) {\r\n      setDigits(only.split(\"\"));\r\n      setTimeout(() => sendOtp(), 80);\r\n    }\r\n  }\r\n\r\n  const digitBoxClass = \"w-9 sm:w-10 md:w-12 h-10 rounded border text-center\";\r\n  const otpBoxClass = \"w-9 sm:w-10 md:w-12 h-10 rounded border text-center\";\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6\">\r\n      <div className=\"absolute inset-0 bg-black/40\" onClick={onClose} aria-hidden />\r\n      <div className=\"relative z-10 w-full max-w-2xl bg-white rounded-xl shadow-lg border ring-1 ring-slate-200 overflow-hidden\">\r\n        <div className=\"flex items-start justify-between gap-4 p-5 border-b\">\r\n          <div>\r\n            <h3 className=\"text-lg font-semibold text-slate-900\">Verify phone number</h3>\r\n            <p className=\"text-sm text-slate-500 mt-1\">Select country (dial code derived automatically), enter your phone and verify with a {OTP_LEN}-digit code.</p>\r\n          </div>\r\n          <div>\r\n            <button aria-label=\"Close\" onClick={onClose} className=\"rounded-md p-2 text-slate-600 hover:bg-slate-100\">✕</button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"p-5 space-y-4\">\r\n          {/* country select + dial + digits */}\r\n          <div className=\"flex flex-col md:flex-row md:items-center gap-3\">\r\n            <div className=\"flex-1 min-w-0\">\r\n              <label className=\"sr-only\">Country</label>\r\n              <select\r\n                value={countryCca2}\r\n                onChange={(e) => setCountryCca2(e.target.value)}\r\n                className=\"w-full rounded border px-3 py-2 text-sm\"\r\n              >\r\n                {loadingCountries ? (\r\n                  <option>Loading countries...</option>\r\n                ) : (\r\n                  <>\r\n                    {countries.map((c) => (\r\n                      <option key={c.cca2} value={c.cca2}>\r\n                        {c.name} {c.dial ? `(${c.dial})` : \"\"}\r\n                      </option>\r\n                    ))}\r\n                    <option value=\"OTHER\">Other</option>\r\n                  </>\r\n                )}\r\n              </select>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-3 w-full md:w-auto\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"px-3 py-2 rounded border bg-slate-50 text-sm font-medium\">{dialCode}</div>\r\n\r\n                <div onPaste={handlePasteNumber} className=\"flex gap-1 flex-wrap\" style={{ maxWidth: \"36ch\" }}>\r\n                  {Array.from({ length: digitCount }).map((_, i) => (\r\n                    <input\r\n                      key={i}\r\n                      ref={(el) => (digitInputsRef.current[i] = el)}\r\n                      inputMode=\"numeric\"\r\n                      maxLength={1}\r\n                      value={digits[i] ?? \"\"}\r\n                      onChange={(e) => setLocalDigit(i, e.target.value)}\r\n                      onKeyDown={(e) => onDigitKey(i, e)}\r\n                      className={`${digitBoxClass}`}\r\n                      aria-label={`phone-digit-${i + 1}`}\r\n                      style={{ textAlign: \"center\" }}\r\n                    />\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"ml-auto\">\r\n                {!otpSent ? (\r\n                  <button\r\n                    onClick={() => sendOtp()}\r\n                    disabled={!localComplete || sending}\r\n                    className={`px-3 py-2 rounded ${localComplete ? \"bg-blue-600 text-white\" : \"bg-slate-100 text-slate-500\"}`}\r\n                  >\r\n                    {sending ? \"Sending...\" : \"Send OTP\"}\r\n                  </button>\r\n                ) : (\r\n                  <button onClick={() => resetOtp()} className=\"px-3 py-2 rounded bg-slate-50 text-slate-700\">Cancel</button>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* OTP inputs */}\r\n          {otpSent && (\r\n            <div className=\"flex flex-col sm:flex-row sm:items-center gap-3\">\r\n              <div className=\"flex gap-2 flex-wrap\">\r\n                {Array.from({ length: OTP_LEN }).map((_, i) => (\r\n                  <input\r\n                    key={i}\r\n                    ref={(el) => (otpInputsRef.current[i] = el)}\r\n                    inputMode=\"numeric\"\r\n                    maxLength={1}\r\n                    value={otpDigits[i] ?? \"\"}\r\n                    onChange={(e) => onOtpChange(i, e.target.value)}\r\n                    onKeyDown={(e) => onOtpKey(i, e)}\r\n                    className={`${otpBoxClass}`}\r\n                    aria-label={`otp-${i + 1}`}\r\n                  />\r\n                ))}\r\n              </div>\r\n\r\n              <div className=\"ml-auto flex items-center gap-3\">\r\n                <button onClick={() => tryVerifyOtp()} disabled={verifying} className=\"px-3 py-2 rounded bg-green-600 text-white\">\r\n                  {verifying ? \"Verifying...\" : \"Verify OTP\"}\r\n                </button>\r\n                <div className=\"text-sm text-slate-500\">{otpExpiry ? `Expires in ${Math.max(0, Math.ceil((otpExpiry - Date.now()) / 1000))}s` : \"\"}</div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {message && <div className={`text-sm ${message.ok ? \"text-green-600\" : \"text-rose-600\"}`}>{message.text}</div>}\r\n          {countriesError && <div className=\"text-xs text-rose-600\">{countriesError}</div>}\r\n\r\n          <div className=\"flex justify-end gap-3 pt-3\">\r\n            <button onClick={onClose} className=\"px-4 py-2 rounded-lg border\">Close</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}