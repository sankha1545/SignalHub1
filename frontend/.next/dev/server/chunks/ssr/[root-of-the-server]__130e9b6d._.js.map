{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/components/forms/ProfileMenu.tsx"],"sourcesContent":["// src/components/ProfileMenu.tsx\r\n\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport {\r\n  User as UserIcon,\r\n  Settings,\r\n  LogOut,\r\n  HelpCircle,\r\n  Moon,\r\n  Sun,\r\n  ChevronDown,\r\n  Crown,\r\n  Bell,\r\n  Zap\r\n} from \"lucide-react\";\r\n\r\ntype Profile = {\r\n  avatarUrl?: string | null;\r\n  displayName?: string | null;\r\n};\r\n\r\ntype MeUser = {\r\n  id: string;\r\n  name?: string | null;\r\n  email?: string | null;\r\n  role?: string | null;\r\n  profile?: Profile | null;\r\n};\r\n\r\nexport default function ProfileMenu() {\r\n  const router = useRouter();\r\n  const ref = useRef<HTMLDivElement | null>(null);\r\n\r\n  const [user, setUser] = useState<MeUser | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isDarkMode, setIsDarkMode] = useState(false);\r\n\r\n  // load current user on mount\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      try {\r\n        const res = await fetch(\"/api/me\");\r\n        if (!res.ok) {\r\n          if (mounted) setUser(null);\r\n          return;\r\n        }\r\n        const json = await res.json().catch(() => null);\r\n        if (mounted && json?.ok && json.user) setUser(json.user as MeUser);\r\n      } catch (err) {\r\n        // ignore errors\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, []);\r\n\r\n  // click outside to close menu\r\n  useEffect(() => {\r\n    function onDoc(e: MouseEvent) {\r\n      if (!ref.current) return;\r\n      if (!ref.current.contains(e.target as Node)) setIsOpen(false);\r\n    }\r\n    document.addEventListener(\"mousedown\", onDoc);\r\n    return () => document.removeEventListener(\"mousedown\", onDoc);\r\n  }, []);\r\n\r\n  function initials(name?: string | null, email?: string | null) {\r\n    const source = name || email || \"U\";\r\n    return (source.trim().charAt(0) || \"U\").toUpperCase();\r\n  }\r\n\r\n  async function handleLogout() {\r\n    try {\r\n      await fetch(\"/api/auth/logout\", { method: \"POST\" }).catch(() => {});\r\n    } finally {\r\n      setUser(null);\r\n      router.push(\"/login\");\r\n    }\r\n  }\r\n\r\n  const menuItems = [\r\n    {\r\n      icon: UserIcon,\r\n      label: \"Profile\",\r\n      action: () => router.push(\"/account\"),\r\n      gradient: \"from-blue-500 to-cyan-500\"\r\n    },\r\n    {\r\n      icon: Settings,\r\n      label: \"Settings\",\r\n      action: () => router.push(\"/dashboard\"),\r\n      gradient: \"from-slate-500 to-slate-700\"\r\n    },\r\n    {\r\n      icon: Bell,\r\n      label: \"Notifications\",\r\n      action: () => console.log(\"Notifications clicked\"),\r\n      gradient: \"from-violet-500 to-purple-500\",\r\n      badge: 3\r\n    },\r\n    {\r\n      icon: HelpCircle,\r\n      label: \"Help & Support\",\r\n      action: () => console.log(\"Help clicked\"),\r\n      gradient: \"from-emerald-500 to-teal-500\"\r\n    },\r\n    {\r\n      icon: LogOut,\r\n      label: \"Sign Out\",\r\n      action: handleLogout,\r\n      gradient: \"from-rose-500 to-pink-500\",\r\n      danger: true\r\n    }\r\n  ];\r\n\r\n  const displayName = user?.profile?.displayName || user?.name || user?.email || (loading ? \"Loading...\" : \"Account\");\r\n\r\n  return (\r\n    <div ref={ref} className=\"relative\">\r\n      {/* Profile trigger button */}\r\n      <motion.button\r\n        onClick={() => setIsOpen((v) => !v)}\r\n        className=\"w-full flex items-center gap-3 p-3 rounded-xl hover:bg-slate-100 transition-all duration-200 group\"\r\n        whileHover={{ scale: 1.02 }}\r\n        whileTap={{ scale: 0.98 }}\r\n        aria-haspopup=\"true\"\r\n        aria-expanded={isOpen}\r\n      >\r\n        {/* Avatar with status indicator */}\r\n        <div className=\"relative flex-shrink-0\">\r\n          <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-600 via-cyan-500 to-emerald-500 flex items-center justify-center shadow-lg shadow-blue-500/30 overflow-hidden\">\r\n            {user?.profile?.avatarUrl ? (\r\n              // eslint-disable-next-line @next/next/no-img-element\r\n              <img src={user.profile.avatarUrl} alt=\"avatar\" className=\"w-full h-full object-cover\" />\r\n            ) : (\r\n              <div className=\"text-white font-semibold\">{initials(user?.name, user?.email)}</div>\r\n            )}\r\n          </div>\r\n          <motion.div\r\n            className=\"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-emerald-400 rounded-full border-2 border-white\"\r\n            animate={{ scale: [1, 1.2, 1] }}\r\n            transition={{ duration: 2, repeat: Infinity }}\r\n          />\r\n        </div>\r\n\r\n        {/* User info */}\r\n        <div className=\"flex-1 text-left min-w-0\">\r\n          <div className=\"text-sm font-semibold text-slate-800 truncate flex items-center gap-1.5\">\r\n            {displayName}\r\n            <Crown className=\"w-3.5 h-3.5 text-amber-500\" />\r\n          </div>\r\n          <div className=\"text-xs text-slate-500 truncate\">{user?.email || \"\"}</div>\r\n        </div>\r\n\r\n        {/* Dropdown indicator */}\r\n        <motion.div animate={{ rotate: isOpen ? 180 : 0 }} transition={{ duration: 0.3 }}>\r\n          <ChevronDown className=\"w-4 h-4 text-slate-400 group-hover:text-slate-600 transition-colors\" />\r\n        </motion.div>\r\n      </motion.button>\r\n\r\n      {/* Dropdown menu */}\r\n      <AnimatePresence>\r\n        {isOpen && (\r\n          <>\r\n            {/* Backdrop for mobile */}\r\n            <motion.div\r\n              className=\"fixed inset-0 z-40 lg:hidden\"\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n              onClick={() => setIsOpen(false)}\r\n            />\r\n\r\n            {/* Menu */}\r\n            <motion.div\r\n              initial={{ opacity: 0, y: 10, scale: 0.95 }}\r\n              animate={{ opacity: 1, y: 0, scale: 1 }}\r\n              exit={{ opacity: 0, y: 10, scale: 0.95 }}\r\n              transition={{ duration: 0.2 }}\r\n              className=\"absolute bottom-full left-0 right-0 mb-2 z-50 bg-white rounded-xl shadow-2xl border border-slate-200 overflow-hidden\"\r\n            >\r\n              {/* Pro badge */}\r\n              <div className=\"p-3 bg-gradient-to-r from-amber-50 to-orange-50 border-b border-amber-100\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center shadow-lg\">\r\n                    <Crown className=\"w-4 h-4 text-white\" />\r\n                  </div>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"text-xs font-bold text-amber-900\">Pro Member</div>\r\n                    <div className=\"text-[10px] text-amber-700\">Premium features unlocked</div>\r\n                  </div>\r\n                  <Zap className=\"w-4 h-4 text-amber-500\" />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Menu items */}\r\n              <div className=\"p-2\">\r\n                {menuItems.map((item, index) => {\r\n                  const Icon = item.icon as any;\r\n                  return (\r\n                    <motion.button\r\n                      key={item.label}\r\n                      initial={{ opacity: 0, x: -10 }}\r\n                      animate={{ opacity: 1, x: 0 }}\r\n                      transition={{ delay: index * 0.05 }}\r\n                      onClick={() => {\r\n                        item.action();\r\n                        setIsOpen(false);\r\n                      }}\r\n                      className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 group ${\r\n                        item.danger\r\n                          ? \"hover:bg-rose-50 text-rose-600\"\r\n                          : \"hover:bg-slate-50 text-slate-700\"\r\n                      }`}\r\n                      whileHover={{ x: 4 }}\r\n                    >\r\n                      <div className={`w-8 h-8 rounded-lg bg-gradient-to-br ${item.gradient} flex items-center justify-center shadow-sm`}>\r\n                        <Icon className=\"w-4 h-4 text-white\" />\r\n                      </div>\r\n                      <span className=\"flex-1 text-left\">{item.label}</span>\r\n                      {item.badge && (\r\n                        <span className=\"px-2 py-0.5 text-[10px] font-bold bg-rose-500 text-white rounded-full\">{item.badge}</span>\r\n                      )}\r\n                    </motion.button>\r\n                  );\r\n                })}\r\n              </div>\r\n\r\n              {/* Dark mode toggle */}\r\n              <div className=\"p-3 border-t border-slate-200 bg-slate-50\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-slate-600 to-slate-800 flex items-center justify-center shadow-sm\">\r\n                      {isDarkMode ? <Moon className=\"w-4 h-4 text-white\" /> : <Sun className=\"w-4 h-4 text-white\" />}\r\n                    </div>\r\n                    <span className=\"text-sm font-medium text-slate-700\">Dark Mode</span>\r\n                  </div>\r\n                  <motion.button\r\n                    onClick={() => setIsDarkMode(!isDarkMode)}\r\n                    className={`relative w-11 h-6 rounded-full transition-colors duration-300 ${\r\n                      isDarkMode ? \"bg-gradient-to-r from-blue-500 to-cyan-500\" : \"bg-slate-300\"\r\n                    }`}\r\n                    whileTap={{ scale: 0.95 }}\r\n                  >\r\n                    <motion.div\r\n                      className=\"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-md\"\r\n                      animate={{ x: isDarkMode ? 20 : 0 }}\r\n                      transition={{ type: \"spring\", stiffness: 500, damping: 30 }}\r\n                    />\r\n                  </motion.button>\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          </>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 541, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/components/ui/sidebar/Sidebar.tsx"],"sourcesContent":["// components/ui/sidebar/Sidebar.tsx\r\n\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport clsx from \"clsx\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n  LayoutDashboard,\r\n  Inbox,\r\n  Send,\r\n  Users,\r\n  BarChart3,\r\n  Settings,\r\n  Search,\r\n  Menu,\r\n  X,\r\n  ChevronRight,\r\n  Sparkles,\r\n  ArrowRight,\r\n  Calendar,\r\n  Clock,\r\n  Plus,\r\n  Clipboard,\r\n  Slack,\r\n  User,\r\n  CheckCircle,\r\n  Bell,\r\n  CalendarClock,\r\n} from \"lucide-react\";\r\nimport ProfileMenu from \"@/components/forms/ProfileMenu\";\r\n\r\n/**\r\n * Sidebar component that renders portal-specific navigation.\r\n *\r\n * Props:\r\n * - portal?: \"admin\" | \"manager\" | \"employee\" (default \"admin\")\r\n * - isOpen?: boolean (controlled mobile drawer)\r\n * - onClose?: () => void (callback when mobile drawer closes)\r\n * - hideToggle?: boolean (hide floating hamburger when true)\r\n *\r\n * Notes:\r\n * - Manager and Employee sidebars intentionally differ from Admin.\r\n * - The component includes an internal ScheduleModal used by Managers.\r\n * - Replace fetch endpoints (/api/...) to match your backend.\r\n */\r\n\r\ntype Portal = \"admin\" | \"manager\" | \"employee\" | undefined;\r\n\r\ntype Props = {\r\n  portal?: Portal;\r\n  isOpen?: boolean;\r\n  onClose?: () => void;\r\n  hideToggle?: boolean;\r\n};\r\n\r\ntype NavItem = {\r\n  id: string;\r\n  label: string;\r\n  href: string;\r\n  icon: React.ComponentType<any>;\r\n  gradient?: string;\r\n  badge?: number | null;\r\n};\r\n\r\nfunction formatPath(raw: string | null | undefined) {\r\n  if (!raw) return \"/\";\r\n  return raw === \"/\" ? \"/\" : raw.replace(/\\/+$/, \"\");\r\n}\r\n\r\n/* ------------------- Simple Schedule Modal (Manager-only) ------------------- */\r\nfunction ScheduleModal({\r\n  open,\r\n  onClose,\r\n  onCreated,\r\n  defaultOrganizer,\r\n}: {\r\n  open: boolean;\r\n  onClose: (success?: boolean) => void;\r\n  onCreated?: (data: any) => void;\r\n  defaultOrganizer?: string | null;\r\n}) {\r\n  const [organizer, setOrganizer] = useState(defaultOrganizer ?? \"\");\r\n  const [datetime, setDatetime] = useState(\"\");\r\n  const [reminder, setReminder] = useState<number>(10);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      setOrganizer(defaultOrganizer ?? \"\");\r\n      setDatetime(\"\");\r\n      setReminder(10);\r\n      setError(null);\r\n    }\r\n  }, [open, defaultOrganizer]);\r\n\r\n  const handleSubmit = async (e?: React.FormEvent) => {\r\n    e?.preventDefault();\r\n    setError(null);\r\n    if (!organizer || !datetime) {\r\n      setError(\"Please provide an organizer and meeting date/time.\");\r\n      return;\r\n    }\r\n    // Basic ISO date validation\r\n    const dt = new Date(datetime);\r\n    if (Number.isNaN(dt.getTime())) {\r\n      setError(\"Invalid date/time.\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      // POST to scheduling endpoint - adapt to your backend\r\n      const res = await fetch(\"/api/schedule/create\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ organizer, sendAt: dt.toISOString(), reminderMinutes: reminder }),\r\n        credentials: \"same-origin\",\r\n      });\r\n      const json = await res.json();\r\n      if (!res.ok) {\r\n        throw new Error(json?.message || \"Failed to schedule meeting\");\r\n      }\r\n      onCreated?.(json);\r\n      onClose(true);\r\n    } catch (err: any) {\r\n      setError(err?.message || \"Network error\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!open) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6\">\r\n      <div className=\"absolute inset-0 bg-black/40\" onClick={() => onClose(false)} />\r\n      <motion.div\r\n        initial={{ scale: 0.98, opacity: 0 }}\r\n        animate={{ scale: 1, opacity: 1 }}\r\n        transition={{ duration: 0.12 }}\r\n        className=\"relative w-full max-w-md bg-white rounded-2xl p-6 shadow-xl z-10\"\r\n      >\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h3 className=\"text-lg font-semibold\">Schedule meeting</h3>\r\n          <button className=\"p-1 rounded-md hover:bg-slate-100\" onClick={() => onClose(false)}>\r\n            <X className=\"w-4 h-4\" />\r\n          </button>\r\n        </div>\r\n\r\n        <form onSubmit={(e) => handleSubmit(e)} className=\"space-y-3\">\r\n          <div>\r\n            <label className=\"text-xs text-slate-600\">Organizer</label>\r\n            <input\r\n              value={organizer}\r\n              onChange={(e) => setOrganizer(e.target.value)}\r\n              className=\"w-full mt-1 p-2 border rounded-md text-sm\"\r\n              placeholder=\"Organizer name or email\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"text-xs text-slate-600\">Date & time</label>\r\n            <input\r\n              type=\"datetime-local\"\r\n              value={datetime}\r\n              onChange={(e) => setDatetime(e.target.value)}\r\n              className=\"w-full mt-1 p-2 border rounded-md text-sm\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"text-xs text-slate-600\">Reminder (before meeting)</label>\r\n            <select value={String(reminder)} onChange={(e) => setReminder(Number(e.target.value))} className=\"w-full mt-1 p-2 border rounded-md text-sm\">\r\n              {[10, 20, 30, 40, 50, 60].map((m) => (\r\n                <option key={m} value={m}>\r\n                  {m} minutes before\r\n                </option>\r\n              ))}\r\n            </select>\r\n            <p className=\"text-xs text-slate-400 mt-1\">Reminder will be scheduled as: meeting_time - reminder.</p>\r\n          </div>\r\n\r\n          {error && <div className=\"text-sm text-rose-600\">{error}</div>}\r\n\r\n          <div className=\"flex items-center justify-end gap-2 pt-2\">\r\n            <button type=\"button\" className=\"px-3 py-1 rounded-md text-sm\" onClick={() => onClose(false)} disabled={loading}>\r\n              Cancel\r\n            </button>\r\n            <button type=\"submit\" disabled={loading} className=\"px-4 py-2 rounded-md bg-slate-900 text-white text-sm flex items-center gap-2\">\r\n              {loading ? \"Scheduling…\" : \"Schedule\"}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ------------------- Sidebar Component ------------------- */\r\nexport default function Sidebar({ portal = \"admin\", isOpen: isOpenProp, onClose, hideToggle = false }: Props) {\r\n  const raw = usePathname();\r\n  const pathname = formatPath(raw);\r\n\r\n  // mobile open controlled/uncontrolled\r\n  const [internalOpen, setInternalOpen] = useState(false);\r\n  const openControlled = typeof isOpenProp === \"boolean\";\r\n  const open = openControlled ? isOpenProp! : internalOpen;\r\n  const setOpen = (next: boolean) => {\r\n    if (openControlled) {\r\n      if (!next && onClose) onClose();\r\n    } else {\r\n      setInternalOpen(next);\r\n      if (!next && onClose) onClose();\r\n    }\r\n  };\r\n\r\n  // UI state\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [hoveredItem, setHoveredItem] = useState<string | null>(null);\r\n  const closeBtnRef = useRef<HTMLButtonElement | null>(null);\r\n\r\n  // manager-specific state\r\n  const [scheduleOpen, setScheduleOpen] = useState(false);\r\n  const [teams, setTeams] = useState<Array<{ id: string; name: string }>>([]);\r\n  const [teamsLoading, setTeamsLoading] = useState(false);\r\n  const [currentTeamId, setCurrentTeamId] = useState<string | null>(null);\r\n\r\n  // keyboard esc to close\r\n  useEffect(() => {\r\n    function onEsc(e: KeyboardEvent) {\r\n      if (e.key === \"Escape\") setOpen(false);\r\n    }\r\n    window.addEventListener(\"keydown\", onEsc);\r\n    return () => window.removeEventListener(\"keydown\", onEsc);\r\n  }, [isOpenProp]);\r\n\r\n  useEffect(() => {\r\n    if (open) closeBtnRef.current?.focus();\r\n  }, [open]);\r\n\r\n  // Load teams for managers (only when manager portal active)\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    if (portal !== \"manager\") return;\r\n    setTeamsLoading(true);\r\n    (async () => {\r\n      try {\r\n        const res = await fetch(\"/api/dashboard/teams\", { credentials: \"same-origin\" });\r\n        if (!res.ok) {\r\n          setTeams([]);\r\n          return;\r\n        }\r\n        const json = await res.json();\r\n        const list = Array.isArray(json) ? json : json?.teams ?? [];\r\n        if (mounted) {\r\n          setTeams(list);\r\n          if (list.length > 0 && !currentTeamId) setCurrentTeamId(list[0].id);\r\n        }\r\n      } catch (e) {\r\n        if (mounted) setTeams([]);\r\n      } finally {\r\n        if (mounted) setTeamsLoading(false);\r\n      }\r\n    })();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [portal]);\r\n\r\n  /* ------------------- NAV CONFIGS ------------------- */\r\n  const NAV_ADMIN: NavItem[] = [\r\n    { id: \"overview\", label: \"Overview\", href: \"/dashboard/admin/overview\", icon: LayoutDashboard, gradient: \"from-blue-500 to-cyan-500\" },\r\n    { id: \"inbox\", label: \"Inbox\", href: \"/dashboard/admin/inbox\", icon: Inbox, gradient: \"from-emerald-500 to-teal-500\", badge: 12 },\r\n    { id: \"sent\", label: \"Sent\", href: \"/dashboard/admin/sent\", icon: Send, gradient: \"from-violet-500 to-purple-500\" },\r\n    { id: \"teams\", label: \"Teams\", href: \"/dashboard/admin/teams\", icon: Users, gradient: \"from-orange-500 to-rose-500\" },\r\n    { id: \"analytics\", label: \"Analytics\", href: \"/dashboard/admin/analytics\", icon: BarChart3, gradient: \"from-pink-500 to-rose-500\" },\r\n    { id: \"settings\", label: \"Settings\", href: \"/dashboard/admin/settings\", icon: Settings, gradient: \"from-slate-500 to-slate-700\" },\r\n  ];\r\n\r\n  const NAV_MANAGER: NavItem[] = [\r\n    { id: \"dashboard\", label: \"Dashboard\", href: \"/dashboard/manager/overview\", icon: LayoutDashboard, gradient: \"from-blue-500 to-cyan-500\" },\r\n    { id: \"team-inbox\", label: \"Team Inbox\", href: \"/dashboard/manager/TeamInbox\", icon: Inbox, gradient: \"from-emerald-500 to-teal-500\" },\r\n    \r\n    { id: \"tasks\", label: \"Tasks\", href: \"/dashboard/manager/Tasks\", icon: Clipboard, gradient: \"from-pink-500 to-rose-500\" },\r\n    { id: \"people\", label: \"People\", href: \"/dashboard/manager/People\", icon: User, gradient: \"from-teal-500 to-emerald-500\" },\r\n    { id: \"analytics\", label: \"Analytics\", href: \"/dashboard/manager/Analytics\", icon: BarChart3, gradient: \"from-pink-500 to-rose-500\" },\r\n    { id: \"settings\", label: \"Settings\", href: \"/dashboard/manager/settings\", icon: Settings, gradient: \"from-slate-500 to-slate-700\" },\r\n  ];\r\n\r\n  const NAV_EMPLOYEE: NavItem[] = [\r\n    { id: \"inbox\", label: \"Inbox\", href: \"/dashboard/employee/Inbox\", icon: Inbox, gradient: \"from-emerald-500 to-teal-500\" },\r\n    { id: \"my-tasks\", label: \"My Tasks\", href: \"/dashboard/employee/tasks\", icon: Clipboard, gradient: \"from-pink-500 to-rose-500\" },\r\n    { id: \"my-schedule\", label: \"My Schedule\", href: \"/dashboard/employee/schedule\", icon: Calendar, gradient: \"from-violet-500 to-purple-500\" },\r\n    {id:  \"my-team\", label: \"My Team\", href:\"/dashboard/employee/myteam\", icon: Users, gradient : \"from-emerald-500 to-teal-500\"},\r\n     ];\r\n\r\n  const NAV = portal === \"admin\" ? NAV_ADMIN : portal === \"manager\" ? NAV_MANAGER : NAV_EMPLOYEE;\r\n\r\n  /* ------------------- Active computation ------------------- */\r\n  const computeActive = (p: string | undefined | null) => {\r\n    const t = formatPath(p);\r\n    if (portal === \"admin\") {\r\n      if (t.startsWith(\"/dashboard/admin/overview\")) return \"overview\";\r\n      if (t.startsWith(\"/dashboard/admin/inbox\")) return \"inbox\";\r\n      if (t.startsWith(\"/dashboard/admin/sent\")) return \"sent\";\r\n      if (t.startsWith(\"/dashboard/admin/teams\")) return \"teams\";\r\n      if (t.startsWith(\"/dashboard/admin/analytics\")) return \"analytics\";\r\n      if (t.startsWith(\"/dashboard/admin/settings\")) return \"settings\";\r\n    } else if (portal === \"manager\") {\r\n      if (t.startsWith(\"/dashboard/manager/overview\")) return \"dashboard\";\r\n      if (t.startsWith(\"/dashboard/manager/inbox\")) return \"team-inbox\";\r\n      if (t.startsWith(\"/dashboard/manager/team\")) return \"my-team\";\r\n      if (t.startsWith(\"/dashboard/manager/schedule\")) return \"schedule\";\r\n      if (t.startsWith(\"/dashboard/manager/tasks\")) return \"tasks\";\r\n      if (t.startsWith(\"/dashboard/manager/people\")) return \"people\";\r\n      if (t.startsWith(\"/dashboard/manager/analytics\")) return \"analytics\";\r\n      if (t.startsWith(\"/dashboard/manager/settings\")) return \"settings\";\r\n    } else {\r\n      if (t.startsWith(\"/dashboard/employee/Inbox\")) return \"inbox\";\r\n      if (t.startsWith(\"/dashboard/employee/tasks\")) return \"my-tasks\";\r\n      if (t.startsWith(\"/dashboard/employee/schedule\")) return \"my-schedule\";\r\n      if (t.startsWith(\"/dashboard/employee/knowledge\")) return \"knowledge\";\r\n      if (t.startsWith(\"/dashboard/employee/profile\")) return \"profile\";\r\n    }\r\n    return undefined;\r\n  };\r\n\r\n  const activeId = computeActive(pathname);\r\n\r\n  const filteredNav = NAV.filter((it) => it.label.toLowerCase().includes(searchQuery.toLowerCase()));\r\n\r\n  /* ------------------- Sidebar content ------------------- */\r\n  const sidebarContent = (isMobile = false) => (\r\n    <div className=\"flex flex-col h-full\">\r\n      {/* Header */}\r\n      <div className=\"p-6 pb-4\">\r\n        <motion.div initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.36 }} className=\"flex items-center gap-3 mb-6\">\r\n          <div className=\"relative\">\r\n            <div className=\"w-11 h-11 rounded-xl bg-gradient-to-br from-blue-600 via-cyan-500 to-emerald-500 flex items-center justify-center text-white font-bold shadow-lg shadow-blue-500/30\">S</div>\r\n            <motion.div className=\"absolute -top-1 -right-1 w-3 h-3 bg-emerald-400 rounded-full border-2 border-white\" animate={{ scale: [1, 1.2, 1] }} transition={{ duration: 2, repeat: Infinity }} />\r\n          </div>\r\n\r\n          <div className=\"flex-1\">\r\n            <div className=\"text-base font-bold bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent\">SignalHub</div>\r\n            <div className=\"text-xs text-slate-500 font-medium flex items-center gap-1\">\r\n              <Sparkles className=\"w-3 h-3\" />\r\n              Unified Inbox\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n\r\n        {/* Manager team switcher (only visible to manager portal) */}\r\n        {portal === \"manager\" && (\r\n          <div className=\"mb-3\">\r\n            <label className=\"text-xs text-slate-500\">Team</label>\r\n            <div className=\"mt-2\">\r\n              {teamsLoading ? (\r\n                <div className=\"text-xs text-slate-400\">Loading teams…</div>\r\n              ) : (\r\n                <select value={currentTeamId ?? \"\"} onChange={(e) => setCurrentTeamId(e.target.value || null)} className=\"w-full p-2 rounded-md border text-sm\">\r\n                  {teams.length === 0 && <option value=\"\">No teams</option>}\r\n                  {teams.map((t) => (\r\n                    <option key={t.id} value={t.id}>\r\n                      {t.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Search */}\r\n        <motion.div className=\"relative group\" initial={{ opacity: 0, scale: 0.98 }} animate={{ opacity: 1, scale: 1 }} transition={{ duration: 0.32, delay: 0.06 }}>\r\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 group-focus-within:text-blue-500 transition-colors\" />\r\n          <input\r\n            aria-label=\"Search navigation\"\r\n            placeholder=\"Search...\"\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n            className=\"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 focus:bg-white transition-all duration-200\"\r\n          />\r\n        </motion.div>\r\n      </div>\r\n\r\n      {/* Navigation */}\r\n      <nav className=\"flex-1 px-3 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-300 scrollbar-track-transparent\" aria-label=\"Primary\">\r\n        <div className=\"space-y-1\">\r\n          {filteredNav.map((item, index) => {\r\n            const Icon = item.icon as any;\r\n            const isActive = activeId === item.id;\r\n            const isHovered = hoveredItem === item.id;\r\n\r\n            return (\r\n              <motion.div key={item.id} initial={{ opacity: 0, x: -18 }} animate={{ opacity: 1, x: 0 }} transition={{ duration: 0.28, delay: index * 0.03 }}>\r\n                <Link\r\n                  href={item.href}\r\n                  onClick={() => {\r\n                    if (isMobile) setOpen(false);\r\n                  }}\r\n                  onMouseEnter={() => setHoveredItem(item.id)}\r\n                  onMouseLeave={() => setHoveredItem(null)}\r\n                  className={clsx(\r\n                    \"relative flex items-center gap-3 px-3 py-3 rounded-xl text-sm font-medium transition-all duration-200 group\",\r\n                    isActive ? \"bg-gradient-to-r from-blue-50 to-cyan-50 text-blue-700 shadow-sm\" : \"text-slate-600 hover:bg-slate-50\"\r\n                  )}\r\n                  aria-current={isActive ? \"page\" : undefined}\r\n                >\r\n                  {isActive && (\r\n                    <motion.div layoutId=\"activeIndicator\" className=\"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-gradient-to-b from-blue-500 to-cyan-500 rounded-r-full\" transition={{ type: \"spring\", stiffness: 300, damping: 30 }} />\r\n                  )}\r\n\r\n                  <div className=\"relative\">\r\n                    <motion.div className={clsx(\"w-9 h-9 rounded-lg flex items-center justify-center transition-all duration-200\", isActive ? `bg-gradient-to-br ${item.gradient} shadow-lg` : \"bg-slate-100 group-hover:bg-slate-200\")} animate={isActive ? { scale: [1, 1.05, 1] } : {}}>\r\n                      <Icon className={clsx(\"w-4 h-4 transition-colors\", isActive ? \"text-white\" : \"text-slate-600\")} />\r\n                    </motion.div>\r\n\r\n                    {item.badge && (\r\n                      <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} className=\"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 bg-gradient-to-br from-rose-500 to-pink-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center shadow-lg\" aria-hidden=\"true\">\r\n                        {item.badge}\r\n                      </motion.div>\r\n                    )}\r\n                  </div>\r\n\r\n                  <span className=\"flex-1 text-left\">{item.label}</span>\r\n\r\n                  <motion.div initial={{ opacity: 0, x: -5 }} animate={{ opacity: isHovered && !isActive ? 1 : 0, x: isHovered && !isActive ? 0 : -5 }} transition={{ duration: 0.18 }} aria-hidden=\"true\">\r\n                    <ChevronRight className=\"w-4 h-4 text-slate-400\" />\r\n                  </motion.div>\r\n\r\n                  {isActive && (\r\n                    <motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ duration: 0.18 }}>\r\n                      <ArrowRight className=\"w-4 h-4 text-blue-600\" />\r\n                    </motion.div>\r\n                  )}\r\n                </Link>\r\n              </motion.div>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {/* Quick actions (portal specific) */}\r\n        <motion.div initial={{ opacity: 0, y: 8 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.36, delay: 0.18 }} className=\"mt-6 mb-4 px-3\">\r\n          <div className=\"mb-2 text-xs font-semibold text-slate-400 uppercase tracking-wider\">Quick Actions</div>\r\n\r\n          {portal === \"admin\" && (\r\n            <div className=\"p-4 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-xl text-white relative overflow-hidden group cursor-pointer hover:shadow-xl transition-shadow duration-300\">\r\n              <div className=\"relative\">\r\n                <div className=\"text-sm font-bold mb-1\">Invite managers</div>\r\n                <div className=\"text-xs opacity-90 mb-3\">Send an invite to a new manager</div>\r\n                <motion.div className=\"inline-flex items-center gap-1 text-xs font-semibold bg-white/20 backdrop-blur-sm px-3 py-1.5 rounded-lg\" whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>\r\n                  Invite <ArrowRight className=\"w-3 h-3\" />\r\n                </motion.div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {portal === \"manager\" && (\r\n            <>\r\n              <div className=\"flex gap-2\">\r\n                <button onClick={() => setScheduleOpen(true)} className=\"flex-1 inline-flex items-center justify-center gap-2 rounded-md bg-indigo-600 text-white px-3 py-2 text-sm hover:bg-indigo-700 transition\">\r\n                  <Calendar className=\"w-4 h-4\" /> Schedule meeting\r\n                </button>\r\n                <button className=\"inline-flex items-center gap-2 rounded-md border border-slate-200 px-3 py-2 text-sm\" onClick={() => {\r\n                  // client-side shortcut to create task - adapt to your create task flow\r\n                  window.location.href = \"/dashboard/manager/tasks/create\";\r\n                }}>\r\n                  <Plus className=\"w-4 h-4\" /> Task\r\n                </button>\r\n              </div>\r\n              <p className=\"text-xs text-slate-400 mt-2\">Quickly schedule meetings for your team or create tasks.</p>\r\n            </>\r\n          )}\r\n\r\n          {portal === \"employee\" && (\r\n            <>\r\n              <div className=\"flex gap-2\">\r\n                <button className=\"flex-1 inline-flex items-center justify-center gap-2 rounded-md bg-emerald-600 text-white px-3 py-2 text-sm hover:bg-emerald-700 transition\" onClick={() => {\r\n                  // start break / status toggle (demo client-side action)\r\n                  fetch(\"/api/me/status\", { method: \"POST\", credentials: \"same-origin\", body: JSON.stringify({ onBreak: true }) }).catch(() => {});\r\n                }}>\r\n                  <Clock className=\"w-4 h-4\" /> Start break\r\n                </button>\r\n                <button className=\"inline-flex items-center gap-2 rounded-md border border-slate-200 px-3 py-2 text-sm\" onClick={() => window.location.href = \"/dashboard/employee/notes/create\"}>\r\n                  <Plus className=\"w-4 h-4\" /> Note\r\n                </button>\r\n              </div>\r\n              <p className=\"text-xs text-slate-400 mt-2\">Set your status or jot down a quick note.</p>\r\n            </>\r\n          )}\r\n        </motion.div>\r\n      </nav>\r\n\r\n      {/* Profile section */}\r\n      <div className=\"p-4 border-t border-slate-200 bg-slate-50/50\">\r\n        <ProfileMenu />\r\n      </div>\r\n\r\n      {/* Schedule Modal (manager only) */}\r\n      {portal === \"manager\" && (\r\n        <ScheduleModal\r\n          open={scheduleOpen}\r\n          onClose={(success?: boolean) => {\r\n            setScheduleOpen(false);\r\n            if (success) {\r\n              // optional toast or action - simple page reload to refresh schedule\r\n              // window.location.reload();\r\n            }\r\n          }}\r\n          onCreated={() => {\r\n            // placeholder hook\r\n          }}\r\n          defaultOrganizer={undefined}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n\r\n  /* ------------------- Render root (desktop + mobile) ------------------- */\r\n  return (\r\n    <>\r\n      {/* Floating mobile hamburger toggle */}\r\n      {!hideToggle && (\r\n        <div className=\"lg:hidden fixed top-4 left-4 z-50\">\r\n          <motion.button\r\n            whileHover={{ scale: 1.05 }}\r\n            whileTap={{ scale: 0.95 }}\r\n            aria-label={open ? \"Close menu\" : \"Open menu\"}\r\n            onClick={() => setOpen(!open)}\r\n            className=\"p-3 rounded-xl bg-white shadow-lg shadow-slate-900/10 text-slate-700 border border-slate-200 backdrop-blur-sm\"\r\n          >\r\n            <AnimatePresence mode=\"wait\">\r\n              {open ? (\r\n                <motion.div key=\"close\" initial={{ rotate: -90, opacity: 0 }} animate={{ rotate: 0, opacity: 1 }} exit={{ rotate: 90, opacity: 0 }} transition={{ duration: 0.18 }}>\r\n                  <X className=\"w-5 h-5\" />\r\n                </motion.div>\r\n              ) : (\r\n                <motion.div key=\"menu\" initial={{ rotate: 90, opacity: 0 }} animate={{ rotate: 0, opacity: 1 }} exit={{ rotate: -90, opacity: 0 }} transition={{ duration: 0.18 }}>\r\n                  <Menu className=\"w-5 h-5\" />\r\n                </motion.div>\r\n              )}\r\n            </AnimatePresence>\r\n          </motion.button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Desktop fixed sidebar */}\r\n      <motion.aside initial={{ x: -12, opacity: 0 }} animate={{ x: 0, opacity: 1 }} transition={{ duration: 0.36 }} className=\"hidden lg:fixed lg:inset-y-0 lg:left-0 lg:flex lg:flex-col lg:w-72 lg:min-h-screen lg:border-r lg:border-slate-200 lg:bg-white/80 lg:backdrop-blur-xl z-30\" aria-hidden={false}>\r\n        {sidebarContent(false)}\r\n      </motion.aside>\r\n\r\n      {/* Mobile drawer */}\r\n      <AnimatePresence>\r\n        {open && (\r\n          <>\r\n            <motion.div className=\"fixed inset-0 z-40 bg-slate-900/60 backdrop-blur-sm\" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} transition={{ duration: 0.28 }} onClick={() => setOpen(false)} aria-hidden=\"true\" />\r\n\r\n            <motion.aside initial={{ x: \"-100%\", opacity: 0 }} animate={{ x: 0, opacity: 1 }} exit={{ x: \"-100%\", opacity: 0 }} transition={{ type: \"spring\", stiffness: 300, damping: 30 }} className=\"fixed inset-y-0 left-0 z-50 w-80 bg-white shadow-2xl\" role=\"dialog\" aria-modal=\"true\" aria-label=\"Main menu\">\r\n              <div className=\"absolute top-4 right-4 z-10\">\r\n                <motion.button ref={closeBtnRef} whileHover={{ scale: 1.1, rotate: 90 }} whileTap={{ scale: 0.9 }} className=\"p-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-700 transition-colors\" aria-label=\"Close menu\" onClick={() => setOpen(false)}>\r\n                  <X className=\"w-5 h-5\" />\r\n                </motion.button>\r\n              </div>\r\n\r\n              {sidebarContent(true)}\r\n            </motion.aside>\r\n          </>\r\n        )}\r\n      </AnimatePresence>\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1993, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/socketClient.ts"],"sourcesContent":["// src/lib/socketClient.ts\r\n\r\nimport { io, Socket } from \"socket.io-client\";\r\n\r\nconst DEFAULT_SOCKET_URL = (process.env.NEXT_PUBLIC_SOCKET_URL || \"http://localhost:4001\").replace(/\\/$/, \"\");\r\nconst DEFAULT_PATH = \"/\"; // if your socket server serves at root; otherwise adjust\r\n\r\nlet socket: Socket | null = null;\r\nlet currentToken: string | null = null;\r\n\r\n/**\r\n * createSocket() - internal helper to (re)create socket with token\r\n */\r\nfunction createSocket(token?: string) {\r\n  const url = DEFAULT_SOCKET_URL;\r\n  const opts: any = {\r\n    path: DEFAULT_PATH,\r\n    transports: [\"websocket\"],\r\n    autoConnect: false,\r\n    reconnection: true,\r\n    reconnectionAttempts: Infinity,\r\n    reconnectionDelayMax: 5000,\r\n    timeout: 20000,\r\n  };\r\n\r\n  if (token) {\r\n    opts.auth = { token };\r\n  }\r\n\r\n  const s = io(url, opts);\r\n  // helpful debug logs\r\n  s.on(\"connect\", () => {\r\n    // eslint-disable-next-line no-console\r\n    console.debug(\"[socket] connected\", s.id);\r\n  });\r\n  s.on(\"connect_error\", (err: any) => {\r\n    // eslint-disable-next-line no-console\r\n    console.warn(\"[socket] connect_error\", err && err.message ? err.message : err);\r\n  });\r\n  s.on(\"disconnect\", (reason: any) => {\r\n    // eslint-disable-next-line no-console\r\n    console.debug(\"[socket] disconnected\", reason);\r\n  });\r\n\r\n  return s;\r\n}\r\n\r\n/**\r\n * connectWithToken(token)\r\n * - creates (or recreates) the socket with token and connects\r\n */\r\nexport async function connectWithToken(token?: string) {\r\n  // prefer explicit token, otherwise attempt to read global/local fallback\r\n  const t = token ?? (typeof window !== \"undefined\" ? (window as any).__SESSION_TOKEN ?? (localStorage.getItem(\"session\") ?? null) : null);\r\n  currentToken = t;\r\n\r\n  // if socket exists and token unchanged, just ensure connected\r\n  if (socket && socket.connected && currentToken === t) {\r\n    return socket;\r\n  }\r\n\r\n  // if socket exists but token changed, clean up\r\n  if (socket) {\r\n    try {\r\n      socket.removeAllListeners();\r\n      socket.disconnect();\r\n    } catch {}\r\n    socket = null;\r\n  }\r\n\r\n  socket = createSocket(t ?? undefined);\r\n\r\n  // Connect\r\n  try {\r\n    socket.connect();\r\n    // wait for connect with a Promise (timeout)\r\n    await new Promise<void>((resolve, reject) => {\r\n      const to = setTimeout(() => {\r\n        // don't reject — leave to app to handle offline mode\r\n        clearTimeout(to);\r\n        resolve();\r\n      }, 3000);\r\n      socket!.once(\"connect\", () => {\r\n        clearTimeout(to);\r\n        resolve();\r\n      });\r\n      socket!.once(\"connect_error\", () => {\r\n        clearTimeout(to);\r\n        resolve(); // resolve so UI can continue; connection may recover\r\n      });\r\n    });\r\n  } catch (err) {\r\n    // swallow; connect errors are non-fatal for UI\r\n  }\r\n\r\n  return socket;\r\n}\r\n\r\n/**\r\n * disconnectSocket()\r\n */\r\nexport function disconnectSocket() {\r\n  try {\r\n    if (socket) {\r\n      socket.disconnect();\r\n      socket.removeAllListeners();\r\n      socket = null;\r\n      currentToken = null;\r\n    }\r\n  } catch {}\r\n}\r\n\r\n/**\r\n * joinRoom / leaveRoom helpers\r\n * rooms are plain strings (e.g., `chat:abc`, `user:xxx`, `org:yyy`)\r\n */\r\nexport async function joinRoom(room: string) {\r\n  if (!socket) await connectWithToken();\r\n  try {\r\n    socket?.emit(\"join_chat\", { chatId: room.startsWith(\"chat:\") ? room.split(\"chat:\")[1] : room });\r\n    // also call socket.join on server-side; client telling server via join_chat is typical\r\n  } catch {}\r\n}\r\n\r\nexport async function leaveRoom(room: string) {\r\n  try {\r\n    socket?.emit(\"leave_chat\", { chatId: room.startsWith(\"chat:\") ? room.split(\"chat:\")[1] : room });\r\n  } catch {}\r\n}\r\n\r\n/**\r\n * sendEvent(event, payload)\r\n */\r\nexport function sendEvent(event: string, payload?: any) {\r\n  try {\r\n    if (!socket) {\r\n      // call connectWithToken but do not await long\r\n      connectWithToken().then(() => {\r\n        socket?.emit(event, payload);\r\n      });\r\n      return;\r\n    }\r\n    socket.emit(event, payload);\r\n  } catch {}\r\n}\r\n\r\n/**\r\n * on(event, handler) / off(event, handler)\r\n */\r\nexport function onEvent(event: string, handler: (...args: any[]) => void) {\r\n  try {\r\n    if (!socket) {\r\n      // best-effort connect\r\n      connectWithToken().then(() => {\r\n        socket?.on(event, handler);\r\n      });\r\n      return;\r\n    }\r\n    socket.on(event, handler);\r\n  } catch {}\r\n}\r\n\r\nexport function offEvent(event: string, handler?: (...args: any[]) => void) {\r\n  try {\r\n    if (!socket) return;\r\n    if (handler) socket.off(event, handler);\r\n    else socket.removeAllListeners(event);\r\n  } catch {}\r\n}\r\n\r\n/**\r\n * getSocket() - returns the underlying socket instance (may be null)\r\n */\r\nexport function getSocketInstance() {\r\n  return socket;\r\n}\r\n\r\nexport default {\r\n  connectWithToken,\r\n  disconnectSocket,\r\n  joinRoom,\r\n  leaveRoom,\r\n  sendEvent,\r\n  onEvent,\r\n  offEvent,\r\n  getSocketInstance,\r\n};\r\n"],"names":[],"mappings":"AAAA,0BAA0B;;;;;;;;;;;;;;;;;;;;;AAE1B;;AAEA,MAAM,qBAAqB,CAAC,QAAQ,GAAG,CAAC,sBAAsB,IAAI,uBAAuB,EAAE,OAAO,CAAC,OAAO;AAC1G,MAAM,eAAe,KAAK,yDAAyD;AAEnF,IAAI,SAAwB;AAC5B,IAAI,eAA8B;AAElC;;CAEC,GACD,SAAS,aAAa,KAAc;IAClC,MAAM,MAAM;IACZ,MAAM,OAAY;QAChB,MAAM;QACN,YAAY;YAAC;SAAY;QACzB,aAAa;QACb,cAAc;QACd,sBAAsB;QACtB,sBAAsB;QACtB,SAAS;IACX;IAEA,IAAI,OAAO;QACT,KAAK,IAAI,GAAG;YAAE;QAAM;IACtB;IAEA,MAAM,IAAI,IAAA,8LAAE,EAAC,KAAK;IAClB,qBAAqB;IACrB,EAAE,EAAE,CAAC,WAAW;QACd,sCAAsC;QACtC,QAAQ,KAAK,CAAC,sBAAsB,EAAE,EAAE;IAC1C;IACA,EAAE,EAAE,CAAC,iBAAiB,CAAC;QACrB,sCAAsC;QACtC,QAAQ,IAAI,CAAC,0BAA0B,OAAO,IAAI,OAAO,GAAG,IAAI,OAAO,GAAG;IAC5E;IACA,EAAE,EAAE,CAAC,cAAc,CAAC;QAClB,sCAAsC;QACtC,QAAQ,KAAK,CAAC,yBAAyB;IACzC;IAEA,OAAO;AACT;AAMO,eAAe,iBAAiB,KAAc;IACnD,yEAAyE;IACzE,MAAM,IAAI,SAAS,CAAC,sCAAgC,0BAA+E,IAAI;IACvI,eAAe;IAEf,8DAA8D;IAC9D,IAAI,UAAU,OAAO,SAAS,IAAI,iBAAiB,GAAG;QACpD,OAAO;IACT;IAEA,+CAA+C;IAC/C,IAAI,QAAQ;QACV,IAAI;YACF,OAAO,kBAAkB;YACzB,OAAO,UAAU;QACnB,EAAE,OAAM,CAAC;QACT,SAAS;IACX;IAEA,SAAS,aAAa,KAAK;IAE3B,UAAU;IACV,IAAI;QACF,OAAO,OAAO;QACd,4CAA4C;QAC5C,MAAM,IAAI,QAAc,CAAC,SAAS;YAChC,MAAM,KAAK,WAAW;gBACpB,qDAAqD;gBACrD,aAAa;gBACb;YACF,GAAG;YACH,OAAQ,IAAI,CAAC,WAAW;gBACtB,aAAa;gBACb;YACF;YACA,OAAQ,IAAI,CAAC,iBAAiB;gBAC5B,aAAa;gBACb,WAAW,qDAAqD;YAClE;QACF;IACF,EAAE,OAAO,KAAK;IACZ,+CAA+C;IACjD;IAEA,OAAO;AACT;AAKO,SAAS;IACd,IAAI;QACF,IAAI,QAAQ;YACV,OAAO,UAAU;YACjB,OAAO,kBAAkB;YACzB,SAAS;YACT,eAAe;QACjB;IACF,EAAE,OAAM,CAAC;AACX;AAMO,eAAe,SAAS,IAAY;IACzC,IAAI,CAAC,QAAQ,MAAM;IACnB,IAAI;QACF,QAAQ,KAAK,aAAa;YAAE,QAAQ,KAAK,UAAU,CAAC,WAAW,KAAK,KAAK,CAAC,QAAQ,CAAC,EAAE,GAAG;QAAK;IAC7F,uFAAuF;IACzF,EAAE,OAAM,CAAC;AACX;AAEO,eAAe,UAAU,IAAY;IAC1C,IAAI;QACF,QAAQ,KAAK,cAAc;YAAE,QAAQ,KAAK,UAAU,CAAC,WAAW,KAAK,KAAK,CAAC,QAAQ,CAAC,EAAE,GAAG;QAAK;IAChG,EAAE,OAAM,CAAC;AACX;AAKO,SAAS,UAAU,KAAa,EAAE,OAAa;IACpD,IAAI;QACF,IAAI,CAAC,QAAQ;YACX,8CAA8C;YAC9C,mBAAmB,IAAI,CAAC;gBACtB,QAAQ,KAAK,OAAO;YACtB;YACA;QACF;QACA,OAAO,IAAI,CAAC,OAAO;IACrB,EAAE,OAAM,CAAC;AACX;AAKO,SAAS,QAAQ,KAAa,EAAE,OAAiC;IACtE,IAAI;QACF,IAAI,CAAC,QAAQ;YACX,sBAAsB;YACtB,mBAAmB,IAAI,CAAC;gBACtB,QAAQ,GAAG,OAAO;YACpB;YACA;QACF;QACA,OAAO,EAAE,CAAC,OAAO;IACnB,EAAE,OAAM,CAAC;AACX;AAEO,SAAS,SAAS,KAAa,EAAE,OAAkC;IACxE,IAAI;QACF,IAAI,CAAC,QAAQ;QACb,IAAI,SAAS,OAAO,GAAG,CAAC,OAAO;aAC1B,OAAO,kBAAkB,CAAC;IACjC,EAAE,OAAM,CAAC;AACX;AAKO,SAAS;IACd,OAAO;AACT;uCAEe;IACb;IACA;IACA;IACA;IACA;IACA;IACA;IACA;AACF","debugId":null}},
    {"offset": {"line": 2171, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/dashboard/ChatSocketProvider.tsx"],"sourcesContent":["// src/context/ChatSocketProvider.tsx\r\n\"use client\";\r\n\r\nimport React, {\r\n  createContext,\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport socketClient, {\r\n  connectWithToken,\r\n  disconnectSocket,\r\n  joinRoom,\r\n  leaveRoom,\r\n  sendEvent,\r\n  onEvent,\r\n  offEvent,\r\n} from \"@/lib/socketClient\";\r\n\r\ntype ChatSocketContextValue = {\r\n  connected: boolean;\r\n  socketId: string | null;\r\n  connect: (token?: string | null) => Promise<void>;\r\n  disconnect: () => void;\r\n  joinChat: (chatId: string) => Promise<void>;\r\n  leaveChat: (chatId: string) => Promise<void>;\r\n  sendMessage: (chatId: string, payload: any) => void;\r\n  on: (event: string, handler: (...args: any[]) => void) => void;\r\n  off: (event: string, handler?: (...args: any[]) => void) => void;\r\n};\r\n\r\nconst ChatSocketContext = createContext<ChatSocketContextValue | null>(null);\r\n\r\nexport function useChatSocket(): ChatSocketContextValue {\r\n  const ctx = useContext(ChatSocketContext);\r\n  if (!ctx) throw new Error(\"useChatSocket must be used inside ChatSocketProvider\");\r\n  return ctx;\r\n}\r\n\r\nexport function ChatSocketProvider({\r\n  children,\r\n  getToken,\r\n}: {\r\n  children: React.ReactNode;\r\n  getToken?: (() => Promise<string | null> | string | null);\r\n}) {\r\n  const [connected, setConnected] = useState(false);\r\n  const [socketId, setSocketId] = useState<string | null>(null);\r\n  const tokenRef = useRef<string | null>(null);\r\n\r\n  const doConnect = useCallback(\r\n    async (maybeToken?: string | null) => {\r\n      try {\r\n        let token = maybeToken ?? null;\r\n        if (!token && getToken) {\r\n          try {\r\n            const t = await (getToken as any)();\r\n            token = typeof t === \"string\" ? t : null;\r\n          } catch {}\r\n        }\r\n        if (!token && typeof window !== \"undefined\") {\r\n          token = (window as any).__SESSION_TOKEN ?? localStorage.getItem(\"session\") ?? null;\r\n        }\r\n\r\n        tokenRef.current = token;\r\n        const s = await connectWithToken(token);\r\n        const inst = s ?? (window as any).__socketInstance ?? null;\r\n\r\n        setTimeout(() => {\r\n          setConnected(Boolean(inst && inst.connected));\r\n          setSocketId(inst?.id ?? null);\r\n        }, 300);\r\n\r\n        if (inst) {\r\n          inst.on?.(\"connect\", () => {\r\n            setConnected(true);\r\n            setSocketId(inst.id ?? null);\r\n          });\r\n          inst.on?.(\"disconnect\", () => {\r\n            setConnected(false);\r\n            setSocketId(null);\r\n          });\r\n        }\r\n      } catch {\r\n        // best-effort\r\n      }\r\n    },\r\n    [getToken]\r\n  );\r\n\r\n  const doDisconnect = useCallback(() => {\r\n    try {\r\n      disconnectSocket();\r\n    } finally {\r\n      setConnected(false);\r\n      setSocketId(null);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    doConnect().catch(() => {});\r\n    return () => {\r\n      try {\r\n        doDisconnect();\r\n      } catch {}\r\n    };\r\n  }, [doConnect, doDisconnect]);\r\n\r\n  // IMPORTANT: join by raw chatId (server's \"join-room\" handler will map to room internally)\r\n  const joinChat = useCallback(async (chatId: string) => {\r\n    if (!chatId) return;\r\n    await joinRoom(chatId);\r\n  }, []);\r\n\r\n  const leaveChat = useCallback(async (chatId: string) => {\r\n    if (!chatId) return;\r\n    await leaveRoom(chatId);\r\n  }, []);\r\n\r\n  const sendMessage = useCallback((chatId: string, payload: any) => {\r\n    // Event for real-time UX; persistence happens via POST /api/chats/:id\r\n    sendEvent(\"chat:message\", { chatId, ...payload });\r\n  }, []);\r\n\r\n  const on = useCallback((event: string, handler: (...args: any[]) => void) => {\r\n    onEvent(event, handler);\r\n  }, []);\r\n\r\n  const off = useCallback((event: string, handler?: (...args: any[]) => void) => {\r\n    offEvent(event, handler);\r\n  }, []);\r\n\r\n  const value = useMemo(\r\n    () => ({\r\n      connected,\r\n      socketId,\r\n      connect: doConnect,\r\n      disconnect: doDisconnect,\r\n      joinChat,\r\n      leaveChat,\r\n      sendMessage,\r\n      on,\r\n      off,\r\n    }),\r\n    [connected, socketId, doConnect, doDisconnect, joinChat, leaveChat, sendMessage, on, off]\r\n  );\r\n\r\n  return <ChatSocketContext.Provider value={value}>{children}</ChatSocketContext.Provider>;\r\n}\r\n"],"names":[],"mappings":"AAAA,qCAAqC;;;;;;;;AAGrC;AASA;AAXA;;;;AAiCA,MAAM,kCAAoB,IAAA,sNAAa,EAAgC;AAEhE,SAAS;IACd,MAAM,MAAM,IAAA,mNAAU,EAAC;IACvB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;AACT;AAEO,SAAS,mBAAmB,EACjC,QAAQ,EACR,QAAQ,EAIT;IACC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAgB;IACxD,MAAM,WAAW,IAAA,+MAAM,EAAgB;IAEvC,MAAM,YAAY,IAAA,oNAAW,EAC3B,OAAO;QACL,IAAI;YACF,IAAI,QAAQ,cAAc;YAC1B,IAAI,CAAC,SAAS,UAAU;gBACtB,IAAI;oBACF,MAAM,IAAI,MAAM,AAAC;oBACjB,QAAQ,OAAO,MAAM,WAAW,IAAI;gBACtC,EAAE,OAAM,CAAC;YACX;YACA;;YAIA,SAAS,OAAO,GAAG;YACnB,MAAM,IAAI,MAAM,IAAA,8IAAgB,EAAC;YACjC,MAAM,OAAO,KAAK,AAAC,OAAe,gBAAgB,IAAI;YAEtD,WAAW;gBACT,aAAa,QAAQ,QAAQ,KAAK,SAAS;gBAC3C,YAAY,MAAM,MAAM;YAC1B,GAAG;YAEH,IAAI,MAAM;gBACR,KAAK,EAAE,GAAG,WAAW;oBACnB,aAAa;oBACb,YAAY,KAAK,EAAE,IAAI;gBACzB;gBACA,KAAK,EAAE,GAAG,cAAc;oBACtB,aAAa;oBACb,YAAY;gBACd;YACF;QACF,EAAE,OAAM;QACN,cAAc;QAChB;IACF,GACA;QAAC;KAAS;IAGZ,MAAM,eAAe,IAAA,oNAAW,EAAC;QAC/B,IAAI;YACF,IAAA,8IAAgB;QAClB,SAAU;YACR,aAAa;YACb,YAAY;QACd;IACF,GAAG,EAAE;IAEL,IAAA,kNAAS,EAAC;QACR,YAAY,KAAK,CAAC,KAAO;QACzB,OAAO;YACL,IAAI;gBACF;YACF,EAAE,OAAM,CAAC;QACX;IACF,GAAG;QAAC;QAAW;KAAa;IAE5B,2FAA2F;IAC3F,MAAM,WAAW,IAAA,oNAAW,EAAC,OAAO;QAClC,IAAI,CAAC,QAAQ;QACb,MAAM,IAAA,sIAAQ,EAAC;IACjB,GAAG,EAAE;IAEL,MAAM,YAAY,IAAA,oNAAW,EAAC,OAAO;QACnC,IAAI,CAAC,QAAQ;QACb,MAAM,IAAA,uIAAS,EAAC;IAClB,GAAG,EAAE;IAEL,MAAM,cAAc,IAAA,oNAAW,EAAC,CAAC,QAAgB;QAC/C,sEAAsE;QACtE,IAAA,uIAAS,EAAC,gBAAgB;YAAE;YAAQ,GAAG,OAAO;QAAC;IACjD,GAAG,EAAE;IAEL,MAAM,KAAK,IAAA,oNAAW,EAAC,CAAC,OAAe;QACrC,IAAA,qIAAO,EAAC,OAAO;IACjB,GAAG,EAAE;IAEL,MAAM,MAAM,IAAA,oNAAW,EAAC,CAAC,OAAe;QACtC,IAAA,sIAAQ,EAAC,OAAO;IAClB,GAAG,EAAE;IAEL,MAAM,QAAQ,IAAA,gNAAO,EACnB,IAAM,CAAC;YACL;YACA;YACA,SAAS;YACT,YAAY;YACZ;YACA;YACA;YACA;YACA;QACF,CAAC,GACD;QAAC;QAAW;QAAU;QAAW;QAAc;QAAU;QAAW;QAAa;QAAI;KAAI;IAG3F,qBAAO,8OAAC,kBAAkB,QAAQ;QAAC,OAAO;kBAAQ;;;;;;AACpD","debugId":null}},
    {"offset": {"line": 2304, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/dashboard/layout.tsx"],"sourcesContent":["// app/dashboard/layout.tsx\r\n\"use client\";\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport type { ReactNode } from \"react\";\r\nimport Sidebar from \"@/components/ui/sidebar/Sidebar\";\r\nimport { ChatSocketProvider } from \"./ChatSocketProvider\";   // ⬅️ added import\r\n\r\ntype MeResponse = {\r\n  ok?: boolean;\r\n  role?: string;\r\n  user?: { id?: string; email?: string; role?: string; organizationId?: string; organizationName?: string };\r\n};\r\n\r\nexport default function DashboardLayout({ children }: { children: ReactNode }) {\r\n  const [loading, setLoading] = useState(true);\r\n  const [role, setRole] = useState<string | null>(null);\r\n  const [orgName, setOrgName] = useState<string | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // determine portal from role\r\n  const portal = role === \"ADMIN\" ? \"admin\" : role === \"MANAGER\" ? \"manager\" : \"employee\";\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    setLoading(true);\r\n    (async () => {\r\n      try {\r\n        const res = await fetch(\"/api/me\", { credentials: \"include\" });\r\n        if (!res.ok) {\r\n          if (mounted) {\r\n            setRole(null);\r\n            setOrgName(null);\r\n            setError(\"Not authenticated\");\r\n            setLoading(false);\r\n          }\r\n          return;\r\n        }\r\n        const j: MeResponse = await res.json().catch(() => ({}));\r\n        const r = (j?.role ?? j?.user?.role ?? null) as string | null;\r\n        const org = (j?.user?.organizationName ?? null) as string | null;\r\n        if (mounted) {\r\n          setRole(r ? String(r).toUpperCase() : null);\r\n          setOrgName(org);\r\n          setError(null);\r\n          setLoading(false);\r\n        }\r\n      } catch (err: any) {\r\n        if (mounted) {\r\n          setError(err?.message || String(err));\r\n          setLoading(false);\r\n        }\r\n      }\r\n    })();\r\n\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, []);\r\n\r\n  // Loading skeleton\r\n  if (loading) {\r\n    return (\r\n      <ChatSocketProvider>\r\n        <div className=\"min-h-screen flex bg-slate-50\">\r\n          <aside className=\"w-72 p-6\">\r\n            <div className=\"h-8 w-36 rounded-lg bg-slate-200 animate-pulse mb-6\" />\r\n            <div className=\"space-y-3\">\r\n              <div className=\"h-10 rounded-lg bg-slate-200 animate-pulse\" />\r\n              <div className=\"h-10 rounded-lg bg-slate-200 animate-pulse\" />\r\n              <div className=\"h-10 rounded-lg bg-slate-200 animate-pulse\" />\r\n              <div className=\"h-10 rounded-lg bg-slate-200 animate-pulse\" />\r\n            </div>\r\n          </aside>\r\n\r\n          <div className=\"flex-1 p-6\">\r\n            <div className=\"h-8 w-1/3 rounded bg-slate-200 animate-pulse mb-4\" />\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n              <div className=\"lg:col-span-2 space-y-4\">\r\n                <div className=\"h-44 rounded bg-slate-200 animate-pulse\" />\r\n                <div className=\"h-44 rounded bg-slate-200 animate-pulse\" />\r\n              </div>\r\n              <div className=\"space-y-4\">\r\n                <div className=\"h-28 rounded bg-slate-200 animate-pulse\" />\r\n                <div className=\"h-28 rounded bg-slate-200 animate-pulse\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </ChatSocketProvider>\r\n    );\r\n  }\r\n\r\n  // Not signed in\r\n  if (!role) {\r\n    return (\r\n      <ChatSocketProvider>\r\n        <div className=\"min-h-screen flex items-center justify-center p-6 bg-slate-50\">\r\n          <div className=\"bg-white rounded-lg p-6 shadow\">\r\n            <h2 className=\"text-lg font-semibold\">Not signed in</h2>\r\n            <p className=\"text-sm text-slate-600 mt-2\">Please sign in to access the dashboard.</p>\r\n            <div className=\"mt-4 flex gap-2\">\r\n              <a href=\"/login\" className=\"px-3 py-2 rounded bg-indigo-600 text-white text-sm\">Sign in</a>\r\n              <a href=\"/\" className=\"px-3 py-2 rounded border text-sm\">Go home</a>\r\n            </div>\r\n            {error && <div className=\"mt-3 text-xs text-rose-600\">{error}</div>}\r\n          </div>\r\n        </div>\r\n      </ChatSocketProvider>\r\n    );\r\n  }\r\n\r\n  // Main dashboard layout\r\n  return (\r\n    <ChatSocketProvider>\r\n      <div className=\"min-h-screen flex bg-slate-50\">\r\n        {/* Sidebar */}\r\n        <Sidebar portal={portal as any} />\r\n\r\n        {/* Main content area */}\r\n        <div className=\"flex-1 min-h-screen lg:pl-72\">\r\n          {/* Header */}\r\n          <header className=\"bg-white border-b border-slate-200 sticky top-0 z-20\">\r\n            <div className=\"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-4\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <button\r\n                  onClick={() => {\r\n                    const el = document.querySelector(\"button[aria-label='Open menu']\");\r\n                    if (el) (el as HTMLButtonElement).click();\r\n                  }}\r\n                  className=\"lg:hidden inline-flex items-center justify-center p-2 rounded-md bg-white border shadow-sm\"\r\n                  aria-label=\"Open menu\"\r\n                >\r\n                  <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden>\r\n                    <path d=\"M4 6h16M4 12h16M4 18h16\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n                  </svg>\r\n                </button>\r\n\r\n                <div>\r\n                  <div className=\"text-sm font-semibold text-slate-800\">Dashboard</div>\r\n                  <div className=\"text-xs text-slate-500\">{orgName ?? \"Organization\"} • {role?.toLowerCase()}</div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex items-center gap-3\">\r\n                <a href=\"/account\" className=\"hidden sm:inline-flex text-sm px-3 py-1 rounded-md hover:bg-slate-50\">Account</a>\r\n                <form action=\"/api/auth/logout\" method=\"POST\">\r\n                  <button type=\"submit\" className=\"px-3 py-1 rounded-md border text-sm\">Sign out</button>\r\n                </form>\r\n              </div>\r\n            </div>\r\n          </header>\r\n\r\n          <main className=\"p-6\">\r\n            <div className=\"max-w-7xl mx-auto\">{children}</div>\r\n          </main>\r\n        </div>\r\n      </div>\r\n    </ChatSocketProvider>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}