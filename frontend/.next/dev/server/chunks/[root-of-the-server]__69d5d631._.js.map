{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  // prevent multiple instantiation in dev\r\n  // eslint-disable-next-line no-var\r\n  var prisma: PrismaClient | undefined;\r\n}\r\n\r\nexport const prisma =\r\n  global.prisma ??\r\n  new PrismaClient({\r\n    log: [\"query\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAQO,MAAM,SACX,OAAO,MAAM,IACb,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,OAAO,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/api/auth/google/verify/route.ts"],"sourcesContent":["// app/api/auth/google/verify/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport type { NextRequest } from \"next/server\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { jwtVerify, SignJWT } from \"jose\";\r\nimport { prisma } from \"@/lib/prisma\"; // adjust path to your prisma client\r\n\r\nconst client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);\r\n\r\nasync function verifyIdToken(idToken: string) {\r\n  const ticket = await client.verifyIdToken({\r\n    idToken,\r\n    audience: process.env.GOOGLE_CLIENT_ID,\r\n  });\r\n  const payload = ticket.getPayload();\r\n  return payload; // contains email, sub, name, picture etc\r\n}\r\n\r\nfunction createSessionJwt(payload: any) {\r\n  // WARNING: use a robust session signature in production\r\n  // Here we create a short JWT for demo; replace with your session mechanism\r\n  const secret = new TextEncoder().encode(process.env.SESSION_SECRET || \"dev-secret\");\r\n  const exp = Math.floor(Date.now() / 1000) + 60 * 60 * 24 * 7; // 7d\r\n  return new SignJWT({ sub: payload.sub, email: payload.email, name: payload.name })\r\n    .setProtectedHeader({ alg: \"HS256\" })\r\n    .setExpirationTime(exp)\r\n    .sign(secret);\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const body = await request.json();\r\n    const idToken = body?.idToken;\r\n    if (!idToken) {\r\n      return NextResponse.json({ error: \"Missing idToken\" }, { status: 400 });\r\n    }\r\n\r\n    const payload = await verifyIdToken(idToken);\r\n    if (!payload || !payload.email) {\r\n      return NextResponse.json({ error: \"Failed to verify id token\" }, { status: 401 });\r\n    }\r\n\r\n    const email = payload.email as string;\r\n    const name = (payload.name as string) ?? undefined;\r\n    const sub = payload.sub as string; // Google user id\r\n\r\n    // upsert user in DB (example using prisma)\r\n    let user = await prisma.user.findUnique({ where: { email } });\r\n    if (!user) {\r\n      user = await prisma.user.create({\r\n        data: {\r\n          email,\r\n          name,\r\n          provider: \"google\",\r\n          // store google sub if you want\r\n          googleSub: sub,\r\n        },\r\n      });\r\n    } else {\r\n      // optionally update user fields\r\n      await prisma.user.update({\r\n        where: { id: user.id },\r\n        data: { name },\r\n      });\r\n    }\r\n\r\n    // create a session token (JWT) â€” replace with your session handling\r\n    const sessionJwt = await createSessionJwt({ sub, email, name });\r\n\r\n    const res = NextResponse.json({ ok: true, message: \"Logged in\" });\r\n    // set cookie: adjust options to your needs\r\n    res.cookies.set({\r\n      name: \"session\",\r\n      value: sessionJwt,\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === \"production\",\r\n      sameSite: \"lax\",\r\n      path: \"/\",\r\n      maxAge: 60 * 60 * 24 * 7,\r\n    });\r\n\r\n    return res;\r\n  } catch (err: any) {\r\n    console.error(\"google verify error\", err);\r\n    return NextResponse.json({ error: err?.message ?? \"Server error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,sCAAsC;;;;;AACtC;AAEA;AACA;AACA,8MAAuC,oCAAoC;;;;;AAE3E,MAAM,SAAS,IAAI,oLAAY,CAAC,QAAQ,GAAG,CAAC,gBAAgB;AAE5D,eAAe,cAAc,OAAe;IAC1C,MAAM,SAAS,MAAM,OAAO,aAAa,CAAC;QACxC;QACA,UAAU,QAAQ,GAAG,CAAC,gBAAgB;IACxC;IACA,MAAM,UAAU,OAAO,UAAU;IACjC,OAAO,SAAS,yCAAyC;AAC3D;AAEA,SAAS,iBAAiB,OAAY;IACpC,wDAAwD;IACxD,2EAA2E;IAC3E,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,cAAc,IAAI;IACtE,MAAM,MAAM,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK,QAAQ,KAAK,KAAK,KAAK,GAAG,KAAK;IACnE,OAAO,IAAI,kKAAO,CAAC;QAAE,KAAK,QAAQ,GAAG;QAAE,OAAO,QAAQ,KAAK;QAAE,MAAM,QAAQ,IAAI;IAAC,GAC7E,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,KAClB,IAAI,CAAC;AACV;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,UAAU,MAAM;QACtB,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,UAAU,MAAM,cAAc;QACpC,IAAI,CAAC,WAAW,CAAC,QAAQ,KAAK,EAAE;YAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,MAAM,QAAQ,QAAQ,KAAK;QAC3B,MAAM,OAAO,AAAC,QAAQ,IAAI,IAAe;QACzC,MAAM,MAAM,QAAQ,GAAG,EAAY,iBAAiB;QAEpD,2CAA2C;QAC3C,IAAI,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE;YAAM;QAAE;QAC3D,IAAI,CAAC,MAAM;YACT,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,MAAM,CAAC;gBAC9B,MAAM;oBACJ;oBACA;oBACA,UAAU;oBACV,+BAA+B;oBAC/B,WAAW;gBACb;YACF;QACF,OAAO;YACL,gCAAgC;YAChC,MAAM,gIAAM,CAAC,IAAI,CAAC,MAAM,CAAC;gBACvB,OAAO;oBAAE,IAAI,KAAK,EAAE;gBAAC;gBACrB,MAAM;oBAAE;gBAAK;YACf;QACF;QAEA,oEAAoE;QACpE,MAAM,aAAa,MAAM,iBAAiB;YAAE;YAAK;YAAO;QAAK;QAE7D,MAAM,MAAM,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,SAAS;QAAY;QAC/D,2CAA2C;QAC3C,IAAI,OAAO,CAAC,GAAG,CAAC;YACd,MAAM;YACN,OAAO;YACP,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,MAAM;YACN,QAAQ,KAAK,KAAK,KAAK;QACzB;QAEA,OAAO;IACT,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,KAAK,WAAW;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpF;AACF","debugId":null}}]
}