{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line\r\n  var __prisma__: PrismaClient | undefined;\r\n}\r\nexport const prisma =\r\n  global.__prisma__ ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"warn\", \"error\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.__prisma__ = prisma;\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;;AAMO,MAAM,SACX,OAAO,UAAU,IACjB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAQ;KAAQ,GAAG;AAC7E;AAEF,wCAA2C,OAAO,UAAU,GAAG","debugId":null}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/api/teams/%5Bid%5D/route.ts"],"sourcesContent":["// src/app/api/teams/[id]/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n// import { getSessionUser } from \"@/lib/auth\"; // use if you need auth checks\r\n\r\nfunction jsonError(message: string, status = 400) {\r\n  return NextResponse.json({ ok: false, message }, { status });\r\n}\r\n\r\nfunction isValidId(id?: string | null) {\r\n  return typeof id === \"string\" && id.trim().length > 0;\r\n}\r\n\r\nexport async function GET(req: Request, { params }: { params: { id?: string } }) {\r\n  try {\r\n    const id = params?.id;\r\n    if (!isValidId(id)) return jsonError(\"Missing team id\", 400);\r\n\r\n    const team = await prisma.team.findUnique({\r\n      where: { id },\r\n      include: {\r\n        members: { select: { id: true, role: true, user: { select: { id: true, name: true, email: true } } } },\r\n        manager: { select: { id: true, name: true, email: true } },\r\n        organization: { select: { id: true, name: true } },\r\n      },\r\n    });\r\n\r\n    if (!team) return jsonError(\"Team not found\", 404);\r\n\r\n    // normalize\r\n    const resp = {\r\n      id: team.id,\r\n      name: team.name,\r\n      description: team.description,\r\n      managerId: team.managerId ?? null,\r\n      managerName: team.manager?.name ?? null,\r\n      featured: (team as any).featured ?? false,\r\n      gradient: (team as any).gradient ?? \"from-blue-500 to-cyan-500\",\r\n      projects: (team as any).projects ?? 0,\r\n      completion: (team as any).completion ?? 0,\r\n      members: (team.members || []).map((m: any) => ({\r\n        userId: m.user?.id,\r\n        name: m.user?.name,\r\n        email: m.user?.email,\r\n        role: m.role,\r\n      })),\r\n      organizationId: team.organizationId,\r\n      organizationName: team.organization?.name ?? null,\r\n      createdAt: team.createdAt,\r\n      updatedAt: team.updatedAt,\r\n    };\r\n\r\n    return NextResponse.json({ ok: true, team: resp }, { status: 200 });\r\n  } catch (err: any) {\r\n    console.error(\"[api/teams][id][GET] error:\", err);\r\n    const isDev = process.env.NODE_ENV !== \"production\";\r\n    return NextResponse.json(\r\n      { ok: false, message: isDev ? (err?.message || String(err)) : \"Server error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function PUT(req: Request, { params }: { params: { id?: string } }) {\r\n  try {\r\n    const id = params?.id;\r\n    if (!isValidId(id)) return jsonError(\"Missing team id\", 400);\r\n\r\n    let body: any = {};\r\n    try {\r\n      body = (await req.json()) || {};\r\n    } catch {\r\n      body = {};\r\n    }\r\n\r\n    const {\r\n      name,\r\n      description,\r\n      managerId,\r\n      featured,\r\n      gradient,\r\n      projects,\r\n      completion,\r\n      memberUserIds, // array to fully sync\r\n    } = body;\r\n\r\n    // update in transaction: update team, sync members\r\n    const updated = await prisma.$transaction(async (tx) => {\r\n      const existing = await tx.team.findUnique({ where: { id } });\r\n      if (!existing) throw { code: \"TEAM_NOT_FOUND\" };\r\n\r\n      const data: any = {};\r\n      if (name !== undefined) data.name = String(name).trim();\r\n      if (description !== undefined) data.description = description === null ? null : String(description);\r\n      if (managerId !== undefined) data.managerId = managerId === null ? null : String(managerId);\r\n      if (featured !== undefined) data.featured = !!featured;\r\n      if (gradient !== undefined) data.gradient = String(gradient);\r\n      if (projects !== undefined) data.projects = Number(projects ?? 0);\r\n      if (completion !== undefined) data.completion = Number(completion ?? 0);\r\n\r\n      await tx.team.update({ where: { id }, data });\r\n\r\n      if (Array.isArray(memberUserIds)) {\r\n        const sanitized = memberUserIds.map((u: any) => String(u)).filter(Boolean);\r\n        // delete members not in sanitized\r\n        await tx.teamMember.deleteMany({\r\n          where: { teamId: id, userId: { notIn: sanitized.length ? sanitized : [\"__none__\"] } },\r\n        });\r\n        // create missing members\r\n        const existingMembers = await tx.teamMember.findMany({ where: { teamId: id }, select: { userId: true } });\r\n        const existingUserIds = new Set(existingMembers.map((m) => String(m.userId)));\r\n        const toCreate = sanitized.filter((u: any) => !existingUserIds.has(String(u))).map((userId: string) => ({\r\n          teamId: id,\r\n          userId,\r\n          role: \"EMPLOYEE\",\r\n        }));\r\n        if (toCreate.length > 0) await tx.teamMember.createMany({ data: toCreate, skipDuplicates: true });\r\n      }\r\n\r\n      const t = await tx.team.findUnique({\r\n        where: { id },\r\n        include: {\r\n          members: { select: { id: true, role: true, user: { select: { id: true, name: true, email: true } } } },\r\n          manager: { select: { id: true, name: true, email: true } },\r\n        },\r\n      });\r\n\r\n      return t;\r\n    });\r\n\r\n    return NextResponse.json({ ok: true, team: updated }, { status: 200 });\r\n  } catch (err: any) {\r\n    if (err && typeof err === \"object\" && \"code\" in err) {\r\n      if (err.code === \"TEAM_NOT_FOUND\") return jsonError(\"Team not found\", 404);\r\n    }\r\n    console.error(\"[api/teams][id][PUT] error:\", err);\r\n    const isDev = process.env.NODE_ENV !== \"production\";\r\n    return NextResponse.json(\r\n      { ok: false, message: isDev ? (err?.message || String(err)) : \"Server error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function DELETE(req: Request, { params }: { params: { id?: string } }) {\r\n  try {\r\n    const id = params?.id;\r\n    if (!isValidId(id)) return jsonError(\"Missing team id\", 400);\r\n\r\n    const result = await prisma.$transaction(async (tx) => {\r\n      const existing = await tx.team.findUnique({ where: { id } });\r\n      if (!existing) throw { code: \"TEAM_NOT_FOUND\" };\r\n\r\n      // delete team members\r\n      await tx.teamMember.deleteMany({ where: { teamId: id } });\r\n\r\n      // optionally delete related resources: threads, tasks, invites (uncomment if desired)\r\n      // await tx.thread.deleteMany({ where: { teamId: id } });\r\n      // await tx.task.deleteMany({ where: { teamId: id } });\r\n      // await tx.invite.deleteMany({ where: { teamId: id } });\r\n\r\n      // delete team itself\r\n      await tx.team.delete({ where: { id } });\r\n\r\n      return { deletedId: id };\r\n    });\r\n\r\n    return NextResponse.json({ ok: true, ...result }, { status: 200 });\r\n  } catch (err: any) {\r\n    if (err && typeof err === \"object\" && \"code\" in err) {\r\n      if (err.code === \"TEAM_NOT_FOUND\") return jsonError(\"Team not found\", 404);\r\n    }\r\n    console.error(\"[api/teams][id][DELETE] error:\", err);\r\n    const isDev = process.env.NODE_ENV !== \"production\";\r\n    return NextResponse.json(\r\n      { ok: false, message: isDev ? (err?.message || String(err)) : \"Server error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}