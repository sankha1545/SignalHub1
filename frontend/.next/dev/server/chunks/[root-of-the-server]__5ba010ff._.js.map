{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/socket.ts"],"sourcesContent":["// src/lib/socket.ts\r\n// Small helper to call the socket server's /emit endpoint from backend code.\r\n// Usage:\r\n//   import { emitToRooms } from \"@/lib/socket\";\r\n//   await emitToRooms({ event: \"chat:created\", rooms: [\"user:123\",\"org:abc\"], payload: {...} });\r\n\r\nimport fetch from \"node-fetch\";\r\n\r\nconst SOCKET_SERVER_URL = process.env.SOCKET_SERVER_URL || process.env.NEXT_PUBLIC_SOCKET_URL || \"http://localhost:4001\";\r\nconst SOCKET_SERVER_KEY = process.env.SOCKET_SERVER_KEY || \"\";\r\n\r\ntype EmitArgs = {\r\n  event: string;\r\n  payload?: any;\r\n  rooms?: string[] | string;\r\n  excludeSocketId?: string;\r\n  timeoutMs?: number;\r\n};\r\n\r\nexport async function emitToRooms({ event, payload = {}, rooms, excludeSocketId, timeoutMs = 2000 }: EmitArgs) {\r\n  if (!SOCKET_SERVER_URL) return { ok: false, error: \"no socket server url\" };\r\n  if (!SOCKET_SERVER_KEY) {\r\n    // still allow if no key supplied (not recommended for prod)\r\n    console.warn(\"socket: no SOCKET_SERVER_KEY configured ‚Äî /emit endpoint not protected\");\r\n  }\r\n\r\n  const url = new URL(\"/emit\", SOCKET_SERVER_URL).toString();\r\n  const body = {\r\n    key: SOCKET_SERVER_KEY,\r\n    rooms,\r\n    event,\r\n    payload,\r\n    excludeSocketId,\r\n  };\r\n\r\n  try {\r\n    const controller = new AbortController();\r\n    const id = setTimeout(() => controller.abort(), timeoutMs);\r\n    const resp = await fetch(url, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(body),\r\n      signal: controller.signal,\r\n    });\r\n    clearTimeout(id);\r\n    if (!resp.ok) {\r\n      const text = await resp.text().catch(() => \"\");\r\n      return { ok: false, status: resp.status, body: text };\r\n    }\r\n    const json = await resp.json().catch(() => ({}));\r\n    return { ok: true, result: json };\r\n  } catch (err: any) {\r\n    return { ok: false, error: String(err?.message ?? err) };\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,oBAAoB;AACpB,6EAA6E;AAC7E,SAAS;AACT,gDAAgD;AAChD,iGAAiG;;;;;AAEjG;;AAEA,MAAM,oBAAoB,QAAQ,GAAG,CAAC,iBAAiB,IAAI,QAAQ,GAAG,CAAC,sBAAsB,IAAI;AACjG,MAAM,oBAAoB,QAAQ,GAAG,CAAC,iBAAiB,IAAI;AAUpD,eAAe,YAAY,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC,EAAE,KAAK,EAAE,eAAe,EAAE,YAAY,IAAI,EAAY;IAC3G;;IACA,IAAI,CAAC,mBAAmB;QACtB,4DAA4D;QAC5D,QAAQ,IAAI,CAAC;IACf;IAEA,MAAM,MAAM,IAAI,IAAI,SAAS,mBAAmB,QAAQ;IACxD,MAAM,OAAO;QACX,KAAK;QACL;QACA;QACA;QACA;IACF;IAEA,IAAI;QACF,MAAM,aAAa,IAAI;QACvB,MAAM,KAAK,WAAW,IAAM,WAAW,KAAK,IAAI;QAChD,MAAM,OAAO,MAAM,IAAA,0KAAK,EAAC,KAAK;YAC5B,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;YACrB,QAAQ,WAAW,MAAM;QAC3B;QACA,aAAa;QACb,IAAI,CAAC,KAAK,EAAE,EAAE;YACZ,MAAM,OAAO,MAAM,KAAK,IAAI,GAAG,KAAK,CAAC,IAAM;YAC3C,OAAO;gBAAE,IAAI;gBAAO,QAAQ,KAAK,MAAM;gBAAE,MAAM;YAAK;QACtD;QACA,MAAM,OAAO,MAAM,KAAK,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC9C,OAAO;YAAE,IAAI;YAAM,QAAQ;QAAK;IAClC,EAAE,OAAO,KAAU;QACjB,OAAO;YAAE,IAAI;YAAO,OAAO,OAAO,KAAK,WAAW;QAAK;IACzD;AACF","debugId":null}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/socketAdapter.ts"],"sourcesContent":["// src/lib/socketAdapter.ts\r\n// Adapter to forward legacy `global.io` / `global._io` / `global.socketServer`\r\n// calls to the standalone socket server via the /emit HTTP endpoint.\r\n\r\nimport { emitToRooms } from \"@/lib/socket\";\r\n\r\ntype EmitFn = (event: string, payload?: any) => Promise<void> | void;\r\n\r\nfunction makeRoomEmitter(room: string | string[]) {\r\n  return {\r\n    emit: (event: string, payload?: any) => {\r\n      return emitToRooms({ event, payload, rooms: room });\r\n    },\r\n    // allow io.to(room).except(socketId).emit(...) pattern\r\n    except: (socketId: string) => ({\r\n      emit: (event: string, payload?: any) => {\r\n        return emitToRooms({ event, payload, rooms: room, excludeSocketId: socketId });\r\n      },\r\n    }),\r\n  };\r\n}\r\n\r\n// Single shared adapter instance\r\nconst adapter = {\r\n  /**\r\n   * io.emit(\"event\", payload)\r\n   *  -> broadcast globally\r\n   */\r\n  emit: ((event: string, payload?: any) => {\r\n    return emitToRooms({ event, payload });\r\n  }) as EmitFn,\r\n\r\n  /**\r\n   * io.to(\"room\").emit(\"event\", payload)\r\n   *  -> broadcast to specific room(s)\r\n   */\r\n  to: (room: string | string[]) => makeRoomEmitter(room),\r\n};\r\n\r\n// Attach to global only once\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var __socketAdapterInitialized: boolean | undefined;\r\n}\r\n\r\nfunction attachGlobals() {\r\n  if (global.__socketAdapterInitialized) return;\r\n  global.__socketAdapterInitialized = true;\r\n\r\n  // These are the names used in your API code:\r\n  // (global as any).io || (global as any)._io || (global as any).socketServer\r\n  const g: any = global;\r\n\r\n  if (!g.io) g.io = adapter;\r\n  if (!g._io) g._io = adapter;\r\n  if (!g.socketServer) g.socketServer = adapter;\r\n}\r\n\r\n// Run immediately on import (server-only)\r\nattachGlobals();\r\n\r\nexport { adapter as socketAdapter };\r\n"],"names":[],"mappings":"AAAA,2BAA2B;AAC3B,+EAA+E;AAC/E,qEAAqE;;;;;AAErE;;AAIA,SAAS,gBAAgB,IAAuB;IAC9C,OAAO;QACL,MAAM,CAAC,OAAe;YACpB,OAAO,IAAA,qIAAW,EAAC;gBAAE;gBAAO;gBAAS,OAAO;YAAK;QACnD;QACA,uDAAuD;QACvD,QAAQ,CAAC,WAAqB,CAAC;gBAC7B,MAAM,CAAC,OAAe;oBACpB,OAAO,IAAA,qIAAW,EAAC;wBAAE;wBAAO;wBAAS,OAAO;wBAAM,iBAAiB;oBAAS;gBAC9E;YACF,CAAC;IACH;AACF;AAEA,iCAAiC;AACjC,MAAM,UAAU;IACd;;;GAGC,GACD,MAAO,CAAC,OAAe;QACrB,OAAO,IAAA,qIAAW,EAAC;YAAE;YAAO;QAAQ;IACtC;IAEA;;;GAGC,GACD,IAAI,CAAC,OAA4B,gBAAgB;AACnD;AAQA,SAAS;IACP,IAAI,OAAO,0BAA0B,EAAE;IACvC,OAAO,0BAA0B,GAAG;IAEpC,6CAA6C;IAC7C,4EAA4E;IAC5E,MAAM,IAAS;IAEf,IAAI,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG;IAClB,IAAI,CAAC,EAAE,GAAG,EAAE,EAAE,GAAG,GAAG;IACpB,IAAI,CAAC,EAAE,YAAY,EAAE,EAAE,YAAY,GAAG;AACxC;AAEA,0CAA0C;AAC1C","debugId":null}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\r\nimport { PrismaClient } from \"@prisma/client\";\r\n// near the top, before exports\r\nimport \"@/lib/socketAdapter\";\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line\r\n  var __prisma__: PrismaClient | undefined;\r\n}\r\nexport const prisma =\r\n  global.__prisma__ ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"warn\", \"error\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.__prisma__ = prisma;\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;AACA,+BAA+B;AAC/B;;;AAMO,MAAM,SACX,OAAO,UAAU,IACjB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAQ;KAAQ,GAAG;AAC7E;AAEF,wCAA2C,OAAO,UAAU,GAAG","debugId":null}},
    {"offset": {"line": 304, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/jwt.ts"],"sourcesContent":["// src/lib/jwt.ts\r\nimport jwt, { JwtPayload } from \"jsonwebtoken\";\r\n\r\nconst SECRET = process.env.JWT_SECRET;\r\nif (!SECRET) {\r\n  if (process.env.NODE_ENV === \"production\") {\r\n    throw new Error(\"JWT_SECRET environment variable must be set in production!\");\r\n  } else {\r\n    console.warn(\"[JWT] Using fallback secret for development\");\r\n  }\r\n}\r\n\r\n/**\r\n * üîê Create a short-lived temp token (email/phone verification)\r\n */\r\nexport function signTemp(payload: Record<string, any>, expiresIn: string = \"15m\"): string {\r\n  const safePayload = { ...payload };\r\n  delete safePayload.exp;\r\n  return jwt.sign(safePayload, SECRET!, { expiresIn });\r\n}\r\n\r\n/**\r\n * ‚úÖ Verify short-lived temp tokens\r\n * Returns payload object or null if invalid/expired\r\n */\r\nexport function verifyTemp(token: string): Record<string, any> | null {\r\n  try {\r\n    return jwt.verify(token, SECRET!) as Record<string, any>;\r\n  } catch (err) {\r\n    console.warn(\"[JWT] verifyTemp failed:\", (err as Error).message);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * üíæ Create a long-lived session token for logged-in users\r\n */\r\nexport function signSession(payload: Record<string, any>, expiresIn: string = \"7d\"): string {\r\n  const safePayload = { ...payload };\r\n  delete safePayload.exp;\r\n  return jwt.sign(safePayload, SECRET!, { expiresIn });\r\n}\r\n\r\n/**\r\n * üîé Verify a session token\r\n * Returns payload object or null if invalid/expired\r\n */\r\nexport function verifySession(token: string): Record<string, any> | null {\r\n  try {\r\n    return jwt.verify(token, SECRET!) as Record<string, any>;\r\n  } catch (err) {\r\n    console.warn(\"[JWT] verifySession failed:\", (err as Error).message);\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,iBAAiB;;;;;;;;;;;AACjB;;AAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;AACrC,IAAI,CAAC,QAAQ;IACX;;SAEO;QACL,QAAQ,IAAI,CAAC;IACf;AACF;AAKO,SAAS,SAAS,OAA4B,EAAE,YAAoB,KAAK;IAC9E,MAAM,cAAc;QAAE,GAAG,OAAO;IAAC;IACjC,OAAO,YAAY,GAAG;IACtB,OAAO,kJAAG,CAAC,IAAI,CAAC,aAAa,QAAS;QAAE;IAAU;AACpD;AAMO,SAAS,WAAW,KAAa;IACtC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,QAAQ,IAAI,CAAC,4BAA4B,AAAC,IAAc,OAAO;QAC/D,OAAO;IACT;AACF;AAKO,SAAS,YAAY,OAA4B,EAAE,YAAoB,IAAI;IAChF,MAAM,cAAc;QAAE,GAAG,OAAO;IAAC;IACjC,OAAO,YAAY,GAAG;IACtB,OAAO,kJAAG,CAAC,IAAI,CAAC,aAAa,QAAS;QAAE;IAAU;AACpD;AAMO,SAAS,cAAc,KAAa;IACzC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,QAAQ,IAAI,CAAC,+BAA+B,AAAC,IAAc,OAAO;QAClE,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 363, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/auth.ts"],"sourcesContent":["// src/lib/auth.ts\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { verifySession } from \"@/lib/jwt\";\r\n\r\nexport type SessionUser = {\r\n  id: string;\r\n  email?: string | null;\r\n  role: string;\r\n  organizationId?: string | null;\r\n};\r\n\r\nexport async function getSessionUser(req: Request): Promise<SessionUser | null> {\r\n  try {\r\n    // 1Ô∏è‚É£ Prefer Authorization header: \"Bearer <token>\"\r\n    let token: string | null = null;\r\n    const authHeader = req.headers.get(\"authorization\");\r\n    if (authHeader?.startsWith(\"Bearer \")) {\r\n      token = authHeader.slice(\"Bearer \".length).trim();\r\n    }\r\n\r\n    // 2Ô∏è‚É£ Fallback to cookies\r\n    if (!token) {\r\n      const cookieHeader = req.headers.get(\"cookie\") || \"\";\r\n      const cookies: Record<string, string> = Object.fromEntries(\r\n        cookieHeader\r\n          .split(\";\")\r\n          .map(c => c.trim().split(\"=\"))\r\n          .map(([k, v]) => [decodeURIComponent(k), decodeURIComponent(v)])\r\n      );\r\n      token = cookies[\"session\"] || cookies[\"token\"] || null;\r\n    }\r\n\r\n    if (!token) return null;\r\n\r\n    // 3Ô∏è‚É£ Verify token safely\r\n    const payload = verifySession(token);\r\n    if (!payload?.id) return null;\r\n\r\n    // 4Ô∏è‚É£ Fetch user from DB\r\n    const user = await prisma.user.findUnique({ where: { id: payload.id } });\r\n    if (!user) return null;\r\n\r\n    return {\r\n      id: user.id,\r\n      email: user.email ?? null,\r\n      role: user.role,\r\n      organizationId: user.organizationId,\r\n    };\r\n  } catch (err: any) {\r\n    console.warn(\"[getSessionUser] error:\", err?.message || err);\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,kBAAkB;;;;;AAClB;AACA;;;AASO,eAAe,eAAe,GAAY;IAC/C,IAAI;QACF,oDAAoD;QACpD,IAAI,QAAuB;QAC3B,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;QACnC,IAAI,YAAY,WAAW,YAAY;YACrC,QAAQ,WAAW,KAAK,CAAC,UAAU,MAAM,EAAE,IAAI;QACjD;QAEA,0BAA0B;QAC1B,IAAI,CAAC,OAAO;YACV,MAAM,eAAe,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;YAClD,MAAM,UAAkC,OAAO,WAAW,CACxD,aACG,KAAK,CAAC,KACN,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,GAAG,KAAK,CAAC,MACxB,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAK;oBAAC,mBAAmB;oBAAI,mBAAmB;iBAAG;YAEnE,QAAQ,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,QAAQ,IAAI;QACpD;QAEA,IAAI,CAAC,OAAO,OAAO;QAEnB,0BAA0B;QAC1B,MAAM,UAAU,IAAA,oIAAa,EAAC;QAC9B,IAAI,CAAC,SAAS,IAAI,OAAO;QAEzB,yBAAyB;QACzB,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,IAAI,QAAQ,EAAE;YAAC;QAAE;QACtE,IAAI,CAAC,MAAM,OAAO;QAElB,OAAO;YACL,IAAI,KAAK,EAAE;YACX,OAAO,KAAK,KAAK,IAAI;YACrB,MAAM,KAAK,IAAI;YACf,gBAAgB,KAAK,cAAc;QACrC;IACF,EAAE,OAAO,KAAU;QACjB,QAAQ,IAAI,CAAC,2BAA2B,KAAK,WAAW;QACxD,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 415, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/api/me/route.ts"],"sourcesContent":["// src/app/api/me/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { getSessionUser } from \"@/lib/auth\";\r\nimport { cookies } from \"next/headers\";\r\nimport jwt from \"jsonwebtoken\";\r\n\r\n/**\r\n * GET /api/me\r\n * PATCH /api/me\r\n *\r\n * - Resolve session using getSessionUser, Bearer JWT, or cookie fallback.\r\n * - GET returns user + organization + teams (manager + member roles).\r\n * - PATCH upserts profile, disallows changing email via this endpoint.\r\n */\r\n\r\nconst COOKIE_NAME = \"session\";\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"\";\r\n\r\n/* -------------------------------------------------------\r\n   Helpers\r\n------------------------------------------------------- */\r\n\r\n/** Safe JSON parse for request bodies */\r\nasync function jsonSafe(req: Request) {\r\n  try {\r\n    return await req.json();\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/** Resolve session user with multiple fallbacks */\r\nasync function resolveSessionUser(req: Request) {\r\n  try {\r\n    // 1) next-auth helper\r\n    try {\r\n      const s = await getSessionUser(req);\r\n      if (s && s.id) return s;\r\n    } catch (err) {\r\n      console.warn(\"[resolveSessionUser] getSessionUser failed:\", err);\r\n    }\r\n\r\n    // 2) Authorization: Bearer <token>\r\n    try {\r\n      const headerAuth = (req.headers.get(\"authorization\") ??\r\n        req.headers.get(\"Authorization\")) as string | null;\r\n\r\n      if (headerAuth?.toLowerCase().startsWith(\"bearer \")) {\r\n        const token = headerAuth.slice(7).trim();\r\n        if (JWT_SECRET && token) {\r\n          const payload = jwt.verify(token, JWT_SECRET) as any;\r\n          if (payload?.id) {\r\n            return {\r\n              id: payload.id,\r\n              name: payload.name ?? null,\r\n              email: payload.email ?? null,\r\n              role: payload.role ?? null,\r\n              organizationId: payload.organizationId ?? null,\r\n            };\r\n          }\r\n        } else {\r\n          console.warn(\r\n            \"[resolveSessionUser] Bearer token present but JWT_SECRET missing or token empty\"\r\n          );\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.warn(\r\n        \"[resolveSessionUser] bearer token verification failed:\",\r\n        err\r\n      );\r\n    }\r\n\r\n    // 3) cookie fallback (server-side)\r\n    try {\r\n      const cookieStore = await cookies();\r\n      const token = cookieStore.get(COOKIE_NAME)?.value;\r\n      if (token && JWT_SECRET) {\r\n        const payload = jwt.verify(token, JWT_SECRET) as any;\r\n        if (payload?.id) {\r\n          return {\r\n            id: payload.id,\r\n            name: payload.name ?? null,\r\n            email: payload.email ?? null,\r\n            role: payload.role ?? null,\r\n            organizationId: payload.organizationId ?? null,\r\n          };\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.warn(\r\n        \"[resolveSessionUser] cookie token verification failed:\",\r\n        err\r\n      );\r\n    }\r\n\r\n    return null;\r\n  } catch (err) {\r\n    console.error(\"[resolveSessionUser] unexpected error:\", err);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Build teams array for the user.\r\n * - includes teams where user is manager\r\n * - includes teams where user is member via teamMember\r\n * - de-duplicates preferring MANAGER when both apply\r\n */\r\nasync function fetchUserTeams(userId: string) {\r\n  try {\r\n    if (!prisma || typeof prisma !== \"object\") return [];\r\n\r\n    // 1) teams where user is manager\r\n    const managedTeamsPromise = (async () => {\r\n      try {\r\n        return await prisma.team.findMany({\r\n          where: { managerId: userId },\r\n          select: {\r\n            id: true,\r\n            name: true,\r\n            description: true,\r\n            organizationId: true,\r\n            managerId: true,\r\n            createdAt: true,\r\n          },\r\n        });\r\n      } catch (e) {\r\n        console.warn(\"[fetchUserTeams] managed teams lookup failed:\", e);\r\n        return [];\r\n      }\r\n    })();\r\n\r\n    // 2) teams where user is a teamMember\r\n    const memberTeamsPromise = (async () => {\r\n      try {\r\n        const memberRows = await prisma.teamMember.findMany({\r\n          where: { userId },\r\n          select: {\r\n            id: true,\r\n            role: true,\r\n            joinedAt: true,\r\n            team: {\r\n              select: {\r\n                id: true,\r\n                name: true,\r\n                description: true,\r\n                organizationId: true,\r\n                managerId: true,\r\n                createdAt: true,\r\n              },\r\n            },\r\n          },\r\n        });\r\n\r\n        return memberRows\r\n          .filter((r) => r.team)\r\n          .map((r) => ({\r\n            id: r.team.id,\r\n            teamId: r.team.id,\r\n            name: r.team.name,\r\n            description: r.team.description ?? null,\r\n            organizationId: r.team.organizationId ?? null,\r\n            managerId: r.team.managerId ?? null,\r\n            createdAt: r.team.createdAt?.toISOString?.() ?? null,\r\n            memberRole: r.role ?? null,\r\n          }));\r\n      } catch (e) {\r\n        console.warn(\"[fetchUserTeams] teamMember lookup failed:\", e);\r\n        return [];\r\n      }\r\n    })();\r\n\r\n    const [managedTeams, memberTeams] = await Promise.all([\r\n      managedTeamsPromise,\r\n      memberTeamsPromise,\r\n    ]);\r\n\r\n    // Deduplicate preferring MANAGER\r\n    const map = new Map<string, any>();\r\n\r\n    for (const t of memberTeams) {\r\n      map.set(t.id, {\r\n        id: t.id,\r\n        name: t.name,\r\n        description: t.description ?? null,\r\n        organizationId: t.organizationId ?? null,\r\n        managerId: t.managerId ?? null,\r\n        role: t.memberRole ?? \"EMPLOYEE\",\r\n        createdAt: t.createdAt ?? null,\r\n      });\r\n    }\r\n\r\n    for (const t of managedTeams) {\r\n      map.set(t.id, {\r\n        id: t.id,\r\n        name: t.name,\r\n        description: (t as any).description ?? null,\r\n        organizationId: (t as any).organizationId ?? null,\r\n        managerId: (t as any).managerId ?? null,\r\n        role: \"MANAGER\",\r\n        createdAt: t.createdAt?.toISOString?.() ?? null,\r\n      });\r\n    }\r\n\r\n    const teams = Array.from(map.values()).sort((a, b) => {\r\n      const at = a.createdAt ? Date.parse(a.createdAt) : 0;\r\n      const bt = b.createdAt ? Date.parse(b.createdAt) : 0;\r\n      return bt - at;\r\n    });\r\n\r\n    return teams;\r\n  } catch (err) {\r\n    console.warn(\"[fetchUserTeams] unexpected error:\", err);\r\n    return [];\r\n  }\r\n}\r\n\r\n/* -------------------------------------------------------\r\n   GET /api/me\r\n------------------------------------------------------- */\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const sessionUser = await resolveSessionUser(req);\r\n    if (!sessionUser) {\r\n      return NextResponse.json(\r\n        { ok: false, user: null, teams: [], error: \"Unauthorized\" },\r\n        { status: 401, headers: { \"Cache-Control\": \"no-store\" } }\r\n      );\r\n    }\r\n\r\n    const userId = String(sessionUser.id);\r\n\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: userId },\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        email: true,\r\n        phone: true,\r\n        role: true,\r\n        createdAt: true,\r\n        updatedAt: true,\r\n        profile: true,\r\n        organization: { select: { id: true, name: true } },\r\n      },\r\n    });\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { ok: false, user: null, teams: [], error: \"User not found\" },\r\n        { status: 404, headers: { \"Cache-Control\": \"no-store\" } }\r\n      );\r\n    }\r\n\r\n    const teams = await fetchUserTeams(userId);\r\n\r\n    const responseUser = {\r\n      ...user,\r\n      organization: user.organization ?? null,\r\n    };\r\n\r\n    return NextResponse.json(\r\n      { ok: true, user: responseUser, teams },\r\n      { status: 200, headers: { \"Cache-Control\": \"no-store\" } }\r\n    );\r\n  } catch (err) {\r\n    console.error(\"GET /api/me error:\", err);\r\n    return NextResponse.json(\r\n      {\r\n        ok: false,\r\n        user: null,\r\n        teams: [],\r\n        error: \"Internal server error\",\r\n      },\r\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } }\r\n    );\r\n  }\r\n}\r\n\r\n/* -------------------------------------------------------\r\n   PATCH /api/me\r\n------------------------------------------------------- */\r\nexport async function PATCH(req: Request) {\r\n  try {\r\n    const sessionUser = await resolveSessionUser(req);\r\n    if (!sessionUser) {\r\n      return NextResponse.json(\r\n        { ok: false, error: \"Unauthorized\" },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const body = await jsonSafe(req);\r\n    console.info(\r\n      \"PATCH /api/me payload keys:\",\r\n      typeof body === \"object\" ? Object.keys(body) : typeof body\r\n    );\r\n\r\n    // Email cannot be changed here\r\n    if (typeof body.email === \"string\" && body.email.trim().length > 0) {\r\n      return NextResponse.json(\r\n        { ok: false, error: \"Email cannot be changed via this endpoint\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const name = typeof body.name === \"string\" ? body.name.trim() : undefined;\r\n    const phone = typeof body.phone === \"string\" ? body.phone.trim() : undefined;\r\n    const incomingProfile =\r\n      body.profile && typeof body.profile === \"object\" ? body.profile : {};\r\n\r\n    if (!name || name.length === 0) {\r\n      return NextResponse.json(\r\n        { ok: false, error: \"Name is required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    if (name.length > 200) {\r\n      return NextResponse.json(\r\n        { ok: false, error: \"Name too long\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    if (phone && phone.length > 40) {\r\n      return NextResponse.json(\r\n        { ok: false, error: \"Phone too long\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const profileUpdates: any = {\r\n      displayName:\r\n        typeof incomingProfile.displayName === \"string\"\r\n          ? incomingProfile.displayName.trim()\r\n          : undefined,\r\n      avatarUrl:\r\n        typeof incomingProfile.avatarUrl === \"string\"\r\n          ? incomingProfile.avatarUrl.trim()\r\n          : undefined,\r\n      bio:\r\n        typeof incomingProfile.bio === \"string\"\r\n          ? incomingProfile.bio.trim()\r\n          : undefined,\r\n      phoneNumber:\r\n        typeof incomingProfile.phoneNumber === \"string\"\r\n          ? incomingProfile.phoneNumber.trim()\r\n          : phone ?? undefined,\r\n    };\r\n\r\n    const metadata: Record<string, any> = {};\r\n    if (typeof incomingProfile.country === \"string\") {\r\n      metadata.country = incomingProfile.country.trim();\r\n    }\r\n    if (typeof incomingProfile.region === \"string\") {\r\n      metadata.region = incomingProfile.region.trim();\r\n    }\r\n    if (typeof incomingProfile.district === \"string\") {\r\n      metadata.district = incomingProfile.district.trim();\r\n    }\r\n    if (typeof incomingProfile.postalCode === \"string\") {\r\n      metadata.postalCode = incomingProfile.postalCode.trim();\r\n    }\r\n    if (typeof incomingProfile.language === \"string\") {\r\n      metadata.language = incomingProfile.language.trim();\r\n    }\r\n\r\n    let existingMetadata: Record<string, any> = {};\r\n    try {\r\n      const existingProfileRow = await prisma.profile.findUnique({\r\n        where: { userId: sessionUser.id },\r\n        select: { metadata: true },\r\n      });\r\n      existingMetadata = (existingProfileRow?.metadata as any) ?? {};\r\n    } catch (err) {\r\n      console.warn(\r\n        \"[PATCH /api/me] could not read existing profile metadata:\",\r\n        err\r\n      );\r\n      existingMetadata = {};\r\n    }\r\n\r\n    const mergedMetadata = { ...existingMetadata, ...metadata };\r\n\r\n    const dataToUpdate: any = {\r\n      name,\r\n      ...(phone !== undefined ? { phone } : {}),\r\n      profile: {\r\n        upsert: {\r\n          create: {\r\n            displayName: profileUpdates.displayName ?? null,\r\n            avatarUrl: profileUpdates.avatarUrl ?? null,\r\n            bio: profileUpdates.bio ?? null,\r\n            phoneNumber: profileUpdates.phoneNumber ?? null,\r\n            metadata: mergedMetadata,\r\n          },\r\n          update: {\r\n            ...(profileUpdates.displayName !== undefined\r\n              ? { displayName: profileUpdates.displayName }\r\n              : {}),\r\n            ...(profileUpdates.avatarUrl !== undefined\r\n              ? { avatarUrl: profileUpdates.avatarUrl }\r\n              : {}),\r\n            ...(profileUpdates.bio !== undefined\r\n              ? { bio: profileUpdates.bio }\r\n              : {}),\r\n            ...(profileUpdates.phoneNumber !== undefined\r\n              ? { phoneNumber: profileUpdates.phoneNumber }\r\n              : {}),\r\n            metadata: mergedMetadata,\r\n          },\r\n        },\r\n      },\r\n    };\r\n\r\n    const updatedUser = await prisma.user.update({\r\n      where: { id: sessionUser.id },\r\n      data: dataToUpdate,\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        email: true,\r\n        phone: true,\r\n        role: true,\r\n        createdAt: true,\r\n        updatedAt: true,\r\n        profile: true,\r\n        organization: { select: { id: true, name: true } },\r\n      },\r\n    });\r\n\r\n    console.info(\"PATCH /api/me updated user id:\", updatedUser.id);\r\n    return NextResponse.json({ ok: true, user: updatedUser }, { status: 200 });\r\n  } catch (err: any) {\r\n    console.error(\r\n      \"PATCH /api/me error:\",\r\n      err?.message ?? err,\r\n      err?.stack ?? \"\"\r\n    );\r\n    if (err?.code) {\r\n      console.error(\r\n        \"Prisma error code:\",\r\n        err.code,\r\n        \"meta:\",\r\n        err.meta ?? null\r\n      );\r\n    }\r\n    return NextResponse.json(\r\n      { ok: false, error: \"Internal server error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}