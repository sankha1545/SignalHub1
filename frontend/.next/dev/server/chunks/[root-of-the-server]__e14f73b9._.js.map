{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/crypto.ts"],"sourcesContent":["// lib/crypto.ts\r\nimport crypto from \"crypto\";\r\nimport bcrypt from \"bcrypt\";\r\n\r\nexport function genRandomToken(bytes = 32) {\r\n  return crypto.randomBytes(bytes).toString(\"hex\");\r\n}\r\n\r\nexport async function hashToken(token: string) {\r\n  const saltRounds = 10;\r\n  return bcrypt.hash(token, saltRounds);\r\n}\r\n\r\nexport async function verifyHash(token: string, hash: string) {\r\n  return bcrypt.compare(token, hash);\r\n}\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;;;AAChB;AACA;;;AAEO,SAAS,eAAe,QAAQ,EAAE;IACvC,OAAO,gHAAM,CAAC,WAAW,CAAC,OAAO,QAAQ,CAAC;AAC5C;AAEO,eAAe,UAAU,KAAa;IAC3C,MAAM,aAAa;IACnB,OAAO,gHAAM,CAAC,IAAI,CAAC,OAAO;AAC5B;AAEO,eAAe,WAAW,KAAa,EAAE,IAAY;IAC1D,OAAO,gHAAM,CAAC,OAAO,CAAC,OAAO;AAC/B","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line\r\n  var __prisma__: PrismaClient | undefined;\r\n}\r\nexport const prisma =\r\n  global.__prisma__ ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"warn\", \"error\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.__prisma__ = prisma;\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;;AAMO,MAAM,SACX,OAAO,UAAU,IACjB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAQ;KAAQ,GAAG;AAC7E;AAEF,wCAA2C,OAAO,UAAU,GAAG","debugId":null}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/otp.ts"],"sourcesContent":["// lib/otp.ts\r\nimport { genRandomToken, hashToken, verifyHash } from \"./crypto\";\r\nimport { prisma } from \"./prisma\";\r\n\r\nfunction generate6Digit() {\r\n  return (Math.floor(Math.random() * 900000) + 100000).toString();\r\n}\r\n\r\nexport async function createEmailOtp(email: string) {\r\n  const code = generate6Digit();\r\n  const hash = await hashToken(code);\r\n  const rec = await prisma.emailOtp.create({\r\n    data: { email, otp: hash, verified: false },\r\n  });\r\n  return { id: rec.id, code }; // return raw code for sending\r\n}\r\n\r\nexport async function verifyEmailOtp(email: string, code: string) {\r\n  const rec = await prisma.emailOtp.findFirst({\r\n    where: { email },\r\n    orderBy: { createdAt: \"desc\" },\r\n  });\r\n  if (!rec) return false;\r\n  const ok = await verifyHash(code, rec.otp);\r\n  if (!ok) return false;\r\n  await prisma.emailOtp.update({ where: { id: rec.id }, data: { verified: true } });\r\n  return true;\r\n}\r\n\r\n\r\n// Phone OTP\r\nexport async function createPhoneOtp(phone: string) {\r\n  const code = generate6Digit();\r\n  const hash = await hashToken(code);\r\n  const rec = await prisma.phoneOtp.create({\r\n    data: { phone, otp: hash, used: false, attempts: 0 },\r\n  });\r\n  return { id: rec.id, code };\r\n}\r\n\r\nexport async function verifyPhoneOtp(phone: string, code: string) {\r\n  const rec = await prisma.phoneOtp.findFirst({\r\n    where: { phone },\r\n    orderBy: { createdAt: \"desc\" },\r\n  });\r\n  if (!rec) return { ok: false, reason: \"no-otp\" };\r\n  const ok = await verifyHash(code, rec.otp);\r\n  if (!ok) {\r\n    await prisma.phoneOtp.update({ where: { id: rec.id }, data: { attempts: { increment: 1 } } });\r\n    return { ok: false, reason: \"wrong-code\" };\r\n  }\r\n  await prisma.phoneOtp.update({ where: { id: rec.id }, data: { used: true } });\r\n  return { ok: true };\r\n}\r\n"],"names":[],"mappings":"AAAA,aAAa;;;;;;;;;;;AACb;AACA;;;AAEA,SAAS;IACP,OAAO,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,UAAU,MAAM,EAAE,QAAQ;AAC/D;AAEO,eAAe,eAAe,KAAa;IAChD,MAAM,OAAO;IACb,MAAM,OAAO,MAAM,IAAA,mIAAS,EAAC;IAC7B,MAAM,MAAM,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QACvC,MAAM;YAAE;YAAO,KAAK;YAAM,UAAU;QAAM;IAC5C;IACA,OAAO;QAAE,IAAI,IAAI,EAAE;QAAE;IAAK,GAAG,8BAA8B;AAC7D;AAEO,eAAe,eAAe,KAAa,EAAE,IAAY;IAC9D,MAAM,MAAM,MAAM,gIAAM,CAAC,QAAQ,CAAC,SAAS,CAAC;QAC1C,OAAO;YAAE;QAAM;QACf,SAAS;YAAE,WAAW;QAAO;IAC/B;IACA,IAAI,CAAC,KAAK,OAAO;IACjB,MAAM,KAAK,MAAM,IAAA,oIAAU,EAAC,MAAM,IAAI,GAAG;IACzC,IAAI,CAAC,IAAI,OAAO;IAChB,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QAAE,OAAO;YAAE,IAAI,IAAI,EAAE;QAAC;QAAG,MAAM;YAAE,UAAU;QAAK;IAAE;IAC/E,OAAO;AACT;AAIO,eAAe,eAAe,KAAa;IAChD,MAAM,OAAO;IACb,MAAM,OAAO,MAAM,IAAA,mIAAS,EAAC;IAC7B,MAAM,MAAM,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QACvC,MAAM;YAAE;YAAO,KAAK;YAAM,MAAM;YAAO,UAAU;QAAE;IACrD;IACA,OAAO;QAAE,IAAI,IAAI,EAAE;QAAE;IAAK;AAC5B;AAEO,eAAe,eAAe,KAAa,EAAE,IAAY;IAC9D,MAAM,MAAM,MAAM,gIAAM,CAAC,QAAQ,CAAC,SAAS,CAAC;QAC1C,OAAO;YAAE;QAAM;QACf,SAAS;YAAE,WAAW;QAAO;IAC/B;IACA,IAAI,CAAC,KAAK,OAAO;QAAE,IAAI;QAAO,QAAQ;IAAS;IAC/C,MAAM,KAAK,MAAM,IAAA,oIAAU,EAAC,MAAM,IAAI,GAAG;IACzC,IAAI,CAAC,IAAI;QACP,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;YAAE,OAAO;gBAAE,IAAI,IAAI,EAAE;YAAC;YAAG,MAAM;gBAAE,UAAU;oBAAE,WAAW;gBAAE;YAAE;QAAE;QAC3F,OAAO;YAAE,IAAI;YAAO,QAAQ;QAAa;IAC3C;IACA,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QAAE,OAAO;YAAE,IAAI,IAAI,EAAE;QAAC;QAAG,MAAM;YAAE,MAAM;QAAK;IAAE;IAC3E,OAAO;QAAE,IAAI;IAAK;AACpB","debugId":null}},
    {"offset": {"line": 311, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/lib/mail.ts"],"sourcesContent":["// lib/mail.ts\r\nimport nodemailer from \"nodemailer\";\r\n\r\nconst SMTP_HOST = process.env.SMTP_HOST || \"127.0.0.1\";\r\nconst SMTP_PORT = Number(process.env.SMTP_PORT || 587);\r\nconst SMTP_USER = process.env.SMTP_USER || \"\";\r\nconst SMTP_PASS = process.env.SMTP_PASS || \"\";\r\nconst SMTP_FROM = process.env.SMTP_FROM || \"no-reply@example.com\";\r\n\r\nlet transporter: nodemailer.Transporter | null = null;\r\n\r\nfunction createTransporter() {\r\n  // if no host is configured, return null so we can fallback to console logging\r\n  if (!SMTP_HOST) return null;\r\n\r\n  // prefer IPv4 loopback if host equals 'localhost' (to avoid ::1 resolution issues)\r\n  const host = SMTP_HOST === \"localhost\" ? \"127.0.0.1\" : SMTP_HOST;\r\n\r\n  const opts: any = {\r\n    host,\r\n    port: SMTP_PORT,\r\n    secure: SMTP_PORT === 465, // true for 465, false for other ports\r\n  };\r\n\r\n  if (SMTP_USER) {\r\n    opts.auth = { user: SMTP_USER, pass: SMTP_PASS };\r\n  }\r\n\r\n  // Allow insecure TLS in dev (use cautiously)\r\n  if (process.env.NODE_ENV !== \"production\") {\r\n    opts.tls = { rejectUnauthorized: false };\r\n  }\r\n\r\n  return nodemailer.createTransport(opts);\r\n}\r\n\r\ntransporter = createTransporter();\r\n\r\nexport async function sendEmail(to: string, subject: string, html: string, text?: string) {\r\n  // If transporter not configured, print to console and return a fake info object\r\n  if (!transporter) {\r\n    console.warn(\"[mail] SMTP not configured â€” logging email to console.\");\r\n    console.log(\"=== EMAIL START ===\");\r\n    console.log(\"to:\", to);\r\n    console.log(\"subject:\", subject);\r\n    console.log(\"text:\", text ?? html);\r\n    console.log(\"=== EMAIL END ===\");\r\n    return { logged: true };\r\n  }\r\n\r\n  try {\r\n    const info = await transporter.sendMail({\r\n      from: SMTP_FROM,\r\n      to,\r\n      subject,\r\n      text: text ?? undefined,\r\n      html,\r\n    });\r\n    return info;\r\n  } catch (err) {\r\n    // If sending fails in dev, log the message and error (don't crash app)\r\n    console.error(\"[mail] sendMail failed:\", err);\r\n    if (process.env.NODE_ENV !== \"production\") {\r\n      console.log(\"=== EMAIL (failed) ===\");\r\n      console.log(\"to:\", to);\r\n      console.log(\"subject:\", subject);\r\n      console.log(\"text:\", text ?? html);\r\n      console.log(\"======================\");\r\n      return { error: String(err), logged: true };\r\n    }\r\n    throw err;\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,cAAc;;;;;AACd;;AAEA,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS,IAAI;AAC3C,MAAM,YAAY,OAAO,QAAQ,GAAG,CAAC,SAAS,IAAI;AAClD,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS,IAAI;AAC3C,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS,IAAI;AAC3C,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS,IAAI;AAE3C,IAAI,cAA6C;AAEjD,SAAS;IACP,8EAA8E;IAC9E;;IAEA,mFAAmF;IACnF,MAAM,OAAO,cAAc,cAAc,cAAc;IAEvD,MAAM,OAAY;QAChB;QACA,MAAM;QACN,QAAQ,cAAc;IACxB;IAEA,IAAI,WAAW;QACb,KAAK,IAAI,GAAG;YAAE,MAAM;YAAW,MAAM;QAAU;IACjD;IAEA,6CAA6C;IAC7C,wCAA2C;QACzC,KAAK,GAAG,GAAG;YAAE,oBAAoB;QAAM;IACzC;IAEA,OAAO,4JAAU,CAAC,eAAe,CAAC;AACpC;AAEA,cAAc;AAEP,eAAe,UAAU,EAAU,EAAE,OAAe,EAAE,IAAY,EAAE,IAAa;IACtF,gFAAgF;IAChF,IAAI,CAAC,aAAa;QAChB,QAAQ,IAAI,CAAC;QACb,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,OAAO;QACnB,QAAQ,GAAG,CAAC,YAAY;QACxB,QAAQ,GAAG,CAAC,SAAS,QAAQ;QAC7B,QAAQ,GAAG,CAAC;QACZ,OAAO;YAAE,QAAQ;QAAK;IACxB;IAEA,IAAI;QACF,MAAM,OAAO,MAAM,YAAY,QAAQ,CAAC;YACtC,MAAM;YACN;YACA;YACA,MAAM,QAAQ;YACd;QACF;QACA,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,uEAAuE;QACvE,QAAQ,KAAK,CAAC,2BAA2B;QACzC,wCAA2C;YACzC,QAAQ,GAAG,CAAC;YACZ,QAAQ,GAAG,CAAC,OAAO;YACnB,QAAQ,GAAG,CAAC,YAAY;YACxB,QAAQ,GAAG,CAAC,SAAS,QAAQ;YAC7B,QAAQ,GAAG,CAAC;YACZ,OAAO;gBAAE,OAAO,OAAO;gBAAM,QAAQ;YAAK;QAC5C;;;IAEF;AACF","debugId":null}},
    {"offset": {"line": 394, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/api/auth/email/send/route.ts"],"sourcesContent":["// app/api/auth/email/send/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport { createEmailOtp } from \"@/lib/otp\";\r\nimport { sendEmail } from \"@/lib/mail\";\r\n\r\nexport async function POST(req: Request) {\r\n  const body = await req.json();\r\n  const { email } = body;\r\n  if (!email) return NextResponse.json({ error: \"email_required\" }, { status: 400 });\r\n\r\n  const { id, code } = await createEmailOtp(email);\r\n\r\n  // send OTP email (use simple template)\r\n  await sendEmail(\r\n    email,\r\n    \"Your verification code\",\r\n    `<p>Your verification code is <b>${code}</b>. It expires in 10 minutes.</p>`\r\n  );\r\n\r\n  return NextResponse.json({ ok: true, id });\r\n}\r\n"],"names":[],"mappings":"AAAA,mCAAmC;;;;;AACnC;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,EAAE,KAAK,EAAE,GAAG;IAClB,IAAI,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAiB,GAAG;QAAE,QAAQ;IAAI;IAEhF,MAAM,EAAE,EAAE,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,qIAAc,EAAC;IAE1C,uCAAuC;IACvC,MAAM,IAAA,iIAAS,EACb,OACA,0BACA,CAAC,gCAAgC,EAAE,KAAK,mCAAmC,CAAC;IAG9E,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAM;IAAG;AAC1C","debugId":null}}]
}