{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/api/invites/creates/route.ts"],"sourcesContent":["// src/app/api/invites/creates/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport crypto from \"crypto\";\r\nimport nodemailer from \"nodemailer\";\r\n\r\n\r\nfunction isValidEmail(email: string) {\r\n  return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const body = await req.json();\r\n    const email = (body?.email || \"\").toString().trim().toLowerCase();\r\n    if (!email || !isValidEmail(email)) {\r\n      return NextResponse.json({ message: \"Invalid email\" }, { status: 400 });\r\n    }\r\n\r\n    // create token & expiry (same as before)\r\n    const token = crypto.randomBytes(24).toString(\"hex\");\r\n    const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000);\r\n\r\n    // Build invite link\r\n    const appUrl = process.env.NEXT_PUBLIC_APP_URL || \"http://localhost:3000\";\r\n    const inviteLink = `${appUrl}/auth/invite/accept?token=${token}`;\r\n\r\n    // READ THESE FROM .env.local\r\n    const host = process.env.HMAIL_HOST || \"127.0.0.1\";\r\n    const port = Number(process.env.HMAIL_PORT || 25);\r\n    const secure = (process.env.HMAIL_SECURE === \"true\"); // true for port 465\r\n    const user = process.env.HMAIL_USER || \"\"; // SMTP username (if any)\r\n    const pass = process.env.HMAIL_PASS || \"\"; // SMTP password (if any)\r\n\r\n    console.log(\"SMTP ENV:\", {\r\n  host: process.env.HMAIL_HOST,\r\n  user: process.env.HMAIL_USER,\r\n  pass: !!process.env.HMAIL_PASS, // don't print password\r\n});\r\n\r\n    const transporter = nodemailer.createTransport({\r\n      host,\r\n      port,\r\n      secure, // true for 465, false for 25/587 (STARTTLS)\r\n      auth: user ? { user, pass } : undefined,\r\n      // If your hMailServer uses self-signed certs during dev:\r\n      tls: { rejectUnauthorized: process.env.HMAIL_TLS_REJECT !== \"false\" }, // set HMAIL_TLS_REJECT=false to allow self-signed in dev\r\n      // Optional: requireTLS: true, // force STARTTLS on ports that support it (587)\r\n    });\r\n\r\n    // Verify connection first to get a clear error if auth fails\r\n    try {\r\n      await transporter.verify(); // throws if auth or connect fails\r\n    } catch (verifyErr: any) {\r\n      console.error(\"SMTP verify failed:\", verifyErr);\r\n      // Provide a helpful message to the client for debugging (do not leak secrets)\r\n      return NextResponse.json(\r\n        { ok: false, message: `SMTP connection failed: ${verifyErr?.message || verifyErr}` },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    const html = `\r\n      <div style=\"font-family: Inter, Arial, sans-serif; color:#0f172a;\">\r\n        <h2>You're invited to join SignalHub</h2>\r\n        <p>Click the link below to accept the invitation. The link expires on ${expiresAt.toUTCString()}.</p>\r\n        <p><a href=\"${inviteLink}\" style=\"display:inline-block;padding:10px 14px;background:#0f172a;color:#fff;border-radius:8px;text-decoration:none;\">Accept invitation</a></p>\r\n      </div>\r\n    `;\r\n\r\n    const mailOptions = {\r\n      from: process.env.INVITE_FROM || `\"SignalHub\" <no-reply@yourdomain.com>`,\r\n      to: email,\r\n      subject: \"You're invited to join as a manager â€” SignalHub\",\r\n      html,\r\n    };\r\n\r\n    // send\r\n    const info = await transporter.sendMail(mailOptions);\r\n    console.log(\"Invite email accepted by SMTP server:\", info);\r\n\r\n    // persist token/expiry in DB (not shown)\r\n\r\n    return NextResponse.json({ ok: true, message: \"Invite sent\", token, expiresAt: expiresAt.toISOString() });\r\n  } catch (err: any) {\r\n    console.error(\"Invite create error:\", err);\r\n    return NextResponse.json({ ok: false, message: err?.message || \"Server error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,uCAAuC;;;;;AACvC;AACA;AACA;;;;AAGA,SAAS,aAAa,KAAa;IACjC,OAAO,6BAA6B,IAAI,CAAC;AAC3C;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,QAAQ,CAAC,MAAM,SAAS,EAAE,EAAE,QAAQ,GAAG,IAAI,GAAG,WAAW;QAC/D,IAAI,CAAC,SAAS,CAAC,aAAa,QAAQ;YAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,yCAAyC;QACzC,MAAM,QAAQ,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC;QAC9C,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK;QAEvD,oBAAoB;QACpB,MAAM,SAAS,6DAAmC;QAClD,MAAM,aAAa,GAAG,OAAO,0BAA0B,EAAE,OAAO;QAEhE,6BAA6B;QAC7B,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI;QACvC,MAAM,OAAO,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI;QAC9C,MAAM,SAAU,QAAQ,GAAG,CAAC,YAAY,KAAK,QAAS,oBAAoB;QAC1E,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI,IAAI,yBAAyB;QACpE,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI,IAAI,yBAAyB;QAEpE,QAAQ,GAAG,CAAC,aAAa;YAC3B,MAAM,QAAQ,GAAG,CAAC,UAAU;YAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU;YAC5B,MAAM,CAAC,CAAC,QAAQ,GAAG,CAAC,UAAU;QAChC;QAEI,MAAM,cAAc,4JAAU,CAAC,eAAe,CAAC;YAC7C;YACA;YACA;YACA,MAAM,OAAO;gBAAE;gBAAM;YAAK,IAAI;YAC9B,yDAAyD;YACzD,KAAK;gBAAE,oBAAoB,QAAQ,GAAG,CAAC,gBAAgB,KAAK;YAAQ;QAEtE;QAEA,6DAA6D;QAC7D,IAAI;YACF,MAAM,YAAY,MAAM,IAAI,kCAAkC;QAChE,EAAE,OAAO,WAAgB;YACvB,QAAQ,KAAK,CAAC,uBAAuB;YACrC,8EAA8E;YAC9E,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,IAAI;gBAAO,SAAS,CAAC,wBAAwB,EAAE,WAAW,WAAW,WAAW;YAAC,GACnF;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,CAAC;;;8EAG4D,EAAE,UAAU,WAAW,GAAG;oBACpF,EAAE,WAAW;;IAE7B,CAAC;QAED,MAAM,cAAc;YAClB,MAAM,QAAQ,GAAG,CAAC,WAAW,IAAI,CAAC,qCAAqC,CAAC;YACxE,IAAI;YACJ,SAAS;YACT;QACF;QAEA,OAAO;QACP,MAAM,OAAO,MAAM,YAAY,QAAQ,CAAC;QACxC,QAAQ,GAAG,CAAC,yCAAyC;QAErD,yCAAyC;QAEzC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,SAAS;YAAe;YAAO,WAAW,UAAU,WAAW;QAAG;IACzG,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,SAAS,KAAK,WAAW;QAAe,GAAG;YAAE,QAAQ;QAAI;IACjG;AACF","debugId":null}}]
}