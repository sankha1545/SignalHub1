{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attack%20Capital/SignalHub/frontend/src/app/api/upload/route.ts"],"sourcesContent":["// src/app/api/upload/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport fs from \"fs\";\r\nimport path from \"path\";\r\n\r\nconst UPLOAD_DIR = path.join(process.cwd(), \"public\", \"uploads\");\r\nconst MAX_BYTES = 2 * 1024 * 1024; // 2 MB\r\n\r\nasync function ensureUploadDir() {\r\n  try {\r\n    await fs.promises.access(UPLOAD_DIR);\r\n  } catch (err) {\r\n    await fs.promises.mkdir(UPLOAD_DIR, { recursive: true });\r\n  }\r\n}\r\n\r\nfunction safeFilename(originalName: string) {\r\n  const ext = path.extname(originalName).slice(0, 20); // keep short\r\n  const base = path.basename(originalName, ext).replace(/[^a-zA-Z0-9-_]/g, \"-\").slice(0, 40);\r\n  const suffix = `${Date.now().toString(36)}-${Math.floor(Math.random() * 1e6).toString(36)}`;\r\n  return `${base}-${suffix}${ext || \".bin\"}`;\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    // Ensure upload dir exists\r\n    await ensureUploadDir();\r\n\r\n    // Read form data from the incoming request\r\n    const formData = await req.formData();\r\n    const file = formData.get(\"file\") as unknown as File | null;\r\n\r\n    if (!file) {\r\n      return NextResponse.json({ ok: false, error: \"No file provided\" }, { status: 400 });\r\n    }\r\n\r\n    // file is a web File object with .name and .size and .stream()/arrayBuffer()\r\n    const name = (file as any).name ?? \"upload.bin\";\r\n    const size = Number((file as any).size ?? 0);\r\n\r\n    if (size > MAX_BYTES) {\r\n      return NextResponse.json({ ok: false, error: \"File too large (max 2 MB)\" }, { status: 413 });\r\n    }\r\n\r\n    // read file bytes\r\n    const arrayBuffer = await (file as any).arrayBuffer();\r\n    const buffer = Buffer.from(arrayBuffer);\r\n\r\n    // generate safe filename and write to public/uploads\r\n    const filename = safeFilename(name);\r\n    const filepath = path.join(UPLOAD_DIR, filename);\r\n    await fs.promises.writeFile(filepath, buffer);\r\n\r\n    // Public URL (served from /uploads/<filename>)\r\n    const origin = process.env.NEXT_PUBLIC_SITE_ORIGIN ?? (process.env.NEXTAUTH_URL ?? \"\");\r\n    // If origin not set, fallback to relative url\r\n    const url = origin ? `${origin.replace(/\\/$/, \"\")}/uploads/${filename}` : `/uploads/${filename}`;\r\n\r\n    return NextResponse.json({ ok: true, url });\r\n  } catch (err: any) {\r\n    console.error(\"upload route error:\", err);\r\n    return NextResponse.json({ ok: false, error: \"Upload failed\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,8BAA8B;;;;;AAC9B;AACA;AACA;;;;AAEA,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU;AACtD,MAAM,YAAY,IAAI,OAAO,MAAM,OAAO;AAE1C,eAAe;IACb,IAAI;QACF,MAAM,wGAAE,CAAC,QAAQ,CAAC,MAAM,CAAC;IAC3B,EAAE,OAAO,KAAK;QACZ,MAAM,wGAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,YAAY;YAAE,WAAW;QAAK;IACxD;AACF;AAEA,SAAS,aAAa,YAAoB;IACxC,MAAM,MAAM,4GAAI,CAAC,OAAO,CAAC,cAAc,KAAK,CAAC,GAAG,KAAK,aAAa;IAClE,MAAM,OAAO,4GAAI,CAAC,QAAQ,CAAC,cAAc,KAAK,OAAO,CAAC,mBAAmB,KAAK,KAAK,CAAC,GAAG;IACvF,MAAM,SAAS,GAAG,KAAK,GAAG,GAAG,QAAQ,CAAC,IAAI,CAAC,EAAE,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,KAAK,QAAQ,CAAC,KAAK;IAC3F,OAAO,GAAG,KAAK,CAAC,EAAE,SAAS,OAAO,QAAQ;AAC5C;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,2BAA2B;QAC3B,MAAM;QAEN,2CAA2C;QAC3C,MAAM,WAAW,MAAM,IAAI,QAAQ;QACnC,MAAM,OAAO,SAAS,GAAG,CAAC;QAE1B,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,6EAA6E;QAC7E,MAAM,OAAO,AAAC,KAAa,IAAI,IAAI;QACnC,MAAM,OAAO,OAAO,AAAC,KAAa,IAAI,IAAI;QAE1C,IAAI,OAAO,WAAW;YACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QAEA,kBAAkB;QAClB,MAAM,cAAc,MAAM,AAAC,KAAa,WAAW;QACnD,MAAM,SAAS,OAAO,IAAI,CAAC;QAE3B,qDAAqD;QACrD,MAAM,WAAW,aAAa;QAC9B,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,YAAY;QACvC,MAAM,wGAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,UAAU;QAEtC,+CAA+C;QAC/C,MAAM,SAAS,QAAQ,GAAG,CAAC,uBAAuB,IAAK,QAAQ,GAAG,CAAC,YAAY,IAAI;QACnF,8CAA8C;QAC9C,MAAM,MAAM,SAAS,GAAG,OAAO,OAAO,CAAC,OAAO,IAAI,SAAS,EAAE,UAAU,GAAG,CAAC,SAAS,EAAE,UAAU;QAEhG,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM;QAAI;IAC3C,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAgB,GAAG;YAAE,QAAQ;QAAI;IAChF;AACF","debugId":null}}]
}